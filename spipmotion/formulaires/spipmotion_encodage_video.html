<div id="encodage_#VALEUR" class="spipmotion_profil">
<h4><:spipmotion:profil_encodage{format=#ENV{valeur}}:></h4>
<ul>
	[(#SAISIE{input,width_#ENV{valeur},
		label=<:spipmotion:width_video:>,
		defaut=480,
		size=4})]

	[(#SAISIE{input,height_#ENV{valeur},
		label=<:spipmotion:height_video:>,
		defaut=320,
		size=4})]

	[(#SAISIE{input,bitrate_#ENV{valeur},
		label=<:spipmotion:bitrate:>,
		defaut=418,
		size=4})]

	[(#SAISIE{input,fps_#ENV{valeur},
		label=<:spipmotion:framerate:>,
		explication=<:spipmotion:explication_framerate:>,
		size=4})]

	#SET{acodecs_possibles,#ARRAY}
	#SET{vcodecs_possibles,#ARRAY}
	#SET{vorbis,''}
	#SET{formats_possibles,#ARRAY}
	#SET{presets_qualite,#ARRAY}
	<BOUCLE_ogg(CONDITION){si #ENV{valeur}|in_array{#ARRAY|push{ogg}|push{ogv}|push{webm}}|oui}>
		[(#ENV{valeur}|=={webm}|non)
			[(#CONFIG{spipmotion_ffmpeg2theora/version}|>{0}|oui)
				[(#SAISIE{selection,encodeur_#ENV{valeur},
					label=<:spipmotion:label_encodeur:>,
					explication=<:spipmotion:explication_encodeur:>,
					defaut=ffmpeg2theora,
					cacher_option_intro=oui,
					datas=#ARRAY{
						ffmpeg2theora,ffmpeg2theora,
						ffmpeg,ffmpeg}})]
				[(#SAISIE{selection,qualite_video_ffmpeg2theora_#ENV{valeur},
					label=<:spipmotion:label_qualite_video_ffmpeg2theora:>,
					explication=<:spipmotion:explication_qualite_video_ffmpeg2theora:>,
					defaut=7,
					cacher_option_intro=oui,
					datas=#ARRAY{
						0,0,
						1,1,
						2,2,
						3,3,
						4,4,
						5,5,
						6,6,
						7,7,
						8,8,
						9,9,
						10,10}})]
			]
			#SET{vcodecs_possibles,#ARRAY|push{libtheora}|push{libdirac}}
		]
		#SET{acodecs_possibles,#ARRAY|push{vorbis}|push{libvorbis}}
		#SET{vorbis,oui}
		#SET{2_passes,oui}
	</BOUCLE_ogg>
	<BOUCLE_flv(CONDITION){si #ENV{valeur}|=={flv}|oui}>
		[(#REM)
			Voir http://en.wikipedia.org/wiki/Flv#Codec_support
			On ne met pas adpcm car il n'est pas compatible avec le H264
			et ca évite trop de tests
		]
		#SET{acodecs_possibles,#ARRAY|push{libmp3lame}|push{libfaac}|push{libspeex}}
		#SET{vcodecs_possibles,#ARRAY|push{flv}|push{libx264}}
		#SET{presets_qualite,#ARRAY|push{normal}|push{medium}|push{placebo}|push{superfast}|push{faster}|push{fast}|push{slow}|push{slower}}
		#SET{2_passes,oui}
	</BOUCLE_flv>
	<BOUCLE_mp4(CONDITION){si #ENV{valeur}|in_array{#ARRAY|push{mov}|push{mp4}|push{m4v}}|oui}>
		#SET{acodecs_possibles,#ARRAY|push{libfaac}|push{libmp3lame}}
		#SET{vcodecs_possibles,#ARRAY|push{libx264}|push{libxvid}|push{mpeg4}}
		#SET{formats_possibles,#ARRAY|push{ipod}|push{psp}|push{mp4}|push{m4v}}
		#SET{presets_qualite,#ARRAY|push{normal}|push{medium}|push{placebo}|push{superfast}|push{faster}|push{fast}|push{slow}|push{slower}}
		#SET{2_passes,oui}
	</BOUCLE_mp4>
	<//B_flv>
	<//B_ogg>

	[(#REM)
		On récupère les codecs disponibles dans FFMPEG que l'on a mis dans les métas
	]
	#SET{acodecs_existants,#EVAL{$GLOBALS['meta']['spipmotion_codecs_audio_encode']}}
	#SET{vcodecs_existants,#EVAL{$GLOBALS['meta']['spipmotion_codecs_video_encode']}}

	[(#REM)
		On récupère l'intersection des codecs disponibles avec les codecs possibles
	]
	#SET{acodecs,#GET{acodecs_possibles,#ARRAY}|array_intersect{#GET{acodecs_existants,#ARRAY}|unserialize}}
	#SET{vcodecs,#GET{vcodecs_possibles,#ARRAY}|array_intersect{#GET{vcodecs_existants,#ARRAY}|unserialize}}
	#SET{acodec_defaut,#GET{acodec}|table_valeur{0}}
	#SET{vcodec_defaut,#GET{vcodec}|table_valeur{0}}

	[(#GET{vcodecs}|count|>{0}|oui)
		[(#GET{formats_possibles}|count|>{0}|oui)
			[(#SAISIE{selection_valeur,format_#ENV{valeur},
				label=<:spipmotion:label_format_final:>,
				defaut=ipod,
				cacher_option_intro=oui,
				datas=#GET{formats_possibles}})]
		]
		[(#SAISIE{selection_valeur,vcodec_#ENV{valeur},
			label=<:spipmotion:label_codec_video:>,
			cacher_option_intro=oui,
			defaut=#GET{vcodec_defaut},
			datas=#GET{vcodecs}})]
		[(#GET{presets_qualite}|count|>{0}|oui)
			[(#SAISIE{selection_valeur,vpreset_#ENV{valeur},
				label=<:spipmotion:label_presets_qualite:>,
				explication=<:spipmotion:explication_presets_qualite:>,
				cacher_option_intro=oui,
				datas=#GET{presets_qualite}})]
		]
	]

	[(#GET{2_passes}|=={oui}|oui)
		[(#SAISIE{selection,passes_#ENV{valeur},
			label=<:spipmotion:label_passes_encodage:>,
			cacher_option_intro=oui,
			datas=#ARRAY{1,<:spipmotion:label_passes_1_encodage:>,2,<:spipmotion:label_passes_2_encodage:>}})]
	]

	[(#GET{acodecs}|count|>{0}|oui)
		[(#SAISIE{selection_valeur,acodec_#ENV{valeur},
			label=<:spipmotion:label_codec_son:>,
			cacher_option_intro=oui,
			defaut=#GET{acodec_defaut},
			datas=#GET{acodecs}})]

		[(#SAISIE{selection,frequence_audio_#ENV{valeur},
			label=<:spipmotion:frequence_audio:>,
			defaut=22050,
			cacher_option_intro=oui,
			datas=#ARRAY{
				11025,11025 Hz,
				22050,22050 Hz,
				44100,44100 Hz,
				48000,48000 Hz}})]

		[(#REM)explication=<:spipmotion:explication_vorbis_qualite:>,]
		[(#GET{vorbis}|=={oui}|oui)
			[(#SAISIE{selection,qualite_audio_#ENV{valeur},
			label=<:spipmotion:label_vorbis_qualite:>,
			defaut=4,
			cacher_option_intro=oui,
			datas=#ARRAY{
				-1,-1,
				0,0,
				1,1,
				2,2,
				3,3,
				4,4,
				5,5,
				6,6,
				7,7,
				8,8,
				9,9,
				10,10
			}})]
		]
		[(#GET{vorbis}|=={oui}|non)
			[(#SAISIE{selection,bitrate_audio_#ENV{valeur},
				label=<:spipmotion:bitrate_audio:>,
				defaut=64,
				cacher_option_intro=oui,
				datas=#ARRAY{
					32,32 kbps,
					64,64 kbps,
					96,96 kbps,
					128,128 kbps,
					192,192 kbps,
					256,256 kbps}})]
		]
	]
</ul>
</div>