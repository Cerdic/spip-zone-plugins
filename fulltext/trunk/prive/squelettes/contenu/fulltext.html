[(#AUTORISER{configurer,fulltext}|sinon_interdire_acces)]

<h1 class="grostitre"><:fulltext:titre_page_fulltext_index:></h1>

#BOITE_OUVRIR{'',box important,#CHEMIN{images/fulltext-24.png}}

#SET{tables,#REM|liste_des_champs}
#SET{nombre,0}
#SET{myisam_nombre,0}
[(#ENV{creer}|=={tous}|oui)
	[(#GET{tables}|Fulltext_creer_tous)]
]
<BOUCLE_tables(DATA){source table, #GET{tables}}{par cle}>#SET{table,#CLE}
<h3>[(#GET{table})][ ((#GET{table}|compter_elements))]</h3>#SET{ok,non}
[(#SET{engine,[(#GET{table}|Fulltext_trouver_engine_table)]})]
[(#GET{engine}|=={''}|ou{[(#GET{engine}|strtolower|!={myisam})]}|oui)
	[(#ENV{myisam}|=={#GET{table}}|ou{#ENV{myisam}|=={tout}}|oui)
		[(#GET{table}|Fulltext_conversion_myisam)]#SET{ok,ok}
	]
	[(#GET{ok}|!={ok}|et{#GET{engine}|!={''}}|oui) #SET{ok,ok}
		#SET{myisam_nombre,#GET{myisam_nombre}|plus{1}}
		<p><:fulltext:table_format:> #GET{engine}; <:fulltext:il_faut_myisam:></p>
		<p><a href="[(#SELF|parametre_url{myisam,[(#CLE|table_objet)]})]"><:fulltext:convertir_myisam:></a></p>
	]
	[(#GET{ok}|!={ok}|oui)
		<p><:fulltext:table_non_reconnue:></p>
	]
]
#SET{regexp,^[a-z_0-9]+$}
<BOUCLE_siok(CONDITION){si #GET{engine}|=={''}|ou{#GET{engine}|strtolower|!={myisam}}|non}>
	[(#ENV{table,''}|=={#GET{table}}|et{#ENV{nom,''}|!={""}}|et{#ENV{nom,''}|concat{#GET{table}}|match{#GET{regexp}}}|oui)
		[(#GET{table}|Fulltext_creer_index{#ENV{nom},[(#VALEUR|array_keys)]})]
	]
	[(#ENV{regenerer}|=={#GET{table}}|ou{#ENV{regenerer}|=={tous}}|oui)
		[(#GET{table}|Fulltext_regenerer_index)]
	]
	[(#ENV{reinitialise}|=={#GET{table}}|ou{#ENV{reinitialise}|=={tous}}|oui)
		[(#REM|Fulltext_reinitialiser_document)]
	]
	[(#ENV{reinitialise}|=={document_tout}|oui)
		[(#REM|Fulltext_reinitialiser_totalement_document)]
	]
	[(#ENV{reinitialise}|=={document_ptg}|oui)
		[(#REM|Fulltext_reinitialiser_document_ptg)]
	]
	#SET{cles,#GET{table}|fulltext_keys}
	
	<BOUCLE_sicles(CONDITION){si #GET{cles}|count|>{0}}>
		<dl>
			<BOUCLE_liste_cles(DATA){source table,#GET{cles}}>
			<dt>
				#CLE <a href="[(#SELF|parametre_url{supprimer,#GET{table}}|parametre_url{index,#CLE})]" title="<:fulltext:supprimer:>">
				[(#CHEMIN{images/croix-rouge.gif}|balise_img{<:fulltext:supprimer:>})]</a>
				[(#ENV{supprimer}|=={#GET{table}}|et{#ENV{index}|=={#CLE}}|oui)
					[(#GET{table}|Fulltext_supprimer_index{#CLE})]
				]
			</dt>
			<dd>#VALEUR</dd>
			</BOUCLE_liste_cles>
		</dl>
	</BOUCLE_sicles>
	</B_sicles>
		[(#ENV{creer}|=={tous}|oui)
			<p><:fulltext:pas_index:></p
		]
	<//B_sicles>

	#SET{cles,#GET{table}|fulltext_keys}
	#SET{champs,#VALEUR|array_keys}
	#SET{champs2,#VALEUR|spip_asort|array_keys}
	#SET{champ_titre,#GET{champs2}|array_pop}
	
	[(#GET{cles}|table_valeur{#GET{champ_titre}}|non)
		[(#GET{table}|Fulltext_lien_creer_index{#GET{champs}, #GET{champ_titre}})]
		#SET{nombre,#GET{nombre}|plus{1}}
	]
	[(#GET{cles}|table_valeur{tout}|non)
		[(#GET{table}|Fulltext_lien_creer_index{#GET{champs}, tout})]
		#SET{nombre,#GET{nombre}|plus{1}}
	]
</BOUCLE_siok>
</BOUCLE_tables>

[(#GET{nombre}|>{0}|et{#ENV{creer}|!={tous}}|oui)
	<p><strong><a href='[(#SELF|parametre_url{creer,tous})]'><:fulltext:creer_tous:></a></strong></p>
]

[(#GET{myisam_nombre}|>{0}|oui)
	<p><strong><a href='[(#SELF|parametre_url{myisam,tous})]'><:fulltext:convertir_toutes:></a></strong></p>	
]

[(#REM|verifier_conversion)]
#BOITE_FERMER