#CACHE{0}
<BOUCLE_article_principal(DOCUMENTS) {id_document}{tout}><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html dir="#LANG_DIR" lang="#LANG">
<head>
<title>[(#TITRE|supprimer_numero|sinon{[(#FICHIER|basename)]}|textebrut) - ][(#NOM_SITE_SPIP|textebrut)]</title>
[<meta name="description" content="(#DESCRIPTIF|couper{150}|texte_backend|textebrut)" />]
<INCLURE{fond=inc-head}>

<script type="text/javascript" src="#URL_PAGE{photospip.js}"></script>

<link rel="stylesheet" href="#URL_PAGE{photospip.css}" type="text/css" media="print, projection, screen" />
</head>

<body class="page_article">
<div id="page">
	<INCLURE{fond=inc-entete}>
		
		<script type="text/javascript"><!--
			[(#REM)
				Calcul du ratio entre notre image originale et la prévisualisation
				Utile pour les opération de recadrage notamment
			]
			#SET{largeur_max,#CONFIG{photospip/largeur_previsu,450}}
			#SET{hauteur_max,#CONFIG{photospip/hauteur_previsu,450}}
			[(#SET{largeur_reduit,[(#FICHIER|image_reduire{#GET{largeur_max},#GET{hauteur_max}}|extraire_attribut{width})]})]
			#SET{ratio,#LARGEUR|div{#GET{largeur_reduit}}}
			
			// Fonction que l'on réalise lorsque l'on submit un des formulaire de modification
			var onsubmit_modif = function(id){
				//jQuery('.previsu_texte').hide();
				jQuery('input[name=valider]').attr({disabled:"disabled"}).css(
					'opacity',0.2
				);
				[(#CONFIG{photospip/image_recadre,oui}|oui)
				image_crop_close();]
				jQuery('#image-container').append('<div class="waiting"><h2>Modification de votre image...<\/h2><p>Veuillez patienter que cela soit termin&eacute;<\/p><\/div>');
				jQuery('#image-container').positionner(true);
			}
		
			// Callback après le submit des formulaire de modification
			var aftersubmit_modif = function(){
				jQuery('.validation').load('[(#URL_PAGE{inc-validation}|parametre_url{id_document,#ID_DOCUMENT,"&"})]');
			}
		
			[(#CONFIG{photospip/image_recadre,oui}|oui)
				var $x1, $y1, $x2, $y2, $w, $h;
				function crop_selectchange(img, selection){
					// Le ratio est la relation entre notre image normale et la prévisualisation
					var ratio = parseFloat([(#GET{ratio})]);
					$x1.val(parseFloat(selection.x1*ratio).toFixed(0));
					$y1.val(parseFloat(selection.y1*ratio).toFixed(0));
					$x2.val(parseFloat(selection.x2*ratio).toFixed(0));
					$y2.val(parseFloat(selection.y2*ratio).toFixed(0));
					$w.val(parseFloat(selection.width*ratio).toFixed(0));
					$h.val(parseFloat(selection.height*ratio).toFixed(0));
				}
				
				jQuery(document).ready(function () {
					$x1 = jQuery('#recadre_x1');
					$x1.change(function(){
						jQuery('#image_modifier img').imgAreaSelect({x1:20,y1:20,x2:70,y2:70,width:50,height:50,onSelectChange: crop_selectchange,show:true});
					});
					$y1 = jQuery('#recadre_y1');
					$x2 = jQuery('#recadre_x2');
					$y2 = jQuery('#recadre_y2');
					$w = jQuery('#recadre_width');
					$h = jQuery('#recadre_height');
				});
			
				var image_crop = function(){
					jQuery('#image_modifier img').imgAreaSelect(
						{x1:10, y1:10,x2:50,y2:50,width:40,height:40,onSelectChange: crop_selectchange,show:true}
					);
				}
				
				var image_crop_close = function(){
					jQuery('#image_modifier img').imgAreaSelect({hide:true});
				}
			]
			
			var activatesliders = function(){
				jQuery('#sliderrotation').slider({
					min: -180,
					max: 180,
					startValue : 45,
					change: function(e, ui){
						jQuery(this).parent().find('input').val(ui.value.toFixed(0));
					}
				});
				jQuery('#slidergamma').slider({
					min: -254,
					max: 254,
					startValue : 10,
					change: function(e, ui){
						jQuery(this).parent().find('input').val(ui.value.toFixed(0));
					}
				});
				jQuery('#param_image_gamma').val('10');
				jQuery('#sliderflou').slider({
					min: 1,
					max: 11,
					startValue : 3,
					change: function(e, ui){
						jQuery(this).parent().find('input').val(ui.value.toFixed(0));
					}
				});
				jQuery('#param_image_flou').val('3');
			}
			
			var load = function(){
			  	jQuery('.picker').css('opacity', 0.25);
		
			  	var selected;
			  	jQuery('.colorwell').each(function(){
			  		var pick = jQuery(this).parent().children('.picker');
			  		jQuery.farbtastic(pick).linkTo(this);
			  		jQuery(this).css('opacity', 0.75);
			  	}).focus(function(){
			  		if (selected) {
			  			jQuery(selected).css('opacity', 0.75).removeClass('colorwell-selected');
			  		}
			  		var pick = jQuery(this).parent().children('.picker');
			  		jQuery.farbtastic(pick).linkTo(this);
			  		pick.css('opacity', 1);
			  		jQuery(selected = this).css('opacity', 1).addClass('colorwell-selected');
			  	}).blur(function(){
			  		var pick = jQuery(this).parent().children('.picker');
			  		pick.css('opacity', 0.25);
			  		jQuery(selected = this).css('opacity', 0.75).removeClass('colorwell-selected');
			  	});
			  	jQuery('.version').hover(function(){
					jQuery(this).find('label img').fadeTo('fast',.1,function(){
						jQuery(this).parent().parent().find('input').attr({
			  				checked: "checked"
				  		});
				  		jQuery(this).parent().parent().find('.revenir_version, .delete_version').show();	
					});	
			  	},function(){
					jQuery(this).find('label img').fadeTo('fast',1,function(){
						jQuery(this).parent().parent().find('.revenir_version, .delete_version').hide();
					});	
			  	});
				[(#CONFIG{photospip/image_recadre}|oui)
				if(jQuery('#image_recadre').is(':checked')){
					image_crop();
				}]
				jQuery('form input[type=radio]').not('.nocache').unbind().click(function(){
					if(jQuery(this).next().next('div').is(':hidden')){
				  		jQuery(".visible").slideUp().removeClass('visible')
						jQuery(this).parent().find('.cache').slideDown().addClass('visible');
						activatesliders();
						[(#CONFIG{photospip/image_recadre,oui}|oui)
						if(jQuery(this).attr('id') == 'image_recadre'){
							image_crop();
						}
						else{	
							image_crop_close();
						}]
					}
			  	});
			  	jQuery('#versions input[type=radio]').css("display", "none");
			  }
			jQuery(document).ready(function() {
				jQuery('.validation').load('[(#URL_PAGE{inc-validation}|parametre_url{id_document,#ID_DOCUMENT,"&"})]');
				activatesliders();
				load();
				jQuery('#container-1').tabs();
				jQuery('.cache').hide();
				jQuery('.image_recadre input[type=radio]').click(function(){
					if (jQuery(this).val() != ''){
						jQuery('#image_modifier img').imgAreaSelect({aspectRatio: jQuery(this).val()});
					}
					else{
						jQuery('#image_modifier img').imgAreaSelect({aspectRatio: ''});
					}
				});
			});
			onAjaxLoad(load);
			// -->
			</script>
		<div id="modifier_image">
			<div id="image-container">
				<INCLURE{fond=fragment_photospip}{id_document}{largeur_max=#GET{largeur_max}}{hauteur_max=#GET{hauteur_max}}>
			</div>
	
				[(#SET{photospip,pasok})]
				<BOUCLE_interd(DOCUMENTS_INTERS){id_document}> </BOUCLE_interd>
				[(#TOTAL_BOUCLE|>={#CONFIG{photospip/limite_version}}|?{#SET{photospip,ok},#SET{photospip,pasok}})]
				<//B_interd>
				<div class="nettoyeur"></div>
			[(#AUTORISER{'modifier','document',#ID_DOCUMENT})
			<div>
			<div id="container-1">
				<ul>
					<li><a href="#fragment-format"><span><:photospip:filtres_format:></span></a></li>
					<li><a href="#fragment-couleurs"><span><:photospip:filtres_de_couleur:></span></a></li>
					[(#PLUGIN{fonctions_images}|oui)
					[(#CONFIG{photospip/image_niveau_de_gris_auto}|oui)#SET{fonctions_images,ok}]
					[(#CONFIG{photospip/image_sincity}|oui)#SET{fonctions_images,ok}]
					[(#CONFIG{photospip/image_saturation_desaturation_text}|oui)#SET{fonctions_images,ok}]
					[(#GET{fonctions_images}|=={ok}|oui)
					<li><a href="#fragment-sup"><span><:photospip:filtres_supplementaires:></span></a></li>]]
				</ul>
				<div id="fragment-format">
					<div class="help">
						<h4><:photospip:titre_aide:></h4>
						<div class="infos">
							<:photospip:texte_aide:>
						</div>
					</div>
					<h3><:photospip:filtres_format:></h3>
					<form id="photospip1" onsubmit="onsubmit_modif();return AjaxSqueeze(this,'image-container',aftersubmit_modif,event)" method="post" action="[(#URL_ACTION_AUTEUR{photospip,#ID_DOCUMENT})]">
						<ul>
							[(#CONFIG{photospip/tourner,oui}|oui)
							<li>
								<input type="radio" name="filtre" id="tourner" value="tourner" />
								<label for="tourner">[<img src="(#CHEMIN{images/photospip-ico/ico_rotation.png})" alt="<:photospip:tourner:>" />&nbsp;&nbsp;]<:photospip:tourner:></label>
								<div class="cache params_filtre">
									<:photospip:tourner_text:><br />
									<input type="radio" name="params_tourner" class="nocache" value="90" id="param_tourner_90" />
									<label for="param_tourner_90" class="nocache"><:photospip:tourner_90:></label><br />
									<input type="radio" name="params_tourner" class="nocache" value="180" id="param_tourner_180" />
									<label for="param_tourner_180" class="nocache"><:photospip:tourner_180:></label><br />
									<input type="radio" name="params_tourner" class="nocache" value="270" id="param_tourner_270" />
									<label for="param_tourner_270" class="nocache"><:photospip:tourner_270:></label>
									<br />
								</div>
							</li>]
							[(#CONFIG{photospip/image_flip_vertical}|oui)
							<li>
								<input type="radio" name="filtre" id="image_flip_vertical" value="image_flip_vertical" />
								<label for="image_flip_vertical">[<img src="(#CHEMIN{images/photospip-ico/ico_flip_vertical.png})" alt="<:photospip:image_flip_vertical:>" />&nbsp;&nbsp;]<:photospip:image_flip_vertical:></label>
								<div class="cache params_filtre">
									<:photospip:image_flip_vertical_text:>
								</div>
							</li>]
							[(#CONFIG{photospip/image_flip_horizontal}|oui)
							<li>
								<input type="radio" name="filtre" id="image_flip_horizontal" value="image_flip_horizontal" />
								<label for="image_flip_horizontal">[<img src="(#CHEMIN{images/photospip-ico/ico_flip_horizontal.png})" alt="<:photospip:image_flip_horizontal:>" />&nbsp;&nbsp;]<:photospip:image_flip_horizontal:></label>
								<div class="cache params_filtre">
									<:photospip:image_flip_horizontal_text:>
								</div>
							</li>]
							[(#CONFIG{photospip/image_rotation}|oui)
							<li>
								<input type="radio" name="filtre" id="image_rotation" value="image_rotation" />
								<label for="image_rotation">[<img src="(#CHEMIN{images/photospip-ico/ico_rotation.png})" alt="<:photospip:image_rotation:>" />&nbsp;&nbsp;]<:photospip:image_rotation:></label>`
								<div class="cache params_filtre">
									<:photospip:image_rotation_text:>
									<div id='sliderrotation' class='ui-slider-1 ui-slider' style="margin: 10px 40px;">
										<div class='ui-slider-handle'></div>	
									</div>
									<label for="param_image_rotation"><:photospip:angle_rotation:></label>&nbsp;
									<input type="text" class="texte" name="params_image_rotation" style="width:60px;display:inline" id="param_image_rotation" value="45" maxlength="4" />
									<br class="nettoyeur" />
								</div>
							</li>]
							[(#CONFIG{photospip/image_recadre,oui}|oui)
							<li>
								<input type="radio" name="filtre" id="image_recadre" value="image_recadre" />
								<label for="image_recadre">[<img src="(#CHEMIN{images/photospip-ico/ico_rotation.png})" alt="<:photospip:image_recadre:>" />&nbsp;&nbsp;]<:photospip:image_recadre:></label>
								<div class="cache params_filtre image_recadre">
									<:photospip:image_recadre_text:>
									<p><:photospip:image_taille_actuelle:> #LARGEUR x #HAUTEUR px</p>
									<p><strong><:photospip:ratio:></strong></p>
									<p><label for="ratio"><:photospip:ratio_libre:></label>
									<input type="radio" class="nocache" id="ratio" name="ratio" value="" /><br />
									<label for="ratio1">1:1 :</label>
									<input type="radio" class="nocache" id="ratio1" name="ratio" value="1:1" /><br />
									<label for="ratio2">4:3 :</label>
									<input type="radio" class="nocache" id="ratio2" name="ratio" value="4:3" /></p>
									<label for="recadre_width"><:photospip:recadre_width:></label>
									<input type="text" class="texte" id="recadre_width" name="recadre_width" style="width:60px;display:inline" value="" readonly="readonly" /><br />
									<label for="recadre_height"><:photospip:recadre_height:></label>
									<input type="text" class="texte" id="recadre_height" name="recadre_height" style="width:60px;display:inline" value="" readonly="readonly" /><br />
									<p><:photospip:recadre_x1_y1:></p>
									<label for="recadre_x1">x</label>
									<input type="text" class="texte" id="recadre_x1" name="recadre_x1" style="width:60px;display:inline" value="" readonly="readonly" />
									<label for="recadre_y1">y</label>
									<input type="text" class="texte" id="recadre_y1" name="recadre_y1" style="width:60px;display:inline" value="" readonly="readonly" /><br />
									<p><:photospip:recadre_x2_y2:></p>
									<label for="recadre_x2">x</label>
									<input type="text" class="texte" id="recadre_x2" name="recadre_x2" style="width:60px;display:inline" value="" readonly="readonly" />
									<label for="recadre_y2">y</label>
									<input type="text" class="texte" id="recadre_y2" name="recadre_y2" style="width:60px;display:inline" value="" readonly="readonly" /><br />
									<br class="nettoyeur" />
								</div>
							</li>]
						</ul>
						<div class="clear">
							<input type="hidden" name="redirect" value="[(#SELF)]" />
							<input type="hidden" name="redirect_ajax" value="[(#URL_PAGE{fragment_photospip}|parametre_url{id_document,#ID_DOCUMENT})]" />
							<div class="boutons validation" >
								<p>
									<input type="radio" name="validation" class="nocache" value="tester" id="tester1" checked="checked" /><label for="tester1" class="nocache">[<img src="(#CHEMIN{images/photospip-ico/ico_tester.png})" alt="<:photospip:tester:>" /> ]<:photospip:tester:></label><br />
									[(#GET{photospip}|=={pasok}|?{<input type="radio" name="validation" class="nocache" value="appliquer" id="appliquer1" /><label for="appliquer1" class="nocache">[<img src="(#CHEMIN{images/photospip-ico/ico_appliquer.png})" alt="<:photospip:valider:>" /> ]<:photospip:valider:></label>,<span class="warning"><:photospip:nb_versions_depasse:></span><br />})]
								</p>
								<p class="boutons">
									<input type="submit" class="submit" name="valider" value="<:photospip:valider:>" />
								</p>
							</div>
							<br class="nettoyeur" />
						</div>
					</form>
				</div>
				<div id="fragment-couleurs">
					<div class="help">
						<h4><:photospip:titre_aide:></h4>
						<div class="infos">
							<:photospip:texte_aide:>
						</div>
					</div>
					<h3><:photospip:filtres_de_couleur:></h3>
						<form id="photospip2" onsubmit="onsubmit_modif();return AjaxSqueeze(this,'image-container',aftersubmit_modif,event)" method="post" enctype="multipart/form-data" action="[(#URL_ACTION_AUTEUR{photospip,#ID_DOCUMENT})]">
						<ul>
							[(#CONFIG{photospip/image_nb,oui}|oui)
							<li>
								<input type="radio" name="filtre" id="filtre_nb" value="image_nb" />
								<label for="filtre_nb">[<img src="(#CHEMIN{images/photospip-ico/ico_nb.png})" alt="<:photospip:image_nb:>" />&nbsp;&nbsp;]<:photospip:image_nb:></label>
								<div class="cache params_filtre">
									<:photospip:image_nb_text:>
								</div>
							</li>]
							[(#CONFIG{photospip/image_gamma}|oui)
							<li>
								<input type="radio" name="filtre" id="filtre_gamma" value="image_gamma" />
								<label for="filtre_gamma"><:photospip:image_gamma:></label>
								<div class="cache params_filtre">
									<:photospip:image_gamma_text:>
									<div id='slidergamma' class='ui-slider-1' style="margin: 10px 40px;">
										<div class='ui-slider-handle'></div>	
									</div>
									<label for="param_image_gamma"><:photospip:niveau_gamma:></label>&nbsp;
									<input type="text" class="texte" name="params_image_gamma" style="width:60px;display:inline" id="param_image_gamma" value="6" maxlength="4" />
									<br class="nettoyeur" />
								</div>
							</li>]
							[(#CONFIG{photospip/image_flou}|oui)
							<li>
								<input type="radio" name="filtre" id="filtre_flou" value="image_flou" />
								<label for="filtre_flou"><:photospip:image_flou:></label>
								<div class="cache params_filtre">
									<:photospip:image_flou_text:>
									<div id='sliderflou' class='ui-slider-1' style="margin: 10px 40px;">
										<div class='ui-slider-handle'></div>	
									</div>
									<label for="param_image_flou"><:photospip:niveau_flou:></label>&nbsp;
									<input type="text" class="texte" name="params_image_flou" style="width:60px;display:inline" id="param_image_flou" value="3" maxlength="2" />
									<br class="nettoyeur" />
								</div>
							</li>]
							[(#CONFIG{photospip/image_sepia}|oui)
							<li>
								<input type="radio" name="filtre" id="filtre_sepia" value="image_sepia" />
								<label for="filtre_sepia">[<img src="(#CHEMIN{images/photospip-ico/ico_sepia.png})" alt="<:photospip:image_sepia:>" />&nbsp;&nbsp;]<:photospip:image_sepia:></label>
								<div class="cache params_filtre">
									<label for="param_image_sepia"><:photospip:couleur_sepia:></label>&nbsp;
									<input type="text" name="params_image_sepia" class="colorwell texte" style="width:100px;display:inline" id="param_image_sepia" value="#896f5e" maxlength="7" />
									<span class="picker" style="float:right;padding:3px">&nbsp;</span>
									<br class="nettoyeur" />
								</div>
							</li>]
						</ul>
						<div class="clear">
							<input type="hidden" name="redirect" value="[(#SELF)]" />
							<input type="hidden" name="redirect_ajax" value="[(#URL_PAGE{fragment_photospip}|parametre_url{id_document,#ID_DOCUMENT})]" />
							<div class="boutons validation" >
								<p>
									<input type="radio" name="validation" class="nocache" value="tester" id="tester2" checked="checked" /><label for="tester2" class="nocache">[<img src="(#CHEMIN{images/photospip-ico/ico_tester.png})" alt="<:photospip:tester:>" /> ]<:photospip:tester:></label><br />
									[(#GET{photospip}|=={pasok}|?{<input type="radio" name="validation" class="nocache" value="appliquer" id="appliquer2" /><label for="appliquer2" class="nocache">[<img src="(#CHEMIN{images/photospip-ico/ico_appliquer.png})" alt="<:photospip:valider:>" /> ]<:photospip:valider:></label>,<span class="warning"><:photospip:nb_versions_depasse:></span><br />})]
								</p>
								<p>
									<input type="submit" class="submit" name="valider" value="<:photospip:valider:>" />
								</p>
							</div>
							<br class="nettoyeur" />
						</div>
					</form>
				</div>

				[(#GET{fonctions_images}|=={ok}|oui)
				<div id="fragment-sup">
					<div class="help">
						<h4><:photospip:titre_aide:></h4>
						<div class="infos">
							<:photospip:texte_aide:>
						</div>
					</div>
					<h3><:photospip:filtres_supplementaires:></h3>
					<form id="photospip3" onsubmit="onsubmit_modif();return AjaxSqueeze(this,'image-container',aftersubmit_modif,event)" method="post" action="[(#URL_ACTION_AUTEUR{photospip,#ID_DOCUMENT})]">
					<ul>
						[(#CONFIG{photospip/image_niveau_de_gris_auto}|oui)
						<li>
							<input type="radio" name="filtre" id="filtre_niveaux_auto" value="image_niveaux_gris_auto" />
							<label for="filtre_niveaux_auto"><:photospip:image_niveau_de_gris_auto:></label>
							<div class="cache params_filtre explications">
								<:photospip:image_niveau_de_gris_auto_text:>
							</div>
						</li>]
						[(#CONFIG{photospip/image_sincity}|oui)
						<li>
							<input type="radio" name="filtre" id="filtre_sincity" value="image_sincity" />
							<label for="filtre_sincity"><:photospip:image_sincity:></label>
							<div class="cache params_filtre explications">
								<:photospip:image_sincity_text:>
							</div>
						</li>]
						[(#CONFIG{photospip/image_saturation_desaturation_text}|oui)
						<li>
							<input type="radio" name="filtre" id="filtre_saturer" value="image_saturer" />
							<label for="filtre_saturer"><:photospip:image_saturation_desaturation:></label>
							<div class="cache params_filtre explications">
								<:photospip:image_saturation_desaturation_text:>
								<div id='slidersaturer' class='ui-slider-1' style="margin: 10px 40px;">
									<div class='ui-slider-handle'></div>	
								</div>
								<label for="param_image_saturer"><:photospip:niveau_saturation_desaturation:></label>&nbsp;
								<input type="text" class="texte" name="params_image_saturer" style="width:60px;display:inline" id="param_image_saturer" value="1" maxlength="3" />
								<br class="nettoyeur" />
							</div>
						</li>]
					</ul>
					<div class="clear">
						<input type="hidden" name="redirect" value="[(#SELF)]" />
						<input type="hidden" name="redirect_ajax" value="[(#URL_PAGE{fragment_photospip}|parametre_url{id_document,#ID_DOCUMENT})]" />
						<div class="boutons validation">
							<p>
								<input type="radio" name="validation" class="nocache" value="tester" id="tester3" checked="checked" /><label for="tester3" class="nocache">[<img src="(#CHEMIN{images/photospip-ico/ico_tester.png})" alt="<:photospip:tester:>" /> ]<:photospip:tester:></label><br />
								[(#GET{photospip}|=={pasok}|?{<input type="radio" name="validation" class="nocache" value="appliquer" id="appliquer3" /><label for="appliquer3" class="nocache">[<img src="(#CHEMIN{images/photospip-ico/ico_appliquer.png})" alt="<:photospip:valider:>" /> ]<:photospip:valider:></label>,<span class="warning"><:photospip:nb_versions_depasse:></span>})]
							</p>
							<p>
								<input type="submit" class="submit" name="valider" value="<:photospip:valider:>" /> 
							</p>
						</div>
						<br class="nettoyeur" />
					</div>
					</form>
				</div>]
			</div>
			<div class="nettoyeur"></div>
			</div>]
			[(#AUTORISER{'modifier','document',#ID_DOCUMENT}|non)
			<div class="erreur">
				<:photospip:modification_pas_autorisee:>
			</div>]
		</div>
		<div class="nettoyeur"></div>

	[(#REM) Pied de page ]
	<INCLURE{fond=inc-pied}{skel=#SQUELETTE}>

</div><!--#page-->
</body>
</html>
</BOUCLE_article_principal>