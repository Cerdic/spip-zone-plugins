#HTTP_HEADER{"Cache-Control: no-store, no-cache, must-revalidate"}
#HTTP_HEADER{"Pragma: no-cache"}

<!-- lilo [(#REM)

	// login.html

	// $LastChangedRevision$
	// $LastChangedBy$
	// $LastChangedDate$

]-->
<div id='lilo-panel'>
<script type='text/JavaScript'>
jQuery().ready(function(){
	var alea_actuel = '', alea_futur = '';
	var qstring = window.location.search;
	var page_login = (qstring.length && (qstring.search(/page=login/)>0));
	[<!--(#REM) 
	
		utiliser une variable pour controler, eviter que focus() relance l'appel 
		des aleas toutes les secondes tant que le champ de mot de passe est selectionne'.
		
	-->]var str_login = '';
	
$(document).ready(function(){
	[<!--(#REM) 
		
		placer le focus sur le premier champ (login) 
		
	-->]$('#var_login_id').focus();
	[<!--(#REM) 
		
		vider le champ mot de passe si il est pre-rempli 
		
	-->]$('#session_password').val(''); });
	[<!--(#REM) 
	
		lancer la recuperation des aleas par ajax sur le focus dans le champ de mot de passe 
		
	-->]$('#session_password').focus(function(){ recup_aleas(); });
    
  function recup_aleas() {
		if($('#var_login_id').val().length && $('#var_login_id').val() != str_login) {
			str_login = $('#var_login_id').val();
			$.ajax({
				type: 'post'
				, url: $('#lilo_url_action').val()
				, data: {var_login: $('#var_login_id').val(), url: $('input[name=\'url\']').val()}
				, success: function(data) {
					var result = data.split(':');
					var id_auteur = result[0];
					alea_actuel = result[1];
					alea_futur = result[2];
					var logo_src = result[3];
					$('input[@name=session_password_md5]').val(alea_actuel);
					$('input[@name=next_session_password_md5]').val(alea_futur);
					// change logo uniquement si OK et page login
					if(page_login && logo_src.length) {
						$('img.lilo-logo').attr({ src: logo_src, alt: 'Logo auteur' });
					}
					return true;
				}
				, error: function(xmlhttprequest, type, e) {
					if(lilo_config['login_identifiant_inconnu']) {
						alert(lilo_config['login_identifiant_inconnu']);
					}
				}
			}); // end $.ajax
		} // end if
	} // end function
	
	$('#lilo_login').submit( function() {
		if (
			(this.session_password.value.length > 0)
			&& (this.var_login.value.length > 0)
			) {
			this.session_password_md5.value = calcMD5(alea_actuel + this.session_password.value);
			this.next_session_password_md5.value = calcMD5(alea_futur + this.session_password.value);
			this.session_login_hidden.value = this.var_login.value;
			this.session_password.value = ""; 
			return(true);
			}
		return(false);
	}); // end submit
	
	$('#lilo_login input.noAutoComplete').attr("autocomplete","off"); 
	
});[<!--(#REM) fin de .ready() -->]
</script>

[(#ENV{echec_cookie})
<fieldset class="reponse_formulaire">
<legend><:avis_erreur_cookie:></legend>
<p><:login_cookie_oblige:></p>
<p><:login_cookie_accepte:></p>
</fieldset>]

[(#LILO_LOGIN_VOIR_ERREUR|match{oui}|?{' '})
[(#ENV{echec_visiteur})
<fieldset class="reponse_formulaire">
<legend><:avis_erreur_visiteur:></legend>
<p><:texte_erreur_visiteur:></p>
</fieldset>]
]

	<script type="text/javascript" src="#EVAL{_DIR_JAVASCRIPT}md5.js"> </script>
	<form id="lilo_login" action="#URL_ACTION_SPIP_COOKIE" method="post">
	<fieldset[ (#ENV*{erreur}|?{'class="reponse_formulaire"',''})]>
	[(#LILO_LOGIN_VOIR_ERREUR|match{oui}|?{' '})
		[<div class="reponse_formulaire">(#ENV*{erreur})</div>]]
	<div><label for="var_login_id"><:login_login:></label>
	<input type="text" class="forml[(#LILO_LOGIN_NOCOMPLETE|match{oui}|?{' '})noAutoComplete]" id="var_login_id" name="var_login" value="" title="<:login_login2:>" maxlength="40" /></div>
	<input type="hidden" name="session_login_hidden" value="" />

	<div><label for="session_password"><:login_pass2:></label>
	<input type="password" class="forml" name="session_password" id="session_password" value="" maxlength="20" /></div>
	<input type="hidden" name="session_password_md5" value="" />
	<input type="hidden" name="next_session_password_md5" value="" />
	
[(#LILO_LOGIN_SESSION_REMEMBER|match{oui}|?{' '})
	<input type="hidden" name="session_remember" value="oui" />
][(#LILO_LOGIN_SESSION_REMEMBER|match{oui}|?{'',' '})
	<div id='bloc_session_remember'>
	<div class='marge'></div>
	<input class='forml' type="checkbox" name="session_remember" id="session_id" value="oui"[(#ENV*{prefs}|filtre_rester_connecte)checked="checked"]/>
	<label for="session_id"><:login_rester_identifie:></label></div>
]	
	<input type="hidden" name="essai_login" value="oui" />
	<input type="hidden" name="url" value="[(#ENV{url})]" />
	<input type="hidden" id="lilo_url_action" value="#URL_ACTION_LILO_INFOS" />
	
	<div class="spip_bouton"><input type="submit" value="<:bouton_valider:>" /></div>
	</fieldset>
	</form>

</div>