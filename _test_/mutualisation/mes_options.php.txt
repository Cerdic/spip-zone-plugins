<?php

	if (!defined("_ECRIRE_INC_VERSION")) return;
	require _DIR_RACINE.'mutualisation/mutualiser.php';

	$site = str_replace('www.', '', $_SERVER['HTTP_HOST']);
	if ($site != $_SERVER['HTTP_HOST']) {
		include_spip('inc/headers');
		redirige_par_entete('http://'.$site.'/');
	}

	define ('_INSTALL_SERVER_DB', 'mysql');
	define ('_INSTALL_HOST_DB', 'localhost');
	define ('_INSTALL_USER_DB', 'loginsql');
	define ('_INSTALL_PASS_DB', '123456HDJ');
	define ('_INSTALL_NAME_DB', 'mu_'.prefixe_mutualisation($site));
	define ('_INSTALL_TABLE_PREFIX', 'spip');

	/* 
	 * Si le nom du serveur est different du nom dns, 
	 * ca peut parfois poser probleme
	 * il faut alors le definir ici
	 */
	# define ('_INSTALL_HOST_DB_LOCALNAME', 'nom_serveur');
	
	/* 
	 * Si le serveur n'est pas mysql, il faut le preciser obligatoirement.
	 * # define ('_INSTALL_SERVER_DB', 'pg'); // mysql|pg
	 * 
	 * /!\ En PG, il est conseille d'utiliser la creation d'utilisateur SQL
	 */
	
	/*
	 * Creer automatiquement les users SQL
	 * 
	 * Cela permet 
	 * - d'avoir un utilisateur root possedant les droits 
	 * de creation de bases (cet utilisateur possedant obligatoirement 
	 * une base a son nom en PG - PG ne se connecte pas sans donner un nom de bdd)
	 * - de creer des utilisateurs sql automatiquement 
	 * ne possedant que les droits d'administation 
	 * de leur base de donnee qui sera creee
	 * 
	 * Il faut remplacer alors 
	 * _INSTALL_(USER|PASS)_DB par _INSTALL_(USER|PASS)_DB_ROOT
	 * 
	 * et ajouter dans demarrer_site l'option
	 * 'creer_user_base' => true
	 */ 
	# define ('_INSTALL_USER_DB_ROOT', 'mon_root');
	# define ('_INSTALL_PASS_DB_ROOT', '********');
 
	/*
	 * Creer les bases de donnees via un ping sur une URL (methode AlternC)
	 *
	 * Il suffit de renseigner l'option url_creer_base, en lui passant les bons parametres :
	 * 'url_creer_base' => 'https://bureau.tld/admin/sql_doadd.php?username=USER&password=PASS&dbn='.prefixe_mutualisation($site)
	 */
	 
	 
	/*
	 * Transformer sur les pages publiques les url des images
	 * /sites/mon_site/IMG/* -> /IMG/*
	 * /sites/mon_site/local/* -> /local/*
	 * 
	 * - Necessite le mod_rewrite (reecriture d'url) d'apache
	 * - Ne fonctionne qu'avec des mutualisations de nom de domaine 
	 * ('http_host' : http://mon_site_mutu.tld)
	 * (donc pas avec une mutualisation de repertoire - http://site/mon_spip_mutu/)
	 
	 * et ajouter dans demarrer_site l'option
	 * 'url_img_courtes' => true
	 */
	
	/*
	 * Inscrire ici le nom du site d'administration du tableau de bord
	 * de la mutualisation (ou plusieurs, separes par des virgules)
	 * (dans cet exemple, 'scriibe.net' est le top level domain, TLD)
	 * pour autoriser tous les sites, ne pas definir la constante ;
	 * Si le site maitre n'est pas dans sites/ mais a la racine, mettre ''
	 * et ajouter 'mutualisation' dans $dossier_squelettes
	 */
	define ('_SITES_ADMIN_MUTUALISATION', 'scriibe.net');

	demarrer_site($site,
		array(
#			'creer_site' => true,
#			'creer_base' => true,
#			'mail' => 'fil@rezo.net',
#			'cookie_prefix' => true,
#			'table_prefix' => true,
#			'repertoire' => 'sites',
#			'url_img_courtes' => true,
		)
	);
	
	demarrer_site($site,
		array(
			// Creer ou non le site s'il n'existe pas (defaut: false) 
			'creer_site' => true, 
			// Creer ou non la base de donnee si elle n'existe pas (false)
			'creer_base' => true, 
			// Creer ou non un utilisateur pour la nouvelle base de donnee (false)
			'creer_user_base' => false,
			// Adresse mail pour recevoir un mail lors d'une creation de site mutualise ('') 
			'mail' => '',
			// Code d'activation ('ecureuil')
			'code' => 'ecureuil',
			// Definir automatiquement le prefixe de table (false)
			// /!\ mettre true si tous les sites dans la meme base 
			'table_prefix' => false,
			// Definir automatiquement le prefixe de cookie (false)
			'cookie_prefix' => true,
			// Nom du repertoire contenant les sites mutualises ('sites')
			'repertoire' => 'sites',
			// Utiliser la redirection des URL d'images courtes
			// dans la partie publique (false)
			// (IMG/* au lieu de sites/nom/IMG/*)
			'url_img_courtes' => true,
			// Utiliser une table externe pour recuperer des identifiants
			// (code, user, pass) permettant a un utilisateur d'installer le site (false)
			# 'utiliser_panel' => false, 
			// Creer la base de donnees via une URL (methode AlternC)
			'url_creer_base' => ''
		)
	);

?>
