#CACHE{0}
<script src="#CHEMIN{javascript/jqModal.js}" type="text/javascript"></script>
<script type="text/javascript">
/* Overriding Javascript's Alert Dialog */
function confirm(msg,callback) {
	$('#confirm')
		.jqmShow()
		.find('p.jqmConfirmMsg')
		.html(msg)
		.end()
		.find(':submit:visible')
		.click(function(){
			if(this.value == 'yes')
				(typeof callback == 'string') ?
				window.location.href = callback :
				callback;
			$('#confirm').jqmHide();
		});
}

// trigger a confirm whenever links of class alert are pressed.
$().ready(function() {
  $('#confirm').jqm({overlay: 88, modal: true, trigger: false});
  
  // trigger a confirm whenever links of class alert are pressed.
  $('a.confirm').click(function() { 
    confirm('',this.href); 
    return false;
  });
});
</script>
<br />
<br />
<br />
<br />
<div id="conteneur">

	<div id="navigation">
		#INCLURE{fond=prive/menu_inscription2}	
	</div>

	<div id="contenu" class="serif">
		<div class="entete-formulaire">
			<h1><:inscription2:liste_comptes_titre:></h1>
		</div>
		<div class="formulaire_spip">
			<form method="post" action="#SELF"><div>
				[(#SELF|form_hidden)]
				<ul>
					<li class="fieldset">
						<fieldset>
							<h3 class="legend"><:inscription2:recherche_utilisateurs:></h3>
							<ul>
								<li>
									<input class="text" type="text" name="valeur" onfocus='this.value=""' value="[(#ENV{valeur}|?{#ENV{valeur},<:info_rechercher:>})]" />
								</li>
								<li>
									<select name="case" id="case">
										#SET{case,#ENV{case}}
										<BOUCLE_recherchefields(POUR){tableau #CONFIG{inscription2}}{valeur = 'on'}>
										[(#CLE|match{_table}|oui)
											[(#SET{cle,[(#CLE|replace{'_table',''})]})]
											[(#GET{cle}|=={#GET{case}}|oui)
												<option value='#GET{cle}' selected="selected">[(#VAL{inscription2:}|concat{#GET{cle}}|_T)]</option>
											]
											[(#GET{cle}|=={#GET{case}}|non)
												<option value='#GET{cle}'>[(#VAL{inscription2:}|concat{#GET{cle}}|_T)]</option>
											]
										]
										</BOUCLE_recherchefields>
									</select>
								</li>
							</ul>
						</fieldset>
					</li>
				</ul>
				<p class="boutons">
				<input type="submit" class="submit" value="<:info_rechercher:>" />
				</p>
			</div>
			[(#SET{ordre,[(#SELF|parametre_url{'ordre'})]})]
			[(#ENV{desc}|=={'-1'}|?{[(#SET{desc,1})],[(#SET{desc,-1})]})]
			[(#ENV{case}|oui)
			<INCLURE{fond=prive/table_adherent_auteur_recherche}{id_auteur}{ajax}{ordre=#GET{ordre}}{env}>]
			[(#ENV{case}|non)
			<INCLURE{fond=prive/table_adherent_auteur}{id_auteur}{ajax}{ordre=#GET{ordre}}{env}>]
		</form>
			<a href='[(#SELF|parametre_url{debut,''}|parametre_url{ordre,''}|parametre_url{desc,''})]'> tous</a>
		<?php
		include_spip('base/abstract_sql');
		
		$url = self();
		//supprimer un auteur ou nettoyer 
		$id=_request('id');
		$act=_request('act');
		
		//supprimer un auteur
		if(!empty($id) and $act=='sup'){
			$row = sql_getfetsel("statut","spip_auteurs","id_auteur='$id'");
			
			if($row['statut'] !='0minirezo' and $row['statut'] !='1comite')
				sql_delete("spip_auteurs","id_auteur='$id'");
	
			sql_updateq("spip_auteurs",array('statut'=>'5poubelle'),"id_auteur='$id'");
			sql_delete("spip_auteurs_elargis","id_auteur='$id'");
	                
	        if(defined('_DIR_PLUGIN_ACCESRESTREINT'))
	            sql_delete("spip_zones_auteurs","id_auteur='$id'");
	
	        if(defined('_DIR_PLUGIN_SPIPLISTES'))
	            sql_delete("spip_auteurs_listes","id_auteur='$id'");
		}
	
		//nettoyer la table
		if($act=='net' AND false){
			$desc = sql_showtable('spip_auteurs_elargis', '', true);
			foreach($desc['field'] as $cle =>$val){
				if(!(lire_config('inscription2/'.$cle) or lire_config('inscription2/'.$cle.'_fiche') 
					or lire_config('inscription2/'.$cle.'_fiche_mod') or lire_config('inscription2/'.$cle.'_table')) 
					and $cle != 'id' and $cle != 'id_auteur' and $cle != 'spip_listes_format')
					$a = spip_query('ALTER TABLE spip_auteurs_elargis DROP COLUMN '.$cle);
			}
		}
		?>
		</div>
	</div>
</div>

<!-- Confirm Dialog -->
<div class="jqmConfirm" id="confirm">
	<div id="ex3b" class="jqmConfirmWindow">
	    <div class="jqmConfirmTitle clearfix">
	    	<h1>Confirmation </h1><a href="#" class="jqmClose"><em>Close</em></a>
		</div>
		<div class="jqmConfirmContent">
			<p class="jqmConfirmMsg"></p>
			<:inscription2:confirmation:>
		</div>
		<input type="submit" value="no" />
		<input type="submit" value="yes" /> 
	</div>
</div>