[(#REM)

	Controleur pour le crayon 'adressecomplete', uniquement html
	Validation JS pour les champs specifies obligatoires
	Si les champs ne sont pas activs dans le CFG, ils n'apparaissent pas...

]
#CACHE{0}
<BOUCLE_a(SPIP_AUTEURS_ELARGIS){id_auteur=(#ENV{id_auteurs_elargi})}{tous}>
<script type="text/javascript">
/* http://bassistance.de/jquery-plugins/jquery-plugin-validation/ */
	
	jQuery.validator.addMethod("chainenombre", function(value, element) {
		return this.required(element) || /^[A-Za-z0-9\-\'\.§ε‰€ηΛθ‘ιζƒμ•λ”ν“κρξο™…τ†σΰ,ϋ ]+$/.test(value);
	}, "<:inscription2:champ_obligatoire:>, <:inscription2:chaine_valide:> <:inscription2:chainenombre:>");
        
	jQuery.validator.addMethod("chaine", function(value, element) {
		return this.required(element) || /^[A-Za-z\-\'\.§ε‰€ηΛθ‘ιζƒμ•λ”ν“κρξο™…τ†σΰ,ϋ ]+$/.test(value);
	}, "<:inscription2:champ_obligatoire:>, <:inscription2:chaine_valide:> <:inscription2:chainelettre:>");

	jQuery.validator.addMethod("postal", function(value, element) {
		return this.required(element) || /^[A-Z]{1,2}[-|\s][0-9]{3,6}$|^[0-9]{3,6}$|^[0-9|A-Z]{2,5}[-|\s][0-9|A-Z]{2,4}$|^[A-Z]{1,2} [0-9|A-Z]{2,5}[-|\s][0-9|A-Z]{2,4}$/.test(value);
	}, "<:inscription2:champ_obligatoire:>, <:inscription2:cp_valide:>");
	
	var id = cQuery(".auteurs_elargi-adressecomplete-#ID_AUTEUR").crayon();		
	function validation(){
		var validator = jQuery(id).validate({
			debug:true,
			showErrors: function(errors, errorList) {
				// Si c est pas ok on cache le bouton ok et on affiche les erreurs normales
				jQuery(id).find('.crayon-submit').hide();
				console.log(errors);
				validator.defaultShowErrors();
			},
			errorPlacement: function(error, element) {
				error.appendTo( element.parent("div"));
			},
			success: function(label) {
				label.remove();
				if(jQuery(id).find('label.error').length == 0){
					jQuery(id).find('.crayon-submit').show();
				}else{
					jQuery(id).find('.crayon-submit').hide();
				}
			},
			rules: {
				#ENV{name_adresse}: { 
					[(#CONFIG{inscription2/adresse_obligatoire}|=={on}|?{required: true,}),]
					rangeLength:[5,1000]
				},
				#ENV{name_code_postal}:{
					[(#CONFIG{inscription2/code_postal_obligatoire}|=={on}|?{required: true,}),]
					postal:true, 
					rangeLength:[3,20]
				},
				#ENV{name_ville}: {
					[(#CONFIG{inscription2/ville_obligatoire}|=={on}|?{required: true,}),]
					chaine:true,
					rangeLength:[2,30]
				},
				#ENV{name_pays}:{[(#CONFIG{inscription2/pays_obligatoire}|=={on}|?{required: true,''})]}
			},
			messages: {
				#ENV{name_adresse}: {
					required:"<:inscription2:champ_obligatoire:>",
					rangeLength:"Min 10 Max 1000 <:inscription2:caracteres:>"
				},
				#ENV{name_code_postal}: {
					required:"<:inscription2:champ_obligatoire:>",
					postal:"<:inscription2:cp_valide:>",
					rangeLength:"Min 3 Max 20 <:inscription2:caracteres:>"
				},
				#ENV{name_ville}: {
					required:"<:inscription2:champ_obligatoire:>",
					chaine:"<:inscription2:chaine_valide:> <:inscription2:chainelettre:>",
					rangeLength:"Min 2 Max 30 <:inscription2:caracteres:>"
				},
				#ENV{name_pays}: {
					required:"<:inscription2:champ_obligatoire:>"
				},
			}
		});
		
		//On ajoute l'asterisque qui signale qu'un champ est obligatoire
		jQuery(id).find('.obligatoire label').not('.error').append('*');
		jQuery(id).find('.obligatoire input').each(function(){
			if(jQuery(this).val() =="" ){
				jQuery(this).addClass('error');
				var id_label = jQuery(this).attr('name');
				var label = '<label class="error" generated="true"><:inscription2:champ_obligatoire:></label>';
				jQuery(this).parent("div").append(label);
				jQuery(this).parent("div").find("label.error").show();
				
				jQuery(id).find('.crayon-submit').hide();
			}
		});
		
		//On test le formulaire pour chercher les potentielles erreurs
		validator.form();
	}
	setTimeout('validation()',500);
	
</script>
<fieldset[ style="(#ENV{style})"]>
	<legend><:inscription2:votre_adresse:></legend>

	[(#CONFIG{inscription2/adresse_fiche_mod}|?{' ',''})
	#SET{adresse_obl, false}
	[(#CONFIG{inscription2/adresse_obligatoire}|=={on}|?{' ',''})#SET{adresse_obl, true}]
	[(#GET{adresse_obl}|=={true}|?{<div class="obligatoire">,<div>})]
		<label><:inscription2:adresse:></label> 
		<textarea class="crayon-active" name="#ENV{name_adresse}" style="width:#ENV{largeur}px;">[(#ADRESSE**|entites_html)]</textarea><br />
	</div>]

	[(#CONFIG{inscription2/code_postal_fiche_mod}|?{' ',''})
	#SET{code_postal_obl, false}
	[(#CONFIG{inscription2/code_postal_obligatoire}|=={on}|?{' ',''})#SET{code_postal_obl, true}]
	[(#GET{code_postal_obl}|=={true}|?{<div class="obligatoire">,<div>})]
		<label><:inscription2:code_postal:></label>
		<input class="crayon-active" name="#ENV{name_code_postal}" style="width:#ENV{largeur}px;" value="[(#CODE_POSTAL**|entites_html)]" />
	</div>]

	[(#CONFIG{inscription2/ville_fiche_mod}|?{' ',''})
	#SET{ville_obligatoire, false}
	[(#CONFIG{inscription2/ville_obligatoire}|=={on}|?{' ',''}) #SET{ville_obligatoire, true}]
	[(#GET{ville_obligatoire}|=={true}|?{<div class="obligatoire">,<div>})]
		<label><:inscription2:ville:></label> 
		<input class="crayon-active" name="#ENV{name_ville}" style="width:#ENV{largeur}px;" value="[(#VILLE**|entites_html)]" />
	</div>]

	[(#CONFIG{inscription2/pays_fiche_mod}|?{' ',''})
	#SET{pays_obligatoire, false}
	[(#CONFIG{inscription2/pays_obligatoire}|=={on}|?{' ',''}) #SET{pays_obligatoire, true}]
	[(#GET{pays_obligatoire}|=={true}|?{<div class="obligatoire">,<div>})]
		<label><:inscription2:pays:></label> 
		#SET{id,#PAYS}
		<select class="crayon-active" name="#ENV{name_pays}" style="width:#ENV{largeur}px;" onchange="validation()">
			<INCLURE{fond=controleurs/pays}{id=#GET{id}}>
		</select>
	</div>]
</fieldset>

</BOUCLE_a>
<//B_a>