[(#REM)

	Controleur pour le crayon 'adressecompletepro', uniquement html
	Validation JS pour les champs spécifiés obligatoires
	Si les champs ne sont pas activés dans le CFG, ils n'apparaissent pas...

]
#CACHE{0}
<BOUCLE_a(AUTEURS_ELARGIS){id_auteur=#ENV{id_auteurs_elargi}}{tout}>
<script type="text/javascript" src="#CHEMIN{lib/jquery-validate/jquery.validate.js}"></script>
[(#LANG|=={en}|?{'',' '})
	<script type="text/javascript" src="#CHEMIN{lib/jquery-validate/localization/messages_#LANG.js}"></script>
]
<script type="text/javascript">
/* http://bassistance.de/jquery-plugins/jquery-plugin-validation/ */

	jQuery.validator.addMethod("chainenombre", function(value, element) {
		return this.optional(element) || /^[A-Za-z0-9\-\'\.ßÂâÄäÁÀàËëÈèÊêÉéÏïÎîÌìÍÒòÓÔôÖöÙùÜüÛû‡,˚ ]+$/.test(value);
	});
        
	jQuery.validator.addMethod("chaine", function(value, element) {
		return this.optional(element) || /^[A-Za-z\-\'\.ßÂâÄäÁÀàËëÈèÊêÉéÏïÎîÌìÍÒòÓÔôÖöÙùÜüÛû‡,˚ ]+$/.test(value);
	});

	jQuery.validator.addMethod("postal", function(value, element) {
		return this.optional(element) || /^[A-Z]{1,2}[-|\s][0-9]{3,6}$|^[0-9]{3,6}$|^[0-9|A-Z]{2,5}[-|\s][0-9|A-Z]{2,4}$|^[A-Z]{1,2} [0-9|A-Z]{2,5}[-|\s][0-9|A-Z]{2,4}$/.test(value);
	});
		
	var id = cQuery(".auteurs_elargi-adressecompletepro-#ID_AUTEUR").crayon();
	id = jQuery(id).find('form');

	function validation(){
			var validator = id.validate({
			onkeyup:function(){
				validation();
			},
			showErrors: function(errors, errorList) {
				affiche_submit(id);
				validator.defaultShowErrors();
			},
			errorPlacement: function(error, element) {
				error.appendTo( element.parent("li") );
			},
			success: function(label) {
				label.remove();
				affiche_submit(id);
			},
			rules: {
				#ENV{name_adresse_pro}: { 
					[(#CONFIG{inscription2/adresse_pro_obligatoire}|=={on}|?{required: true,}),]
					rangelength:[5,1000]
				},
				#ENV{name_code_postal_pro}:{
					[(#CONFIG{inscription2/code_postal_pro_obligatoire}|=={on}|?{required: true,}),]
					postal:true, 
					rangelength:[3,20]
				},
				#ENV{name_ville_pro}: {
					[(#CONFIG{inscription2/ville_pro_obligatoire}|=={on}|?{required: true,}),]
					chaine:true,
					rangelength:[2,30]
				},
				#ENV{name_pays_pro}:{[(#CONFIG{inscription2/pays_pro_obligatoire}|=={on}|?{required: true,''})]}
			},
			messages: {
				#ENV{name_adresse_pro}: {
					required:"<:inscription2:champ_obligatoire:>",
				},
				#ENV{name_code_postal_pro}: {
					required:"<:inscription2:champ_obligatoire:>",
					postal:"<:inscription2:cp_valide:>"
				},
				#ENV{name_ville_pro}: {
					required:"<:inscription2:champ_obligatoire:>",
					chaine:"<:inscription2:chaine_valide:> <:inscription2:chainelettre:>",
				},
				#ENV{name_pays_pro}: {
					required:"<:inscription2:champ_obligatoire:>"
				}
			}
		});
		jQuery(id).find('.obligatoire input').each(function(){
			if(jQuery(this).val() =="" ){
				jQuery(this).addClass('error');
				var id_label = jQuery(this).attr('name');
				var label = '<label class="error" generated="true"><:inscription2:champ_obligatoire:></label>';
				jQuery(this).parent("div").append(label);
				jQuery(this).parent("div").find("label.error").show();
				
				jQuery(id).find('.crayon-submit').hide();
			}
		});
		validator.form();
		affiche_submit(id);
	}
	function affiche_submit(id){
		if(id.find('label.error:visible').length == 0){
			id.find('.crayon-submit').show();
		}
		else{
			id.find('.crayon-submit').hide();
		}
	}
	jQuery(id).find('.obligatoire label').not('.error').append('*');
	setTimeout('validation()',500);
</script>
<div class="formulaire_spip">
	<fieldset[ style="(#ENV{style})"]>
		<legend><:inscription2:votre_adresse_pro:></legend>
		<ul>
			[(#CONFIG{inscription2/adresse_pro}|?{' ',''})	
			#SET{adresse_pro_obl, false}
			[(#CONFIG{inscription2/adresse_pro_obligatoire}|=={on}|?{' ',''})#SET{adresse_pro_obl, true}]
			[(#GET{adresse_pro_obl}|=={true}|?{<li class="obligatoire">,<li>})]
			<label><:inscription2:adresse_pro:></label> 
			<textarea class="crayon-active" name="#ENV{name_adresse_pro}" style="width:#ENV{largeur}px;">[(#ADRESSE_PRO**|entites_html)]</textarea><br />
			</li>]
	
			[(#CONFIG{inscription2/code_postal_pro}|?{' ',''})
			#SET{code_postal_pro_obl, false}
			[(#CONFIG{inscription2/code_postal_pro_obligatoire}|=={on}|?{' ',''})#SET{code_postal_pro_obl, true}]
			[(#GET{code_postal_pro_obl}|=={true}|?{<li class="obligatoire">,<li>})]
			<label><:inscription2:code_postal_pro:></label>
			<input class="crayon-active" name="#ENV{name_code_postal_pro}" style="width:#ENV{largeur}px;" value="[(#CODE_POSTAL_PRO**|entites_html)]" />
			</li>]
	
			[(#CONFIG{inscription2/ville_pro}|?{' ',''})
			#SET{ville_pro_obligatoire, false}
			[(#CONFIG{inscription2/ville_pro_obligatoire}|=={on}|?{' ',''}) #SET{ville_pro_obligatoire, true}]
			[(#GET{ville_pro_obligatoire}|=={true}|?{<li class="obligatoire">,<li>})]
			<label><:inscription2:ville_pro:></label>
			<input class="crayon-active" name="#ENV{name_ville_pro}" style="width:#ENV{largeur}px;" value="[(#VILLE_PRO**|entites_html)]" />
			</li>]
	
			[(#CONFIG{inscription2/pays_pro}|?{' ',''})
			#SET{pays_pro_obligatoire, false}
			[(#CONFIG{inscription2/pays_pro_obligatoire}|=={on}|?{' ',''}) #SET{pays_pro_obligatoire, true}]
			[(#GET{pays_pro_obligatoire}|=={true}|?{<li class="obligatoire">,<li>})]
			<label><:inscription2:pays_pro:></label>
			#SET{id,#PAYS_PRO}
			<select class="crayon-active" name="#ENV{name_pays_pro}" onchange="validation()">
				[(#INCLURE{fond=controleurs/pays}{id=#GET{id}})]
			</select>
			</li>]
		</ul>
	</fieldset>
</div>
</BOUCLE_a>
<//B_a>
