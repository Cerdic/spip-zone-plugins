[(#REM)

	Controleur pour le crayon 'telfax', uniquement html
	Validation JS pour les champs spécifiés obligatoires
	Si les champs ne sont pas activés dans le CFG, ils n'apparaissent pas...
]
#CACHE{0}
<BOUCLE_a(SPIP_AUTEURS_ELARGIS){id_auteur=(#ENV{id_auteurs_elargi})}{tous}>
<script type="text/javascript">
/* http://bassistance.de/jquery-plugins/jquery-plugin-validation/ */
	
	jQuery.validator.addMethod("numero", function(value, element) {
		return this.required(element) || /^[0-9\+\. \-]+$/.test(value);
	}, "<:inscription2:champ_obligatoire:>, <:inscription2:numero_valide:>");
	
	var id = cQuery(".auteurs_elargi-telfax-#ID_AUTEUR").crayon();
	
	function validation(){
			var validator = jQuery(id).validate({
			event: "keyup",
			showErrors: function(errors, errorList) {
				// Si c est pas ok on cache le bouton ok et on affiche les erreurs normales
				jQuery(id).find(' .crayon-submit').hide();
				validator.defaultShowErrors();
			},
			errorPlacement: function(error, element) {
				error.appendTo( element.parent("div") );
			},
			success: function(label) {
				label.remove();
				if(jQuery(id).find('label.error:visible').length == 0){
					jQuery(id).find('.crayon-submit').show();
				}else{
					jQuery(id).find('.crayon-submit').hide();
				}
			},
			rules: {
				#ENV{name_telephone}: {
					[(#CONFIG{inscription2/telephone_obligatoire}|=={on}|?{' '})required:true,]numero:true, rangeLength:[6,20]},
				#ENV{name_mobile}: {[(#CONFIG{inscription2/mobile_obligatoire}|=={on}|?{required: true,}),]numero:true, rangeLength:[6,20]},
				#ENV{name_fax}: {[(#CONFIG{inscription2/fax_obligatoire}|=={on}|?{required: true,}),]numero:true, rangeLength:[6,20]},
			},
			messages: {
				#ENV{name_telephone}: {
					required:"<:inscription2:champ_obligatoire:>",
					numero:"<:inscription2:numero_valide:>",
					rangeLength:"Min 6 Max 20 <:inscription2:caracteres:>"},
				#ENV{name_mobile}: {
					required:"<:inscription2:champ_obligatoire:>",
					numero:"<:inscription2:numero_valide:>",
					rangeLength:"Min 6 Max 20 <:inscription2:caracteres:>"},
				#ENV{name_fax}: {
					required:"<:inscription2:champ_obligatoire:>",
					numero:"<:inscription2:numero_valide:>",
					rangeLength:"Min 6 Max 20 <:inscription2:caracteres:>"}
			}
		});
		jQuery(id).find('.obligatoire label').not('.error').append('*');
		jQuery(id).find('.obligatoire input').each(function(){
			if(jQuery(this).val() =="" ){
				jQuery(this).addClass('error');
				var id_label = jQuery(this).attr('name');
				var label = '<label class="error" generated="true"><:inscription2:champ_obligatoire:></label>';
				jQuery(this).parent("div").append(label);
				jQuery(this).parent("div").find("label.error").show();
				
				jQuery(id).find('.crayon-submit').hide();
			}
		});
		validator.form();
		jQuery(id).find('.crayon-submit').click(function(){
		console.log('submit');
		if(validator.form()==true){
			jQuery(id).find('.obligatoire input').each(function(){
			if(jQuery(this).val() =="" ){
				console.log('vide');
				jQuery(this).addClass('error');
				var id_label = jQuery(this).attr('name');
				var label = '<label class="error" generated="true"><:inscription2:champ_obligatoire:></label>';
				jQuery(this).parent("div").append(label);
				jQuery(this).parent("div").find("label.error").show();
				
				jQuery(id).find('.crayon-submit').hide();
				return false;
			}
		});
		}
	});
	}
	setTimeout('validation()',500);

</script>
<fieldset[ style="(#ENV{style})"]>
	<legend><:inscription2:vos_contacts_personnels:></legend>

	[(#CONFIG{inscription2/telephone_fiche_mod}|?{' ',''})
	#SET{telephone_obl, false}
	[(#CONFIG{inscription2/telephone_obligatoire}|=={on}|?{' ',''})#SET{telephone_obl, true}]
	[(#GET{telephone_obl}|=={true}|?{<div class="obligatoire">,<div>})]
	<label><:inscription2:telephone:> : </label>
	<input class="crayon-active" name="#ENV{name_telephone}" style="width:#ENV{largeur}px;" value="[(#TELEPHONE**|entites_html)]" />
	</div>]

	[(#CONFIG{inscription2/mobile_fiche_mod}|?{' ',''})
	#SET{mobile_obl, false}
	[(#CONFIG{inscription2/mobile_obligatoire}|=={on}|?{' ',''})#SET{mobile_obl, true}]
	[(#GET{mobile_obl}|=={true}|?{<div class="obligatoire">,<div>})]
	<label><:inscription2:mobile:> : </label>
	<input class="crayon-active" name="#ENV{name_mobile}" style="width:#ENV{largeur}px;" value="[(#MOBILE**|entites_html)]" />
	</div>]

	[(#CONFIG{inscription2/fax_fiche_mod}|?{' ',''})
	#SET{fax_obl, false}
	[(#CONFIG{inscription2/fax_obligatoire}|=={on}|?{' ',''})#SET{fax_obl, true}]
	[(#GET{fax_obl}|=={true}|?{<div class="obligatoire">,<div>})]
	<label><:inscription2:fax:> : </label>
	<input class="crayon-active" name="#ENV{name_fax}" style="width:#ENV{largeur}px;" value="[(#FAX**|entites_html)]" />
	</div>]
	
</fieldset>
</BOUCLE_a>
<//B_a>