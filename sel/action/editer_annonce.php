<?phpif (!defined("_ECRIRE_INC_VERSION")) return;function action_editer_annonce_dist() {	$securiser_action = charger_fonction('securiser_action', 'inc');	$arg = $securiser_action();	// pas d'annonce ? on en cree une nouvelle, mais seulement si 'oui' en argument.		if (!$id_annonce = intval($arg)) {		if ($arg != 'oui') {			include_spip('inc/headers');			redirige_url_ecrire();		}				$id_annonce = insert_annonce();			}			if ($id_annonce) $err = revisions_annonces($id_annonce);	return array($id_annonce,$err);}function format_fr2datetime($unedate) {	$annee = substr($unedate,6,4);	$mois = substr($unedate,3,2);	$jour = substr($unedate,1,2);	return $annee.'-'.$mois.'-'.$jour.' 00:00:00';}function insert_annonce() {	$champs = array(			'titre' => _T('sel:item_nouvelle_annonce')	);			// Envoyer aux plugins	$champs = pipeline('pre_insertion', array(		'args' => array(		'table' => 'spip_annonces',		),		'data' => $champs	));			$id_annonce = sql_insertq("spip_annonces", $champs);	return $id_annonce;}		// Enregistrer certaines modifications d'une annoncefunction revisions_annonces($id_annonce, $c=false) {				    // recuperer les champs dans POST s'ils ne sont pas transmis	if ($c === false) {						$c = array();			foreach (array('titre', 'direction_echange', 'nature', 'id_auteur', 'description', 'nombre_personnes', 'date_debut', 'date_fin', 'adresse1', 'adresse2', 'code_postal', 'ville', 'pays', 'transport', 'repas', 'hebergement', 'nom_referent', 'tel1_referent', 'tel2_referent', 'email_referent', 'statut', 'total_unite', 'si_unite_heure', 'total_fiduc', 'commentaires') as $champ) {				if (($a = _request($champ)) !== null) {					if (($champ == 'date_debut') || ($champ == 'date_fin')) $c[$champ] = format_fr2datetime($a);					else $c[$champ] = $a;				}			}	}	include_spip('inc/modifier');			modifier_contenu('annonce', $id_annonce, array(	'nonvide' => array('titre' => _T('sel:info_sans_titre')),	'invalideur' => "id='id_annonce/$id_annonce'"	),	$c);		}?>