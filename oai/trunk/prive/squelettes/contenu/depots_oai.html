[(#REM)

	Liste des dépôts OAI détectés

	On repère ceux qui se trouvent dans un dossier oai/nom_du_depot
	Les tableaux affichent le contenu du fichier Identify.html

]
<h1 class="grostitre"><:oai:titre_page_depots:></h1>

[(#REM) On cherche les dépôts en collectant les fichiers oai/***/Identify.html ]
#SET{chemins_depots,#ARRAY}
<BOUCLE_chemins(DATA){source table, #REM|creer_chemin}>
<BOUCLE_fichiers(DATA){source pregfiles, #VALEUR, Identify.html}>
[(#REM) Si le dossier grand parent est "oai", bingo ]
[(#VALEUR|explode{/}|table_valeur{#VALEUR|explode{/}|count|moins{3}}|=={oai}|et{#VALEUR|in_array{#GET{chemins_depots}}|non}|oui)
#SET{chemins_depots,#GET{chemins_depots}|push{#VALEUR}}
]
</BOUCLE_fichiers>
</BOUCLE_chemins>

<BOUCLE_afficher_depots(DATA){source table, #GET{chemins_depots}}>
#SET{depot,#VALEUR|explode{/}|table_valeur{#VALEUR|explode{/}|count|moins{2}}}
#SET{url_depot,#URL_SITE_SPIP|concat{/oai.api/,#GET{depot}}}
<div class="liste-objets">
	<table class="spip liste">
		<BOUCLE_identify(DATA){source xml, #GET{url_depot}|parametre_url{verb,Identify}}{datapath Identify}>
		<BOUCLE_valeurs(DATA){source table, #VALEUR}>
		[(#CLE|=={repositoryName}|oui)
		[<caption><strong class="caption">(#VALEUR{0}|propre|ptobr)</strong></caption>]
		]
		<tr class="[(#COMPTEUR_BOUCLE|alterner{row_odd,row_even})]">
			<td><strong>#CLE</strong></td>
			<td>[(#VALEUR{0}|propre|ptobr)]</td>
		</tr>
		</BOUCLE_valeurs>
		</BOUCLE_identify>
	</table>
</div>
</BOUCLE_afficher_depots>