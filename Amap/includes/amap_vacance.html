#CACHE{0}
<?php
if ( isset($_POST['idEvenement']) && isset($_POST['idContrat']) && isset($_POST['idPersonne']) && isset($_POST['idRemplacant']) )
{
  if ( $_POST['idRemplacant'] != $_POST['idPersonne'] )
  {
    // update dans la table amap_vacance
    $txtQuery = "UPDATE amap_vacance SET ";
    $txtQuery .= "id_remplacant='".$_POST['idRemplacant']."' ";
    $txtQuery .= " WHERE id_contrat=".$_POST['idContrat'];
    $txtQuery .= " AND id_evenement=".$_POST['idEvenement'];

    $sqlResult_2 = spip_query($txtQuery);

    if ($sqlResult_2)
      echo "<hr/><div class='verdana2' style='text-align: justify'>
               Mise à jour dans la table amap_vacance sous les numeros (".$_POST['idContrat'].", ".$_POST['idEvenement'].")
             </div><hr/>";
    else
      echo "<hr/><div class='verdana2' style='text-align: justify'>Mise à jour: erreur!!</div><hr/>";
  }
  else
    echo "<hr/><div class='verdana2' style='text-align: justify'>Vous ne pouvez pas vous remplacer vous m&ecirc;me...</div><hr/>";
}
else if ( isset($_POST['idEvenement']) && isset($_POST['idPersonne']) && isset($_POST['idProduit']) && isset($_POST['idSaison']) )
{
  // insert dans la table amap_vacance
  $txtQuery = "INSERT INTO amap_vacance(id_contrat, id_evenement) VALUES ((";
  $txtQuery .= "SELECT id_contrat FROM amap_contrat";
  $txtQuery .= " WHERE id_saison=".$_POST['idSaison'];
  $txtQuery .= " AND id_produit=".$_POST['idProduit'];
  $txtQuery .= " AND id_personne=".$_POST['idPersonne'];
  $txtQuery .= "), '".$_POST['idEvenement']."')";
  $sqlResult = spip_query($txtQuery);

  if ($sqlResult)
    echo "<hr/><div class='verdana2' style='text-align: justify'>
               Insertion dans la table amap_vacance sous les numeros (".$_POST['idContrat'].", ".$_POST['idEvenement'].")
             </div><hr/>";
  else
    echo "<hr/><div class='verdana2' style='text-align: justify'>
               Insertion dans la table amap_vacance: erreur!!
             </div><hr/>";
}
?>
<INCLURE{fond=../amap/includes/amap_vacance_liste}{id_article}>
