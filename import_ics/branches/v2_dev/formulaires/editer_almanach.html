

<div class="ajax">

<div class='formulaire_spip formulaire_editer formulaire_#FORM formulaire_#FORM-#ENV{id_almanach,nouveau}'>
	[<p class="reponse_formulaire reponse_formulaire_ok">(#ENV**{message_ok})</p>]
	[<p class="reponse_formulaire reponse_formulaire_erreur">(#ENV*{message_erreur})</p>]

#SET{tableau_decalage,#ARRAY{-24,-24h,-23,-23h,-22,-22h,-21,-21h,-20,-20h,-19,-19h,-18,-18h,-17,-17h,-16,-16h,-15,-15h,-14,-14h,-13,-13h,-12,-12h,-11,-11h,-10,-10h,-9,-9h,-8,-8h,-7,-7h,-6,-6h,-5,-5h,-4,-4h,-3,-3h,-2,-2h,-1,-1h,0,'aucun decalage',1,+1h,2,+2h,3,+3h,4,+4h,5,+5h,6,+6h,7,+7h,8,+8h,9,+9h,10,+10h,11,+11h,12,+12h,13,+13h,14,+14h,15,+15h,16,+16h,17,+17h,18,+18h,19,+19h,20,+20h,21,+21h,22,+22h,23,+23h,24,+24h}}

[(#REM) on définit un tableau vide, on rajoute dynamiquement les ensembles clé-valeur sortis de la boucle sur le groupe de mot-clés Type. On l'utilise ensuite pour la selection des mots clés par une saisie. on fait la même chose pour les ressources]
#SET{tableau_type_evenement, #ARRAY}

[(#REM)Attention astuce inside pour que les clés numériques ne soient pas réindexées, on inverse l'ordre d'intégration dasn le tableau et ensuite on flip le tableau]
<BOUCLE_groupe(GROUPES_MOTS){titre=Type}>
<BOUCLE_mots(MOTS){id_groupe}>
#SET{tableau_type_evenement, #GET{tableau_type_evenement}|array_merge{#ARRAY{#TITRE,#ID_MOT}}
</BOUCLE_mots>
</BOUCLE_groupe>
[(#SET{tableau_type_evenement, #GET{tableau_type_evenement}|array_flip})]

[(#REM)même chose avec les ressources mais on conditionne à la présence du plugin orr]
#SET{tableau_ressources,#ARRAY}
<B_ressources>
  <script language="JavaScript">
  $( document ).ready(function() {
    $('.editer_id_ressource').hide();
  });
  function toggle(className, obj) {
      var $input = $(obj);
      if ($input.prop('checked')) $(className).show();
      else $(className).hide();
  }
  </script>
<BOUCLE_ressources(ORR_RESSOURCES?)>
#SET{tableau_ressources, #GET{tableau_ressources}|array_merge{#ARRAY{#ORR_RESSOURCE_NOM,#ID_ORR_RESSOURCE}}
</BOUCLE_ressources>
[(#SET{tableau_ressources, #GET{tableau_ressources}|array_flip})]

	[<p class="reponse_formulaire reponse_formulaire_ok">(#ENV**{message_ok})</p>]
	[<p class="reponse_formulaire reponse_formulaire_erreur">(#ENV**{message_erreur})</p>]

	[(#ENV{editable})
	<form method='post' action='#ENV{action}' enctype='multipart/form-data'><div>
		#ACTION_FORMULAIRE{#ENV{action}}
		<input type='hidden' name='id_almanach' value='#ENV{id_almanach}' />
		[<(#DIV|sinon{ul})>]

			[(#SAISIE{input, titre, obligatoire=oui,
				label=<:almanach:label_titre:>,
				explication=<:almanach:explication_titre:> })]

			[(#SAISIE{url, url, obligatoire=oui,
				label=<:almanach:label_url:>,
				explication=<:almanach:explication_url:>,
				verifier => array('type' => 'url',),
			})]
			[(#SAISIE{selecteur_article, le_id_article, obligatoire=oui,
				label=<:agenda:evenement_article:>,
        defaut=#ID_ARTICLE,
				explication=<:almanach:explication_id_article:>
			})]

			[(#SAISIE{selection, id_mot, obligatoire=oui,
				label=<:seminaire:choix_mot:>,
				explication=<:almanach:type_evenement:>,
				datas=#GET{tableau_type_evenement}
			})]

			[(#SAISIE{selection,decalage,
				label=Décalage,
				explication= Vous pouvez tenter un décalage global des horaires s'ils n'apparaissent pas à la bonne heure.,
				datas=#GET{tableau_decalage}
			})]
			[(#PLUGIN{orr}|oui)
			<li class="editer_resa_auto">
				<div class="choix">
					<input type='checkbox' onclick="toggle('.editer_id_ressource', this)" class="checkbox" name='resa_auto' value='oui' id='resa_auto_oui'[ (#ENV{resa_auto}oui{non}|oui)checked="checked"] />
					<label for='resa_auto_oui'>Activer les réservations automatiques</label>
				</div>
			</li>

			[(#SAISIE{selection, id_ressource, obligatoire=non,
				label=<:almanach:resa_auto:>,
				explication=<:almanach:choix_salle:>,
				datas=#GET{tableau_ressources}
			})]
			]
		[</(#DIV|sinon{ul})>]
		[(#REM) ajouter les saisies supplementaires : extra et autre, a cet endroit ]
		<!--extra-->
		[(#REM)<p class="boutons"><input type='submit' class='submit' value='Suivant' /></p> ça ce sera quand le formulaire en deux parties sera correct pour l'instant on fait un formulaire en une partie]
		<p class="boutons"><input type='submit' class='submit' value='<:bouton_enregistrer:>' /></p>
	</div></form>
	]
</div>
</div>
