
<div class='formulaire_spip formulaire_editer formulaire_#FORM formulaire_#FORM-#ENV{id_almanach,nouveau}'>

#SET{tableau_decalage,#ARRAY{-24,-24h,-23,-23h,-22,-22h,-21,-21h,-20,-20h,-19,-19h,-18,-18h,-17,-17h,-16,-16h,-15,-15h,-14,-14h,-13,-13h,-12,-12h,-11,-11h,-10,-10h,-9,-9h,-8,-8h,-7,-7h,-6,-6h,-5,-5h,-4,-4h,-3,-3h,-2,-2h,-1,-1h,0,'aucun decalage',1,+1h,2,+2h,3,+3h,4,+4h,5,+5h,6,+6h,7,+7h,8,+8h,9,+9h,10,+10h,11,+11h,12,+12h,13,+13h,14,+14h,15,+15h,16,+16h,17,+17h,18,+18h,19,+19h,20,+20h,21,+21h,22,+22h,23,+23h,24,+24h}}

[(#REM) on définit un tableau vide, on rajoute dynamiquement les ensembles clé-valeur sortis de la boucle sur le groupe de mot-clés Type. On l'utilise ensuite pour la selection des mots clés par une saisie. on fait la même chose pour les ressources]




[(#REM)utilisation des ressources, si on utilise ORR]
#SET{tableau_ressources,#ARRAY}
<B_ressources>
  <script language="JavaScript">
  $( document ).ready(function() {
    $('.editer_id_ressource').hide();
  });
  function toggle(className, obj) {
      var $input = $(obj);
      if ($input.prop('checked')) $(className).show();
      else $(className).hide();
  }
  </script>
<BOUCLE_ressources(ORR_RESSOURCES?)>
#SET{tableau_ressources, #GET{tableau_ressources}|array_merge{#ARRAY{#ORR_RESSOURCE_NOM,#ID_ORR_RESSOURCE}}
</BOUCLE_ressources>
[(#SET{tableau_ressources, #GET{tableau_ressources}|array_flip})]

	[<p class="reponse_formulaire reponse_formulaire_ok">(#ENV**{message_ok})</p>]
	[<p class="reponse_formulaire reponse_formulaire_erreur">(#ENV**{message_erreur})</p>]

	[(#ENV{editable})
	<form method='post' action='#ENV{action}' enctype='multipart/form-data'>
		#ACTION_FORMULAIRE{#ENV{action}}
		<input type='hidden' name='id_almanach' value='#ENV{id_almanach}' />
		[<(#DIV|sinon{ul})>]

			[(#SAISIE{input, titre, obligatoire=oui,
				label=<:almanach:label_titre:>,
				explication=<:almanach:explication_titre:> })]

			[(#SAISIE{url, url, obligatoire=oui,
				label=<:almanach:label_url:>,
				explication=<:almanach:explication_url:>,
				verifier => array('type' => 'url',),
			})]
			[(#SAISIE{selecteur_article, le_id_article, obligatoire=oui,
				label=<:agenda:evenement_article:>,
				li_class=editer_parent, 
        defaut=#ID_ARTICLE,
				explication=<:almanach:explication_id_article:>
			})]

      #SET{id_groupe,#EVAL{'_IMPORT_ICS_ID_GROUPE'}|sinon{#CONFIG{import_ics/id_groupe}}}
      #SET{id_mot,#EVAL{'_IMPORT_ICS_ID_MOT'}|sinon{#CONFIG{import_ics/id_mot}}}
      [(#GET{id_mot}|non)
        [(#SAISIE{mot,id_mot,
          label=<:almanach:mot:>,
          explication=<:almanach:mot_explication:>,
          id_groupe=#GET{id_groupe},
          forcer_select=oui,
          table_liaison=evenements})] 
      ]
      [(#GET{id_mot}|oui)
        #SAISIE{hidden,id_mot,valeur=#GET{id_mot}}
        [(#SAISIE{mot,id_mot,
          label=<:almanach:mot:>,
          explication=<:almanach:mot_explication_verrouille:>,
          valeur_forcee=#GET{id_mot},
          disable=oui,
          forcer_select=oui,
          table_liaison=evenements})] 
      ]

			[(#SAISIE{selection,decalage,
				label=<:almanach:decalage:>,
				explication=<:almanach:explication:>,
				datas=#GET{tableau_decalage}
			})]
			[(#PLUGIN{orr}|oui)
			[<(#DIV|sinon{li}) class="editer_resa_auto">]
				<div class="choix">
					<input type='checkbox' onclick="toggle('.editer_id_ressource', this)" class="checkbox" name='resa_auto' value='oui' id='resa_auto_oui'[ (#ENV{resa_auto}oui{non}|oui)checked="checked"] />
					<label for='resa_auto_oui'>Activer les réservations automatiques</label>
				</div>
			[</(#DIV|sinon{li})>]

			[(#SAISIE{selection, id_ressource, obligatoire=non,
				label=<:almanach:resa_auto:>,
				explication=<:almanach:choix_salle:>,
				datas=#GET{tableau_ressources}
			})]
			]
		[</(#DIV|sinon{ul})>]
		[(#REM) ajouter les saisies supplementaires : extra et autre, a cet endroit ]
		<!--extra-->
		[(#REM)<p class="boutons"><input type='submit' class='submit' value='Suivant' /></p> ça ce sera quand le formulaire en deux parties sera correct pour l'instant on fait un formulaire en une partie]
		<p class="boutons"><input type='submit' class='submit' value='<:bouton_enregistrer:>' /></p>
	</form>
	]
</div>
