[(#REM)
	Tutoriel pour implémenter le framework ecommerce sous SPIP.
	Étape 1 : Panier > explications.
]
<h1>Étape 2 : validation du panier et création de la commande.</h1>

<p>
	On affiche le contenu du panier au moyen de <code>\#FORMULAIRE_PANIER</code>. Sans paramètre, il s'agit du panier en cours, sinon on peut passer l'identifiant d'un panier donné (voir le code en ligne : <a href="http://zone.spip.org/trac/spip-zone/browser/_plugins_/paniers/trunk/formulaires/panier.php">panier.php</a> et <a href="http://zone.spip.org/trac/spip-zone/browser/_plugins_/paniers/trunk/formulaires/panier.html">panier.html</a>). Le formulaire permet de changer les quantités de chaque objet et de recalculer le total. Pour retirer un objet, passer la quantité à 0 et recalculer. L'identifiant du panier en cours peut être récupéré avec <code>\#SESSION{id_panier}</code>.
	<br>Un panier est réparti sur 2 tables : les infos de base sont contenues dans la table <code>spip_paniers</code>, les objets et leurs quantités se trouvent dans la table <code>spip_paniers_liens</code>.
<p>

<p>
	On peut supprimer le panier en cours au moyen du bouton d'action <code>supprimer_panier_encours</code>, ou un panier donné avec <code>supprimer_panier</code> (voir le code en ligne : <a href="http://zone.spip.org/trac/spip-zone/browser/_plugins_/paniers/trunk/action/supprimer_panier_encours.php">supprimer_panier_encours.php</a> et <a href="http://zone.spip.org/trac/spip-zone/browser/_plugins_/paniers/trunk/action/supprimer_panier.php">supprimer_panier.php</a>).
	<cadre class='code multi'>[(\#BOUTON_ACTION{
	'vider le panier',
	\#URL_ACTION_AUTEUR{
		supprimer_panier_encours,
		'',
		\#SELF}
})]</cadre>
</p>

<p>
	On valide le panier au moyen du bouton d'action <code>commandes_paniers</code>, qui va le transformer en commande. Celle-ci aura le statut «&nbsp;en cours&nbsp;», et le panier sera supprimé. A noter qu'il ne peut y avoir qu'une seule commande en cours à la fois par visiteur : toute nouvelle commande en cours créée écrasera une éventuelle ancienne commande avec le même statut. Le 2ème paramètre à passer à <code>\#URL_ACTION_AUTEUR</code> est l'identifiant du panier, s'il n'est pas donné ce sera celui en cours (voir le code en ligne : <a href="http://zone.spip.org/trac/spip-zone/browser/_plugins_/commandes_paniers/action/commandes_paniers.php">commandes_paniers.php</a>).
<cadre class='code multi'>[(\#BOUTON_ACTION{
	'passer la commande',
	\#URL_ACTION_AUTEUR{
		commandes_paniers,
		\#SESSION{id_panier},
		\#URL_PAGE{paiement}}
})]</cadre>
</p>

<h3>Remarques complémentaires</h3>

<p>
	Pour gérer des adresses de facturation et de livraison, il nous faudrait le plugin «&nbsp;<a href='http://plugins.spip.net/coordonnees'>Coordonnées</a>&nbsp;». On pourrait afficher une simulation des frais de port à côté du panier. Il faudrait insérer une ou plusieurs étapes supplémentaires avant le paiement afin de choisir ou créer des adresses, choisir un mode de livraison, etc.
</p>
