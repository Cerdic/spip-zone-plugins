#HTTP_HEADER{content-type:text/html;charset=#CHARSET}
#CACHE{5}

<style type='text/css'>
@import url("#CHEMIN{css/popular_tags.css}");
</style>

#CACHE{0}
<?php
if (!$auteur_session)
    redirige_par_entete('spip.php?page=login&url='.rawurlencode(str_replace('&amp;', '&', self())));
[(#ENV{id_article}|?{' ',''}) $elements='articles'; $element='article'; $id_element='#ID_ARTICLE';]
[(#ENV{id_document}|?{' ',''}) $elements='documents'; $element='document'; $id_element='#ID_DOCUMENT';]
	
	if (!$id_element = intval($id_element)) die ('bah, non...');

	if (isset($_REQUEST['tags'])) {
		include_spip('inc/tag-machine');
		ajouter_liste_mots(_request('tags'),
			$id_element,
			$groupe_defaut = 'tags',
			$elements,
			'id_'.$element,
			true);

		if (isset($_REQUEST['descriptif'])) {
$query="UPDATE spip_".$element."s SET descriptif='".addslashes(_request('descriptif'))."' WHERE id_".$element."='".$id_element."'";
			spip_query($query);
		}

		if (isset($_REQUEST['titre'])) {
$query="UPDATE spip_".$element."s SET titre='".addslashes(_request('titre'))."' WHERE id_".$element."='".$id_element."'";
		spip_query($query);
		}

		redirige_par_entete(
			parametre_url(
			parametre_url(
			parametre_url(
			parametre_url(self(),
				'tags', ''),
				'descriptif', ''),
				'titre', ''),
				'url', '',
			'&')
		);
	}
?>

[(#REM)

	Les tags de notre article
	
	// ici mettre {" "} si on ne veut pas de virgule, voir aussi dans le
	// javascript ci-dessous
]
<BOUCLE_a(ARTICLES){id_article}{statut IN prop,publie}>
<h1>#TITRE</h1>

<form method='get' action='[(#SELF|parametre_url{tags,""}|parametre_url{titre,""}|parametre_url{descriptif,""}|parametre_url{url,""})]'>
[(#SELF|parametre_url{tags,""}|parametre_url{titre,""}|parametre_url{descriptif,""}|parametre_url{url,""}|form_hidden)]

<table><tr><td align='right'>
	url
</td><td>
	<input type='text' name='url' readonly='1'
		value="[(#URL_ARTICLE|url_absolue|entites_html)]" size='80' />
</td></tr><tr><td align='right'>
	titre
</td><td>
	<input type='text' name='titre'
	value="[(#TITRE*|entites_html)]" size='80' />
</td></tr><tr><td align='right'>
	desc
</td><td>
	<textarea name='descriptif' rows='2'
	cols='77'>[(#DESCRIPTIF*|entites_html)]</textarea>
</td></tr><tr><td align='right'>
	tags
</td><td>
	<input type='text' name='tags' autocomplete='off' id='tags'
	value="<BOUCLE_m(MOTS){type=tags}{id_article}{" "}>[(#TITRE*|strcspn{' ,"'}|=={[(#TITRE*|strlen)]}|?{'',&quot;})][(#TITRE*|entites_html)][(#TITRE*|strcspn{' ,"'}|=={[(#TITRE*|strlen)]}|?{'',&quot;})]</BOUCLE_m>" size='80' />
</td></tr>
<tr><td align='right'>
<span id='sug'></span>
</td><td>
<div id='suggestions'>
&nbsp;
</div>
</td></tr>
<tr><td colspan='2'>
	<div align="#LANG_RIGHT"><input type='submit' value='ok' />
</td></tr>
</table>



</form>

</BOUCLE_a>

<BOUCLE_d(DOCUMENTS){id_document}>
<h1>#TITRE</h1>

<form method='get' action='[(#SELF|parametre_url{tags,""}|parametre_url{titre,""}|parametre_url{descriptif,""}|parametre_url{url,""})]'>
[(#SELF|parametre_url{tags,""}|parametre_url{titre,""}|parametre_url{descriptif,""}|parametre_url{url,""}|form_hidden)]

<table><tr><td align='right'>
	url
</td><td>
	<input type='text' name='url' readonly='1'
		value="[(#URL_DOCUMENT|url_absolue|entites_html)]" size='80' />
</td></tr><tr><td align='right'>
	titre
</td><td>
	<input type='text' name='titre'
	value="[(#TITRE*|entites_html)]" size='80' />
</td></tr><tr><td align='right'>
	desc
</td><td>
	<textarea name='descriptif' rows='2'
	cols='60'>[(#DESCRIPTIF*|entites_html)]</textarea>
</td></tr><tr><td align='right'>
	tags
</td><td>
	<input type='text' name='tags' autocomplete='off' id='tags'
	value="<BOUCLE_md(MOTS){type=tags}{id_document}{" "}>[(#TITRE*|strcspn{' ,"'}|=={[(#TITRE*|strlen)]}|?{'',&quot;})][(#TITRE*|entites_html)][(#TITRE*|strcspn{' ,"'}|=={[(#TITRE*|strlen)]}|?{'',&quot;})]</BOUCLE_md>" size='80' />
</td></tr>
<tr><td align='right'>
<span id='sug'></span>
</td><td>
<div id='suggestions'>
&nbsp;
</div>
</td></tr>
<tr><td colspan='2'>
	<div align="#LANG_LEFT"><input type='submit' value='ok' />
</td></tr>
</table>



</form>

</BOUCLE_d>


[(#REM)

	La liste des tags, dans des gentils < span >
	Idealement le addtag(this) serait ajoute par
	la fonction loadpopular ci-dessous

]

<div id='popularTags'>
<BOUCLE_tags(MOTS){type=tags}{par titre}><span>#TITRE*</span>
</BOUCLE_tags>
</div>




[(#REM)

	Code partiellement copie du genial scuttle ; 

]
<script src="#CHEMIN{javascript/popular_tags.js}"></script>
