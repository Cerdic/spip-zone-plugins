[(#REM)
	
	Plugin Xiti
	
	Génération des différentes variables utiles pour le code javascript du marqueur
	et insertion du marqueur javascript

]<BOUCLE_si_activer(CONDITION){si #CONFIG{xiti/activer_xiti}|=={oui}|oui}>
[(#REM)

	Les configurations de base

]
[(#SET{xtnv,[(#CONFIG{xiti/xtnv_xiti, document})]})]
[(#SET{xtdi,[(#CONFIG{xiti/xtdi_xiti})]})]
[(#SET{xtdmc,[(#CONFIG{xiti/xtdmc_xiti,[(#URL_SITE_SPIP|xiti_xtdmc)]})]})]
[(#SET{xtprm,'&amp;xtcode=UTF-8'})]
[(#SET{profondeur, -1})]

[(#REM) boucle artourub détermine si article ou rubrique ]
<BOUCLE_artourub(ARTICLES){id_article}>
	[(#CONFIG{xiti/secteur_xiti}|=={oui}|oui)
		[(#CONFIG{xiti/xtsite_xiti_#ID_SECTEUR}|trim|strlen|>{2}|oui)
			#SET{xtsite,#CONFIG{xiti/xtsite_xiti_#ID_SECTEUR}}
			[(#CONFIG{xiti/xtpage_xiti}|=={oui}|et{#CONFIG{xiti/secteur_xiti_home}|=={on}}|oui)
				#SET{profondeur,0}
			]
		]
		[(#CONFIG{xiti/xtsd_xiti_#ID_SECTEUR}|trim|strlen|>{2}|oui)
			#SET{xtsd,#CONFIG{xiti/xtsd_xiti_#ID_SECTEUR}}
		]
	]
	[(#CONFIG{xiti/langue_xiti}|=={oui}|oui) 
		[(#GET{xtsd}|non|et{#CONFIG{xiti/xtsd_xiti_#LANG}|trim|strlen|>{2}|oui}|oui)
			#SET{xtsd,#CONFIG{xiti/xtsd_xiti_#LANG}}
		]
		[(#GET{xtsite}|non|et{#CONFIG{xiti/xtsite_xiti_#LANG}|trim|strlen|>{2}|oui}|oui)
			[(#SET{xtsite,[(#CONFIG{xiti/xtsite_xiti_[(#LANG)]})]})]
		]
	]
	<BOUCLE_xtn2_art(XITI_NIVEAUX){si #CONFIG{xiti/niveaux_deux}|=={on}}{id_article}>
	[(#SET{xtn2,#NIVEAU})]
	</BOUCLE_xtn2_art>
	[(#REM) placer un libelle de page pour les rapports Xiti]
	<BOUCLE_chemin_art2(HIERARCHIE){si #CONFIG{xiti/xtpage_xiti}|=={oui}}{id_article}{profondeur > #GET{profondeur}}>
		[(#SET{titre_objet, [(#GET{titre_objet})::][(#TITRE|xiti|couper{50,''}|textebrut)]})]
		<BOUCLE_xtn2_hierarchie_art(XITI_NIVEAUX){si #GET{xtn2}|non|et{#CONFIG{xiti/niveaux_deux}|=={on}}}{id_rubrique}>
		[(#SET{xtn2,#NIVEAU})]
		</BOUCLE_xtn2_hierarchie_art>
	</BOUCLE_chemin_art2>
	[(#SET{titre_objet, [(#GET{titre_objet})::][(#TITRE|xiti|couper{50,''}|textebrut)]})]
</BOUCLE_artourub>
	<BOUCLE_rubchemin(RUBRIQUES){id_rubrique}>
		[(#CONFIG{xiti/secteur_xiti}|=={oui}|oui)
			[(#CONFIG{xiti/xtsite_xiti_#ID_SECTEUR}|trim|strlen|>{2}|oui)
				#SET{xtsite,#CONFIG{xiti/xtsite_xiti_#ID_SECTEUR}}
				[(#CONFIG{xiti/xtpage_xiti}|=={oui}|et{#CONFIG{xiti/secteur_xiti_home}|=={on}}|oui)
					#SET{profondeur,0}
					[(#ID_RUBRIQUE|=={#ID_SECTEUR}|et{#CONFIG{xiti/niveaux_deux}|=={on}|et{#CONFIG{xiti/xtn2_home_xiti_#ID_RUBRIQUE}|strlen|>{0}}}|oui)
					#SET{xtn2,#CONFIG{xiti/xtn2_home_xiti_#ID_RUBRIQUE}}
					]
				]
			]
			[(#CONFIG{xiti/xtsd_xiti_#ID_SECTEUR}|trim|strlen|>{2}|oui)
				#SET{xtsd,#CONFIG{xiti/xtsd_xiti_#ID_SECTEUR}}
			]
		]
		[(#CONFIG{xiti/langue_xiti}|=={oui}|oui) 
			[(#GET{xtsd}|non|et{#CONFIG{xiti/xtsd_xiti_#LANG}|trim|strlen|>{2}|oui}|oui)
				#SET{xtsd,#CONFIG{xiti/xtsd_xiti_#LANG}}
			]
			[(#GET{xtsite}|non|et{#CONFIG{xiti/xtsite_xiti_#LANG}|trim|strlen|>{2}|oui}|oui)
				[(#SET{xtsite,[(#CONFIG{xiti/xtsite_xiti_[(#LANG)]})]})]
			]
		]
		<BOUCLE_xtn2_rub(XITI_NIVEAUX){si #CONFIG{xiti/niveaux_deux}|=={on}|et{#GET{xtn2}|non}}{id_rubrique}>
		[(#SET{xtn2,#NIVEAU})]
		</BOUCLE_xtn2_rub>
		[(#REM) placer un libelle de page pour les rapports Xiti]
		<BOUCLE_chemin2(HIERARCHIE){si #CONFIG{xiti/xtpage_xiti}|=={oui}}{id_rubrique}{profondeur > #GET{profondeur}}>
			[(#SET{titre_objet, [(#GET{titre_objet})::][(#TITRE|xiti|couper{50,''}|textebrut)]})]
			<BOUCLE_xtn2_hierarchie_rub(XITI_NIVEAUX){si #GET{xtn2}|non|et{#CONFIG{xiti/niveaux_deux}|=={on}}}{id_rubrique}>
			[(#SET{xtn2,#NIVEAU})]
			</BOUCLE_xtn2_hierarchie_rub>
		</BOUCLE_chemin2>
		[(#PROFONDEUR|>{#GET{profondeur}}|oui)
		[(#SET{titre_objet, [(#GET{titre_objet})::][(#TITRE|xiti|couper{50,''}|textebrut)]})]]
	</BOUCLE_rubchemin>
<//B_artourub>
[(#ENV{page}|=={recherche}|oui)
	[(#SET{xtpage, page_recherche[::(#RECHERCHE|xiti)]})]
]

[(#ENV{page}|=={sommaire}|et{#CONFIG{xiti,xtn2_accueil_xiti}|strlen|>{0}}|oui)
	[(#SET{xtn2,[(#CONFIG{xiti/xtn2_accueil_xiti})]})]
]

[(#GET{titre_objet}|et{#GET{xtpage}|non|ou{#GET{xtpage}|=={''}|oui}}|oui)
	[(#SET{xtpage, [(#GET{titre_objet})]})]
]
[(#GET{xtpage}|non|ou{#GET{xtpage}|=={''}|oui}|oui)
	[(#SET{xtpage, [page_(#ENV{page,accueil})][_(#LANG)]})]
]

[(#CONFIG{xiti/langue_xiti}|=={oui}|oui) 
	[(#GET{xtsd}|non|et{#CONFIG{xiti/xtsd_xiti_#LANG}|trim|strlen|>{2}|oui}|oui)
		#SET{xtsd,#CONFIG{xiti/xtsd_xiti_#LANG}}
	]
	[(#GET{xtsite}|non|et{#CONFIG{xiti/xtsite_xiti_#LANG}|trim|strlen|>{2}|oui}|oui)
		[(#SET{xtsite,[(#CONFIG{xiti/xtsite_xiti_[(#LANG)]})]})]
	]
]

[(#GET{xtn2}|non)
	[(#SET{xtn2,[(#CONFIG{xiti/xtn2_xiti})]})]
]

[(#INCLURE{fond=inclure/marqueur_js,
	xtnv=[(#GET{xtnv}|trim)],
	xtsd=[(#GET{xtsd,[(#CONFIG{xiti/xtsd_xiti})]}|trim)],
	xtsite=[(#GET{xtsite,[(#CONFIG{xiti/xtsite_xiti})]}|trim)],
	xtn2=[(#GET{xtn2}|trim)],
	xtpage=[(#GET{xtpage}|trim)],
	xtdi=[(#GET{xtdi}|trim)],
	xt_multc=[(#GET{xt_multc}|trim)],
	xt_an=[(#GET{xt_an}|trim)],
	xt_ac=[(#GET{xt_ac}|trim)],
	xtdmc=[(#GET{xtdmc}|trim)],
	xtprm=[(#GET{xtprm}|trim)],
	xtergo=[(#GET{xtergo}|trim)]})]
</BOUCLE_si_activer>
#FILTRE{trim}