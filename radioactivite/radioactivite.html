#INSERT_HEAD

<style>
table{border-collapse: collapse;}
td{border:1px solid #666; padding:0.5em;}
tr.changearea td{border-top:2px solid #000;}
.centrer{text-align:center}
.centrer div{margin:0 auto}
</style>

<?php
echo "<small>source <a href='http://www.bousai.ne.jp/eng/'>http://www.bousai.ne.jp/eng/</a></small> ";
echo "<small><a href='squelettes/squelt-radiations.tar.gz'>squelette</a>";
echo "<br /> Les d&eacute;bits de dose sont exprim&eacute;s en nanoGray/heure (nGy/h) soit 1 milliardi&egrave;me de Gray/heure. Le premier niveau de pr&eacute;-alarme en France est fix&eacute; &agrave; 350 nGy/h.</small>";
include_spip('inc/filtres');
include_spip('inc/distant');
//on incr&eacute;mente pour les 8 pages
$id="01";
$i=1;
while($i<=8) {
	$id="0".$i;
	if ($recup = recuperer_page('http://www.bousai.ne.jp/eng/speedi/pref.php?id='.$id)
	AND $b = extraire_balises($recup, 'table')
	AND $b = extraire_balise($b[2], 'table')
	) $c[] = extraire_balises($b, 'tr');
	//$c = array_merge(null, $total);
	$i++;
}
//print_r($c)."<br />";
function aff_style($multi) 
    {
    // on fait une boucle qui lit les &eacute;l&eacute;ments du tableau
    $i=1;
    foreach ($multi as $cle=>$c) 
        {
     
	if(is_array($c)) {
		foreach(array_slice($c,3) as $d) {
			$id="0".$i;
			$d = array_map('supprimer_tags', extraire_balises($d, 'td'));
			if (is_numeric($d[2])){
				$rate=($d[2]>100)?$d[2]*0.2:$d[2]*1;
			}else $rate='0';
		echo "#A".$id.$d[0]."{height:".round($rate)."px; width:".round($rate)."px;}"."\n";
		$i++;
		}
	}
	
        } 
    } 
    
function aff_table($multi) 
    {
    // on fait une boucle qui lit les &eacute;l&eacute;ments du tableau
    $i=1;
    foreach ($multi as $cle=>$c) 
        {
     
	if(is_array($c)) {
	
		foreach(array_slice($c,3) as $d) {
			$id="0".$i;
			$d = array_map('supprimer_tags', extraire_balises($d, 'td'));
			if (is_numeric($d[2])){
			$imgcercle=($d[2]>100)?"cercle-noir.png":"cercle-rouge.png";
			} else $imgcercle='';
			$classchange=($d[0]=='1')?"class='changearea'":"";
			echo "<tr $classchange><td>";
			echo  $d[0]."</td><td>".$d[1]."</td><td>".$d[2]."</td><td>".$d[3]."</td><td>".$d[4];
			echo "</td>";
			echo "<td class='centrer'><div id=A".$id.$d[0].">";
			echo "<img src='squelettes/images/".$imgcercle."' width='100%' />";
			echo "</div></td>";
			echo "</tr>"."\n";
			$i++;
		}
	} 
	
        } 
    }
    
echo "<style>";
aff_style($c);
echo "</style>";

echo "<table>";
echo "<thead><tr><td>code</td><td>station</td><td>rate nGy/h</td><td>wind</td><td>speed</td><td></td></thead><tbody>";
aff_table($c);
echo "</tbody></table>";


