RewriteEngine On

################ CONFIGURATION ############################

# Si votre site est dans un sous-repertoire, preciser ci-dessous
# le nom du sous-repertoire, et supprimer le '#'
# Chez certains hebergeurs il faut indiquer "RewriteBase /"

#RewriteBase /sous/repertoire/

################ REGLAGES PERSONNALISES ###################

# -----------------------------------------------------------------------------------
# Regles generales
# -----------------------------------------------------------------------------------

# Ramener a la racine les dossiers de ressources et du back office
RewriteCond %{REQUEST_URI} !^(ecrire|IMG|dist|plugins|oo|local)/
RewriteRule ^(.*)?/(ecrire|IMG|dist|plugins|oo|local)/(.*) /$2/$3 [QSA,R,L]

################ GESTIONS DES URLS SPIP ###################

#####
# Si le fichier ou repertoire demande existe
# ignorer toutes les regles qui suivent

RewriteCond %{REQUEST_FILENAME} -f
RewriteRule "." - [skip=100]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule "." - [skip=100]

#####
# Compatibilite avec les URLS "html" (pour transition sympa)
# voir fichier ecrire/urls/html.php3

RewriteRule rubrique([0-9]+)\.html$	spip.php?page=rubrique&id_rubrique=$1 [QSA,L]
RewriteRule article([0-9]+)\.html$	spip.php?page=article&id_article=$1 [QSA,L]
RewriteRule breve([0-9]+)\.html$	spip.php?page=breve&id_breve=$1 [QSA,L]
RewriteRule mot([0-9]+)\.html$		spip.php?page=mot&id_mot=$1 [QSA,L]
RewriteRule auteur([0-9]+)\.html$	spip.php?page=auteur&id_auteur=$1 [QSA,L]
RewriteRule site([0-9]+)\.html$	spip.php?page=site&id_syndic=$1 [QSA,L]

#####
# Compatibilite avec les anciennes URLS appelant directement des fichiers php

RewriteRule ^(rubrique|article|breve|mot|auteur|site|agenda|backend|backend-breves|distrib|forum|ical|plan|recherche|resume|sommaire|sommaire_texte)\.php3?$	spip.php?page=$1 [QSA,L]
RewriteRule ^page.php[3]?	spip.php [QSA,L]
RewriteRule ^spip_cal\.php3?$	spip.php?action=ical [QSA,L]
RewriteRule ^spip_rss\.php3?$	spip.php?action=rss [QSA,L]

#####
# URLs "propres"

RewriteRule ^$		spip.php?page=sommaire [QSA,L]
RewriteRule ^.*$		spip.php?page=type_urls [QSA,E=url_propre:$0,L]

################ DIVERS ###################################

#####
# bloquer les acces aux repertoires .svn/ (SPIP, plugins, squelettes...)

RewriteRule ^(.*/)?\.svn/ - [F]

#####
# expirer les images (pour contourner gros bug MSIE sur le cache)

<IfModule mod_expires.c>
 ExpiresActive on
 ExpiresByType image/gif A3600
 ExpiresByType image/jpeg A3600
 ExpiresByType image/png A3600
</IfModule>
