[(#REM)

	Noisette d'Archives Mensuelles pour SPIP 1.9.2c et +

	Parametres:
	self:		la page de destination, souvent celle ou apparait cette noisette.
				Penser a specifier {self=#SELF} en parametre pour l'INCLURE appelant
	date:		la date de contexte, transmise par defaut ou specifiee par l'INCLURE appelant.
				Elle servira a mettre en evidence le mois choisi par le visiteur (class css 'on')
				Penser a specifier au minimum {date} en parametre pour l'INCLURE appelant
	pour SPIP 1.9.3dev, on peut preferer {env}
	var_date:	variable de navigation, facultatif, 'date' par defaut
				{var_date=date_liste} pour &date_liste=2008-02

	Principe:
	Cet exemple illustre comment generer une liste glissante de liens pointant
	vers une page permettant l'affichage d'elements du mois choisi par le visiteur.
	On se base sur l'ensemble des ARTICLES du site. Pour adapter a un autre ensemble
	d'elelements, ou un groupe d'articles plus reduit (mot-cle, rubrique limitee)
	ne pas perdre de vue qu'il y a 4 boucles dont les criteres doivent etre coherent.
	
	_reference	boucle englobante. Elle sert a definir la date de reference
				pour demarrer la liste. Cette date sera employee par les 3 autres boucles
				grace aux criteres {mois_relatif}
				Elle utilise le critere agenda en prenant le plus recent des articles
				de la periode visee.
	_archives	boucle principale. Elle n'affichera que la #DATE des articles.
				En cas de gros volume, le parcours de la table peut s'averer contre-performant.
				On profite donc du fait qu'on utilisera que les #DATE, de plus avec un degre
				de precision au mois pres pour recuperer les donnees groupees par mois
				avec le critere fusion.
				Ensuite, on limite aux articles publies dans les 12 derniers mois.
	_recent,
	_ancien		deux boucles qui affichent quelque chose si un article est publie dans la periode qui suit
				ou qui precede.

][(#REM)

	Periode visee:
	Comme dit plus haut, la date de contexte met en evidence le mois selectionne par le visiteur.
	Elle ne peut donc servir a definir la fenetre.
	On prend donc a la place l'anee de la date systeme, ajustee par un decalage determine par les liens
	des boucles _recent et _ancien

]#SET{date,#EVAL{date('Y-m')}}
[(#SET{annee_fin,[(#GET{date}|annee|plus{#ENV{decal}})]})]
[(#SET{annee_deb,[(#GET{annee_fin}|plus{#ENV{decal}|>{0}|?{1,-1}})]})]
<BOUCLE_reference(ARTICLES)
	{par date}{inverse}{0,1}
	{agenda date, periode, #GET{annee_deb}, (#GET{date}|mois), 1, #GET{annee_fin}, (#GET{date}|mois), 31}
><B_archives>
<div id="archives" class="menu">
	<h2><:dtarch:archives:></h2>
	<BOUCLE_recent(ARTICLES){lang_select=non}{par date}{inverse}{0,1}{mois_relatif<0}>
	<p>
		<a href="[(#SELF|parametre_url{decal,[(#ENV{decal}|plus{1})]})]">+1an</a>
	</p>
	</BOUCLE_recent>
	<ul>[(#REM)



		]<BOUCLE_archives(ARTICLES)
			{lang_select=non}{fusion DATE_FORMAT(date,'%Y-%m')}
			{par date}{inverse}
			{mois_relatif>=0}{mois_relatif<12}
		>[<li>
			<a href="[(#SELF|parametre_url{#ENV{var_date,date},[(#DATE|affdate{Y-m})]})]"[
				class="(#DATE|affdate{Y-m}|=={[(#ENV{date}|affdate{Y-m})]}|?{on})"
			]>(#DATE|affdate_mois_annee)</a>
		</li>
		]</BOUCLE_archives>
	</ul>
	<BOUCLE_ancien(ARTICLES){lang_select=non}{par date}{inverse}{0,1}{mois_relatif>=12}>
	<p>
		<a href="[(#SELF|parametre_url{decal,[(#ENV{decal}|moins{1})]})]">-1an</a>
	</p>
	</BOUCLE_ancien>
</div>
</B_archives>
</BOUCLE_reference>