[(#SET{id_carte_gis,#ENV{id_carte_gis,1}})]
<script type="text/javascript">
	var URLbase = "[(#CHEMIN{plugins}|url_absolue)]";
	var map[(#GET{id_carte_gis})] = null;
	var markers[(#GET{id_carte_gis})] = null;
    <BOUCLE_centrado(GIS){id_article?}{id_rubrique ?}{0,1}>
	#SET{latitude,#ENV{latit,#LAT}}
	#SET{lonxitude,#ENV{lonxit,#LONX}}
	#SET{zoommapa, #ENV{zoom,#ZOOM}}
	</BOUCLE_centrado>
	#SET{latitude,#ENV{latit,#CONFIG**{gis_default_lat,0}}}
	#SET{lonxitude,#ENV{lonxit,#CONFIG**{gis_default_lonx,0}}}
	#SET{zoommapa, #ENV{zoom,#CONFIG**{gis_default_zoom,0}}
	<//B_centrado>
	function init[(#GET{id_carte_gis})](){
		map[(#GET{id_carte_gis})] = new OpenLayers.Map("map[(#GET{id_carte_gis})]",{
			maxExtent: new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34),
			numZoomLevels: 19,
			maxResolution: 156543.0399,
			units: 'm',
			projection: new OpenLayers.Projection("EPSG:900913"),
			displayProjection: new OpenLayers.Projection("EPSG:4326")
		});
		markers[(#GET{id_carte_gis})] = new OpenLayers.Layer.Markers("Markers");
		var lon = #GET{lonxitude};
		var lat = #GET{latitude};
		var zoom = #ENV{zoom,#CONFIG**{gis_default_zoom,0}};
		var lonlat = new OpenLayers.LonLat(lon, lat);
		var nasa = new OpenLayers.Layer.WMS( "NASA Global Mosaic",
			"http://t1.hypercube.telascience.org/cgi-bin/landsat7", 
			{layers: "landsat7"}
		);
 		var wms = new OpenLayers.Layer.WMS(
			"#EVAL{$map_wms_name = isset($GLOBALS['meta']['openlayer_wmsname'])?$GLOBALS['meta']['openlayer_wmsname']:'OpenLayers WMS';}",
			"#EVAL{$map_wms_url = isset($GLOBALS['meta']['openlayer_wmsurl'])?$GLOBALS['meta']['openlayer_wmsurl']:'http://labs.metacarta.com/wms/vmap0';}",
			{layers: 'basic'}
		);
		var osm = new OpenLayers.Layer.OSM.Osmarender("Osmarender");
		map[(#GET{id_carte_gis})].addLayers([osm, wms, nasa]);
		map[(#GET{id_carte_gis})].addLayer(markers[(#GET{id_carte_gis})]);
		map[(#GET{id_carte_gis})].zoomTo(zoom);
		map[(#GET{id_carte_gis})].setCenter(lonlat.fromDataToDisplay());
		map[(#GET{id_carte_gis})].addControl(new OpenLayers.Control.LayerSwitcher());
	[(#ENV{recursive}|=={1}|?{' ',''})
		jQuery.get('[(#URL_PAGE{rss-gis-recursive})]', {[limit:(#ENV{limit, 50})][, id_rubrique:(#ID_RUBRIQUE)][, id_parent:(#ID_RUBRIQUE)][, id_secteur:(#ID_SECTEUR)][, id_mot:(#ID_MOT)][, id_auteur:(#ID_AUTEUR)][, recherche:(#RECHERCHE)][, id_article:(#ID_ARTICLE)][, id_groupe:(#ID_GROUPE)]}, function(xml[(#GET{id_carte_gis})]){
	][(#ENV{recursive}|=={1}|?{'',' '})
		jQuery.get('[(#URL_PAGE{rss-gis})]', {[limit:(#ENV{limit, 50})][, id_rubrique:(#ID_RUBRIQUE)][, id_secteur:(#ID_SECTEUR)][, id_mot:(#ID_MOT)][, id_auteur:(#ID_AUTEUR)][, recherche:(#RECHERCHE)][, id_article:(#ID_ARTICLE)][, id_groupe:(#ID_GROUPE)]}, function(xml[(#GET{id_carte_gis})]){
	]
			jQuery("item", xml[(#GET{id_carte_gis})]).each(function(item[(#GET{id_carte_gis})]){
				var xmlItem[(#GET{id_carte_gis})] = xml[(#GET{id_carte_gis})].documentElement.getElementsByTagName("item")[item[(#GET{id_carte_gis})]];
 				agregarMarcador(xmlItem[(#GET{id_carte_gis})], markers[(#GET{id_carte_gis})], map[(#GET{id_carte_gis})]);
			});
		});
	}
	$(document).ready(function(){
		init[(#GET{id_carte_gis})]();
	});
</script>