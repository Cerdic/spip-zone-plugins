#CACHE{0}
[(#SET{date_future,[(#ENV{date}|ajouter_des_jours{7})]})]
<BOUCLE_auteur(AUTEURS){id_auteur = #SESSION{id_auteur}}{tout}>

	[(#REM)
		Si on a un abonnement valide sur le site, on l'affiche.
	]
	<BOUCLE_abo_valide(AUTEURS_ELARGIS_ABONNEMENTS abonnements){id_auteur}{validite > #GET{date_future}}>
		<h2><:abo:votre_abonnement:></h2>

		#SET{ladate,#VALIDITE|affdate}
		#LIBELLE - <:abo:echeance_le{date=#GET{ladate}}:>
	</BOUCLE_abo_valide>		

		[(#REM)
			Sinon on teste si on etait deja abonne
			et que l'abonnement est perime
		]	
		<BOUCLE_abo_echu(AUTEURS_ELARGIS_ABONNEMENTS abonnements){id_auteur}{validite > 0}>

			[(#ENV{reabo}|non)
				<h2><:abo:votre_abonnement:></h2>
				
				<div class="abonnement_echeance">
				<p>
				#SET{ladate,#VALIDITE|affdate}
				#SET{proche,#VALIDITE|>{#ENV{date}}|oui}
				[(#GET{proche}|non)<:abo:echance_abonnement_passee{date=#GET{ladate},titre=#LIBELLE}:>]
				[(#GET{proche}|oui)<:abo:echance_abonnement_proche{date=#GET{ladate},titre=#LIBELLE}:>]
				</p>
				<p>
				[(#GET{proche}|non)<:abo:renouveler_abonnement_passe{date=#GET{ladate},titre=#LIBELLE}:>]
				[(#GET{proche}|oui)<:abo:renouveler_abonnement_proche{date=#GET{ladate},titre=#LIBELLE}:>]
				</p>
				</div>
			]
			#FORMULAIRE_COMMANDER_ABONNEMENT
			
		</BOUCLE_abo_echu>
			#SET{pas_abo,oui}
		<//B_abo_echu>

		[(#REM)
			Et on affiche aussi la liste des articles payes
		]			
		<B_articles>
			<h2><:abo:vos_articles:></h2>
			<ul>
			<BOUCLE_articles(AUTEURS_ELARGIS_ARTICLES articles){id_auteur_elargi = #ID_AUTEUR}>
			<li><a href="#URL_ARTICLE">#TITRE</a></li>
			</BOUCLE_articles>
			</ul>
		</B_articles>

		[(#GET{pas_abo}|=={oui}|oui)
			#FORMULAIRE_COMMANDER_ABONNEMENT
		]
	<//B_abo_valide>		

</BOUCLE_auteur>
