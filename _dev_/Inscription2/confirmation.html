<html>
<head>
	<title>Page de confirmation de l inscription</title>
<script language="javascript" src="#URL_PAGE{'md5.js'}"></script>
<script language="javascript">
<!--
  function cryptage() {
    if(document.password.pass.value == document.password.pass2.value){
		str = document.password.pass.value;
		document.password.pass.value = MD5(str);
		document.password.pass2.value = '';
	}else{
		document.password.pass.value = '';
		document.password.pass2.value = '';
	}
  }
// -->
</script>
</head>

<body>
<?php
	$id = $_GET['id'];
	$mode = $_GET['mode'];
	$cle = $_GET['cle'];
	$pass = $_POST['pass'];
	if($id != '' and $mode != '' and $cle != '' and $pass == ''){
		$n = confirmation($id, $mode, $cle);
		if ($n == 'pass'){
	?>
		<h1>Choissisez votre mot de passe</h1>
		<form name='password' method='post' action="#SELF" >
		Inserez votre mot de passe&nbsp;:
		<input type='text' name='pass' id='pass'>
		Reinserez votre mot de passe&nbsp;:
		<input type='text' name='pass2' id='pass2'>
	
		<input onClick="cryptage();" type="submit" value='<:bouton_valider:>'/>
	<?php 	
		}elseif($n == 'sup'){
			spip_query("DELETE FROM spip_auteurs WHERE id_auteur = '$id'");
			spip_query("DELETE FROM spip_auteurs_elargis WHERE id_auteur = '$id'");
			echo "suppresion effectu&eacute;";
		}else
			echo "rien a faire";
	}else{
		$htpass = generer_htpass($pass);
		spip_query("UPDATE spip_auteurs SET statut = '6forum', pass='$pass', htpass='$htpass', alea_actuel='' WHERE id_auteur = ".$id);
		echo "mot de passe chang&eacute;";
	}	
?>
</body>
</html>