#CACHE{0}
<h3><:lienscontenus:liens_inter_contenus:></h3>
<B_objets_avec_liens_vers_courant>
    <p><:lienscontenus:objets_avec_liens_vers_courant:></p>
    <ul class="liens_contenus" id="liens_contenus_contenants">
    <BOUCLE_objets_avec_liens_vers_courant(SPIP_LIENS_CONTENUS){type_objet_contenu=#TYPE_OBJET}{id_objet_contenu=#ID_OBJET}{par type_objet_contenant, id_objet_contenant}>
        <li class="#TYPE_OBJET_CONTENANT[ (#TYPE_OBJET_CONTENANT|lienscontenus_statut{#ID_OBJET_CONTENANT})]">[(#TYPE_OBJET_CONTENANT|lienscontenus_icone_statut{#ID_OBJET_CONTENANT}) ]<a href="[(#TYPE_OBJET_CONTENANT|lienscontenus_generer_url{#ID_OBJET_CONTENANT})]">#TYPE_OBJET_CONTENANT #ID_OBJET_CONTENANT</a></li>
    </BOUCLE_objets_avec_liens_vers_courant>
    </ul>
</B_objets_avec_liens_vers_courant>
<p><:lienscontenus:aucun_objets_avec_lien_vers_courant:></p>
<//B_objets_avec_liens_vers_courant>
<B_objets_avec_liens_depuis_courant>
    <p><:lienscontenus:objets_avec_liens_depuis_courant:></p>
    <ul class="liens_contenus" id="liens_contenus_contenus">
    <BOUCLE_objets_avec_liens_depuis_courant(SPIP_LIENS_CONTENUS){type_objet_contenant=#TYPE_OBJET}{id_objet_contenant=#ID_OBJET}{par type_objet_contenu, id_objet_contenu}>
        <li class="#TYPE_OBJET_CONTENU [(#TYPE_OBJET_CONTENU|lienscontenus_verifier_si_existe{#ID_OBJET_CONTENU})]">[(#TYPE_OBJET_CONTENU|lienscontenus_icone_statut{#ID_OBJET_CONTENU}) ]<a href="[(#TYPE_OBJET_CONTENU|lienscontenus_generer_url{#ID_OBJET_CONTENU})]">#TYPE_OBJET_CONTENU #ID_OBJET_CONTENU</a></li>
    </BOUCLE_objets_avec_liens_depuis_courant>
    </ul>
	<p style="font-size: 0.8em;"><:lienscontenus:legende_liens_faux_objets:></p>
</B_objets_avec_liens_depuis_courant>
<p><:lienscontenus:aucun_objets_avec_lien_depuis_courant:></p>
<//B_objets_avec_liens_depuis_courant>
<script language="javascript" type="text/javascript">
$(document).ready(function() {
	// TODO : a ne faire que dans une page article
	// TODO : gerer le cas des breves et des sites
	// on recupere le statut actuel et le code par defaut du onchange
	var initialStatut = $('select[@name=statut_nouv] > option[@selected]').attr('value');
	var currentStatut = initialStatut;
	var currentOnChange = $('select[@name=statut_nouv]').attr('onchange').replace('/this/', '$(\'select[@name=statut_nouv]\')');

	// on supprime le onchange par defaut
	/*
	Cela ne marche pas ???
	$('select[@name=statut_nouv]').unbind('change');
	*/
	$('select[@name=statut_nouv]').removeAttr('onchange');

	// on gere un onchange specifique
	$('select[@name=statut_nouv]').bind('change', function(event) {
		// Si le statut initial etait "publie" et s'il y a au moins un contenu publie qui pointe vers lui, on demande confirmation
		if ((initialStatut == 'publie') && (currentStatut == 'publie') && ($('#liens_contenus_contenants > li.publie').size() > 0)) {
			if (confirm('<:lienscontenus:confirmation_depublication:>')) {
				var newStatut = $('select[@name=statut_nouv] > option[@selected]').attr('value');
				currentStatut = newStatut; 
				/*
				Cela ne marche pas... :(
				eval(currentOnChange);
				*/
				$('select[@name=statut_nouv]').next("img").attr('src', '../dist/images/' + puce_statut(newStatut));
				setvisibility('valider_statut', 'visible');
			} else {
				$('select[@name=statut_nouv] > option[@selected]').removeAttr('selected');
				$('select[@name=statut_nouv] > option[@value=publie]').attr('selected', 'selected');
			}
		} else {
			var newStatut = $('select[@name=statut_nouv] > option[@selected]').attr('value');
			currentStatut = newStatut;
			/*
			Cela ne marche pas... :(
			eval(currentOnChange);
			*/
			$('select[@name=statut_nouv]').next("img").attr('src', '../dist/images/' + puce_statut(newStatut));
			setvisibility('valider_statut', 'visible');
		}
	});
});
</script>
