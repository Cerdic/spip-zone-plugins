	<script type="text/javascript">
	if (document.namespaces) { // only needed in IE
     document.namespaces.add("v", "urn:schemas-microsoft-com:vml");
	}
	//<![CDATA[
	URLbase = "#URL_SITE_SPIP/";
	var map;
	var markerManager;
	<BOUCLE_centrado(GIS){id_article?}{id_rubrique ?}{0,1}>
	#SET{latitude,#ENV{latit,#LAT}}
	#SET{lonxitude,#ENV{lonxit,#LONX}}
	</BOUCLE_centrado>
	#SET{latitude,#ENV{latit,#CONFIG**{geomap_default_lat,0}}}
	#SET{lonxitude,#ENV{lonxit,#CONFIG**{geomap_default_lonx,0}}}
	<//B_centrado>
	function load() {
		if (GBrowserIsCompatible()) {
			// facelo mapa
			map = new GMap2(document.getElementById("map"));
    		map.addControl(new mapTypeControl());
			map.addControl(new mapZoomControl());
			map.addControl(new mapMoveControl());
    		map.setCenter(new GLatLng(#GET{latitude}, #GET{lonxitude}), #ENV{zoom,#CONFIG**{geomap_default_zoom,0}}, G_SATELLITE_MAP);
    		center = map.getCenter();
    		map.enableDoubleClickZoom();
    		map.enableContinuousZoom();
    		markerManager = new GMarkerManager(map);
			<BOUCLE_kml_art(documents){id_article}{0,1}{extension=kml}>
			[(#ENV{id_article}|=={''}|?{'',
			var kml = new GGeoXml("#URL_SITE_SPIP/#URL_DOCUMENT");
			map.addOverlay(kml)
			})]
			</BOUCLE_kml_art>
			<BOUCLE_kml_rub(documents){id_rubrique}{0,1}{extension=kml}>
			[(#ENV{id_rubrique}|=={''}|?{'',
			var kml = new GGeoXml("#URL_SITE_SPIP/#URL_DOCUMENT");
			map.addOverlay(kml)
			})]
			</BOUCLE_kml_rub>
			<//B_kml_art>
  			//leemo-lo documento dos marcadores
       			$.get('[(#URL_PAGE{rss-gis})]', {[id_rubrique:(#ID_RUBRIQUE)][, id_mot:(#ID_MOT)][, id_auteur:(#ID_AUTEUR)][, recherche:(#RECHERCHE)][, id_article:(#ID_ARTICLE)]}, function(xml){
    				//xml almacena en un objeto xml los datos recogidos del documento leido
    				$("item", xml).each(function(item){
    					/*primero buscamos dentro del objeto xml almacenado en xml todos los nodos "item", el contenido de cada nodo "item" del documento xml
    					se almacena en la variable xmlItem (*en la variable item se almacena la posicion del "item" actual en el array de items y asi podemos
    					recorrerlos con facilidad)*/
    					var xmlItem = xml.documentElement.getElementsByTagName("item")[item];
   						agregarMarcador(xmlItem, 0);
					});
					markerManager.refresh();
   				});
   			}
		}
	//]]>
	</script>