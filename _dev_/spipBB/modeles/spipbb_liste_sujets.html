#CACHE{0}
<BOUCLE_forum_principal(ARTICLES){id_article}>
[(#REM) On recupere le mot cle ferme]
#SET{id_mot_ferme,#CONFIG{spipbb/spipbb_id_mot_ferme}}

[(#REM) on regarde si l'article/forum est ferme ]
#SET{forumferme,0}
<BOUCLE_etat_forum(ARTICLES){id_article}{id_mot=#GET{id_mot_ferme}}>
	#SET{forumferme,1}
</BOUCLE_etat_forum>
<hr class="clr" /> <!-- Permet l'affichage correctement pour certaines versions de safari -->
<table summary="topics" class="spipforum">
	<thead>
	<tr> 
		<th colspan="2" class="tsujet"><:spipbb:sujets:></th>
		<th class="tmsg"><:spipbb:messages:></th>
		<th class="tsujaut"><:spipbb:sujet_auteur:></th>
		<th class="tmsg"><:spipbb:visites:></th>
		<th class="tdermsg"><:spipbb:messages_derniers:></th>
	</tr>
	</thead>

	[(#SET{titreferme,[(#GET{forumferme}|=={0}|?{' ',
	<tr class="forum_clos">
		<td colspan='6'><:spipbb:forum_ferme:></td>
	</tr>
	})]
	})]
	#GET{titreferme}

[(#REM) Les annonces en premier]
<BOUCLE_messages_annonce(FORUMS){id_article}{!par date_thread}{id_mot=#CONFIG{spipbb/spipbb_id_mot_annonce}}{doublons annonces}>
	<!-- C est forcement un pied de discussion -->
	#SET{id_forum_annonce,#ID_FORUM}
	<!-- BEGIN topicrow_a -->
	<tr>
		<td class='etatsuj annpost'>&nbsp;<span><:spipbb:annonce:></span>&nbsp;</td>
		<td class="titre" id="forum#ID_FORUM">
			<BOUCLE_sujet_a(FORUMS){id_thread}>
			[<a href="(#URL_PAGE{voirsujet}|parametre_url{id_forum,#ID_FORUM})">
			#TITRE
			</a>]
			</BOUCLE_sujet_a>
		</td>
		<td class="msgpost">
			<BOUCLE_reponses_a(FORUMS){id_thread}{plat}{exclus}></BOUCLE_reponses_a>
			#TOTAL_BOUCLE
			<//B_reponses_a>
		</td>
		<td class="autpost">
			<BOUCLE_auteurp_a(AUTEURS){id_auteur}{tout}>
			<a href="[(#URL_PAGE{profil_BB}|parametre_url{id_auteur,#ID_AUTEUR}|parametre_url{id_article,#ID_ARTICLE})]">#NOM</a>
			</BOUCLE_auteurp_a>
			<a href="mailto:[(#EMAIL|antispam)]">[(#NOM|sinon{<:spipbb:anonyme:>})]</a>
			<//B_auteurp_a>
		</td>
		<td class="msgpost">
			<BOUCLE_vues_a(SPIP_VISITES_FORUMS){id_forum}>#VISITES</BOUCLE_vues_a></B_vues_a>0<//B_vues_a>
		</td>
		<td class="dermsg">
		<BOUCLE_dernier_message_a(FORUMS){id_thread}{plat}{par date}{inverse}{0,1}>
			[(#DATE|nom_jour)] [(#DATE|affdate),] [(#DATE|heures)]:[(#DATE|minutes)]<br />
			<B_auteurpr_a>
			<:par_auteur:>
			<BOUCLE_auteurpr_a(AUTEURS){id_auteur}{tout}>
				<a href="[(#URL_PAGE{profil_BB}|parametre_url{id_auteur,#ID_AUTEUR}|parametre_url{id_article,#ID_ARTICLE})]">#NOM</a>
				</BOUCLE_auteurpr_a></B_auteurpr_a>
				<a href="mailto:[(#EMAIL|antispam)]">[(#NOM|sinon{<:spipbb:anonyme:>})]</a>
				<//B_auteurpr_a> 
				<a href="[(#URL_PAGE{voirsujet}|parametre_url{id_forum,#ENV{id_forum_annonce}})]#forum#ID_FORUM"class="adermsg" title="<:spipbb:messages_voir_dernier:>">
				&nbsp;<span>(<:spipbb:messages_voir_dernier:>)</span></a>
		</BOUCLE_dernier_message_a> - <//B_dernier_message_a>
		</td>
	</tr>
	<!-- END topicrow_a -->
</BOUCLE_messages_annonce>
<BOUCLE_messages_postit(FORUMS){id_article}{!par date_thread}{id_mot=#CONFIG{spipbb/spipbb_id_mot_postit}}{doublons annonces}>
	<!-- C est forcement un pied de discussion -->
	#SET{id_forum_postit,#ID_FORUM}
	<!-- BEGIN topicrow_p -->
	<tr>
		<td class='etatsuj postitpost'>&nbsp;<span><:spipbb:postit:></span>&nbsp;</td>
		<td class="titre" id="forum#ID_FORUM">
			<BOUCLE_sujet_p(FORUMS){id_thread}>
			[<a href="(#URL_PAGE{voirsujet}|parametre_url{id_forum,#ID_FORUM})">
			#TITRE
			</a>]
			</BOUCLE_sujet_p>
		</td>
		<td class="msgpost">
			<BOUCLE_reponses_p(FORUMS){id_thread}{plat}{exclus}></BOUCLE_reponses_p>
			#TOTAL_BOUCLE
			<//B_reponses_p>
		</td>
		<td class="autpost">
			<BOUCLE_auteurp_p(AUTEURS){id_auteur}{tout}>
			<a href="[(#URL_PAGE{profil_BB}|parametre_url{id_auteur,#ID_AUTEUR}|parametre_url{id_article,#ID_ARTICLE})]">#NOM</a>
			</BOUCLE_auteurp_p>
			<a href="mailto:[(#EMAIL|antispam)]">[(#NOM|sinon{<:spipbb:anonyme:>})]</a>
			<//B_auteurp_p>
		</td>
		<td class="msgpost">
			<BOUCLE_vues_p(SPIP_VISITES_FORUMS){id_forum}>#VISITES</BOUCLE_vues_p></B_vues_p>0<//B_vues_p>
		</td>
		<td class="dermsg">
		<BOUCLE_dernier_message_p(FORUMS){id_thread}{plat}{par date}{inverse}{0,1}>
			[(#DATE|nom_jour)] [(#DATE|affdate),] [(#DATE|heures)]:[(#DATE|minutes)]<br />
			<B_auteurpr_p>
			<:par_auteur:>
			<BOUCLE_auteurpr_p(AUTEURS){id_auteur}{tout}>
				<a href="[(#URL_PAGE{profil_BB}|parametre_url{id_auteur,#ID_AUTEUR}|parametre_url{id_article,#ID_ARTICLE})]">#NOM</a>
				</BOUCLE_auteurpr_p></B_auteurpr_a>
				<a href="mailto:[(#EMAIL|antispam)]">[(#NOM|sinon{<:spipbb:anonyme:>})]</a>
				<//B_auteurpr_p> 
				<a href="[(#URL_PAGE{voirsujet}|parametre_url{id_forum,#ENV{id_forum_postit}})]#forum#ID_FORUM"class="adermsg" title="<:spipbb:messages_voir_dernier:>">
				&nbsp;<span>(<:spipbb:messages_voir_dernier:>)</span></a>
		</BOUCLE_dernier_message_p> - <//B_dernier_message_p>
		</td>
	</tr>
	<!-- END topicrow_p -->
</BOUCLE_messages_postit>
<BOUCLE_messages(FORUMS){id_article}{!par date_thread}{pagination 25}{doublons annonces}>
	#SET{thread_clos,non}
	#SET{id_forum,#ID_FORUM}

	<BOUCLE_reponsesalt(FORUMS){id_thread}{plat}> 
		<BOUCLE_reponse_fermealt(FORUMS){id_forum}{id_mot=#CONFIG{spipbb/spipbb_id_mot_ferme}}>
			#SET{thread_clos,#ID_FORUM}
		</BOUCLE_reponse_fermealt>
	</BOUCLE_reponsesalt>
	
	[(#REM) test line type thread ou ferme utilise plus bas]
	[(#SET{aff_ico_thread,[(#GET{thread_clos}|=={non}|?{
		<td class='etatsuj normpost'><span>&nbsp;,<td class='etatsuj fermpost'><span>&nbsp;
	})]
	})]

	<!-- BEGIN topicrow -->
	<tr>
		[(#GET{aff_ico_thread})]<:message:></span>&nbsp;</td>
		<td class="titre" id="forum#ID_FORUM">
			<BOUCLE_sujet(FORUMS){id_thread}>
			[<a href="(#URL_PAGE{voirsujet}|parametre_url{id_forum,#ID_FORUM})">#TITRE</a>]
			</BOUCLE_sujet>
		</td>
		<td class="msgpost">
			<BOUCLE_reponses(FORUMS){id_thread}{plat}{exclus}></BOUCLE_reponses>
			#TOTAL_BOUCLE
			<//B_reponses>
		</td>
		<td class="autpost">
			<BOUCLE_auteurp(AUTEURS){id_auteur}{tout}>
			<a href="[(#URL_PAGE{profil_BB}|parametre_url{id_auteur,#ID_AUTEUR}|parametre_url{id_article,#ID_ARTICLE})]">#NOM</a>
			</BOUCLE_auteurp>
			<a href="mailto:[(#EMAIL|antispam)]">[(#NOM|sinon{<:spipbb:anonyme:>})]</a>
			<//B_auteurp>
		</td>
		<td class="msgpost">
			<BOUCLE_vues(SPIP_VISITES_FORUMS){id_forum}>#VISITES</BOUCLE_vues></B_vues>0<//B_vues>
		</td>
		<td class="dermsg">
		<BOUCLE_dernier_message(FORUMS){id_thread}{plat}{!par date}{0,1}>
			[(#DATE|nom_jour)] [(#DATE|affdate),] [(#DATE|heures)]:[(#DATE|minutes)]<br />
			<B_auteurpr>
			<:par_auteur:>
			<BOUCLE_auteurpr(AUTEURS){id_auteur}{tout}>
			<a href="[(#URL_PAGE{profil_BB}|parametre_url{id_auteur,#ID_AUTEUR}|parametre_url{id_article,#ID_ARTICLE})]">#NOM</a>
			</BOUCLE_auteurpr></B_auteurpr>
			[(#NOM|sinon{<:spipbb:anonyme:>})]
			<//B_auteurpr> 
			<a href="[(#URL_PAGE{voirsujet}|parametre_url{id_forum,#GET{id_forum}})]#forum#ID_FORUM" class="adermsg" title="<:spipbb:messages_voir_dernier:>">
			&nbsp;<span>(<:spipbb:messages_voir_dernier:>)</span></a>
		</BOUCLE_dernier_message> - <//B_dernier_message>
		</td>
	</tr>
	<!-- END topicrow -->
</BOUCLE_messages>

</table><!--Fin table spipforum-->

[<div class="pagination"> <!-- Section présentant la pagination -->
	<div class="navigapage"> <!-- Section de la liste de page -->
		<p class="nav">(#PAGINATION)</p>
	</div>
</div>]
</B_messages>

<!-- BEGIN switch_no_topics -->
<table class="spipforum">
	<tr> 
		<td class="nopost"><:spipbb:sujets_aucun:></td>
	</tr>
</table><!--Fin table spipforum-->
<!-- END switch_no_topics -->
<//B_messages>
</BOUCLE_forum_principal>
