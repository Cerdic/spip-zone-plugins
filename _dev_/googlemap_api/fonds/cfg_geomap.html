#CACHE{0}

<!-- titre=GoogleMap API-->
<!-- descriptif=
<h4><:geomap:configuration_titre:></h4>
-->

<div class="formulaire_spip formulaire_editer formulaire_cfg">
[(#CONFIG{geomap/cle_api}|oui)
<div id="formMap" style="width: 470px; height: 350px;margin:10px auto;overflow:hidden"></div>
<form action="#" onsubmit="showAddress($('#address').attr('value')); return false">
	<p>
		<input size="50" name="address" id="address" value="" type="text" />
		<input value="<:geomap:rechercher:>" type="submit" />
	</p>
</form>]
<script type="text/javascript">
/*<![CDATA[*/
[(#CONFIG{geomap/cle_api}|?{' '})
	var geocoder = null;
	var formMap = null;
	function showAddress(address) {
		if (geocoder) {
			geocoder.getLatLng(address, function(point) {
				if (!point) {
					alert(address+" not found");
				} else {
					formMap.setCenter(point);
				}
			});
		}
	}
	if (GBrowserIsCompatible()) {
		var lat= #CONFIG{geomap/latitude,0.0};
		var long= #CONFIG{geomap/longitude,0.0};
		formMap = new GMap2(document.getElementById("formMap"));
		formMap.addControl(new GLargeMapControl());
		formMap.addControl(new GMapTypeControl());
		formMap.setCenter(new GLatLng(lat,long), #CONFIG{geomap/zoom,0});
		geocoder = new GClientGeocoder();
	[(#CONFIG{geomap/latitude}|oui)
		point = new GPoint(parseFloat(long),parseFloat(lat));
		marker = new GMarker(point,{draggable:true});
		formMap.addOverlay(marker);
		GEvent.addListener(marker, 'dragend', function(){
			var point = marker.getPoint();
			jQuery("#latitude").val(point.lat());
			jQuery("#longitude").val(point.lng());
		});
	]
		// si clic sur la carte on place un marqueur
		GEvent.addListener(formMap, 'click', function(overlay,point) {
			formMap.clearOverlays();
			if(point){
				marker = new GMarker(point,{draggable:true}); 
				formMap.addOverlay(marker);
				var center = marker.getPoint();
				var zoom = formMap.getZoom();
				jQuery("#form_lat").val(center.lat());
				jQuery("#form_long").val(center.lng());
				jQuery("#form_zoom").val(zoom);
				GEvent.addListener(marker, 'dragend', function(){
					var center = marker.getPoint();
					jQuery("#form_lat").val(center.lat());
					jQuery("#form_long").val(center.lng());
				});
			}
		});
		// si changement de zoom on centre la carte sur le marqueur
		GEvent.addListener(formMap, 'zoomend', function(oldlevel, newlevel){
			jQuery("#zoom").val(newlevel);
			var center = marker.getPoint();
			formMap.setCenter(new GLatLng(center.lat(),center.lng()));
			}
		);
		} else {
			alert("Sorry, the Google Maps API is not compatible with this browser");
		}
]
(function($){
	$(function(){
		$("a.spip_out").attr({
			target: "_blank"
		})
		$("input[@name='api_version']").click(function() {
			if ($("#other_version").is(':checked')){
				$(".num_other_version_container").show();
				$(this).blur();
			}
			else
				$(".num_other_version_container").hide();
		});
	});
})(jQuery);
/*]]>*/
</script>
<form method="post" action="#SELF"><div>
	[(#ENV{_cfg_}|form_hidden)]
	<ul>
		<li class="editer_cle_api_geomap">
			<label for="cle_api"><:geomap:cle:></label>
			<p class="explications"><:geomap:explication_cle:></p>
			<input type="text" name="cle_api" class="text" value="#ENV*{cle_api}" id="cle_api" />
		</li>
		<li class="editer_api_version_geomap">
			<label><:geomap:api_version:></label>
			<p class="explications"><:geomap:explication_api_version:></p>
			<div class="choix">
				<input type="radio" name="api_version" class="radio" value="2" id="current_version"[ (#ENV{api_version,2}|=={'2'}|?{'checked="checked"'})] />
				<label for="current_version"><:geomap:current_version:></label>
			</div>
			<div class="choix">
				<input type="radio" name="api_version" class="radio" value="2.x" id="lastest_version"[ (#ENV{api_version}|=={'2.x'}|?{'checked="checked"'})] />
				<label for="lastest_version"><:geomap:lastest_version:></label>
			</div>
			<div class="choix">
				<input type="radio" name="api_version" class="radio" value="2.s" id="stable_version"[ (#ENV{api_version}|=={'2.s'}|?{'checked="checked"'})] />
				<label for="stable_version"><:geomap:stable_version:></label>
			</div>
			<div class="choix">
				<input type="radio" name="api_version" class="radio" value="2." id="other_version"[ (#ENV{api_version}|match{'^2\.'}|?{'checked="checked"'})] />
				<label for="other_version"><:geomap:other_version:></label>
				<div style="display:[(#ENV{api_version}|match{'^2\.'}|?{'block','none'})]" class="num_other_version_container">
					<input type="text" name="num_other_version" class="text" value="#ENV*{num_other_version}" id="num_other_version" />
				</div>
			</div>
		</li>
		<li class="editer_latitude_geomap">
			<label for="latitude"><:geomap:latitude:></label>
			<input type="text" name="latitude" class="text" value="#ENV*{latitude,0.0}" id="latitude" />
		</li>
		<li class="editer_longitude_geomap">
			<label for="longitude"><:geomap:longitude:></label>
			<input type="text" name="longitude" class="text" value="#ENV*{longitude,0.0}" id="longitude" />
		</li>
		<li class="editer_zoom_geomap">
			<label for="zoom"><:geomap:zoom:></label>
			<input type="text" name="zoom" class="text" value="#ENV*{zoom,0}" id="zoom" />
		</li>
		<li class="editer_custom_control_geomap">
			<label><:geomap:pages_public:></label>
			<p class="explications"><:geomap:explication_custom_control:></p>
			<div class="choix">
				<input type="checkbox" name="custom_control" class="checkbox" value="non" id="custom_control"[ (#ENV{custom_control}|=={non}|?{'checked="checked"'})] />
				<label for="custom_control"><:geomap:desactiver_custom_control:></label>
			</div>
		</li>
	</ul>
	<p class="boutons">
		<input type="submit" name="_cfg_ok" class="submit" value="<:valider:>" />
		<input type="submit" name="_cfg_delete" class="submit" value="<:effacer:>" />
	</p>
</div></form>
</div>
#CFG_ARBO{geomap}
