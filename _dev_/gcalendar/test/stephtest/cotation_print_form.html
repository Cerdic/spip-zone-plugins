<BOUCLE_laclasse(SPIP_COTES_CLASSES){id_classe=4}><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>



<script src="spip.php?page=jquery.js" type="text/javascript"></script>
<title>Liste des cotes - classe #NOM</title>
<style type="text/css"> <!-- 	

	body {
	font-family:arial, geneva, sans-serif;
	font-size:10px;	
	}
	
	table {
	font-size: 10px;
	width:100%;
	border-collapse: collapse;
	}
	
	td {
	vertical-align: top;
	padding:3px;
	border:1px solid #333;
	}
	
	.td1 {
	width: 20%;
	text-align: right;
	padding-right: 1em;
	padding-bottom: 10px;
	white-space:nowrap;
	}
	
	.td2 {
	padding-bottom: 10px;
	}
	
	.nom {
	font-weight: bold;
	font-size: 12px;
	}
	
	
	.total {
	background-color:#ddd;
	white-space:nowrap;
	}
	
	.moyenne {
	background-color:#eee;
	font-weight:bold;
	}
	
	.sep {
	border-top: 1px solid #000;
	padding: 0.5em 0;
	}
	
	#lecteur {
	padding: 3px;
	text-align:center;
	border-top:1px solid #333;
	border-bottom:1px solid #333;
	}
	
	ul, li {
	margin:0;
	padding:0;
	list-style-type:none;	
	}
	
	.moins12 {
	background-color:yellow;	
	}
	.moins10 {
	background-color:red;
	}
	.zero {
	background-color:#666;
	color:#fff;
	}
	.moinsun {
	background-color:blue;	
	}
	
	-->
</style>
<script type="text/javascript">
$(document).ready(function(){  

	
});

</script>

</head>
<body>
<div id="general">

<div id="corps">

<div id="header">

<div class="texteheader">
<h1>Tableau de cotes</h1>
</div>
<div class="clearer_header"></div>
</div>


<!-- blocs corps par defaut -->

<div id="texteconteneur">
<div class="texte">Pour la classe #NOM</div>
</div>

<?php
if(isset($_POST['exercices'])){
?>
<div class="listagebloc">
<h2 >Resultat</h2>
<ul class="listageconteneur"><li>
<table>
<!-- entete -->
<tr>
<td>Nom etudiant</td>
<BOUCLE_listeex(SPIP_COTES_EXERCICES){id_exercice IN #ENV*{exercices}}{par id_exercice}{id_classe}{titre!=""}{facteur!=0}>
<td class="shower">#TITRE (Facteur : #FACTEUR)</td>
</BOUCLE_listeex>
<td class="total">Total</td>
<td class="moyenne">Moyenne</td>
<td class="moyenne">Moyenne finale pondérée</td>
</tr>
<!-- corps de la table -->
<BOUCLE_eachstudent(SPIP_COTES_ETUDIANTS){id_classe}{par nom}>
<tr>
<td class="td1">#NOM #PRENOM</td>
<?php $total=0; $totalmax=0; $nbexerices=0; $moyenne=0; $facteurtot=0; ?>
<BOUCLE_listeex2(SPIP_COTES_EXERCICES){id_exercice IN #ENV*{exercices}}{par id_exercice}{id_classe}{titre!=""}{facteur!=0}>

<BOUCLE_lacote(SPIP_COTES_COTES){id_exercice}{id_classe}{id_etudiant}>

<?php
$points="";
if (#COTE <= 11.99){
$points="moins12";
}
if (#COTE <= 9.99){
$points="moins10";
}
if (#COTE <= 1){
$points="zero";
}
if (#COTE == -1){
$points="moinsun";	
}
?>

<td class="shower <?php echo $points; ?>">
[(#COTE|filtre0)]/#COTE_MAX
<?php
	// controle si l'etudiant n'a pas de dispense
	if ("#COTE" !="-1") {
		$total=$total + (#COTE * #FACTEUR);
		$totalmax = $totalmax + (#COTE_MAX * #FACTEUR);
		$nbexerices++;
		$facteurtot=$facteurtot+#FACTEUR;
	}

?></td>
</BOUCLE_lacote>

</BOUCLE_listeex2>

<td class="total">
<?php
echo $total."/".$totalmax;
echo " (".$nbexerices." ex, ".$facteurtot." eq)";
?>

</td>


<?php
$moyenne= round(($total/$totalmax)*20, 2);
$points="";
if ($moyenne <= 11.99){
$points="moins12";
}
if ($moyenne <= 9.99){
$points="moins10";
}
if ($moyenne <= 1){
$points="zero";
}
if ($moyenne == -1){
$points="moinsun";	
}
?>
<td class="moyenne <?php echo $points; ?>">
<?php
echo $moyenne."/20";
?>
</td>


<?php
$neomoyenne= round(($total/($totalmax-20))*20, 2);
$points="";
if ($neomoyenne <= 11.99){
$points="moins12";
}
if ($neomoyenne <= 9.99){
$points="moins10";
}
if ($neomoyenne <= 1){
$points="zero";
}
if ($neomoyenne == -1){
$points="moinsun";	
}
?>

<td class="<?php echo $points; ?>">
<?php
// resultat avec facteur -1

echo $neomoyenne."/20";
?>
</td>
</tr>
</BOUCLE_eachstudent>
<!-- fin de table -->

</table>
</li></ul>
</div>

<?php
}
?>
<!-- formulaire -->

<div class="listagebloc">
<h2 >Paramètres</h2>
<ul class="listageconteneur"><li>

<h4 class="listagetitre">Choisir les exercices à prendre en compte</h4>
<div class="listagetexte">
<form action="#SELF" method="post" id="exercices">
<input type="hidden" name="id_classe" value="4" />

<input type="hidden" name="truc" value="machin" />

<select name="exercices[]" size="10" multiple="true" style="width:100%" id="select_exercice">
<BOUCLE_exercices(SPIP_COTES_EXERCICES){id_classe=4}{facteur!=0}>
	<option value="#ID_EXERCICE">[(#TITRE)]</option>
</BOUCLE_exercices>
</select>

<input type="submit" value="lancer" />
</form>
</div>
<div class="listageinfo">
Les exercices dont la cote max est 0 ne sont pas pris en compte. Les exercices dont le facteur est 0 ne sont pas pris en compte dans la cotation.<br />
La moyenne est arrondie à deux chiffres après la virgules.
</div>
</li></ul>

</div>


<div id="fin-corps"></div><!-- fin du corps -->

</div>

<div id="fin-page"></div>

</div>
</body>
</html></BOUCLE_laclasse>