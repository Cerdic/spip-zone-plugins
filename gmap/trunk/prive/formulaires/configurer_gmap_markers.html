<div class="formulaire_spip configurer_gmap formulaire_configurer formulaire_#FORM">
<h3 class='titrem'>[<img src="(#CHEMIN_IMAGE{logo-config-markers.png})" class="cadre-icone">]<:gmap:configuration_markers:></h3>
	[<p class="reponse_formulaire reponse_formulaire_ok">(#ENV**{message_ok})</p>]
	[<p class="reponse_formulaire reponse_formulaire_erreur">(#ENV*{message_erreur})</p>]
	<form method='post' action='#ENV{action}'><div>
		[(#REM) declarer les hidden qui declencheront le service du formulaire parametre : url d'action ]
		#ACTION_FORMULAIRE{#ENV{action}}

		<table class="edit_types" id="edit_types">
			<tbody>
				<tr class="header"><th><:gmap:edit_types_objet:></th><th><:gmap:edit_types_nom:></th><th><:gmap:edit_types_descriptif:></th><th><:gmap:edit_types_visible:></th><th><:gmap:edit_types_priorite:></th><th><:gmap:edit_types_usage:></th><th>&nbsp;</th></tr>
				<tr class="hidden" id="edit_types_template">
					<td>
						<select name="objet\[\]" class="objet" size="1">
							<option value="" selected="selected"><:gmap:edit_types_objet_tous:></option>
							<option value="rubrique"><:gmap:edit_types_objet_rubrique:></option>
							<option value="article"><:gmap:edit_types_objet_article:></option>
							<option value="breve"><:gmap:edit_types_objet_breve:></option>
							<option value="document"><:gmap:edit_types_objet_document:></option>
							<option value="mot"><:gmap:edit_types_objet_mot:></option>
							<option value="auteur"><:gmap:edit_types_objet_auteur:></option>
						</select>
					</td>
					<td><input type="text" name="nom_0" class="nom" value="nom"></td>
					<td><input type="text" name="descriptif_0" class="descriptif" value="descriptif"></td>
					<td>
						<select name="visible\[\]" class="visible" size="1">
							<option value="oui" selected="selected"><:gmap:oui:></option>
							<option value="non"><:gmap:non:></option>
						</select>
					</td>
					<td><input type="text" name="priorite\[\]" class="priorite" value="10"></td>
					<td>&nbsp;</td>
					<td><input type="hidden" name="id\[\]" class="id" value="template"><input type="hidden" name="oper\[\]" clas="oper" value="create"><span class="btn_delete" /></td>
				</tr>
#SET{objets, #REM|lister_tables_objets_sql}
<BOUCLE_types(DATA){source table, #ENV*{types}}>
	[(#VALEUR{editable}|non)
				<tr class="type">
					<td><input type="hidden" name="objet\[\]" value="#VALEUR{objet}"><:gmap:edit_types_objet_tous:></td>
					<td><input type="hidden" name="nom_#CLE" value="#VALEUR{nom}">#VALEUR{nom}</td>
					<td><input type="text" name="descriptif_#CLE" class="descriptif" value="#VALEUR{descriptif}"></td>
					<td><input type="hidden" name="visible\[\]" value="#VALEUR{visible}">[(#VALEUR{visible}|=={oui}|?{<:gmap:oui:>, <:gmap:non:>})]</td>
					<td><input type="hidden" name="priorite\[\]" value="#VALEUR{priorite}">#VALEUR{priorite}</td>
					<td>[(#VALEUR{nb_points}|>{0}|?{#VALEUR{nb_points},'&nbsp;'})]</td>
					<td><input type="hidden" name="id\[\]" class="id" value="#CLE"><input type="hidden" name="oper\[\]" class="oper" value="update"></td>
				</tr>
	][(#VALEUR{editable}|oui)
			<tr class="type">
				<td>
					<select name="objet\[\]" class="objet" size="1">
						<option value=""[(#VALEUR{objet}|=={''}) selected="selected"]><:gmap:edit_types_objet_tous:></option>
	#INCLURE{fond=formulaires/inc-option-objets,objet=#VALEUR{objet},exclus=spip_geopoints}
					</select>
				</td>
				<td><input type="text" name="nom_#CLE" class="nom" value="#VALEUR{nom}"></td>
				<td><input type="text" name="descriptif_#CLE" class="descriptif" value="#VALEUR{descriptif}"></td>
				<td>
					<select name="visible\[\]" class="visible" size="1">
						<option value="oui"[(#VALEUR{visible}|=={oui}) selected="selected"]><:gmap:oui:></option>
						<option value="non"[(#VALEUR{visible}|=={non}) selected="selected"]><:gmap:non:></option>
					</select>
				</td>
				<td><input type="text" name="priorite\[\]" class="priorite" value="#VALEUR{priorite}"></td>
				<td>[(#VALEUR{nb_points}|>{0}|?{#VALEUR{nb_points},'&nbsp;'})]</td>
				<td><input type="hidden" name="id\[\]" class="id" value="#CLE"><input type="hidden" name="oper\[\]" class="oper" value="update">[(#VALEUR{nb_points}|=={0}|?{<span class="btn_delete" />,})]</td>
			</tr>
	]
</BOUCLE_types>
				<tr id="edit_types_actions">
					<td colspan="7"><a id="edit_types_new" href="#"><span class="btn_add_type" />&nbsp;<:gmap:edit_types_add_type:></a></td>
				</tr>
			</tbody>
		</table>
	
<script type="text/javascript">
//<![CDATA[
function EditType()
{
}
EditType.root = '#edit_types';
EditType.deleteRowHandler = function(event)
{
	event.preventDefault();
	var row = jQuery(this).closest("tr");
	row.addClass("hidden");
	var prevOper = jQuery("input.oper", row).val();
	if (prevOper == "create")
		jQuery("input.oper", row).val("noop");
	else
		jQuery("input.oper", row).val("delete");
};
EditType.newRowHandler = function(event)
{
	event.preventDefault();
	var container = jQuery(this).closest("table.edit_types");
	var numRows = jQuery("tr.type", container).length;
	var newRow = jQuery("#edit_types_template", container).clone();
	newRow.removeClass("hidden").addClass("type").removeAttr("id");
	var id = "new"+numRows;
	jQuery("input.id", newRow).val(id);
	jQuery("input.oper", newRow).val("create");
	jQuery("input.nom", newRow).attr("name", "nom_"+id);
	jQuery("input.descriptif", newRow).attr("name", "descriptif_"+id);
	jQuery(".btn_delete", newRow).click(EditType.deleteRowHandler);
	newRow.insertBefore(jQuery("#edit_types_actions", container));
};
jQuery(document).ready(function()
{
	var container = jQuery(EditType.root);
	jQuery(".btn_delete", container).click(EditType.deleteRowHandler);
	jQuery("#edit_types_new", container).click(EditType.newRowHandler);
});
//]]>
</script>
		
		<p class='boutons'><span class='image_loading'>&nbsp;</span><input type='submit' class='submit' value='<:bouton_enregistrer:>' /></p>
	</div></form>
</div>