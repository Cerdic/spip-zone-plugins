[(#REM)

	Fichier GeoJSON par défaut pour les requêtes de marqueurs.
	
	La requête par défaut consiste à afficher les enfants géolocalisés de premier niveau
	par rapport à un objet de référence.
	Le paramètres admissibles sont :
	- id_rubrique ou id_secteur : les sous-rubriques, les articles, les documents, les brèves et les mots-clefs.
	- id_article : les documents et les mot-clefs d'un article.
	- id_mot : tous les objets liés à ce mot-clef.
	- id_groupe : restreint la liste des mots-clefs à ceux d'un groupe (id_groupe=0 permet de supprimer l'affichage des mots-clefs)
	
	Si aucun paramètre n'est fourni, la requête ne renvoie aucun point.
	
	Ce fichier ne s'applique pas si on donne comme point de départ une brève, un auteur ou un document,
	qui n'ont pas d'enfants.
	Pour représenter les points d'un objet géolocalisé seul, utilisez plutôt #GEOMAP{markers=local}.
	Pour représenter les points d'un type d'objet selon différents critères, utilisez #GEOMAP{markers=articles},
	#GEOMAP{markers=documents}, etc.
	
][(#CACHE{3600*24})][(#HTTP_HEADER{Content-type: text/plain; charset=utf-8})][(#SET{features, 0})]{	"type": "FeatureCollection",
	"features": #EVAL{'chr(91)'}[

	
	
(#REM) Boucle sur les articles, documents, sous-rubriques, brèves et mots-clefs d'une rubrique ]
<BOUCLE_rubriques(RUBRIQUES){id_rubrique=#ENV{id_rubrique}|sinon{#ENV{id_secteur}}}>[
	
	(#REM) Sous-rubriques ]
	<BOUCLE_rub_rubriques(RUBRIQUES){id_parent}><B_rub_rubriques_points>[(#GET{features}|>{0}|?{',',''})]<BOUCLE_rub_rubriques_points(GEOPOINTS){id_rubrique}{meilleur}{","}>
    {	"type": "Feature",
		"geometry": {"type": "Point", "coordinates": [#LONGITUDE,#LATITUDE]},
		"properties": {[
			"name": (#TITRE|textebrut|texte_json),][
			"html": (#GEOPOPUP{objet_parent=#_rubriques:OBJET,id_objet_parent=#_rubriques:ID_OBJET,contenu_seul=oui,json=oui}),][
			"icon": {(#GEOMARKERICONS{format=json})},][
			"objet": "(#OBJET)",][
			"id_objet": (#ID_OBJET),][
			"visible": "(#VISIBLE)",][
			"priorite": (#PRIORITE),]
			"type": "#TYPE_POINT",
			"zoom": #ZOOM
			}
	}</BOUCLE_rub_rubriques_points>[(#SET{features, #GET{features}|plus{#TOTAL_BOUCLE}})]</B_rub_rubriques_points></BOUCLE_rub_rubriques>[
	
	(#REM) Articles]
	<BOUCLE_rub_articles(ARTICLES){id_rubrique}><B_rub_articles_points>[(#GET{features}|>{0}|?{',',''})]<BOUCLE_rub_articles_points(GEOPOINTS){id_article}{meilleur}{","}>
    {	"type": "Feature",
		"geometry": {"type": "Point", "coordinates": [#LONGITUDE,#LATITUDE]},
		"properties": {[
			"name": (#TITRE|textebrut|texte_json),][
			"html": (#GEOPOPUP{objet_parent=#_rubriques:OBJET,id_objet_parent=#_rubriques:ID_OBJET,contenu_seul=oui,json=oui}),][
			"icon": {(#GEOMARKERICONS{format=json})},][
			"objet": "(#OBJET)",][
			"id_objet": (#ID_OBJET),][
			"visible": "(#VISIBLE)",][
			"priorite": (#PRIORITE),]
			"type": "#TYPE_POINT",
			"zoom": #ZOOM
			}
	}</BOUCLE_rub_articles_points>[(#SET{features, #GET{features}|plus{#TOTAL_BOUCLE}})]</B_rub_articles_points></BOUCLE_rub_articles>[
	
	(#REM) Documents]
	<BOUCLE_rub_documents(DOCUMENTS){id_rubrique}><B_rub_documents_points>[(#GET{features}|>{0}|?{',',''})]<BOUCLE_rub_documents_points(GEOPOINTS){id_document}{visible}{meilleur}{","}>
    {	"type": "Feature",
		"geometry": {"type": "Point", "coordinates": [#LONGITUDE,#LATITUDE]},
		"properties": {[
			"name": (#TITRE|sinon{doc#ID_DOCUMENT}|textebrut|texte_json),][
			"html": (#GEOPOPUP{objet_parent=#_rubriques:OBJET,id_objet_parent=#_rubriques:ID_OBJET,contenu_seul=oui,json=oui}),][
			"icon": {(#GEOMARKERICONS{format=json})},][
			"objet": "(#OBJET)",][
			"id_objet": (#ID_OBJET),][
			"visible": "(#VISIBLE)",][
			"priorite": (#PRIORITE),]
			"type": "#TYPE_POINT",
			"zoom": #ZOOM
			}
	}</BOUCLE_rub_documents_points>[(#SET{features, #GET{features}|plus{#TOTAL_BOUCLE}})]</B_rub_documents_points></BOUCLE_rub_documents>[
	
	(#REM) Brèves (seulement pour les rubriques racines) ]
	<BOUCLE_rub_breves(BREVES){id_rubrique}><B_rub_breves_points>[(#GET{features}|>{0}|?{',',''})]<BOUCLE_rub_breves_points(GEOPOINTS){id_breve}{meilleur}{","}>
	{	"type": "Feature",
		"geometry": {"type": "Point", "coordinates": [#LONGITUDE,#LATITUDE]},
		"properties": {[
			"name": (#TITRE|textebrut|texte_json),][
			"html": (#GEOPOPUP{contenu_seul=oui,json=oui}),][
			"icon": {(#GEOMARKERICONS{format=json})},][
			"objet": "(#OBJET)",][
			"id_objet": (#ID_OBJET),][
			"visible": "(#VISIBLE)",][
			"priorite": (#PRIORITE),]
			"type": "#TYPE_POINT",
			"zoom": #ZOOM
			}
	}</BOUCLE_rub_breves_points>[(#SET{features, #GET{features}|plus{#TOTAL_BOUCLE}})]</B_rub_breves_points></BOUCLE_rub_breves>[
	
	(#REM) Mots-clefs ]
	<BOUCLE_rub_mots(MOTS){id_rubrique}><B_rub_mots_points>[(#GET{features}|>{0}|?{',',''})]<BOUCLE_rub_mots_points(GEOPOINTS){id_mot}{meilleur}{","}>
	{	"type": "Feature",
		"geometry": {"type": "Point", "coordinates": [#LONGITUDE,#LATITUDE]},
		"properties": {[
			"name": (#TITRE|textebrut|texte_json),][
			"html": (#GEOPOPUP{contenu_seul=oui,json=oui}),][
			"icon": {(#GEOMARKERICONS{format=json})},][
			"objet": "(#OBJET)",][
			"id_objet": (#ID_OBJET),][
			"visible": "(#VISIBLE)",][
			"priorite": (#PRIORITE),]
			"type": "#TYPE_POINT",
			"zoom": #ZOOM
			}
	}</BOUCLE_rub_mots_points>[(#SET{features, #GET{features}|plus{#TOTAL_BOUCLE}})]</B_rub_mots_points></BOUCLE_rub_mots>
</BOUCLE_rubriques>[



(#REM) Boucle sur les documents et les mots-clefs d'un article ]
<BOUCLE_articles(ARTICLES){id_article=#ENV{id_article}}>[

	(#REM) Documents]
	<BOUCLE_art_documents(DOCUMENTS){id_article}><B_art_documents_points>[(#GET{features}|>{0}|?{',',''})]<BOUCLE_art_documents_points(GEOPOINTS){id_document}{visible}{meilleur}{","}>
    {	"type": "Feature",
		"geometry": {"type": "Point", "coordinates": [#LONGITUDE,#LATITUDE]},
		"properties": {[
			"name": (#TITRE|sinon{doc#ID_DOCUMENT}|textebrut|texte_json),][
			"html": (#GEOPOPUP{objet_parent=#_articles:OBJET,id_objet_parent=#_articles:ID_OBJET,contenu_seul=oui,json=oui}),][
			"icon": {(#GEOMARKERICONS{format=json})},][
			"objet": "(#OBJET)",][
			"id_objet": (#ID_OBJET),][
			"visible": "(#VISIBLE)",][
			"priorite": (#PRIORITE),]
			"type": "#TYPE_POINT",
			"zoom": #ZOOM
			}
	}</BOUCLE_art_documents_points>[(#SET{features, #GET{features}|plus{#TOTAL_BOUCLE}})]</B_art_documents_points></BOUCLE_art_documents>[
	
	(#REM) Mots-clefs ]
	<BOUCLE_art_mots(MOTS){id_article}><B_art_mots_points>[(#GET{features}|>{0}|?{',',''})]<BOUCLE_art_mots_points(GEOPOINTS){id_mot}{meilleur}{","}>
	{	"type": "Feature",
		"geometry": {"type": "Point", "coordinates": [#LONGITUDE,#LATITUDE]},
		"properties": {[
			"name": (#TITRE|textebrut|texte_json),][
			"html": (#GEOPOPUP{contenu_seul=oui,json=oui}),][
			"icon": {(#GEOMARKERICONS{format=json})},][
			"objet": "(#OBJET)",][
			"id_objet": (#ID_OBJET),][
			"visible": "(#VISIBLE)",][
			"priorite": (#PRIORITE),]
			"type": "#TYPE_POINT",
			"zoom": #ZOOM
			}
	}</BOUCLE_art_mots_points>[(#SET{features, #GET{features}|plus{#TOTAL_BOUCLE}})]</B_art_mots_points></BOUCLE_art_mots>
</BOUCLE_articles>[



(#REM) Tous les objets liés à un mot-clef ]
<BOUCLE_mots(MOTS){id_mot=#ENV{id_mot}}>[
	
	(#REM) Rubriques ]
	<BOUCLE_mot_rubriques(RUBRIQUES){id_mot}><B_mot_rubriques_points>[(#GET{features}|>{0}|?{',',''})]<BOUCLE_mot_rubriques_points(GEOPOINTS){id_rubrique}{meilleur}{","}>
    {	"type": "Feature",
		"geometry": {"type": "Point", "coordinates": [#LONGITUDE,#LATITUDE]},
		"properties": {[
			"name": (#TITRE|textebrut|texte_json),][
			"html": (#GEOPOPUP{objet_parent=#_rubriques:OBJET,id_objet_parent=#_rubriques:ID_OBJET,contenu_seul=oui,json=oui}),][
			"icon": {(#GEOMARKERICONS{format=json})},][
			"objet": "(#OBJET)",][
			"id_objet": (#ID_OBJET),][
			"visible": "(#VISIBLE)",][
			"priorite": (#PRIORITE),]
			"type": "#TYPE_POINT",
			"zoom": #ZOOM
			}
	}</BOUCLE_mot_rubriques_points>[(#SET{features, #GET{features}|plus{#TOTAL_BOUCLE}})]</B_mot_rubriques_points></BOUCLE_mot_rubriques>[
	
	(#REM) Articles]
	<BOUCLE_mot_articles(ARTICLES){id_mot}><B_mot_articles_points>[(#GET{features}|>{0}|?{',',''})]<BOUCLE_mot_articles_points(GEOPOINTS){id_article}{meilleur}{","}>
    {	"type": "Feature",
		"geometry": {"type": "Point", "coordinates": [#LONGITUDE,#LATITUDE]},
		"properties": {[
			"name": (#TITRE|textebrut|texte_json),][
			"html": (#GEOPOPUP{objet_parent=#_rubriques:OBJET,id_objet_parent=#_rubriques:ID_OBJET,contenu_seul=oui,json=oui}),][
			"icon": {(#GEOMARKERICONS{format=json})},][
			"objet": "(#OBJET)",][
			"id_objet": (#ID_OBJET),][
			"visible": "(#VISIBLE)",][
			"priorite": (#PRIORITE),]
			"type": "#TYPE_POINT",
			"zoom": #ZOOM
			}
	}</BOUCLE_mot_articles_points>[(#SET{features, #GET{features}|plus{#TOTAL_BOUCLE}})]</B_mot_articles_points></BOUCLE_mot_articles>[
	
	(#REM) Documents]
	<BOUCLE_mot_documents(DOCUMENTS){id_mot}><B_mot_documents_points>[(#GET{features}|>{0}|?{',',''})]<BOUCLE_mot_documents_points(GEOPOINTS){id_document}{visible}{meilleur}{","}>
    {	"type": "Feature",
		"geometry": {"type": "Point", "coordinates": [#LONGITUDE,#LATITUDE]},
		"properties": {[
			"name": (#TITRE|sinon{doc#ID_DOCUMENT}|textebrut|texte_json),][
			"html": (#GEOPOPUP{objet_parent=#_rubriques:OBJET,id_objet_parent=#_rubriques:ID_OBJET,contenu_seul=oui,json=oui}),][
			"icon": {(#GEOMARKERICONS{format=json})},][
			"objet": "(#OBJET)",][
			"id_objet": (#ID_OBJET),][
			"visible": "(#VISIBLE)",][
			"priorite": (#PRIORITE),]
			"type": "#TYPE_POINT",
			"zoom": #ZOOM
			}
	}</BOUCLE_mot_documents_points>[(#SET{features, #GET{features}|plus{#TOTAL_BOUCLE}})]</B_mot_documents_points></BOUCLE_mot_documents>[
	
	(#REM) Brèves (seulement pour les rubriques racines) ]
	<BOUCLE_mot_breves(BREVES){id_mot}><B_mot_breves_points>[(#GET{features}|>{0}|?{',',''})]<BOUCLE_mot_breves_points(GEOPOINTS){id_breve}{meilleur}{","}>
	{	"type": "Feature",
		"geometry": {"type": "Point", "coordinates": [#LONGITUDE,#LATITUDE]},
		"properties": {[
			"name": (#TITRE|textebrut|texte_json),][
			"html": (#GEOPOPUP{contenu_seul=oui,json=oui}),][
			"icon": {(#GEOMARKERICONS{format=json})},][
			"objet": "(#OBJET)",][
			"id_objet": (#ID_OBJET),][
			"visible": "(#VISIBLE)",][
			"priorite": (#PRIORITE),]
			"type": "#TYPE_POINT",
			"zoom": #ZOOM
			}
	}</BOUCLE_mot_breves_points>[(#SET{features, #GET{features}|plus{#TOTAL_BOUCLE}})]</B_mot_breves_points></BOUCLE_mot_breves>

</BOUCLE_mots>
	#EVAL{'chr(93)'}
}