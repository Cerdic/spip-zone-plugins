[(#ID_AUTEUR|?{' ',''})
	<div class="formulaire_spip formulaire_ecrire_message">
	<a id="formulaire_ecrire_message" name="formulaire_ecrire_message"></a>
	
	[<p class="reponse_formulaire">(#ENV*{destko})</p>]
	[<p class="reponse_formulaire">(#ENV*{messageko})</p>]
	
	[<fieldset class="reponse_formulaire">
	<legend><:envoyer_message:></legend>
	<p>(#ENV*{messageenvoye})</p>
	</fieldset>]

	<form action="#SELF#formulaire_ecrire_message" method="post">
		
	[(#ENV**{messageenvoye}|?{'',' '})
		[(#REM) Previsualisation... ]
		[<input type="hidden" name="num_formulaire_ecrire_message" value="(#ENV{valide})" />]
		[<fieldset class="previsu">
		<legend><:previsualisation:></legend>
		<p><strong>#ENV{sujet}</strong> <br/> <em><INCLURE{fond=liste_auteurs}{auteurs=#ENV**{destinataires}}></em></p>
		[(#ENV{texte}|propre)]
		<div class="spip_bouton"><input type="submit" name="confirmer" value="(#ENV{boutonconfirmation})" /></div>
		</fieldset>]
	]
		
	[(#REM) Sinon, formulaire normal ]
	
	<fieldset>
	<legend><INCLURE{fond=liste_auteurs}{auteurs=#ID_AUTEUR}>::<:envoyer_message:></legend>
	[(#REM) Destinataires ]
	<p><label for="sujet_message"><:form_prop_sujet:></label>
	<input type="text" class="forml" name="sujet_message" id="sujet_message" value="#ENV{sujet}" size="30" /></p>
	
	<INCLURE{fond=options_select_destinataires}{destinataires=#ENV**{destinataires}}>
	
	<p><label for="texte_message"><:info_texte_message:></label>
	<textarea class="" style='border:1px solid' name="texte_message" id="texte_message" rows="6" cols="40">#ENV{texte}</textarea></p>
	
	[<div class="spip_bouton"><input type="submit" name="valide" value="(#ENV{bouton})" /></div>]
	</fieldset>
	
	</form>
]
</div>
[(#REM) les messages recus et envoyes dont l'auteur est auteur ou destinataire ]
<BOUCLE_envoyes(SPIP_MESSAGES){id_auteur=#ENV{id_auteur}}{doublons selection}> </BOUCLE_envoyes>
<BOUCLE_recus(SPIP_AUTEURS_MESSAGES){id_auteur=#ENV{id_auteur}}><BOUCLE_memo(SPIP_MESSAGES){id_message}{doublons selection}> </BOUCLE_memo></BOUCLE_recus>
<B_liste>
<p>
#ANCRE_PAGINATION

<table class='spip'>
<thead>
<tr class='row_first'>
<th scope='col'><a href='[(#ENV{self}|parametre_url{tri,nom}|parametre_url{senstri,[(#ENV{tri}|=={nom}|?{[(#ENV{senstri}|?{0,1})],#ENV{senstri}})]})]'>De</a></th>
<th scope='col'>A</th>
<th scope='col'><a href='[(#ENV{self}|parametre_url{tri,titre}|parametre_url{senstri,[(#ENV{tri}|=={titre}|?{[(#ENV{senstri}|?{'0','1'})],#ENV{senstri}})]})]'>Sujet</a></th>
<th scope='col'>Texte</th>
<th scope='col'><a href='[(#ENV{self}|parametre_url{tri,date_heure}|parametre_url{senstri,[(#ENV{tri}|=={date_heure}|?{[(#ENV{senstri}|?{'0','1'})],#ENV{senstri}})]})]'>Date</a></th></tr>
</thead>
<tbody>
<BOUCLE_liste(SPIP_MESSAGES spip_auteurs){!doublons selection}{par #ENV{tri}}{inverse #ENV{senstri,1}}{pagination 5}>
<tr class='[(#COMPTEUR_BOUCLE|alterner{'row_even','row_odd'})]'>
<td>#NOM</td>
<td><BOUCLE_destinataires(SPIP_AUTEURS_MESSAGES){id_message}{', '}><BOUCLE_auteurdest(AUTEURS){id_auteur}{tout}>[(#_destinataires:VU|=={oui}|?{'','<strong>'})]#NOM[(#_destinataires:VU|=={oui}|?{'','</strong>'})]</BOUCLE_auteurdest></BOUCLE_destinataires></td>
<td>#TITRE</td>
<td>#TEXTE</td>
<td>[(#DATE_HEURE|affdate_jourcourt|=={[(#ENV{date}|affdate_jourcourt)]}|?{[(#DATE_HEURE|heures):[(#DATE_HEURE|minutes)]],[(#DATE_HEURE|affdate_jourcourt)]}) ]</td>
</tr>
</BOUCLE_liste>
</tbody>
</table>
</p>
<p class='pagination'>#PAGINATION</p>
</B_liste>
