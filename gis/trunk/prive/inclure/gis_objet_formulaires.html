<div class="ajax">
<BOUCLE_test(GIS){objet}{id_objet}{0,1}> </BOUCLE_test>
#SET{gis_defaut,nouveau}
<//B_test>

[(#GET{gis_defaut}|=={nouveau}|?{#SET{bloc_gis,editer},#SET{bloc_gis,lier}})]

<div class="actions">
	<a href="[(#SELF|parametre_url{bloc_gis,lier}|parametre_url{id_gis,''})]" 
		class="ajax[(#ENV{bloc_gis,#GET{bloc_gis}}|=={lier}|oui)on]">
		<:gis:titre_bloc_points_lies:>
	</a><span class="sep"> | 
	</span><a href="[(#SELF|parametre_url{bloc_gis,rechercher}|parametre_url{id_gis,''})]" 
		class="ajax[(#ENV{bloc_gis,#GET{bloc_gis}}|=={rechercher}|oui)on]">
		<:gis:titre_bloc_rechercher_point:>
	</a><span class="sep"> | 
	</span><a href="[(#SELF|parametre_url{bloc_gis,editer}|parametre_url{id_gis,nouveau})]" 
		class="ajax[(#ENV{id_gis,#GET{gis_defaut}}|=={nouveau}|oui|et{#ENV{bloc_gis,#GET{bloc_gis}}|=={editer}|oui})on]">
		<:gis:titre_bloc_creer_point:>
	</a>
</div>

[(#ENV{bloc_gis,#GET{bloc_gis}}|=={editer}|oui)
	#FORMULAIRE_EDITER_GIS{#ENV{id_gis,#GET{gis_defaut}},#ENV{objet},#ENV{id_objet},#SELF,'non'}
	<script type="text/javascript">
		(function($){
			$(function(){
				// resize + recenter de la map si bloc deplie
				$('#pave_gis_depliable').bind('deplie', function(e){
					var container = $('#map_editer_gis_#ENV{id_gis,oui}');
					form_map.resizeTo(container.width(),container.height());
					var lat = $("#champ_lat").val();
					var lon = $("#champ_lon").val();
					form_map.setCenter(new mxn.LatLonPoint(lat,lon));
				});
			});
		})(jQuery);
	</script>
]

[(#ENV{bloc_gis,#GET{bloc_gis}}|=={lier}|oui)
[(#INCLURE{fond=prive/liste/gis_objet,sinon=<:gis:aucun_gis:>,env})]
]

<BOUCLE_gis(GIS){0,1}> </BOUCLE_gis>[(#ENV{bloc_gis,#GET{bloc_gis}}|=={rechercher}|oui)
<div class="ajax">
	#FORMULAIRE_RECHERCHER_GIS{#ENV{objet},#ENV{id_objet},#SELF|parametre_url{bloc_gis,lier}}
</div>]</B_gis>
</div>
