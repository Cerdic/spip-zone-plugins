#SET{id,#ENV{id}}
#SET{url, #CONFIG{prestashop_api/url}|replace{(https?://), $1#CONFIG{prestashop_api/cle}@}}

<BOUCLE_ean13(DATA){si #ENV{id}|non}{source simplexml, #GET{url}/api/products?filter[ean13]=#ENV{ean13}}{datapath root/children/products/0/children/product/0/attributes}>
[(#CLE|=={id}|oui) #SET{id,#VALEUR} ]
</BOUCLE_ean13>

<BOUCLE_product(DATA){si #GET{id}|oui}{source simplexml, #GET{url}/api/products/#GET{id}\?price\[price_wt\]\[use_tax\]=1, 1}{datapath root/children/product}>
#SET{titre, #VALEUR{children/name/0/children/language/0/text}}
#SET{url_product,#CONFIG{prestashop_api/url}|concat{/index.php?controller=product&id_product=#GET{id}}|recuperer_lapage}
<article class="product produit" itemscope itemtype="http://schema.org/Product">
	<a href="#GET{url_product}" itemprop="url">
	[(#VALEUR{children/id_default_image/0/attributes/xlink:href}
		|replace{(https?://), $1#CONFIG{prestashop_api/cle}@}
		|copie_locale|find_in_path|balise_img{#GET{titre}}
		|image_reduire{#ENV{largeur,200},0}
		|inserer_attribut{itemprop,image})]
	</a>
	<h3 itemprop="name">
		<a href="#GET{url_product}" itemprop="url">#GET{titre}</a>
	</h3>
	[<div class="price prix" itemprop="offers" itemscope itemtype="http://schema.org/Offer">
		<span itemprop="price">(#VALEUR{children/price_wt/0/text}|number_format{2})</span> <span itemprop="priceCurrency" content="EUR">â‚¬</span>
	</div>]
	<a href="#GET{url_product}" class="acheter buy button btn" itemprop="url">[(#ENV{message_acheter, <:prestashop_api:product_acheter:>})]</a>
</article>
</BOUCLE_product>
