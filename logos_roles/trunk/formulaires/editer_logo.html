#CACHE{0}
<BOUCLE_si_logos_actifs(CONDITION){si #CONFIG{activer_logos}|=={oui}}>
<div class='formulaire_spip formulaire_editer formulaire_editer_logo formulaire_editer_logo_#ENV{objet}'>
	[<h3 class="titrem">(#ENV{_options}|table_valeur{titre})</h3>]
	[<p class="reponse_formulaire reponse_formulaire_ok">(#ENV*{message_ok})</p>]
	[<p class="reponse_formulaire reponse_formulaire_erreur">(#ENV*{message_erreur})</p>]
	[(#ENV{editable})
	#SET{valider,#ENV{valider,''}}
	<form method='post' action='#ENV{action}' enctype='multipart/form-data'><div>
		[(#REM) declarer les hidden qui declencheront le service du formulaire
		parametre : url d'action ]
		#ACTION_FORMULAIRE{#ENV{action}}
		[(#REM) un submit pour attraper la touche entree]
		<div style="display:none;"><input type='submit' class='submit' value='<:bouton_upload:>' /></div>
	]
		<div class="editer-groupe">
      <BOUCLE_roles_logos(DATA){source array, #ENV{objet}|table_objet|lister_roles_logos}>

        [(#CONFIG{activer_logos_survol}|=={oui}|ou{#CLE|!={logo_survol}})
          <div class="editer editer_#CLE[ (#ENV{#CLE}|non)logo_upload][ (#ENV**{erreurs}|table_valeur{#CLE}|oui)erreur]">
            <h4>[(#VALEUR|table_valeur{label}|_T)]</h4>
            [(#ENV{#CLE}|oui)
              [(#INCLURE{fond=formulaires/inc-apercu-logo,env,logo=#ENV{#CLE},quoi=#CLE})]
              <input type="hidden" name="#CLE" value="#ENV{#CLE}" />
            ]
            [(#ENV{editable}|et{#ENV{#CLE}|non}|oui)
					    <label for="#CLE_#ENV{objet}_#ENV{id_objet}">
                [(#ENV{_options}|table_valeur{label}|sinon{<:info_telecharger_nouveau_logo:>})]
              </label>
              [<span class='erreur_message'>
                (#ENV**{erreurs}|table_valeur{#CLE})
              </span>]
              <input type='file' class='file' name='#CLE' size="[(#ENV{_options}|table_valeur{size_input}|sinon{12})]" id='#CLE_#ENV{objet}_#ENV{id_objet}' value="" />
					    #SET{valider,' '}

              <div class="mediatheque">
                <input class="hidden" name="document_mediatheque_#CLE" type="hidden" value=""/>
                <input class="invisible" name="choisir_document_mediatheque_#CLE"
                       type="submit" value="<:logos_roles:valider:>"/>

                <a href="#" id="choisir_document_#CLE">
                  <:logos_roles:choisir_mediatheque:>
                </a>

                <script type="text/javascript">
                 $(function () {
                   // Ouvrir une modale de sélection dans la médiathèque avec le lien
                   $('#choisir_document_#CLE').click(function (e) {
                     e.preventDefault();
                     $.modalboxload(
                       '[(#URL_ECRIRE*{popin-choisir_document, var_zajax=contenu&selectfunc=maj_document_mediatheque_[(#CLE)]})]',
                       {autoResize: true}
                     );
                   });
                 });
                 // Callback du popin, on ferme la modale, on met à jour le formulaire et on le soumet
                 function maj_document_mediatheque_[(#CLE)] (id) {
                   $.modalboxclose();
                   $('input\[name="document_mediatheque_#CLE"\]').val(id);
                   $('input\[name="choisir_document_mediatheque_#CLE"\]').click();
                 };
                </script>
              </div>
            ]
          </div>
        ]
      </BOUCLE_roles_logos>
		</div>
		[(#REM) ajouter les saisies supplementaires : extra et autre, a cet endroit ]
		<!--extra-->
	[(#ENV{editable})
		[(#GET{valider})
		<p class="boutons"[(#GET{hide})style='display:none;']><input type='submit' class='submit' value='<:bouton_upload:>' /></p>
		]
	</div></form>
	]
</div>
</BOUCLE_si_logos_actifs>
