<!-- titre=<:contact:titre:> -->
<!-- icone=images/contact-24.png -->

<div class="formulaire_spip formulaire_editer">
<form method="post" action="#SELF">
		[(#ENV{_cfg_}|form_hidden)]
	
	<fieldset>
		<legend><:contact:configuration_destinataires:></legend>
		<ul>
			<li class="editer_texte">
				<p class="explication"><:contact:configuration_destinataires_explication:></p>
					<B_auteurs>
					<select name="choix_destinataires[]" id="choix_destinataires" multiple="multiple" size="5">
					<BOUCLE_auteurs(AUTEURS){tous}>
					<option value="#ID_AUTEUR" [(#ID_AUTEUR|in_array{#ENV{choix_destinataires,#ARRAY}}|oui)selected="selected"]>
						#NOM (##ID_AUTEUR)
					</option>
					</BOUCLE_auteurs>
				</select>
				</B_auteurs>
			</li>
			<li class="choix">
				<div>
					<input type="radio" name="type_choix" id="tous" class="radio" value="tous"[ checked="checked"(#ENV{type_choix}|=={tous}|ou{#ENV{type_choix}|non}|oui)] />
					<label for="tous"><:contact:configuration_destinataires_tous:></label>
				</div>
				<div>
					<input type="radio" name="type_choix" id="un" class="radio" value="un"[ checked="checked"(#ENV{type_choix}|=={un}|oui)] />
					<label for="un"><:contact:configuration_destinataires_un:></label>
				</div>
				<div>
					<input type="radio" name="type_choix" id="plusieurs" class="radio" value="plusieurs"[ checked="checked"(#ENV{type_choix}|=={plusieurs}|oui)] />
					<label for="plusieurs"><:contact:configuration_destinataires_plusieurs:></label>
				</div>
			</li>
		</ul>
	</fieldset>
	
	[(#REM)
		On récupère les champs possibles
		Mais on divise en deux :
			- d'abord les champs choisis
			- puis les champs qui restent
	]
	#SET{champs_possibles, #VAL{rien}|contact_infos_supplementaires}
	#SET{champs_choisis, #CONFIG{contact/champs,#ARRAY}|array_flip}
	#SET_MERGE{champs, #GET{champs_choisis}, #GET{champs_possibles}}
	<fieldset>
		<legend><:contact:infos_supplementaires:></legend>
		<ul id="editer_champs">
			<BOUCLE_champs(POUR){tableau #GET{champs}}>
			<li class="choix editer_champ">
				<input type="checkbox" name="champs[]" id="champ_#CLE" class="checkbox" value="#CLE"[ (#CLE|in_array{#ENV{champs,#ARRAY}}|oui)checked="checked"] />
				<label for="champ_#CLE">#VALEUR</label>
				<div>
					<input type="checkbox" name="obligatoires[]" id="obli_#CLE" class="checkbox" value="#CLE"[ (#CLE|in_array{#ENV{obligatoires,#ARRAY}}|oui)checked="checked"] />
					<label for="obli_#CLE"><:contact:champ_obligatoire:></label>
				</div>
			</li>
			</BOUCLE_champs>
		</ul>
	</fieldset>
	
	<fieldset>
		<legend><:contact:configuration_intro:></legend>
		<ul>
			<li class="editer_texte">
				<p class="explication"><:contact:configuration_intro_explication:></p>
				<textarea name="texte" id="texte" rows="10">#ENV{texte}</textarea>
			</li>
		</ul>
	</fieldset>
	
	<div class="boutons">
		<input type="submit" name="_cfg_ok" value="<:oK:>" />
		<input type="submit" name="_cfg_delete" value="<:supprimer:>" />
	</div>
</form>
</div>

<script type="text/javascript">
	$(function(){
		$('li.editer_champ div').each(function(){
			if (!$(this).siblings('input').is(':checked'))
				$(this).hide();
		});
		
		$('li.editer_champ input.checkbox')
			.click(function(){
				if ($(this).is(':checked'))
					$(this).siblings('div')
						.slideDown();
				else
					$(this).siblings('div')
						.slideUp();
			});
		
		$('ul#editer_champs')
			.sortable({
				cursor : 'move',
				axis : 'y',
				cancel : 'input, label',
				forceHelperSize : true,
				forcePlaceholderSize : true,
				placeholder : 'cadre-couleur',
				start : function(event, ui){
					alert('coucou');
				}
			});
	});
</script>
