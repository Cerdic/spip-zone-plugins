/***************************************************************************\
 *  BOUTIQUE : Plugin, version lite d'un e-commerce pour SPIP              *
 *                                                                         *
 *  Copyright (c) 2006-2007                                                *
 *  Laurent RIEFFEL : mailto:laurent.rieffel@laposte.net			   *
 *                                                                         *
 *  Ce programme est un logiciel libre distribue sous licence GNU/GPL.     *
 *  Pour plus de details voir le fichier COPYING.txt ou l'aide en ligne.   *
\***************************************************************************/

/*
 * Boutique
 * version plug-in d'un e-commerce
 *
 * Auteur : Laurent RIEFFEL
 * 
 * Module pour SPIP version 1.9.x
 * © 2006 - Distribue sous licence GNU/GPL
 *
 */

POURQUOI :
----------
Le projet est nait via la demande d'une amie qui tien une boutique de chaussure italienne.
Je connaissais SPIP depuis sa version 1.8, j'en suis periodiquement les évolutions, et ses
fonctionnalités toujours grandissante.

LA LOGIQUE RETENUE :
--------------------
En creusant, et en posant les bonnes questions, les fonctionnalités, contraintes suivante 
ont été retenues :
	-> La granularité s'arrêtera au modèle, pas à la pointure d'une chaussure.
	   Pour chaque modèle il sera donc renseigné les pointures disponibles.

	-> Certains champs d'un articles SPIP sont donc détournés pour l'usage :
		-> #DESCRIPTIF	: Nouveau prix, concerne l'article soldé
		-> #CHAPO		: Prix de l'article,
		-> #PS		: Les pointures, tailles disponibles.

	-> Pour chaque visiteur de la boutique il ligne, une boutique virtuelle lui est
	   offerte. Pour gérer les acces concurrentiels, entrée simultanée, je passe par
	   un nombre aléatoire. Ensuite une fois ce nombre aléatoire attribué, je donne 
	   l'id_boutique au visiteur. Le code aléatoire, servira plustard comme référence
	   de la commande pour la banque et pour le client.
	   Il est difficile de penser que 2 nombres de 8 chiffres soient identique a des 
	   moments rapprochés

	-> dans la table boutique, il existe un champs statut de suivie d'état, il est 
	   impossible de revenir en arrière !

LES TABLES :
------------
//
// Boutique
//

$spip_boutiques = array(
	"id_boutique" 			=> "bigint(21) NOT NULL",
	"code_boutique"			=> "bigint (21)",
	"categorie"				=> "bigint (21)",
	"nom"					=> "VARCHAR(50)",
	"prenom"				=> "VARCHAR(50)",
	"email"				=> "VARCHAR(100)",
	"news"				=> "bigint (21)",
	"adresse_livraison"		=> "text",
	"code_postal_livraison"		=> "VARCHAR(50)",
	"ville_livraison"			=> "VARCHAR(50)",
	"pays_livraison"			=> "VARCHAR(50)",	
	"zone"				=> "varchar (50)",
	"adresse_facturation"		=> "text",
	"code_postal_facturation"	=> "VARCHAR(50)",
	"ville_facturation"		=> "VARCHAR(50)",
	"pays_facturation"		=> "VARCHAR(50)",	
	"statut" 				=> "varchar(50)",
	"maj" 				=> "TIMESTAMP",
	"transaction" 			=> "varchar(50)");

$spip_boutiques_key = array(
	"PRIMARY KEY" => "id_boutique");

//
// Pannier
//

$spip_paniers = array(
	"id_panier"		=> "bigint(21) NOT NULL",
	"id_boutique" 	=> "bigint(21)",
	"id_article" 	=> "bigint(21)",
	"pointure"	 	=> "bigint(21)",
	"quantite" 		=> "bigint(21)");

$spip_paniers_key = array(
	"PRIMARY KEY" => "id_panier");


global $tables_principales;

$tables_principales['spip_paniers'] = array(
	'field' => &$spip_paniers,
	'key' => &$spip_paniers_key);

$tables_principales['spip_boutiques'] = array(
	'field' => &$spip_boutiques,
	'key' => &$spip_boutiques_key);

LA PARTIE PRIVEE :
------------------
Deux modules, un générique placé dans configuration, le second dans statistique.

Le premier c'est la/les boutique(s) dans la gloablité, avec un point d'entrée sur
le détail du pannier.

Le second, c'est tous les panniers.

-> En premier lieu, il est necessaire créer les tables, c'est tout. Par la suite,
   il sera possible de supprimer les boutiques non conclue par un achat.

-> Il n'y a pas de gestion possible du pannier, tout se fait au travers des boutiques
   seul point d'entrée a tout cela. Par contre, si un article est à épuisement ou 
   doit etre renseigné, il y a une passerelle de paniers vers article (élément de SPIP).


LE SEQUELETTE et CODE :
-----------------------
Pour coller à la demande initale, la gestion de l'article est incluse dans la rubrique.
il y a bien un squelette SPIP pour l'article, mais c'est un moyen de basculer du mode
privée au mode public (restreint).

Il y a un code php panier, qui sert à remplir le pannier du visiteur. Et un code propre
pour la boutique, renseignement et collecte des informations.

Pour les fond associés au pannier et à la boutique (notion php) il faut géré les états,
les différentes phase de l'achat.

Une attention particulière est à apporter a boutique.html, il y a génération du bouton 
initiant la phase du paiement banquaire.

L'INSTALLATION :
----------------

Ensemble de fichier constituant, mas version de dev du plugin.

Elle contient la version de spip revue suite a une erreur, et un patch que j'ai apliqué,
 par ce je ne comprends pas d'ou ca vient.
et que ca marche comme ca !!!

tout mon squelette

tout le plugin

le tout se descend directement sur la racine !

Je considère que le visiteur à une boutique privée dès qu'il entreprend un achat, après il rempli sont panier. Il vous suffit d'ouvrir le fichier base du plugin pour en voir découller le MCD de base.

Il y a encore bcp de "bruits" dans les codes mais c'est une bonne base de travail que je m'efforce de faire rapidement murrir.

Apres il me reste à raccorcher le module bancaire fourni par le prestataire....


Pour le moment la version de dev est là : 

[http://ilsalone.free.fr/indexv2.html|La boutique (800x600)->http://ilsalone.free.fr/indexv2.html]

clquer sur boutique pour rentré dans le corps de la boutique, ou alors ici :

[http://ilsalone.free.fr|La boutique->http://ilsalone.free.fr]

N'hésitez pas à donner votre avis au travers du forum associé ou pour le sdemande ou remarque plus precises, n'hésitez à me contacter par mail ;-)
