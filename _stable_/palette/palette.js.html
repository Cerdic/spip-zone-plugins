[(#REM)

  Charge la librairie farbtastic ainsi que le javascript du plugin Palette
  
  Ajax : pour disposer de palette dans du code html retourné par Ajax, comme par exemple
  dans un contrôleur renvoyé par le plugin crayons, introduisez dans le code html retourné par la requête xmlHTTPrequest
  un appel à la méthode init_palette, comme ceci :
  
<script language="javascript">
  try {init_palette();}
  catch(e) {}
</script>';


]#CACHE{7*24*86400}#HTTP_HEADER{'Content-Type: text/javascript'}
[(#INCLURE{lib/farbtastic/farbtastic.js})]

$(document).ready(
  function() {
    init_palette();
  }
);

function init_palette() {
  $("input.palette").each(
    function(i, palette){
      $(palette).css("background-color", $(palette).attr("value"));
      /* pas de id : on en cree un aleatoire */
      if (!$(palette).attr("id")){
        var newid = parseInt(10000*Math.random());
        palette.id = newid;
      }
      palette.onclick = function(e) {
        $(".colorpicker").empty().remove();
        $(palette).after('<div class="colorpicker"><div class="colorpicker_close" title="<:palette:fermer:>">&nbsp;x&nbsp;</div><div class="colorpicker_bar"><:palette:palette:></div><div id="colorpicker"></div></div>');
        $(".colorpicker").css({position: "absolute", display: "block", "z-index": "99999009"});
        $('#colorpicker').css({display:'block'});
        $('#colorpicker').farbtastic(palette);
        $(".colorpicker_close").hover(function(){
          $(this).addClass("hover");
          },function(){
            $(this).removeClass("hover");
        });
        $(".colorpicker_close").click( function() {
          $(".colorpicker").empty().remove();
        });
      };
    }
  );
}
