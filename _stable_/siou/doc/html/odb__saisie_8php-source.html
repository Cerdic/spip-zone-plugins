<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Siou:  Fichier source de odb_saisie/exec/odb_saisie.php</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Généré par Doxygen 1.5.3 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Page&nbsp;principale</span></a></li>
    <li class="current"><a href="files.html"><span>Fichiers</span></a></li>
    <li><a href="dirs.html"><span>Répertoires</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;Rechercher&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul>
</div>
<div class="nav">
<a class="el" href="dir_ff2f189f9aeaff6fca973b045bafd454.html">odb_saisie</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_0d8566f30943fbf8c12a7678aa741d5f.html">exec</a></div>
<h1>odb_saisie.php</h1><a href="odb__saisie_8php.html">Aller à la documentation de ce fichier.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 include_spip('inc/presentation');
<a name="l00003"></a>00003 include_spip('inc/config');
<a name="l00004"></a>00004 include_spip('inc/charsets');
<a name="l00005"></a><a class="code" href="odb__saisie_8php.html#c24ff0f08fb134ed2d43c99826787bc2">00005</a> define('<a class="code" href="odb__affiche__csv_8php.html#c24ff0f08fb134ed2d43c99826787bc2">DIR_ODB_COMMUN</a>',_DIR_PLUGINS.<span class="stringliteral">"odb/odb_commun/"</span>);
<a name="l00006"></a>00006 include_once(<a class="code" href="odb__affiche__csv_8php.html#c24ff0f08fb134ed2d43c99826787bc2">DIR_ODB_COMMUN</a>.'inc-html.php');
<a name="l00007"></a>00007 include_once(<a class="code" href="odb__affiche__csv_8php.html#c24ff0f08fb134ed2d43c99826787bc2">DIR_ODB_COMMUN</a>.'inc-referentiel.php');
<a name="l00008"></a>00008 include_once(<a class="code" href="odb__affiche__csv_8php.html#c24ff0f08fb134ed2d43c99826787bc2">DIR_ODB_COMMUN</a>.'inc-odb.php');
<a name="l00009"></a>00009 include_once('inc-bdd.php');
<a name="l00010"></a>00010 
<a name="l00011"></a><a class="code" href="odb__saisie_8php.html#80964ebc372556b131e270901883e24f">00011</a> define('<a class="code" href="odb__repartition_8avecGeneriques_8php.html#80964ebc372556b131e270901883e24f">MAX_LIGNES</a>',100); <span class="comment">//nb de lignes affichées max</span>
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 setlocale(LC_TIME, <span class="stringliteral">"fr_FR"</span>);
<a name="l00014"></a>00014 
<a name="l00015"></a><a class="code" href="odb__saisie_8php.html#73292a99bd31040ba09df650515015d1">00015</a> global <a class="code" href="inc-fichiers_8php.html#58f5fd0b9d70bc87295be959c7bc176a">$debug</a>, <a class="code" href="odb__import_8php.html#73292a99bd31040ba09df650515015d1">$txt_gauche</a>, <a class="code" href="odb__affiche__csv_8php.html#0a3ebee356c79fa7521c28283a372f76">$txt_debug</a>;
<a name="l00016"></a><a class="code" href="odb__saisie_8php.html#85ae3e64cd40e9564adceb010085e9dd">00016</a> <a class="code" href="inc-fichiers_8php.html#58f5fd0b9d70bc87295be959c7bc176a">$debug</a>=<span class="keyword">false</span>;<span class="comment">//isset($_REQUEST['debug']);</span>
<a name="l00017"></a>00017 
<a name="l00018"></a><a class="code" href="odb__saisie_8php.html#c69d1b2260261599b555c6b8d3d77999">00018</a> <a class="code" href="odb__import_8php.html#73292a99bd31040ba09df650515015d1">$txt_gauche</a>=<span class="stringliteral">""</span>;<span class="comment">// texte boite de gauche</span>
<a name="l00019"></a><a class="code" href="odb__saisie_8php.html#132ad6788dc28adfa8faa0de53ff0dbc">00019</a> <a class="code" href="odb__import_8php.html#132ad6788dc28adfa8faa0de53ff0dbc">$txt_</a>=<span class="stringliteral">""</span>;<span class="comment">// texte boite de droite</span>
<a name="l00020"></a><a class="code" href="odb__saisie_8php.html#709566ff745c7bb1fd0fe7e2ba030a93">00020</a> <a class="code" href="odb__affiche__csv_8php.html#0a3ebee356c79fa7521c28283a372f76">$txt_debug</a>=<span class="stringliteral">""</span>; <span class="comment">// texte debug</span>
<a name="l00021"></a>00021 define(<a class="code" href="odb__ref_8php.html#509f04652b5e1b2d2b9e6bc121a87e50">OK</a>,<span class="stringliteral">"&lt;SPAN style='color:#3C3;font-weight:bold;'&gt;[OK]&lt;/SPAN&gt;"</span>);
<a name="l00022"></a>00022 define(<a class="code" href="odb__ref_8php.html#e56b96c4dfcced36887ba02c496c40a3">KO</a>,<span class="stringliteral">"&lt;SPAN style='color:#C33;font-weight:bold;'&gt;[KO]&lt;/SPAN&gt;"</span>);
<a name="l00023"></a>00023 
<a name="l00032"></a><a class="code" href="odb__saisie_8php.html#b323857b58a69e0f0ff29ffd9d24d192">00032</a> function <a class="code" href="odb__saisie_8php.html#b323857b58a69e0f0ff29ffd9d24d192" title="affiche formulaire de saisie">odb_form_saisie</a>($table,<a class="code" href="inc-pdf-attestations_8php.html#43e5b5a819fedbd12b8cf5421ba6985e">$titre</a>,<a class="code" href="inc-pdf-attestations_8php.html#b372e2dd50f4a592a1226a01290a2f4f">$annee</a>) {
<a name="l00033"></a>00033    $str = <span class="stringliteral">"&lt;!-- FORMULAIRE $table --&gt;\n"</span>;
<a name="l00034"></a>00034    $str .= <span class="stringliteral">"&lt;form id='form_$table' action='"</span>.generer_url_ecrire('odb_saisie').<span class="stringliteral">"#form_$table' method='post' class='forml spip_xx-small'&gt;\n"</span>;
<a name="l00035"></a>00035    $str .= <span class="stringliteral">"\t&lt;label for='identifiant'&gt;Veuillez choisir un id et une ann&amp;eacute;e&lt;/label&gt;"</span>;
<a name="l00036"></a>00036    <span class="comment">//bouton_radio($nom, $valeur, $titre, $actif = false, $onClick="")</span>
<a name="l00037"></a>00037    <span class="comment">/*$liste = array("id_saisie"=&gt;"N° de saisie","id_table"=&gt;"N° de table");</span>
<a name="l00038"></a>00038 <span class="comment">   foreach($liste as $key=&gt;$val) {</span>
<a name="l00039"></a>00039 <span class="comment">      $str.=bouton_radio("identifiant",$key,$val,$key=="id_saisie","document.forms['form_$table'].submit_$table.value='Retrouver ce $val\\n dans $titre'");</span>
<a name="l00040"></a>00040 <span class="comment">   }*/</span>
<a name="l00041"></a>00041    <span class="comment">//$str .= afficher_choix("identifiant","id_saisie",$liste," ");</span>
<a name="l00042"></a>00042    $str .= <span class="stringliteral">"&lt;SELECT name='annee' onchange=\"window.location='"</span>.generer_url_ecrire('odb_saisie').<span class="stringliteral">"&amp;annee='+this.value;\"&gt;\n"</span>;
<a name="l00043"></a>00043    $str .= <a class="code" href="inc-html_8php.html#8e011c8d22f485dcee8b90fa3ff656c7" title="Cree un champ SELECT contenant les annees de 2002 a annee en cours + 1.">formSelectAnnee</a>(<a class="code" href="inc-pdf-attestations_8php.html#b372e2dd50f4a592a1226a01290a2f4f">$annee</a>);
<a name="l00044"></a>00044    $str .= <span class="stringliteral">"&lt;/SELECT&gt;\n"</span>;
<a name="l00045"></a>00045    $str .= <span class="stringliteral">"&lt;BR/&gt;\n"</span>;
<a name="l00046"></a>00046    $str .= <span class="stringliteral">"\t&lt;input id='id' name='id' class='fondo' type='text' /&gt;\n"</span>;
<a name="l00047"></a>00047    $str .= <span class="stringliteral">"\t&lt;input type='hidden' name='step2' value='$table' /&gt;\n"</span>;
<a name="l00048"></a>00048    $str .= <span class="stringliteral">"\t&lt;input id='submit_$table' class='fondo' type='submit' value='[oo]\nRechercher' onclick=\"if(document.forms['form_$table'].id.value=='') {alert('Veuillez entrer l\'identifiant dans le champ de saisie correspondant\\npour $titre');document.forms['form_$table'].id.focus();return false;} else if(isNaN(parseInt(document.forms['form_$table'].id.value))) {alert('Vous devez saisir un numero de saisie ou un numero de table\\npour $titre');document.forms['form_$table'].id.select();return false;} else return true;\" /&gt;\n"</span>;
<a name="l00049"></a>00049    <span class="comment">//$str .= "\t&lt;input type='submit' class='fondo' id='ajout_candidat' name='ajout_candidat' value='[+]\nSaisir' /&gt;\n";</span>
<a name="l00050"></a>00050    <span class="comment">//$str .= "\t&lt;input type='submit' class='fondo' id='introspecter' name='introspecter' value='[?]\nIntrospection' /&gt;\n";</span>
<a name="l00051"></a>00051    $str .= <span class="stringliteral">"&lt;/form&gt;\n"</span>;
<a name="l00052"></a>00052    <span class="keywordflow">return</span> ($str);
<a name="l00053"></a>00053 }
<a name="l00054"></a>00054 
<a name="l00060"></a><a class="code" href="odb__saisie_8php.html#67a2630322ffbcb7fb0e22fe529cff6f">00060</a> function <a class="code" href="odb__saisie_8php.html#67a2630322ffbcb7fb0e22fe529cff6f" title="exécuté automatiquement par le plugin au chargement de la page ?exec=odb_saisie...">exec_odb_saisie</a>() {
<a name="l00061"></a>00061 global $connect_statut, $connect_toutes_rubriques, <a class="code" href="inc-fichiers_8php.html#58f5fd0b9d70bc87295be959c7bc176a">$debug</a>, <a class="code" href="odb__import_8php.html#73292a99bd31040ba09df650515015d1">$txt_gauche</a>, $txt_droite, <a class="code" href="odb__affiche__csv_8php.html#0a3ebee356c79fa7521c28283a372f76">$txt_debug</a>, $tab_referentiel, <a class="code" href="inc-referentiel_8php.html#32f56aa14be3aa7fa481441d26b8bca5">$odb_referentiel</a>,<a class="code" href="inc-referentiel_8php.html#b3984efda359cc31d6cfe267131a7ff9">$odb_mapping</a>;
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 include_once(<a class="code" href="odb__affiche__csv_8php.html#c24ff0f08fb134ed2d43c99826787bc2">DIR_ODB_COMMUN</a>.<span class="stringliteral">"inc-referentiel.php"</span>);
<a name="l00064"></a>00064 include_once(<a class="code" href="odb__affiche__csv_8php.html#c24ff0f08fb134ed2d43c99826787bc2">DIR_ODB_COMMUN</a>.<span class="stringliteral">"inc-regles_gestion.php"</span>);
<a name="l00065"></a>00065 <a class="code" href="inc-pdf-attestations_8php.html#b372e2dd50f4a592a1226a01290a2f4f">$annee</a>=$_REQUEST['annee'];
<a name="l00066"></a>00066 
<a name="l00067"></a>00067 $array_ref=array('departement<span class="charliteral">','</span>etablissement<span class="charliteral">','</span>ef<span class="charliteral">','</span>lv<span class="charliteral">','</span>eps<span class="charliteral">','</span>prefixe<span class="charliteral">','</span>serie<span class="charliteral">','</span>sexe<span class="charliteral">','</span>ville<span class="charliteral">','</span>pays');
<a name="l00068"></a>00068 <span class="keywordflow">foreach</span>($array_ref as $ref)
<a name="l00069"></a>00069    $tab_referentiel[$ref]=<a class="code" href="inc-referentiel_8php.html#8da6b5d71b8b85a4443092e825841479">getReferentiel</a>($ref,'tout');
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 debut_page(_T('Saisie candidats ODB'), <span class="stringliteral">""</span>, <span class="stringliteral">""</span>);
<a name="l00072"></a>00072 <span class="comment">//echo "&lt;br /&gt;&lt;br /&gt;";</span>
<a name="l00073"></a>00073 gros_titre(_T('Office Du Baccalaur&amp;<a class="code" href="inc-pdf-table_8php.html#1c3d7fb9d2f4e0216017175154061426">eacute</a>;at'));
<a name="l00074"></a>00074 $tab_auteur=$GLOBALS[<span class="stringliteral">"auteur_session"</span>];
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 <span class="keywordflow">if</span>(!<a class="code" href="inc-regles__gestion_8php.html#abf23b66cd362adaa508de5bfb22706a" title="l&amp;#39;utilisateur est il admin ?">isAdmin</a>()) {
<a name="l00077"></a>00077    $isAdmin=<span class="keyword">false</span>;
<a name="l00078"></a>00078    $statut=<a class="code" href="inc-odb_8php.html#147d380870b3247e67b18fd9d7adf910" title="Determine le type d&amp;#39;utilisateur.">getStatutUtilisateur</a>();
<a name="l00079"></a>00079    
<a name="l00080"></a>00080    <span class="keywordflow">switch</span> ($statut) {
<a name="l00081"></a>00081                <span class="comment">// ci dessous inutile pour le moment (chefs d'etablissement)</span>
<a name="l00082"></a>00082                 <span class="keywordflow">case</span> 'Etablissement':
<a name="l00083"></a>00083                         $isOperateur=<span class="keyword">false</span>;
<a name="l00084"></a>00084                         $isChefEtablissement=<span class="keyword">true</span>;
<a name="l00085"></a>00085                         $etab=$tab_auteur['nom_site'];
<a name="l00086"></a>00086 
<a name="l00087"></a>00087                         <span class="keywordflow">foreach</span>($tab_referentiel['etablissement'] as $key =&gt; $val)
<a name="l00088"></a>00088                                 <span class="keywordflow">if</span>($val==$etab) {
<a name="l00089"></a>00089                                         $tab_auteur['id_etablissement']=$key;
<a name="l00090"></a>00090                                 }
<a name="l00091"></a>00091                         <span class="keywordflow">if</span> ($debug) echo <span class="stringliteral">"etablissement $etab ("</span>.$tab_auteur['id_etablissement'].<span class="stringliteral">")&lt;br/&gt;\n"</span>;
<a name="l00092"></a>00092                         <span class="keywordflow">break</span>;
<a name="l00093"></a>00093                 <span class="keywordflow">case</span> 'Encadrant':
<a name="l00094"></a>00094                         $isEncadrant=<span class="keyword">true</span>;
<a name="l00095"></a>00095                 <span class="keywordflow">case</span> 'Operateur':
<a name="l00096"></a>00096                         $isOperateur=<span class="keyword">true</span>;
<a name="l00097"></a>00097                         $isChefEtablissement=<span class="keyword">false</span>;
<a name="l00098"></a>00098                         <span class="keywordflow">break</span>;
<a name="l00099"></a>00099                 <span class="keywordflow">default</span>:
<a name="l00100"></a>00100                         die(<a class="code" href="odb__ref_8php.html#e56b96c4dfcced36887ba02c496c40a3">KO</a>.<span class="stringliteral">" - Statut &lt;b&gt;$statut&lt;/b&gt; invalide"</span>);
<a name="l00101"></a>00101                 }
<a name="l00102"></a>00102 } <span class="keywordflow">else</span>
<a name="l00103"></a>00103    $isAdmin=<span class="keyword">true</span>;
<a name="l00104"></a>00104 
<a name="l00105"></a>00105 <span class="keywordflow">if</span> ($debug) {
<a name="l00106"></a>00106    echo <span class="stringliteral">"&lt;A HREF='#fin_debug'&gt;Sauter les infos de debug&lt;/A&gt;\n"</span>;
<a name="l00107"></a>00107    echo <span class="stringliteral">"&lt;hr/&gt;Auteur&lt;pre style='text-align:left;'&gt;"</span>;
<a name="l00108"></a>00108    print_r($tab_auteur);
<a name="l00109"></a>00109    echo <span class="stringliteral">"&lt;/pre&gt;&lt;hr/&gt;"</span>;
<a name="l00110"></a>00110    echo <span class="stringliteral">"_REQUEST&lt;pre style='text-align:left;'&gt;"</span>;
<a name="l00111"></a>00111    print_r($_REQUEST);
<a name="l00112"></a>00112    echo <span class="stringliteral">"&lt;/pre&gt;&lt;hr/&gt;"</span>;
<a name="l00113"></a>00113 <span class="comment">/*   echo "tab_referentiel&lt;pre style='text-align:left;'&gt;";</span>
<a name="l00114"></a>00114 <span class="comment">   print_r($tab_referentiel);</span>
<a name="l00115"></a>00115 <span class="comment">   echo "&lt;/pre&gt;&lt;hr/&gt;";</span>
<a name="l00116"></a>00116 <span class="comment">   echo "&lt;A NAME='fin_debug'&gt;&lt;/A&gt;\n";*/</span>
<a name="l00117"></a>00117 }
<a name="l00118"></a>00118 
<a name="l00119"></a>00119 debut_cadre_relief( <span class="stringliteral">""</span>, <span class="keyword">false</span>, <span class="stringliteral">""</span>, <a class="code" href="inc-pdf-attestations_8php.html#43e5b5a819fedbd12b8cf5421ba6985e">$titre</a> = _T('Saisie des candidats ODB'));
<a name="l00120"></a>00120 <span class="comment">//debut_boite_info();</span>
<a name="l00121"></a>00121 
<a name="l00122"></a>00122 $REFERER=$_SERVER['HTTP_REFERER'];
<a name="l00123"></a>00123 $REMOTE_ADDR=$_SERVER['REMOTE_ADDR'];
<a name="l00124"></a>00124 $URL_SCRIPT=<a class="code" href="inc-odb__saisie_8php.html#dc3dc64a8aa549177185660abb160f0c">_DIR_PLUGIN_ODB_SAISIE</a>;
<a name="l00125"></a>00125 
<a name="l00126"></a>00126 echo <span class="stringliteral">"\n\n&lt;!-- ============ Code SIOU - Module de saisie ============== --&gt;\n\n"</span>;
<a name="l00127"></a>00127 <a class="code" href="inc-odb_8php.html#bbbb7d83cb4d809eae2b31b2a3b1f556" title="Interdit l&amp;#39;acces a un utilisateur qui n&amp;#39;est pas dans le tableau $tOK.">isAutorise</a>(array('Admin<span class="charliteral">','</span>Operateur<span class="charliteral">','</span>Encadrant<span class="charliteral">','</span>Etablissement'));
<a name="l00128"></a>00128 
<a name="l00129"></a>00129 <span class="keywordflow">if</span>(isset($_REQUEST['historique_suppressions']) &amp;&amp; ($isAdmin || $isEncadrant)) {
<a name="l00130"></a>00130         $tCol=array('id_saisie<span class="charliteral">','</span>maj', 'login', 'nom', 'prenoms', 'ne_le', 'ne_en', 'ne_vers', 'ldn');
<a name="l00131"></a>00131         <a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a> = <span class="stringliteral">"SELECT "</span>.join(<span class="charliteral">','</span>,$tCol).<span class="stringliteral">" \n"</span>
<a name="l00132"></a>00132                         .<span class="stringliteral">" FROM odb_suppr_candidats \n"</span>
<a name="l00133"></a>00133                         .<span class="stringliteral">" ORDER BY maj"</span>
<a name="l00134"></a>00134                         ;
<a name="l00135"></a>00135         <a class="code" href="inc-ezpdf_8php.html#112ef069ddc0454086e3d1e6d8d55d07">$result</a> = <a class="code" href="inc-odb_8php.html#cc73cdf19f49ae7162c99fd07a614e88" title="Execute une requete sql.">odb_query</a>(<a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>,__FILE__,__LINE__);
<a name="l00136"></a>00136         <span class="keywordflow">while</span> ($row = mysql_fetch_array(<a class="code" href="inc-ezpdf_8php.html#112ef069ddc0454086e3d1e6d8d55d07">$result</a>)) {
<a name="l00137"></a>00137                 $id_saisie=$row['id_saisie'];
<a name="l00138"></a>00138                 <span class="keywordflow">foreach</span> ($tCol as $col) {
<a name="l00139"></a>00139                         $$col=$row[$col];
<a name="l00140"></a>00140                         <span class="keywordflow">if</span>($col=='login') $$col=ucwords($$col);
<a name="l00141"></a>00141                         $tSuivi[$id_saisie][$col] = $$col;
<a name="l00142"></a>00142                 }
<a name="l00143"></a>00143         }
<a name="l00144"></a>00144         $thead='';
<a name="l00145"></a>00145         <span class="keywordflow">foreach</span>($tCol as $col) $thead.=<span class="stringliteral">"&lt;th&gt;"</span>.ucfirst(str_replace(<span class="charliteral">'_'</span>,<span class="charliteral">' '</span>,$col)).<span class="stringliteral">"&lt;/th&gt;"</span>;
<a name="l00146"></a>00146         <span class="comment">//echo '&lt;pre&gt;';print_r($tSuivi);echo'&lt;/pre&gt;';</span>
<a name="l00147"></a>00147         <a class="code" href="resultats__ajournes__par__centre_8php.html#ea5d1e230cf3df250120025d801dc7c3">$cpt</a>=0;$tbody=array();
<a name="l00148"></a>00148         <span class="keywordflow">if</span>(is_array($tSuivi)) {
<a name="l00149"></a>00149                 <span class="keywordflow">foreach</span>($tSuivi as $id_saisie =&gt; $t1) {
<a name="l00150"></a>00150                         <a class="code" href="resultats__ajournes__par__centre_8php.html#ea5d1e230cf3df250120025d801dc7c3">$cpt</a>++;
<a name="l00151"></a>00151                         <span class="keywordflow">foreach</span>($t1 as $val) {
<a name="l00152"></a>00152                                 $tbody[<a class="code" href="resultats__ajournes__par__centre_8php.html#ea5d1e230cf3df250120025d801dc7c3">$cpt</a>].=<span class="stringliteral">"&lt;td&gt;$val&lt;/td&gt;"</span>;
<a name="l00153"></a>00153                         }
<a name="l00154"></a>00154                 }
<a name="l00155"></a>00155                 $historique_suppressions=<a class="code" href="inc-html_8php.html#5f91efa37c4c6e04e1e2792cc0c37600" title="Affiche une table html.">odb_html_table</a>(<span class="stringliteral">"Historique des suppressions $annee"</span>,$tbody,$thead,'historique-24.gif');
<a name="l00156"></a>00156         } <span class="keywordflow">else</span> $historique_suppressions=<span class="stringliteral">"Aucun dossier n'a &amp;eacute;t&amp;eacute; supprim&amp;eacute; en $annee."</span>;
<a name="l00157"></a>00157 }
<a name="l00158"></a>00158 
<a name="l00159"></a>00159 <span class="keywordflow">if</span> ((isset($_REQUEST['supprimer'])) &amp;&amp; ($isAdmin || $isEncadrant)) {
<a name="l00160"></a>00160         <span class="comment">// suppression d'une fiche</span>
<a name="l00161"></a>00161         $identifiant=$_REQUEST['supprimer'];
<a name="l00162"></a>00162         $id=$_REQUEST['<span class="keywordtype">id</span>'];
<a name="l00163"></a>00163         <a class="code" href="inc-pdf-attestations_8php.html#b372e2dd50f4a592a1226a01290a2f4f">$annee</a>=$_REQUEST['annee'];
<a name="l00164"></a>00164         debut_boite_info();
<a name="l00165"></a>00165         <a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>=<span class="stringliteral">"INSERT INTO odb_suppr_candidats (`id_saisie`, `id_table`, `id_table_old`, `annee`, `serie`, `prefixe`, `nom`, `prenoms`, `ne_le`, `ne_en`, `ne_vers`, `ldn`, `pdn`, `sexe`, `nationalite`, `quartier_res`, `lv1`, `lv2`, `eps`, `ef1`, `ef2`, `ville`, `departement`, `etablissement`, `ajourne`, `non_inscrit`, login, maj)\n (SELECT `id_saisie`, `id_table`, `id_table_old`, `annee`, `serie`, `prefixe`, `nom`, `prenoms`, `ne_le`, `ne_en`, `ne_vers`, `ldn`, `pdn`, `sexe`, `nationalite`, `quartier_res`, `lv1`, `lv2`, `eps`, `ef1`, `ef2`, `ville`, `departement`, `etablissement`, `ajourne`, `non_inscrit`,'"</span>.$tab_auteur['login'].<span class="stringliteral">"',NOW() from odb_candidats where annee=$annee and $identifiant='$id')"</span>;
<a name="l00166"></a>00166         <a class="code" href="inc-odb_8php.html#cc73cdf19f49ae7162c99fd07a614e88" title="Execute une requete sql.">odb_query</a>(<a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>,__FILE__,__LINE__);
<a name="l00167"></a>00167         $nb=mysql_affected_rows();
<a name="l00168"></a>00168         <span class="keywordflow">if</span>($nb==1) {
<a name="l00169"></a>00169                 echo <a class="code" href="odb__ref_8php.html#509f04652b5e1b2d2b9e6bc121a87e50">OK</a>.<span class="stringliteral">" - Suppression enregistr&amp;eacute;e dans l'historique des suppressions de candidats&lt;br/&gt;"</span>;
<a name="l00170"></a>00170                 <a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>=<span class="stringliteral">"DELETE FROM odb_candidats WHERE annee=$annee and $identifiant='$id'"</span>;
<a name="l00171"></a>00171                 <a class="code" href="inc-odb_8php.html#cc73cdf19f49ae7162c99fd07a614e88" title="Execute une requete sql.">odb_query</a>(<a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>,__FILE__,__LINE__);
<a name="l00172"></a>00172                 echo <a class="code" href="odb__ref_8php.html#509f04652b5e1b2d2b9e6bc121a87e50">OK</a>.<span class="stringliteral">" - La fiche $identifiant=$id a bien &amp;eacute;t&amp;eacute; supprim&amp;eacute;e&lt;br/&gt;"</span>;
<a name="l00173"></a>00173         }
<a name="l00174"></a>00174         <span class="keywordflow">else</span> echo <a class="code" href="odb__ref_8php.html#e56b96c4dfcced36887ba02c496c40a3">KO</a>.<span class="stringliteral">" - aucun ($nb) candidat ne correspond &amp;agrave; $identifiant=$id"</span>;
<a name="l00175"></a>00175         fin_boite_info();
<a name="l00176"></a>00176 }
<a name="l00177"></a>00177 
<a name="l00178"></a>00178 
<a name="l00179"></a>00179 <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">"step3"</span>])) {
<a name="l00181"></a>00181    $table=$_POST[<span class="stringliteral">"step3"</span>];
<a name="l00182"></a>00182    <a class="code" href="inc-pdf-attestations_8php.html#b372e2dd50f4a592a1226a01290a2f4f">$annee</a>=$_POST[<span class="stringliteral">"annee"</span>];
<a name="l00183"></a>00183    $id=$_POST[<span class="stringliteral">"id"</span>];
<a name="l00184"></a>00184    $identifiant=$_POST[<span class="stringliteral">"identifiant"</span>];
<a name="l00185"></a>00185    $id_dept=$_POST[<span class="stringliteral">"sql__departement"</span>];
<a name="l00186"></a>00186    $dept=$tab_referentiel['departement'][$id_dept];
<a name="l00187"></a>00187    $isNouveau=isset($_POST['isNouveau']);
<a name="l00188"></a>00188    <span class="keywordflow">if</span>(!is_numeric($id)) $id=<span class="stringliteral">"'$id'"</span>; 
<a name="l00189"></a>00189    gros_titre($table);
<a name="l00190"></a>00190    <span class="comment">/*debut_gauche();</span>
<a name="l00191"></a>00191 <span class="comment">      odb_raccourcis('tous');</span>
<a name="l00192"></a>00192 <span class="comment">   creer_colonne_droite();</span>
<a name="l00193"></a>00193 <span class="comment">   debut_droite();*/</span>
<a name="l00194"></a>00194    debut_boite_info();
<a name="l00195"></a>00195    <span class="comment">//echo "&lt;pre&gt;";print_r($_POST);echo "&lt;/pre&gt;";</span>
<a name="l00196"></a>00196    <a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>=<span class="stringliteral">"UPDATE $table SET\n"</span>;
<a name="l00197"></a>00197    <span class="keywordflow">foreach</span>($_POST as $key=&gt;$val) {
<a name="l00198"></a>00198       <span class="keywordflow">if</span>(substr_count($key,<span class="stringliteral">"sql"</span>)&gt;0) {
<a name="l00199"></a>00199          $tab_tmp=explode(<span class="stringliteral">"__"</span>,$key);
<a name="l00200"></a>00200          $champ=$tab_tmp[1];
<a name="l00201"></a>00201          $champ_map=$odb_mapping[$table][$champ];
<a name="l00202"></a>00202          $type=$odb_referentiel[$table][$champ_map];
<a name="l00203"></a>00203          <span class="keywordflow">if</span>($isNouveau &amp;&amp; $champ=='id_saisie') {
<a name="l00204"></a>00204                 $id=0;
<a name="l00205"></a>00205                         }
<a name="l00206"></a>00206          <span class="keywordflow">if</span>(substr($type,0,3)==<span class="stringliteral">"ref"</span>) {
<a name="l00207"></a>00207             $myRef=strtolower(substr($type,3));
<a name="l00208"></a>00208             <span class="keywordflow">switch</span>($myRef) {
<a name="l00209"></a>00209                <span class="keywordflow">case</span> 'ville':
<a name="l00210"></a>00210                   $check=$tab_referentiel[$myRef][$id_dept][$val];
<a name="l00211"></a>00211                   <span class="keywordflow">break</span>;
<a name="l00212"></a>00212                <span class="keywordflow">default</span>:
<a name="l00213"></a>00213                   $check=$tab_referentiel[$myRef][$val];
<a name="l00214"></a>00214                   <span class="keywordflow">break</span>;
<a name="l00215"></a>00215             }
<a name="l00216"></a>00216          } elseif(substr($type,0,3)==<span class="stringliteral">"Et."</span>) {
<a name="l00217"></a>00217             <span class="comment">//echo "&lt;hr&gt;====== etab : $val [$id_dept] ==========";</span>
<a name="l00218"></a>00218             $check=$tab_referentiel['etablissement'][$id_dept][$val];
<a name="l00219"></a>00219          } <span class="keywordflow">else</span> $check=$val;
<a name="l00220"></a>00220          <span class="comment">//echo '$table,$check,$champ,$dept,$id '."$table,$check,$champ,$dept,$id&lt;br&gt;";</span>
<a name="l00221"></a>00221          $retour=<a class="code" href="inc-regles__gestion_8php.html#7b7e71083f065a8f45947cf013206a64">reglesGestion</a>($table,$check,$champ_map,$dept,$id);
<a name="l00222"></a>00222          <span class="keywordflow">if</span>($type!=<span class="stringliteral">""</span>) {
<a name="l00223"></a>00223             $val=$retour[<span class="stringliteral">"valeur"</span>];
<a name="l00224"></a>00224             $fatal.=$retour[<span class="stringliteral">"fatal"</span>];
<a name="l00225"></a>00225             $txt_debug.=$retour[<span class="stringliteral">"txt_debug"</span>];
<a name="l00226"></a>00226          } <span class="keywordflow">else</span> {
<a name="l00227"></a>00227             $txt_debug.=<span class="stringliteral">"Type inconnu pour le champ $champ (valeur : $val)&lt;br/&gt;\n"</span>;
<a name="l00228"></a>00228             <span class="keywordflow">if</span>($val==<span class="stringliteral">""</span>) $val=<span class="stringliteral">"'$val'"</span>;
<a name="l00229"></a>00229          }
<a name="l00230"></a>00230          $val=str_replace(<span class="stringliteral">"@_quote_@"</span>,<span class="stringliteral">"'"</span>,$val);
<a name="l00231"></a>00231          <span class="keywordflow">switch</span> ($champ)
<a name="l00232"></a>00232          {
<a name="l00233"></a>00233                 <span class="keywordflow">case</span> 'ne_le' : 
<a name="l00234"></a>00234                         $tmp=array();
<a name="l00235"></a>00235                         $tmp=explode(<span class="charliteral">'/'</span>,$val);
<a name="l00236"></a>00236                         <span class="keywordflow">if</span>(count($tmp)&gt;1) $val=$tmp[2].<span class="charliteral">'-'</span>.$tmp[1].<span class="charliteral">'-'</span>.$tmp[0];
<a name="l00237"></a>00237                         <span class="keywordflow">break</span>;
<a name="l00238"></a>00238                 <span class="keywordflow">default</span>: 
<a name="l00239"></a>00239          }
<a name="l00240"></a>00240          
<a name="l00241"></a>00241          $sql_tab[]=<span class="stringliteral">"$champ=$val"</span>;
<a name="l00242"></a>00242          $sql_insert_col[]=$champ;
<a name="l00243"></a>00243          $sql_insert_val[]=$val;
<a name="l00244"></a>00244          <span class="keywordflow">if</span>(substr_count($champ,'ne_')&gt;0) {
<a name="l00245"></a>00245                 <span class="comment">// modif d'un candidat : on force les champs ne_xxx non passes (car disabled) a 0</span>
<a name="l00246"></a>00246                 <span class="keywordflow">foreach</span>(array('ne_le<span class="charliteral">','</span>ne_en<span class="charliteral">','</span>ne_vers') as $col) {
<a name="l00247"></a>00247                         <span class="keywordflow">if</span>($champ!=$col) {
<a name="l00248"></a>00248                                 $sql_tab[]=<span class="stringliteral">"$col=''"</span>;
<a name="l00249"></a>00249                                         }
<a name="l00250"></a>00250                                 }
<a name="l00251"></a>00251                         }
<a name="l00252"></a>00252          <span class="keywordflow">if</span>($champ!='maj') $sql_histo_pre[]=<span class="stringliteral">"$champ"</span>;
<a name="l00253"></a>00253          <span class="keywordflow">else</span> $maj=$val;
<a name="l00254"></a>00254          $sql_histo_post[]=<span class="stringliteral">"$val"</span>;
<a name="l00255"></a>00255          <span class="keywordflow">if</span>($champ=='id_saisie') $id_saisie=$val;
<a name="l00256"></a>00256          <span class="keywordflow">if</span> ($debug) echo <span class="stringliteral">"$champ=$val&lt;br&gt;\n"</span>;
<a name="l00257"></a>00257       }
<a name="l00258"></a>00258    }
<a name="l00259"></a>00259 
<a name="l00260"></a>00260    echo $fatal;
<a name="l00261"></a>00261    <span class="keywordflow">if</span>(strlen(trim($fatal))==0) {
<a name="l00262"></a>00262       $sql_histo=<span class="stringliteral">"INSERT into odb_histo_candidats (login,maj,"</span>.join(<span class="stringliteral">","</span>,$sql_histo_pre).<span class="stringliteral">") (SELECT '"</span>.$tab_auteur['login'].<span class="stringliteral">"',$maj, "</span>.join(<span class="stringliteral">","</span>,$sql_histo_pre).<span class="stringliteral">" from odb_candidats where id_saisie='$id_saisie' and annee=$annee)"</span>;
<a name="l00263"></a>00263       <span class="keywordflow">if</span>(!$isNouveau) <a class="code" href="inc-odb_8php.html#cc73cdf19f49ae7162c99fd07a614e88" title="Execute une requete sql.">odb_query</a>($sql_histo,__FILE__,__LINE__);
<a name="l00264"></a>00264 
<a name="l00265"></a>00265       <span class="comment">//$sql_delete="DELETE FROM $table WHERE annee=$annee AND $identifiant=$id";</span>
<a name="l00266"></a>00266       <span class="comment">//$txt_debug.= "Requêtes&lt;br/&gt;&lt;pre&gt;$sql_delete&lt;/pre&gt;&lt;br/&gt;\n";</span>
<a name="l00267"></a>00267       <span class="comment">//mysql_query($sql_delete) or die (KO. " - requête $sql_delete&lt;br/&gt;\n".mysql_error());</span>
<a name="l00268"></a>00268       <a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a> .= join(<span class="stringliteral">","</span>,$sql_tab).<span class="stringliteral">"\nWHERE annee=$annee AND $identifiant=$id"</span>;
<a name="l00269"></a>00269       <span class="keywordflow">if</span>($isNouveau) {
<a name="l00270"></a>00270                         $sql2=<span class="stringliteral">"SELECT max(id_saisie)+1 id from odb_candidats where id_saisie&lt;100000 and annee=$annee"</span>;
<a name="l00271"></a>00271                         <a class="code" href="inc-ezpdf_8php.html#112ef069ddc0454086e3d1e6d8d55d07">$result</a>=<a class="code" href="inc-odb_8php.html#cc73cdf19f49ae7162c99fd07a614e88" title="Execute une requete sql.">odb_query</a>($sql2,__FILE__,__LINE__);
<a name="l00272"></a>00272                         $row=mysql_fetch_array(<a class="code" href="inc-ezpdf_8php.html#112ef069ddc0454086e3d1e6d8d55d07">$result</a>);
<a name="l00273"></a>00273                         $id_saisie=$row['<span class="keywordtype">id</span>'];
<a name="l00274"></a>00274                         <span class="keywordflow">if</span>($id_saisie=='') die(<a class="code" href="odb__ref_8php.html#e56b96c4dfcced36887ba02c496c40a3">KO</a>.<span class="stringliteral">" - Nouveau id_saisie introuvable"</span>);
<a name="l00275"></a>00275                         <span class="keywordflow">if</span>($id_saisie==0) $id_saisie=1; <span class="comment">// premier candidat de l'annee (ne dois pas avoir id_saisie=0)</span>
<a name="l00276"></a>00276                         $id=$id_saisie;
<a name="l00277"></a>00277          <span class="comment">//echo "$champ $champ_map $key $val&lt;br&gt;$sql";</span>
<a name="l00278"></a>00278 
<a name="l00279"></a>00279         <a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>=<span class="stringliteral">"INSERT into odb_candidats (\nlogin,id_saisie,"</span>.join(<span class="charliteral">','</span>,$sql_insert_col).<span class="stringliteral">"\n) VALUES (\n'"</span>.$tab_auteur['login'].<span class="stringliteral">"',$id,"</span>.join(<span class="charliteral">','</span>,$sql_insert_val).<span class="stringliteral">"\n)"</span>;
<a name="l00280"></a>00280                 }
<a name="l00281"></a>00281       $txt_debug .= <span class="stringliteral">"&lt;pre&gt;$sql&lt;/pre&gt;&lt;br/&gt;\n"</span>;
<a name="l00282"></a>00282       <a class="code" href="inc-odb_8php.html#cc73cdf19f49ae7162c99fd07a614e88" title="Execute une requete sql.">odb_query</a>(<a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>,__FILE__,__LINE__);
<a name="l00283"></a>00283       <a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>=<span class="stringliteral">"UPDATE odb_repartition rep, odb_candidats can set rep.id_table=can.id_table where rep.id_saisie=can.id_saisie and can.annee=$annee and rep.annee=$annee"</span>;
<a name="l00284"></a>00284       <a class="code" href="inc-odb_8php.html#cc73cdf19f49ae7162c99fd07a614e88" title="Execute une requete sql.">odb_query</a>(<a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>,__FILE__,__LINE__);
<a name="l00285"></a>00285       <a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>=<span class="stringliteral">"delete from odb_repartition where (id_table='' or id_table='0') and annee=$annee"</span>;
<a name="l00286"></a>00286       <a class="code" href="inc-odb_8php.html#cc73cdf19f49ae7162c99fd07a614e88" title="Execute une requete sql.">odb_query</a>(<a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>,__FILE__,__LINE__);
<a name="l00287"></a>00287       <a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>=<span class="stringliteral">"UPDATE odb_candidats set id_table='0' where id_table='' and annee=$annee"</span>;
<a name="l00288"></a>00288       <a class="code" href="inc-odb_8php.html#cc73cdf19f49ae7162c99fd07a614e88" title="Execute une requete sql.">odb_query</a>(<a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>,__FILE__,__LINE__);
<a name="l00289"></a>00289       <span class="keywordflow">if</span>($isNouveau) {
<a name="l00290"></a>00290         echo <a class="code" href="odb__ref_8php.html#509f04652b5e1b2d2b9e6bc121a87e50">OK</a>.<span class="stringliteral">" Le candidat &lt;b&gt;$id&lt;/b&gt; a bien &amp;eacute;t&amp;eacute; enregistr&amp;eacute; &lt;br/&gt;\n"</span>;
<a name="l00291"></a>00291                 }
<a name="l00292"></a>00292       <span class="keywordflow">else</span> echo <a class="code" href="odb__ref_8php.html#509f04652b5e1b2d2b9e6bc121a87e50">OK</a>.<span class="stringliteral">" Mise &amp;agrave; jour de &lt;b&gt;$table&lt;/b&gt; effectu&amp;eacute;e pour &lt;b&gt;$identifiant=$id&lt;/b&gt; en &lt;b&gt;$annee&lt;/b&gt;&lt;br/&gt;Les anciennes donn&amp;eacute;es ont &amp;eacute;t&amp;eacute; enregist&amp;eacute;es dans la table d'historique&lt;br/&gt;\n"</span>;
<a name="l00293"></a>00293    }
<a name="l00294"></a>00294    <span class="keywordflow">if</span>($debug) echo <span class="stringliteral">"&lt;hr/&gt;$txt_debug"</span>;
<a name="l00295"></a>00295 
<a name="l00296"></a>00296    fin_boite_info();
<a name="l00297"></a>00297    echo <span class="stringliteral">"&lt;br /&gt;"</span>;
<a name="l00298"></a>00298    <span class="comment">//debut_cadre_relief("", false, "", $titre = _T("Acc&amp;egrave;s direct &amp;agrave; un candidat $annee"));</span>
<a name="l00299"></a>00299         <span class="keywordflow">if</span>(isset($_REQUEST['ajouter_nouveau'])) {
<a name="l00300"></a>00300                 <span class="comment">//echo"&lt;pre&gt;";print_r($_POST);echo"&lt;/pre&gt;";</span>
<a name="l00301"></a>00301                 <span class="comment">// revenir au cadre d'ajout de nouveau candidat</span>
<a name="l00302"></a>00302                 <span class="comment">//unset($_POST);</span>
<a name="l00303"></a>00303                 $_REQUEST['step2']='odb_candidats';
<a name="l00304"></a>00304                 $_REQUEST['ajout_candidat']='<span class="keyword">auto</span>';
<a name="l00305"></a>00305                 $_REQUEST['annee']=<a class="code" href="inc-pdf-attestations_8php.html#b372e2dd50f4a592a1226a01290a2f4f">$annee</a>;
<a name="l00306"></a>00306                 $ajouterNouveau=<span class="keyword">true</span>;
<a name="l00307"></a>00307                 $tPersist['etablissement']=$_REQUEST['sql__etablissement'];
<a name="l00308"></a>00308                 $tPersist['ville']=$_REQUEST['sql__ville'];
<a name="l00309"></a>00309                 $tPersist['serie']=$_REQUEST['sql__serie'];
<a name="l00310"></a>00310                 <span class="comment">//print_r($tPersist);</span>
<a name="l00311"></a>00311         }
<a name="l00312"></a>00312         <span class="keywordflow">else</span> unset($_POST); <span class="comment">// revenir au debut</span>
<a name="l00313"></a>00313    <span class="comment">//fin_cadre_relief();</span>
<a name="l00314"></a>00314    
<a name="l00315"></a>00315 } 
<a name="l00316"></a>00316 <span class="keywordflow">if</span>(isset($_REQUEST[<span class="stringliteral">"step2"</span>])) {
<a name="l00318"></a>00318    $table=$_REQUEST[<span class="stringliteral">"step2"</span>];
<a name="l00319"></a>00319    $id=$_REQUEST[<span class="stringliteral">"id"</span>]; <span class="comment">//numero</span>
<a name="l00320"></a>00320         $isNouveau=<span class="keyword">false</span>; <span class="comment">// modification d'un candidat existant</span>
<a name="l00321"></a>00321         <span class="keywordflow">if</span>($_REQUEST['ajout_candidat']) {
<a name="l00322"></a>00322                 $isNouveau=<span class="keyword">true</span>; <span class="comment">// insertion d'un nouveau candidat</span>
<a name="l00323"></a>00323                 $identifiant='id_saisie';
<a name="l00324"></a>00324         } elseif(!is_numeric($id)) {<span class="comment">//numero de table</span>
<a name="l00325"></a>00325         $id=<a class="code" href="inc-odb_8php.html#50e3b190a166aaf85cb237405cf56be2" title="affiche un numero de table de facon lisible pour un humain">getIdTableHumain</a>($id);
<a name="l00326"></a>00326         $identifiant='id_table';
<a name="l00327"></a>00327    } <span class="keywordflow">else</span> {
<a name="l00328"></a>00328         $identifiant='id_saisie'; <span class="comment">//champ</span>
<a name="l00329"></a>00329    }
<a name="l00330"></a>00330    <span class="comment">//print_r($_REQUEST);</span>
<a name="l00331"></a>00331    <a class="code" href="inc-pdf-attestations_8php.html#b372e2dd50f4a592a1226a01290a2f4f">$annee</a>=$_REQUEST[<span class="stringliteral">"annee"</span>];
<a name="l00332"></a>00332    <span class="comment">//debut_gauche();</span>
<a name="l00333"></a>00333    gros_titre($table);
<a name="l00334"></a>00334    <span class="keywordflow">if</span>($identifiant=='id_table') $id=<span class="stringliteral">"'$id'"</span>;
<a name="l00335"></a>00335 
<a name="l00336"></a>00336    <span class="keywordflow">if</span>($isNouveau) {
<a name="l00337"></a>00337         <span class="comment">//xxx</span>
<a name="l00338"></a>00338         $nbCan=<a class="code" href="odb__notes_2exec_2inc-bdd_8php.html#000899dd9da7cf04c35abc6e440d6ed3" title="Recupere le nombre de candidats selon divers criteres.">getNbCandidats</a>();
<a name="l00339"></a>00339         <span class="keywordflow">if</span>($nbCan&gt;0) {
<a name="l00340"></a>00340                 <a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>=<span class="stringliteral">"SELECT * from odb_candidats LIMIT 0,1"</span>;
<a name="l00341"></a>00341                 <a class="code" href="inc-ezpdf_8php.html#112ef069ddc0454086e3d1e6d8d55d07">$result</a>=<a class="code" href="inc-odb_8php.html#cc73cdf19f49ae7162c99fd07a614e88" title="Execute une requete sql.">odb_query</a>(<a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>,__FILE__,__LINE__);
<a name="l00342"></a>00342                 } <span class="keywordflow">else</span> { 
<a name="l00343"></a>00343                         <a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>=<span class="stringliteral">"INSERT INTO odb_candidats(id_saisie,annee) VALUES (0,$annee)"</span>;
<a name="l00344"></a>00344                         <a class="code" href="inc-odb_8php.html#cc73cdf19f49ae7162c99fd07a614e88" title="Execute une requete sql.">odb_query</a>(<a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>,__FILE__,__LINE__);
<a name="l00345"></a>00345                 <a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>=<span class="stringliteral">"SELECT * from odb_candidats LIMIT 0,1"</span>;
<a name="l00346"></a>00346                 <a class="code" href="inc-ezpdf_8php.html#112ef069ddc0454086e3d1e6d8d55d07">$result</a>=<a class="code" href="inc-odb_8php.html#cc73cdf19f49ae7162c99fd07a614e88" title="Execute une requete sql.">odb_query</a>(<a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>,__FILE__,__LINE__);                      
<a name="l00347"></a>00347                         <a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>=<span class="stringliteral">"DELETE FROM odb_candidats WHERE id_saisie=0 and annee=$annee"</span>;
<a name="l00348"></a>00348                         <a class="code" href="inc-odb_8php.html#cc73cdf19f49ae7162c99fd07a614e88" title="Execute une requete sql.">odb_query</a>(<a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>,__FILE__,__LINE__);
<a name="l00349"></a>00349                 }
<a name="l00350"></a>00350         } <span class="keywordflow">else</span> {
<a name="l00351"></a>00351                 <a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>=<span class="stringliteral">"SELECT * FROM $table WHERE $identifiant=$id AND annee=$annee"</span>;
<a name="l00352"></a>00352                 <a class="code" href="inc-ezpdf_8php.html#112ef069ddc0454086e3d1e6d8d55d07">$result</a>=<a class="code" href="inc-odb_8php.html#cc73cdf19f49ae7162c99fd07a614e88" title="Execute une requete sql.">odb_query</a>(<a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>,__FILE__,__LINE__);
<a name="l00353"></a>00353         }
<a name="l00354"></a>00354         $nb_fields=mysql_num_fields(<a class="code" href="inc-ezpdf_8php.html#112ef069ddc0454086e3d1e6d8d55d07">$result</a>);
<a name="l00355"></a>00355         <span class="keywordflow">for</span> (<a class="code" href="odb__commun_2img__pack_2vignettes_2index_8php.html#83018d9153d17d91fbcf3bc10158d34f">$i</a>=0;<a class="code" href="odb__commun_2img__pack_2vignettes_2index_8php.html#83018d9153d17d91fbcf3bc10158d34f">$i</a>&lt;$nb_fields;<a class="code" href="odb__commun_2img__pack_2vignettes_2index_8php.html#83018d9153d17d91fbcf3bc10158d34f">$i</a>++) {
<a name="l00356"></a>00356                 $label_bdd=mysql_field_name(<a class="code" href="inc-ezpdf_8php.html#112ef069ddc0454086e3d1e6d8d55d07">$result</a>, <a class="code" href="odb__commun_2img__pack_2vignettes_2index_8php.html#83018d9153d17d91fbcf3bc10158d34f">$i</a>);
<a name="l00357"></a>00357                 $label[<a class="code" href="odb__commun_2img__pack_2vignettes_2index_8php.html#83018d9153d17d91fbcf3bc10158d34f">$i</a>]=str_replace(<span class="charliteral">'_'</span>,<span class="charliteral">' '</span>,$odb_mapping[$table][$label_bdd]);
<a name="l00358"></a>00358                 $label_sql[<a class="code" href="odb__commun_2img__pack_2vignettes_2index_8php.html#83018d9153d17d91fbcf3bc10158d34f">$i</a>]=$label_bdd;
<a name="l00359"></a>00359                 $tCol[$label_bdd]=<a class="code" href="odb__commun_2img__pack_2vignettes_2index_8php.html#83018d9153d17d91fbcf3bc10158d34f">$i</a>;
<a name="l00360"></a>00360         }
<a name="l00361"></a>00361 
<a name="l00362"></a>00362    <span class="keywordflow">if</span>(isset($_REQUEST['sql__departement'])) $id_departement=$_REQUEST['sql__departement'];
<a name="l00363"></a>00363    $couleurOk='#AD2';
<a name="l00364"></a>00364    $couleurKo='#C66';
<a name="l00365"></a>00365    $couleurDisable='#aaa';
<a name="l00366"></a>00366    $couleurEnable=$couleurOk;
<a name="l00367"></a>00367    $couleurFocus='#fa0';
<a name="l00368"></a>00368 
<a name="l00369"></a>00369    <span class="comment">//debut_droite();</span>
<a name="l00370"></a>00370 <span class="comment">/*print_r</span>
<a name="l00371"></a>00371 <span class="comment">   print_r($label);</span>
<a name="l00372"></a>00372 <span class="comment">   echo"&lt;hr/&gt;";</span>
<a name="l00373"></a>00373 <span class="comment">   print_r($label_sql);</span>
<a name="l00374"></a>00374 <span class="comment">   echo"&lt;hr/&gt;";</span>
<a name="l00375"></a>00375 <span class="comment">   print_r($odb_mapping[$table]);</span>
<a name="l00376"></a>00376 <span class="comment">*/</span>
<a name="l00377"></a>00377 
<a name="l00378"></a>00378 <span class="comment">//   </span>
<a name="l00379"></a>00379    <span class="keywordflow">if</span>(isset($_REQUEST['introspecter'])) {
<a name="l00380"></a>00380                 debut_gauche();
<a name="l00381"></a>00381                         debut_raccourcis();
<a name="l00382"></a>00382                                 icone_horizontale (_L('Saisie d\'un nouveau candidat'), 
<a name="l00383"></a>00383                                         generer_url_ecrire(<span class="stringliteral">"odb_saisie"</span>).<span class="stringliteral">"&amp;annee=$annee&amp;id=&amp;step2=odb_candidats&amp;ajout_candidat=true#form_odb_candidats"</span>, 
<a name="l00384"></a>00384                                         <span class="stringliteral">"../"</span>.<a class="code" href="inc-odb__ref_8php.html#76319c6fdabb160dcfd10671480a2ed7">_DIR_PLUGIN_ODB_REF</a>.<span class="stringliteral">"/img_pack/siou_carre.png"</span>);
<a name="l00385"></a>00385                                 icone_horizontale (_L('Introspection'), 
<a name="l00386"></a>00386                                         generer_url_ecrire(<span class="stringliteral">"odb_saisie"</span>).<span class="stringliteral">"&amp;annee=$annee&amp;step2=odb_candidats&amp;introspecter=true"</span>, 
<a name="l00387"></a>00387                                         <span class="stringliteral">"../"</span>.<a class="code" href="inc-odb__ref_8php.html#76319c6fdabb160dcfd10671480a2ed7">_DIR_PLUGIN_ODB_REF</a>.<span class="stringliteral">"/img_pack/siou_carre.png"</span>);
<a name="l00388"></a>00388                                 <span class="keywordflow">if</span>($isEncadrant || $isAdmin) {
<a name="l00389"></a>00389                                         icone_horizontale (_L('Historique des suppressions'), 
<a name="l00390"></a>00390                                                 generer_url_ecrire(<span class="stringliteral">"odb_saisie"</span>).<span class="stringliteral">"&amp;annee=$annee&amp;historique_suppressions=true"</span>, 
<a name="l00391"></a>00391                                                 <span class="stringliteral">"../"</span>.<a class="code" href="inc-odb__ref_8php.html#76319c6fdabb160dcfd10671480a2ed7">_DIR_PLUGIN_ODB_REF</a>.<span class="stringliteral">"/img_pack/siou_carre.png"</span>);
<a name="l00392"></a>00392                                 }
<a name="l00393"></a>00393                         fin_raccourcis();
<a name="l00394"></a>00394                 creer_colonne_droite();
<a name="l00395"></a>00395                 debut_droite();
<a name="l00396"></a>00396                         <span class="keywordflow">if</span>(strlen($historique_suppressions)&gt;0) {
<a name="l00397"></a>00397                                 debut_boite_info();
<a name="l00398"></a>00398                                         echo $historique_suppressions;
<a name="l00399"></a>00399                                 fin_boite_info();
<a name="l00400"></a>00400                         }
<a name="l00401"></a>00401                 debut_boite_info();
<a name="l00402"></a>00402         $nbErreurs=<a class="code" href="inc-referentiel_8php.html#8a347b23cd689ac91a0c11390ae5a7e4" title="Introspection du referentiel pour l&amp;#39;annee specifiee Consiste a verifier l&amp;#39;integrite...">odb_introspection</a>(<a class="code" href="inc-pdf-attestations_8php.html#b372e2dd50f4a592a1226a01290a2f4f">$annee</a>);
<a name="l00403"></a>00403         <a class="code" href="inc-pdf-convocation_8php.html#96f46783d0d9ef01d8a88b9ee6387696">$s</a>=$nbErreurs&gt;1?<span class="charliteral">'s'</span>:'';
<a name="l00404"></a>00404         <span class="keywordflow">if</span>($nbErreurs==0) $nbErreurs='Aucune';
<a name="l00405"></a>00405         echo <span class="stringliteral">"&lt;b&gt;$nbErreurs&lt;/b&gt; erreur$s d&amp;eacute;tect&amp;eacute;e$s"</span>;
<a name="l00406"></a>00406         fin_boite_info();
<a name="l00407"></a>00407         exit;
<a name="l00408"></a>00408         }
<a name="l00409"></a>00409    <span class="keywordflow">if</span> ($isNouveau || mysql_num_rows(<a class="code" href="inc-ezpdf_8php.html#112ef069ddc0454086e3d1e6d8d55d07">$result</a>) &gt; 0) {
<a name="l00410"></a>00410         $flag=0;
<a name="l00411"></a>00411         $tColsSaisieObligatoire=array('annee<span class="charliteral">','</span>serie<span class="charliteral">','</span>nom<span class="charliteral">','</span>prenoms<span class="charliteral">','</span>ldn<span class="charliteral">','</span>pdn<span class="charliteral">','</span>sexe<span class="charliteral">','</span>nationalite<span class="charliteral">','</span>eps<span class="charliteral">','</span>ville<span class="charliteral">','</span>etablissement');
<a name="l00412"></a>00412         $tColsSaisieFacultative=array('prefixe<span class="charliteral">','</span>ne_le<span class="charliteral">','</span>ne_en<span class="charliteral">','</span>ne_vers<span class="charliteral">','</span>lv1<span class="charliteral">','</span>lv2<span class="charliteral">','</span>ef1<span class="charliteral">','</span>ef2<span class="charliteral">','</span>quartier_res');
<a name="l00413"></a>00413       <span class="keywordflow">while</span>($row=mysql_fetch_array(<a class="code" href="inc-ezpdf_8php.html#112ef069ddc0454086e3d1e6d8d55d07">$result</a>)) {
<a name="l00414"></a>00414          $id=$row[$identifiant];
<a name="l00415"></a>00415          $login=ucwords($row['login']);
<a name="l00416"></a>00416 
<a name="l00417"></a>00417          $etablissement=stripslashes($row['etablissement']);
<a name="l00418"></a>00418          <span class="keywordflow">if</span>(!$id_departement&gt;0) 
<a name="l00419"></a>00419                 <span class="keywordflow">if</span>($isNouveau) $id_departement=0;
<a name="l00420"></a>00420                 <span class="keywordflow">else</span> $id_departement=$row['departement'];         
<a name="l00421"></a>00421          $etablissement=stripslashes($tab_referentiel[$etablissement][$id_departement]);
<a name="l00422"></a>00422          <span class="keywordflow">if</span>($isChefEtablissement)
<a name="l00423"></a>00423             <span class="keywordflow">if</span>($tab_auteur[<span class="stringliteral">"nom_site"</span>]!=$etablissement) {
<a name="l00424"></a>00424                die(<a class="code" href="odb__ref_8php.html#e56b96c4dfcced36887ba02c496c40a3">KO</a>.<span class="stringliteral">" - &lt;b&gt;"</span>.$tab_auteur[<span class="stringliteral">"nom"</span>].<span class="stringliteral">"&lt;/b&gt;, vous ne pouvez modifier que les candidats de l'&amp;eacute;tablissement &lt;B&gt;"</span>.$tab_auteur[<span class="stringliteral">"nom_site"</span>].<span class="stringliteral">"&lt;/B&gt;,or le candidat &lt;b&gt;$identifiant=$id&lt;/b&gt; est dans l'&amp;eacute;tablissement &lt;b&gt;$etablissement&lt;/b&gt;"</span>);
<a name="l00425"></a>00425             } <span class="keywordflow">else</span> $disabled=<span class="stringliteral">"disabled"</span>;
<a name="l00426"></a>00426          $tReference=$row;
<a name="l00427"></a>00427          <span class="keywordflow">for</span> (<a class="code" href="odb__commun_2img__pack_2vignettes_2index_8php.html#83018d9153d17d91fbcf3bc10158d34f">$i</a>=0;<a class="code" href="odb__commun_2img__pack_2vignettes_2index_8php.html#83018d9153d17d91fbcf3bc10158d34f">$i</a>&lt;$nb_fields;<a class="code" href="odb__commun_2img__pack_2vignettes_2index_8php.html#83018d9153d17d91fbcf3bc10158d34f">$i</a>++) {
<a name="l00428"></a>00428             $type=$odb_referentiel[$table][$odb_mapping[$table][$label_sql[<a class="code" href="odb__commun_2img__pack_2vignettes_2index_8php.html#83018d9153d17d91fbcf3bc10158d34f">$i</a>]]];
<a name="l00429"></a>00429             <span class="keywordflow">if</span>($isNouveau) {
<a name="l00430"></a>00430                 $row[<a class="code" href="odb__commun_2img__pack_2vignettes_2index_8php.html#83018d9153d17d91fbcf3bc10158d34f">$i</a>]=isset($tPersist[$label_sql[<a class="code" href="odb__commun_2img__pack_2vignettes_2index_8php.html#83018d9153d17d91fbcf3bc10158d34f">$i</a>]])?$tPersist[$label_sql[$i]]:'';
<a name="l00431"></a>00431                 <span class="comment">//echo "$label_sql[$i] : $row[$i]&lt;br/&gt;";</span>
<a name="l00432"></a>00432                                 } <span class="keywordflow">else</span> $row[<a class="code" href="odb__commun_2img__pack_2vignettes_2index_8php.html#83018d9153d17d91fbcf3bc10158d34f">$i</a>]=stripslashes($row[<a class="code" href="odb__commun_2img__pack_2vignettes_2index_8php.html#83018d9153d17d91fbcf3bc10158d34f">$i</a>]);
<a name="l00433"></a>00433                                 $js=<span class="stringliteral">" onChange=\"this.style.backgroundColor='$couleurOk';\""</span>;
<a name="l00434"></a>00434             <span class="keywordflow">if</span>(substr_count($type,<span class="stringliteral">"ref"</span>)&gt;0) { <span class="comment">//c'est un référentiel</span>
<a name="l00435"></a>00435                $referentiel=substr($type,3);
<a name="l00436"></a>00436                <span class="comment">//echo "$referentiel-".$row[$i]." :: ";</span>
<a name="l00437"></a>00437                <span class="keywordflow">switch</span> ($label_sql[$i])
<a name="l00438"></a>00438                {
<a name="l00439"></a>00439                 <span class="keywordflow">case</span> 'serie': 
<a name="l00440"></a>00440                         $js.=<span class="stringliteral">"onClick=\"if(this.options[selectedIndex].text=='A1' || this.options[selectedIndex].text=='A2' || this.options[selectedIndex].text=='B') {\n"</span>.
<a name="l00441"></a>00441                                 <span class="stringliteral">"\tflag=false;document.forms['form_$table'].sql__lv1.style.backgroundColor='$couleurEnable';document.forms['form_$table'].sql__lv2.style.backgroundColor='$couleurEnable';\n"</span>
<a name="l00442"></a>00442                                 .<span class="stringliteral">"} else {\n\tflag=true;document.forms['form_$table'].sql__lv1.value=0;document.forms['form_$table'].sql__lv1.style.backgroundColor='$couleurDisable';document.forms['form_$table'].sql__lv2.style.backgroundColor='$couleurDisable';document.forms['form_$table'].sql__lv2.value=0;\n}\n"</span>
<a name="l00443"></a>00443                                 .<span class="stringliteral">"document.forms['form_$table'].sql__lv1.disabled=flag;document.forms['form_$table'].sql__lv2.disabled=flag;\""</span>
<a name="l00444"></a>00444                                 ;
<a name="l00445"></a>00445                         <span class="keywordflow">break</span>;
<a name="l00446"></a>00446                 <span class="keywordflow">case</span> 'pdn':
<a name="l00447"></a>00447                         $js.=<span class="stringliteral">"onBlur=\"document.forms['form_$table'].sql__nationalite.value=this.value;\" "</span>;
<a name="l00448"></a>00448                         <span class="keywordflow">break</span>;
<a name="l00449"></a>00449                }
<a name="l00450"></a>00450                <span class="keywordflow">if</span>($id_departement&gt;0)
<a name="l00451"></a>00451                 $txt_ligne=<a class="code" href="inc-referentiel_8php.html#caa8fb22e017e5edd73e572b1c091189">formSelectRefInTR</a>($label[$i],<span class="stringliteral">"sql__"</span>.$label_sql[$i],$referentiel,trim($row[$i]),<span class="stringliteral">"class='fondo' $js"</span>,$id_departement);
<a name="l00452"></a>00452                <span class="keywordflow">else</span> 
<a name="l00453"></a>00453                                                 $txt_ligne=<span class="stringliteral">"&lt;tr&gt;&lt;td&gt;&lt;label for='sql__"</span>.$label_sql[$i].<span class="stringliteral">"'&gt;$label[$i]&lt;/label&gt;&lt;/td&gt;\n"</span>.
<a name="l00454"></a>00454                                                         <span class="stringliteral">"&lt;td&gt;&lt;SELECT name='sql__"</span>.$label_sql[$i].<span class="stringliteral">"' id='sql__"</span>.$label_sql[$i].<span class="stringliteral">"' class='fondo'&gt;\n"</span>.
<a name="l00455"></a>00455                                                         <span class="stringliteral">"&lt;OPTION SELECTED VALUE='0'&gt;$label[$i]&lt;/OPTION&gt;"</span>.
<a name="l00456"></a>00456                                                         <span class="stringliteral">"&lt;/SELECT&gt;&lt;/td&gt;&lt;/tr&gt;\n"</span>
<a name="l00457"></a>00457                                                         ;
<a name="l00458"></a>00458             } elseif($type==<span class="stringliteral">"Et."</span>) { <span class="comment">// Etablissement : on concatene les ref d'etablissement</span>
<a name="l00459"></a>00459                <span class="keywordflow">if</span>($id_departement&gt;0)
<a name="l00460"></a>00460                        $txt_ligne=<a class="code" href="inc-referentiel_8php.html#caa8fb22e017e5edd73e572b1c091189">formSelectRefInTR</a>(<span class="stringliteral">"&amp;Eacute;tablissement"</span>,<span class="stringliteral">"sql__"</span>.$label_sql[$i],<span class="stringliteral">"etablissement"</span>,$row[$i],<span class="stringliteral">"$disabled class='fondo' $js"</span>,$id_departement); <span class="comment">//$label,$name,$referentiel,$annee,$valeur_defaut,$html=""</span>
<a name="l00461"></a>00461                <span class="keywordflow">else</span> 
<a name="l00462"></a>00462                                                 $txt_ligne=<span class="stringliteral">"&lt;tr&gt;&lt;td&gt;&lt;label for='sql__"</span>.$label_sql[$i].<span class="stringliteral">"'&gt;$label[$i]&lt;/label&gt;&lt;/td&gt;\n"</span>.
<a name="l00463"></a>00463                                                         <span class="stringliteral">"&lt;td&gt;&lt;SELECT name='sql__"</span>.$label_sql[$i].<span class="stringliteral">"' id='sql__"</span>.$label_sql[$i].<span class="stringliteral">"' class='fondo'&gt;\n"</span>.
<a name="l00464"></a>00464                                                         <span class="stringliteral">"&lt;OPTION SELECTED VALUE='0'&gt;$label[$i]&lt;/OPTION&gt;"</span>.
<a name="l00465"></a>00465                                                         <span class="stringliteral">"&lt;/SELECT&gt;&lt;/td&gt;&lt;/tr&gt;\n"</span>
<a name="l00466"></a>00466                                                         ;
<a name="l00467"></a>00467             } elseif($type==<span class="stringliteral">"VraiFaux"</span>) { <span class="comment">// booleen</span>
<a name="l00468"></a>00468                 <span class="keywordflow">if</span>($isNouveau) {
<a name="l00469"></a>00469                         $txt_ligne=<a class="code" href="inc-html_8php.html#ee820c089a642b6c9643b4a48fc46395" title="Cree un champ INPUT TEXT dans une ligne TR.">formInputTextTR</a>($label[$i],<span class="stringliteral">"sql__"</span>.$label_sql[$i],0,'readonly style=<span class="stringliteral">"font-size:12px;border:none;font-family:Arial,sans-serif;background-color:transparent;"</span>');
<a name="l00470"></a>00470                 } <span class="keywordflow">else</span> 
<a name="l00471"></a>00471                         $txt_ligne=<a class="code" href="inc-html_8php.html#9e275c42206610f6e5a60fb84f386886" title="Debut de balise SELECT dans un TR.">formSelectTR1</a>($label[$i],<span class="stringliteral">"sql__"</span>.$label_sql[$i],<span class="stringliteral">"class='fondo' $js"</span>).formSelectVraiFaux($row[$i]).formSelectTR2();
<a name="l00472"></a>00472                <span class="comment">//echo $label[$i]." sql__".$label_sql[$i]." : ".$row[$i]."&lt;br /&gt;";</span>
<a name="l00473"></a>00473             } elseif($type==<span class="stringliteral">"TIMESTAMP"</span>) { <span class="comment">// timestamp</span>
<a name="l00474"></a>00474                $txt_ligne=<span class="stringliteral">"&lt;input type='hidden' name='sql__"</span>.$label_sql[$i].<span class="stringliteral">"' value='"</span>.date('Y-m-d H:i:s').<span class="stringliteral">"'/&gt;&lt;td&gt;"</span>.$label[$i].<span class="stringliteral">"&lt;/td&gt;&lt;td&gt;"</span>.$row[$i].<span class="stringliteral">" &amp;rArr; "</span>.date('Y-m-d H:i:s').<span class="stringliteral">" &lt;/td&gt;\n"</span>;
<a name="l00475"></a>00475                <span class="comment">//echo $label[$i]." sql__".$label_sql[$i]." : ".$row[$i]."&lt;br /&gt;";</span>
<a name="l00476"></a>00476             } elseif($type==<span class="stringliteral">"YEAR"</span> &amp;&amp; $label_sql[$i]=='annee') {
<a name="l00477"></a>00477                 <span class="keywordflow">if</span>($isOperateur) $option=<span class="stringliteral">"&lt;OPTION SELECTED value='$annee'&gt;$annee&lt;/OPTION&gt;"</span>;
<a name="l00478"></a>00478                 <span class="keywordflow">else</span> $option=<a class="code" href="inc-html_8php.html#8e011c8d22f485dcee8b90fa3ff656c7" title="Cree un champ SELECT contenant les annees de 2002 a annee en cours + 1.">formSelectAnnee</a>(<a class="code" href="inc-pdf-attestations_8php.html#b372e2dd50f4a592a1226a01290a2f4f">$annee</a>);
<a name="l00479"></a>00479                 $txt_ligne=<span class="stringliteral">"&lt;tr&gt;&lt;td&gt;&lt;label for='sql__annee'&gt;$label[$i]&lt;/label&gt;&lt;/td&gt;\n"</span>.
<a name="l00480"></a>00480                         <span class="stringliteral">"&lt;td&gt;&lt;SELECT name='sql__annee' id='sql__annee' class='fondo'&gt;\n"</span>.
<a name="l00481"></a>00481                         $option.
<a name="l00482"></a>00482                         <span class="stringliteral">"&lt;/SELECT&gt;&lt;/td&gt;&lt;/tr&gt;\n"</span>;
<a name="l00483"></a>00483             } <span class="keywordflow">else</span> {<span class="comment">// Champ texte</span>
<a name="l00484"></a>00484                 $readonly='<span class="keyword">class</span>=<span class="stringliteral">"fondo"</span>';
<a name="l00485"></a>00485                 <span class="keywordflow">if</span>($isNouveau || $isOperateur) {
<a name="l00486"></a>00486                         <span class="keywordflow">if</span> ($label_sql[$i]=='id_saisie' &amp;&amp; $isNouveau) {
<a name="l00487"></a>00487                                 $row[$i]='&amp;Agrave; venir';
<a name="l00488"></a>00488                                 $isTexte=<span class="keyword">true</span>;
<a name="l00489"></a>00489                                                 } <span class="keywordflow">else</span> $isTexte=<span class="keyword">false</span>;
<a name="l00490"></a>00490                         <span class="keywordflow">if</span> (in_array($label_sql[$i],array('id_saisie<span class="charliteral">','</span>id_table<span class="charliteral">','</span>id_table_old')))
<a name="l00491"></a>00491                                 $readonly='readonly style=<span class="stringliteral">"font-size:14px;color:#336699;font-weight:bold;border:none;font-family:Arial,sans-serif;background-color:transparent;"</span>';
<a name="l00492"></a>00492                 }
<a name="l00493"></a>00493                 
<a name="l00494"></a>00494                 $js=<span class="stringliteral">"onFocus=\"this.style.backgroundColor='$couleurFocus';\" "</span>;
<a name="l00495"></a>00495                 <span class="keywordflow">switch</span> ($label_sql[$i])
<a name="l00496"></a>00496                 {
<a name="l00497"></a>00497                         <span class="keywordflow">case</span> 'nom': 
<a name="l00498"></a>00498                                 $js.=<span class="stringliteral">"onKeyUp=\"javascript:this.value=this.value.toUpperCase();this.style.backgroundColor='$couleurOk';\""</span>; 
<a name="l00499"></a>00499                                 <span class="keywordflow">break</span>;
<a name="l00500"></a>00500                         <span class="keywordflow">case</span> 'ne_le':
<a name="l00501"></a>00501                                 $tmp=array();
<a name="l00502"></a>00502                                 $tmp=explode(<span class="charliteral">'-'</span>,$row[$i]);
<a name="l00503"></a>00503                                 <span class="comment">//echo $row[$i];print_r($tmp);</span>
<a name="l00504"></a>00504                                 <span class="keywordflow">if</span>(count($tmp)&gt;1)
<a name="l00505"></a>00505                                         $row[$i]=$tmp[2].<span class="charliteral">'/'</span>.$tmp[1].<span class="charliteral">'/'</span>.$tmp[0];
<a name="l00506"></a>00506                                 $js.=<span class="stringliteral">"onBlur=\"if(this.value!='') {if(isDate(this.value)) {isBadDate=false;} else {isBadDate=true;this.style.backgroundColor='$couleurKo';}}\" "</span>;
<a name="l00507"></a>00507                         <span class="keywordflow">case</span> 'ne_en':
<a name="l00508"></a>00508                         <span class="keywordflow">case</span> 'ne_vers':
<a name="l00509"></a>00509                                 $inter=array_diff(array('ne_en<span class="charliteral">','</span>ne_le<span class="charliteral">','</span>ne_vers'),array($label_sql[$i]));
<a name="l00510"></a>00510                                 $js.=<span class="stringliteral">"onKeyUp=\"if(this.value!='') {flag=true;couleur='$couleurDisable';} else {flag=false;couleur='$couleurEnable';}"</span>;
<a name="l00511"></a>00511                                 <span class="keywordflow">foreach</span>($inter as $col) {
<a name="l00512"></a>00512                                         $js.=<span class="stringliteral">"document.forms['form_$table'].sql__$col.disabled=flag;"</span>.
<a name="l00513"></a>00513                                                 <span class="stringliteral">"document.forms['form_$table'].sql__$col.style.backgroundColor=couleur;"</span>;
<a name="l00514"></a>00514                                                         }
<a name="l00515"></a>00515                                                         $js.=<span class="stringliteral">"\" onChange=\"if(!isBadDate) this.style.backgroundColor='$couleurOk';\""</span>;
<a name="l00516"></a>00516                                                         <span class="comment">//print_r($inter);</span>
<a name="l00517"></a>00517                                 <span class="keywordflow">break</span>;
<a name="l00518"></a>00518                         <span class="keywordflow">default</span>: 
<a name="l00519"></a>00519                                 $js.='';
<a name="l00520"></a>00520                 }
<a name="l00521"></a>00521                                 $js.=<span class="stringliteral">" onBlur=\"if(this.value=='') {this.style.backgroundColor='$couleurKo';} else {this.style.backgroundColor='$couleurOk';}\""</span>;
<a name="l00522"></a>00522                 
<a name="l00523"></a>00523                $maxlength=mysql_field_len(<a class="code" href="inc-ezpdf_8php.html#112ef069ddc0454086e3d1e6d8d55d07">$result</a>,$i);
<a name="l00524"></a>00524                <span class="comment">//echo $label[$i]." : $maxlength&lt;br/&gt;";</span>
<a name="l00525"></a>00525                <span class="keywordflow">if</span>($isTexte) $txt_ligne=<a class="code" href="inc-html_8php.html#ee820c089a642b6c9643b4a48fc46395" title="Cree un champ INPUT TEXT dans une ligne TR.">formInputTextTR</a>($label[$i],<span class="stringliteral">"txt_"</span>.$label_sql[$i],$row[$i],<span class="stringliteral">"$readonly $js maxlength='$maxlength'"</span>);
<a name="l00526"></a>00526                <span class="keywordflow">else</span> $txt_ligne=<a class="code" href="inc-html_8php.html#ee820c089a642b6c9643b4a48fc46395" title="Cree un champ INPUT TEXT dans une ligne TR.">formInputTextTR</a>($label[$i],<span class="stringliteral">"sql__"</span>.$label_sql[$i],$row[$i],<span class="stringliteral">"$readonly $js maxlength='$maxlength'"</span>);
<a name="l00527"></a>00527                <span class="comment">//echo "$label[$i] : $type&lt;br/&gt;\n";</span>
<a name="l00528"></a>00528             }
<a name="l00529"></a>00529             <span class="keywordflow">if</span>($flag==1) $class='row_odd';<span class="keywordflow">else</span> $class='row_even';
<a name="l00530"></a>00530             $flag=1-$flag;
<a name="l00531"></a>00531             <span class="comment">//FIXME Beurk (gestion des TR)</span>
<a name="l00532"></a>00532             <span class="keywordflow">if</span>(!in_array($label_sql[$i],array('login<span class="charliteral">','</span>departement'))) 
<a name="l00533"></a>00533                 $texte_table.=str_replace('&lt;tr&gt;',<span class="stringliteral">"&lt;tr class='$class'&gt;"</span>,$txt_ligne).<span class="stringliteral">"\n"</span>;
<a name="l00534"></a>00534             elseif($label_sql[$i]=='departement') {
<a name="l00535"></a>00535                 <span class="keywordflow">if</span>(!isset($id_departement)) $id_departement=$val;
<a name="l00536"></a>00536                 $js=$isNouveau?<span class="stringliteral">"onChange=\"url2='"</span>.generer_url_ecrire('odb_saisie').<span class="stringliteral">"&amp;sql__departement='+this.value+'&amp;annee=$annee&amp;step2=odb_candidats&amp;ajout_candidat=auto#form_$table';window.location=url2;\""</span>
<a name="l00537"></a>00537                         :<span class="stringliteral">"onChange=\"document.form_$table.sql__etablissement.value=0;document.form_$table.sql__ville.value=0;\""</span>;
<a name="l00538"></a>00538                                         $selectDepartement=<a class="code" href="inc-referentiel_8php.html#caa8fb22e017e5edd73e572b1c091189">formSelectRefInTR</a>('D&amp;eacute;partement<span class="charliteral">','</span>sql__departement<span class="charliteral">','</span>departement',$id_departement,<span class="stringliteral">"class='forml' $js"</span>,$id_departement);
<a name="l00539"></a>00539                                         <a class="code" href="inc-pdf-attestations_8php.html#43e5b5a819fedbd12b8cf5421ba6985e">$titre</a>=$isNouveau?<span class="stringliteral">"\t\t&lt;TH&gt;Ajout d'un candidat en $annee&lt;/TH&gt;&lt;TH align='right'&gt;&lt;div align='right'&gt;"</span>.$tab_auteur['nom'].<span class="stringliteral">"&lt;/div&gt;&lt;/TH&gt;\n"</span>
<a name="l00540"></a>00540                                                                                   :<span class="stringliteral">"\t\t&lt;TH&gt;Mise &amp;agrave; jour de $table pour $identifiant=$id en $annee&lt;/TH&gt;&lt;TH align='right'&gt;&lt;div align='right'&gt;$login&lt;/div&gt;&lt;/TH&gt;\n"</span>;
<a name="l00541"></a>00541                                         $jsForm=<a class="code" href="inc-html_8php.html#26ce7f961b7c017f444305029440e0d3" title="Ajoute du code javascript.">putJavascript</a>('isDate');
<a name="l00542"></a>00542                                         $jsForm.=<a class="code" href="inc-html_8php.html#26ce7f961b7c017f444305029440e0d3" title="Ajoute du code javascript.">putJavascript</a>('changerStyle');
<a name="l00543"></a>00543                                         $jsCheckForm = <span class="stringliteral">"function checkForm(formulaire,bAlerter) {\n"</span>
<a name="l00544"></a>00544                                                         . <span class="stringliteral">"\tcheck=true;alerte='Verification formulaire de saisie\\n________________________\\n';\n\n"</span>
<a name="l00545"></a>00545                                                         . <span class="stringliteral">"\tif(formulaire.sql__departement.value==0) {\n"</span>
<a name="l00546"></a>00546                                                         . <span class="stringliteral">"\t\tcheck=false;alerte+='\\n- Veuillez choisir un departement';\n"</span>
<a name="l00547"></a>00547                                                         ;
<a name="l00548"></a>00548                                 <span class="keywordflow">foreach</span>(array_merge($tColsSaisieObligatoire,$tColsSaisieFacultative) as $col) 
<a name="l00549"></a>00549                                         $jsCheckForm.=<span class="stringliteral">"\t\tformulaire.sql__$col.disabled=true;formulaire.sql__$col.style.backgroundColor='$couleurDisable';\n"</span>;
<a name="l00550"></a>00550                                         $jsCheckForm.=<span class="stringliteral">"\t} else {\n"</span>;
<a name="l00551"></a>00551                                         <span class="keywordflow">foreach</span>($tColsSaisieObligatoire as $col)
<a name="l00552"></a>00552                                                 $jsCheckForm.=<span class="stringliteral">"\t\tif(formulaire.sql__$col.value=='' || formulaire.sql__$col.value=='0')\n"</span>
<a name="l00553"></a>00553                                                                 . <span class="stringliteral">"\t\t\t{alerte+='\\n- Veuillez saisir ["</span>.ucwords($col).<span class="stringliteral">"]';check=false;formulaire.sql__$col.style.backgroundColor='$couleurKo';formulaire.sql__$col.focus();}\n"</span>
<a name="l00554"></a>00554                                                                 ;
<a name="l00555"></a>00555                                         <span class="keywordflow">foreach</span>($tab_referentiel['serie'] as $idTmp=&gt;$dptTmp)
<a name="l00556"></a>00556                                                 <span class="keywordflow">if</span>(in_array($dptTmp,array('A1<span class="charliteral">','</span>A2<span class="charliteral">','</span>B'))) $tSeriesLitteraires[$dptTmp]=$idTmp;
<a name="l00557"></a>00557                                         $jsCheckForm.=<span class="stringliteral">"\t\tisLitteraire=false;if(true"</span>;<span class="keywordflow">foreach</span>($tSeriesLitteraires as $idTmp)
<a name="l00558"></a>00558                                                 $jsCheckForm.=<span class="stringliteral">"&amp;&amp;formulaire.sql__serie.value!='$idTmp'"</span>;
<a name="l00559"></a>00559                                         $jsCheckForm.=<span class="stringliteral">")\n\t\t\t{isLitteraire=false;couleurFond='$couleurDisable';}\n\t\telse {isLitteraire=true;couleurFond='$couleurOk';}\n"</span>;
<a name="l00560"></a>00560                                         $jsCheckForm.=<span class="stringliteral">"\t\tformulaire.sql__lv1.disabled=!isLitteraire;formulaire.sql__lv2.disabled=!isLitteraire;formulaire.sql__lv1.style.backgroundColor=couleurFond;formulaire.sql__lv2.style.backgroundColor=couleurFond;\n"</span>;
<a name="l00561"></a>00561                                         $jsCheckForm.=<span class="stringliteral">"\t\tcptDdn=0;\n"</span>
<a name="l00562"></a>00562                                                         . <span class="stringliteral">"\t\tif(formulaire.sql__ne_le.value=='00/00/0000' || formulaire.sql__ne_le.value=='0000-00-00' || formulaire.sql__ne_le.value=='') {formulaire.sql__ne_le.value='';isNeLeSaisi=false;} else {cptDdn++;isNeLeSaisi=true;changerStyle(formulaire.sql__ne_en,'$couleurDisable','disable');changerStyle(formulaire.sql__ne_vers,'$couleurDisable','disable');}\n"</span>
<a name="l00563"></a>00563                                                         . <span class="stringliteral">"\t\tif(isNeLeSaisi) {if(!isDate(formulaire.sql__ne_le.value)) {alerte+='\\n- Veuillez taper une date de naissance valide au format JJ/MM/AAAA';check=false;formulaire.sql__ne_le.style.backgroundColor='$couleurKo';formulaire.sql__ne_le.focus();} }\n"</span>
<a name="l00564"></a>00564                                                         . <span class="stringliteral">"\t\tif(formulaire.sql__ne_en.value=='0000' || formulaire.sql__ne_en.value=='') {formulaire.sql__ne_en.value='';} else {cptDdn++;changerStyle(formulaire.sql__ne_le,'$couleurDisable','disable');changerStyle(formulaire.sql__ne_vers,'$couleurDisable','disable');}\n"</span>
<a name="l00565"></a>00565                                                         . <span class="stringliteral">"\t\tif(formulaire.sql__ne_vers.value=='0000' || formulaire.sql__ne_vers.value=='') {formulaire.sql__ne_vers.value='';} else {cptDdn++;changerStyle(formulaire.sql__ne_en,'$couleurDisable','disable');changerStyle(formulaire.sql__ne_le,'$couleurDisable','disable');}\n"</span>
<a name="l00566"></a>00566                                                         . <span class="stringliteral">"\t\tif(cptDdn!=1) {alerte+='\\n- Veuillez corriger la date de naissance';check=false;formulaire.sql__ne_le.style.backgroundColor='$couleurKo';formulaire.sql__ne_en.style.backgroundColor='$couleurKo';formulaire.sql__ne_vers.style.backgroundColor='$couleurKo';formulaire.sql__ne_le.readonly=false;formulaire.sql__ne_le.disabled=false;formulaire.sql__ne_le.focus();}\n"</span>
<a name="l00567"></a>00567                                                         . <span class="stringliteral">"\t\tif(((formulaire.sql__lv1.value==formulaire.sql__lv2.value) || formulaire.sql__lv1.value=='0' || formulaire.sql__lv2.value=='0') &amp;&amp; isLitteraire) {alerte+='\\n- Langues vivantes invalides';check=false;formulaire.sql__lv2.style.backgroundColor='$couleurKo';formulaire.sql__lv2.focus();}\n"</span>
<a name="l00568"></a>00568                                                         . <span class="stringliteral">"\t\tif((formulaire.sql__ef1.value==formulaire.sql__ef2.value || formulaire.sql__ef1.value=='0') &amp;&amp; formulaire.sql__ef2.value!='0') {alerte+='\\n- Epreuves facultatives invalides';check=false;formulaire.sql__ef2.style.backgroundColor='$couleurKo';formulaire.sql__ef2.focus();}\n"</span>
<a name="l00569"></a>00569                                                         . <span class="stringliteral">"\t}\n\tif(bAlerter &amp;&amp; !check) alert(alerte);else formulaire.sql__nom.focus();\n\treturn(check);\n"</span>
<a name="l00570"></a>00570                                                         . <span class="stringliteral">"}\n"</span>
<a name="l00571"></a>00571                                                         ;
<a name="l00572"></a>00572                                         $jsForm.=<a class="code" href="inc-html_8php.html#26ce7f961b7c017f444305029440e0d3" title="Ajoute du code javascript.">putJavascript</a>($jsCheckForm);
<a name="l00573"></a>00573                                         $texte_table = <span class="stringliteral">"$jsForm\n&lt;A NAME='form_$table'&gt;&lt;/A&gt;&lt;form id='form_$table' action='"</span>.generer_url_ecrire('odb_saisie').<span class="stringliteral">"' method='post' class='forml spip_xx-small' onSubmit='return checkForm(this,true);'&gt;\n"</span>
<a name="l00574"></a>00574                                                 . <span class="stringliteral">"&lt;TABLE class='spip' width='700'&gt;\n"</span>
<a name="l00575"></a>00575                                                 . <span class="stringliteral">"\t&lt;TR class='row_first'&gt;"</span>
<a name="l00576"></a>00576                                                 . $titre
<a name="l00577"></a>00577                                                 . <span class="stringliteral">"\t&lt;/TR&gt;\n"</span>
<a name="l00578"></a>00578                                                 . $selectDepartement
<a name="l00579"></a>00579                                                 . $texte_table
<a name="l00580"></a>00580                                                 ;               
<a name="l00581"></a>00581                                 }
<a name="l00582"></a>00582          }
<a name="l00583"></a>00583       }
<a name="l00584"></a>00584    } <span class="keywordflow">else</span>
<a name="l00585"></a>00585       die(<span class="stringliteral">"L'identifiant $identifiant=$id n'existe pas pour l'ann&amp;eacute;e $annee&lt;br/&gt;Veuillez &lt;A HREF='"</span>.generer_url_ecrire('odb_saisie').<span class="stringliteral">"&amp;annee=$annee'&gt;recommencer&lt;/A&gt;\n"</span>);
<a name="l00586"></a>00586 
<a name="l00587"></a>00587         <span class="keywordflow">if</span>($isEncadrant || $isAdmin) $boutonSupprimer=<span class="stringliteral">"\t&lt;input type='button' name='supprimer' value='[#]\nSupprimer' style='background-color:#000;' class='fondo' onClick=\"if(confirm('Souhaitez-vous vraiment supprimer le dossier\\ndu candidat $id ?')) window.location='"</span>.generer_url_ecrire('odb_saisie').<span class="stringliteral">"&amp;annee=$annee&amp;supprimer=$identifiant&amp;id=$id';\"/&gt;\n"</span>;
<a name="l00588"></a>00588         <span class="keywordflow">else</span> $boutonSupprimer='';
<a name="l00589"></a>00589         <span class="keywordflow">if</span>($isNouveau) {
<a name="l00590"></a>00590                 $identifiant='id_saisie';
<a name="l00591"></a>00591                 $id=$max;
<a name="l00592"></a>00592                 $texte_table.=<span class="stringliteral">"&lt;tr&gt;&lt;td colspan=2&gt;&lt;center&gt;\n"</span>.
<a name="l00593"></a>00593                         <span class="stringliteral">"\t&lt;input type='submit' name='ajouter_nouveau' value='[+ +]\nAjouter et nouveau' class='fondo'/&gt;\n"</span>.
<a name="l00594"></a>00594                         <span class="stringliteral">"\t&lt;input type='submit' name='ajouter_quitter' value='[+ x]\nAjouter et quitter' class='fondo'/&gt;\n"</span>.
<a name="l00595"></a>00595                         <span class="stringliteral">"\t&lt;input type='button' name='annuler' value='[x]\nAbandonner' style='background-color:$couleurKo;' class='fondo' onClick=\"window.location='"</span>.generer_url_ecrire('odb_saisie').<span class="stringliteral">"';\"/&gt;\n"</span>.
<a name="l00596"></a>00596                         <span class="stringliteral">"\t&lt;input type='hidden' name='isNouveau' value='true'/&gt;\n"</span>.
<a name="l00597"></a>00597                         <span class="stringliteral">"&lt;/center&gt;&lt;/td&gt;&lt;/tr&gt;\n"</span>;
<a name="l00598"></a>00598         } <span class="keywordflow">else</span> $texte_table.= <span class="stringliteral">"&lt;TR&gt;&lt;TD COLSPAN=2&gt;&lt;CENTER&gt;&lt;INPUT TYPE='submit' VALUE='[ok]\nMettre &amp;agrave; jour' class='fondo' /&gt;\n"</span>
<a name="l00599"></a>00599                 .<span class="stringliteral">"\t&lt;input type='button' name='annuler' value='[x]\nAbandonner' style='background-color:$couleurKo;' class='fondo' onClick=\"window.location='"</span>.generer_url_ecrire('odb_saisie').<span class="stringliteral">"';\"/&gt;"</span>
<a name="l00600"></a>00600                 .<span class="stringliteral">"$boutonSupprimer&lt;/CENTER&gt;&lt;/TD&gt;&lt;/TR&gt;\n"</span>;
<a name="l00601"></a>00601         <span class="keywordflow">if</span>($isOperateur) $texte_table.=<span class="stringliteral">"\t&lt;input type='hidden' name='isOperateur' value='true'/&gt;\n"</span>;
<a name="l00602"></a>00602    $texte_table .= <span class="stringliteral">"\t&lt;input type='hidden' name='step3' value='$table' /&gt;\n"</span>;
<a name="l00603"></a>00603    $texte_table .= <span class="stringliteral">"\t&lt;input type='hidden' name='annee' value='$annee' /&gt;\n"</span>;
<a name="l00604"></a>00604    $texte_table .= <span class="stringliteral">"\t&lt;input type='hidden' name='identifiant' value='$identifiant' /&gt;\n"</span>;
<a name="l00605"></a>00605    $texte_table .= <span class="stringliteral">"\t&lt;input type='hidden' name='id' value='$id' /&gt;\n"</span>;
<a name="l00606"></a>00606    $texte_table.= <span class="stringliteral">"&lt;/TABLE&gt;\n"</span>;
<a name="l00607"></a>00607    $texte_table.= <span class="stringliteral">"&lt;/FORM&gt;\n"</span>;
<a name="l00608"></a>00608    echo $texte_table;
<a name="l00609"></a>00609    echo <a class="code" href="inc-html_8php.html#26ce7f961b7c017f444305029440e0d3" title="Ajoute du code javascript.">putJavascript</a>(<span class="stringliteral">"checkForm(document.forms['form_$table'],false);\n"</span>);
<a name="l00610"></a>00610 
<a name="l00611"></a>00611    fin_boite_info();
<a name="l00612"></a>00612 
<a name="l00613"></a>00613         <span class="keywordflow">if</span>(!$isNouveau) {
<a name="l00614"></a>00614                 <span class="keywordflow">if</span>($identifiant=='id_table') $id=<span class="stringliteral">"'$id'"</span>;
<a name="l00615"></a>00615                 <a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>=<span class="stringliteral">"SELECT * from odb_histo_candidats where $identifiant=$id AND annee=$annee order by maj desc"</span>;
<a name="l00616"></a>00616                 <a class="code" href="inc-ezpdf_8php.html#112ef069ddc0454086e3d1e6d8d55d07">$result</a>=<a class="code" href="inc-odb_8php.html#cc73cdf19f49ae7162c99fd07a614e88" title="Execute une requete sql.">odb_query</a>(<a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>,__FILE__,__LINE__);
<a name="l00617"></a>00617                 $nb_fields=mysql_num_fields(<a class="code" href="inc-ezpdf_8php.html#112ef069ddc0454086e3d1e6d8d55d07">$result</a>);
<a name="l00618"></a>00618                 $nb_rows=mysql_num_rows(<a class="code" href="inc-ezpdf_8php.html#112ef069ddc0454086e3d1e6d8d55d07">$result</a>);
<a name="l00619"></a>00619                 <span class="keywordflow">if</span>($nb_rows&gt;0) {
<a name="l00620"></a>00620                    echo <span class="stringliteral">"&lt;h3&gt;Historique&lt;/h3&gt;"</span>;
<a name="l00621"></a>00621                    <span class="keywordflow">for</span> (<a class="code" href="odb__commun_2img__pack_2vignettes_2index_8php.html#83018d9153d17d91fbcf3bc10158d34f">$i</a>=0;<a class="code" href="odb__commun_2img__pack_2vignettes_2index_8php.html#83018d9153d17d91fbcf3bc10158d34f">$i</a>&lt;$nb_fields;<a class="code" href="odb__commun_2img__pack_2vignettes_2index_8php.html#83018d9153d17d91fbcf3bc10158d34f">$i</a>++) {
<a name="l00622"></a>00622                       $label_bdd=mysql_field_name(<a class="code" href="inc-ezpdf_8php.html#112ef069ddc0454086e3d1e6d8d55d07">$result</a>, <a class="code" href="odb__commun_2img__pack_2vignettes_2index_8php.html#83018d9153d17d91fbcf3bc10158d34f">$i</a>);
<a name="l00623"></a>00623                       $label[<a class="code" href="odb__commun_2img__pack_2vignettes_2index_8php.html#83018d9153d17d91fbcf3bc10158d34f">$i</a>]=str_replace(<span class="charliteral">'_'</span>,<span class="charliteral">' '</span>,$odb_mapping[$table][$label_bdd]);
<a name="l00624"></a>00624                       <span class="keywordflow">if</span>($label[<a class="code" href="odb__commun_2img__pack_2vignettes_2index_8php.html#83018d9153d17d91fbcf3bc10158d34f">$i</a>]=='') $label[<a class="code" href="odb__commun_2img__pack_2vignettes_2index_8php.html#83018d9153d17d91fbcf3bc10158d34f">$i</a>]=ucfirst(str_replace(<span class="charliteral">'_'</span>,<span class="charliteral">' '</span>,$label_bdd));
<a name="l00625"></a>00625                       $label_sql[<a class="code" href="odb__commun_2img__pack_2vignettes_2index_8php.html#83018d9153d17d91fbcf3bc10158d34f">$i</a>]=$label_bdd;
<a name="l00626"></a>00626                    }
<a name="l00627"></a>00627                    echo <span class="stringliteral">"&lt;table class='spip'&gt;\n&lt;tr&gt;\n"</span>;
<a name="l00628"></a>00628                    <span class="keywordflow">foreach</span>($label as <a class="code" href="inc-pdf-attestations_8php.html#43e5b5a819fedbd12b8cf5421ba6985e">$titre</a>) echo <span class="stringliteral">"\t&lt;th&gt;&lt;small&gt;$titre&lt;/small&gt;&lt;/th&gt;\n"</span>;
<a name="l00629"></a>00629                    <span class="keywordflow">while</span>($row=mysql_fetch_array(<a class="code" href="inc-ezpdf_8php.html#112ef069ddc0454086e3d1e6d8d55d07">$result</a>)) {
<a name="l00630"></a>00630                       $id_departement=$row['departement'];
<a name="l00631"></a>00631                       echo <span class="stringliteral">"&lt;tr&gt;\n"</span>;
<a name="l00632"></a>00632                       <span class="keywordflow">for</span>(<a class="code" href="odb__commun_2img__pack_2vignettes_2index_8php.html#83018d9153d17d91fbcf3bc10158d34f">$i</a>=0;<a class="code" href="odb__commun_2img__pack_2vignettes_2index_8php.html#83018d9153d17d91fbcf3bc10158d34f">$i</a>&lt;$nb_fields;<a class="code" href="odb__commun_2img__pack_2vignettes_2index_8php.html#83018d9153d17d91fbcf3bc10158d34f">$i</a>++) {
<a name="l00633"></a>00633                          $valeur=stripslashes($row[<a class="code" href="odb__commun_2img__pack_2vignettes_2index_8php.html#83018d9153d17d91fbcf3bc10158d34f">$i</a>]);
<a name="l00634"></a>00634                          <span class="keywordflow">if</span>($valeur=='') $valeur=<span class="stringliteral">"&amp;nbsp;"</span>;
<a name="l00635"></a>00635                          <span class="keywordflow">if</span>($valeur!=$tReference[$i]) $isChanged=<span class="keyword">true</span>; <span class="keywordflow">else</span> $isChanged=<span class="keyword">false</span>;
<a name="l00636"></a>00636                          <span class="comment">//echo "$valeur == ".$tReference[$i]." ? $isChanged&lt;br/&gt;";</span>
<a name="l00637"></a>00637                          $champ=$odb_referentiel[$table][$odb_mapping[$table][$label_sql[$i]]];
<a name="l00638"></a>00638                          <span class="keywordflow">if</span>(substr_count($champ,<span class="stringliteral">"ref"</span>)&gt;0) {
<a name="l00639"></a>00639                             $ref=strtolower(substr($champ,3));
<a name="l00640"></a>00640                             <span class="comment">//echo "$ref = $valeur";</span>
<a name="l00641"></a>00641                             $valeur=$tab_referentiel[$ref][$valeur];
<a name="l00642"></a>00642                          } elseif($champ=='Et.') $valeur=$tab_referentiel['etablissement'][$id_departement][$valeur];
<a name="l00643"></a>00643                          elseif($champ=='VraiFaux') $valeur=$valeur==0?'Faux<span class="charliteral">':'</span>Vrai';
<a name="l00644"></a>00644                          <span class="keywordflow">if</span>($isChanged) $style='color:#F00;font-weight:bold;background-color:#FF0;'; <span class="keywordflow">else</span> $style='color:#000;';
<a name="l00645"></a>00645                          echo <span class="stringliteral">"\t&lt;td style='$style'&gt;&lt;small&gt;$valeur&lt;/small&gt;&lt;/td&gt;\n"</span>;
<a name="l00646"></a>00646                       }
<a name="l00647"></a>00647                       echo <span class="stringliteral">"&lt;/tr&gt;\n"</span>;
<a name="l00648"></a>00648                    }
<a name="l00649"></a>00649                    echo <span class="stringliteral">"&lt;/table&gt;"</span>;
<a name="l00650"></a>00650                 }
<a name="l00651"></a>00651         }
<a name="l00652"></a>00652 } <span class="keywordflow">else</span> {
<a name="l00654"></a>00654 <a class="code" href="inc-pdf-attestations_8php.html#b372e2dd50f4a592a1226a01290a2f4f">$annee</a>=isset($_REQUEST['annee'])?$_REQUEST['annee']:date(<span class="stringliteral">"Y"</span>);
<a name="l00655"></a>00655    debut_gauche();
<a name="l00656"></a>00656       echo <span class="stringliteral">"&lt;IMG SRC='"</span>._DIR_PLUGIN_ODB_SAISIE.<span class="stringliteral">"/img_pack/logo_odb.png' alt='Office du bac' ALIGN='absmiddle'&gt;&lt;br&gt;&lt;br&gt;\n"</span>;
<a name="l00657"></a>00657         debut_raccourcis();
<a name="l00658"></a>00658                         icone_horizontale (_L('Saisie d\'un nouveau candidat'), 
<a name="l00659"></a>00659                                 generer_url_ecrire(<span class="stringliteral">"odb_saisie"</span>).<span class="stringliteral">"&amp;annee=$annee&amp;id=&amp;step2=odb_candidats&amp;ajout_candidat=true#form_odb_candidats"</span>, 
<a name="l00660"></a>00660                                 <span class="stringliteral">"../"</span>.<a class="code" href="inc-odb__ref_8php.html#76319c6fdabb160dcfd10671480a2ed7">_DIR_PLUGIN_ODB_REF</a>.<span class="stringliteral">"/img_pack/siou_carre.png"</span>);
<a name="l00661"></a>00661                         icone_horizontale (_L('Introspection'), 
<a name="l00662"></a>00662                                 generer_url_ecrire(<span class="stringliteral">"odb_saisie"</span>).<span class="stringliteral">"&amp;annee=$annee&amp;step2=odb_candidats&amp;introspecter=true"</span>, 
<a name="l00663"></a>00663                                 <span class="stringliteral">"../"</span>.<a class="code" href="inc-odb__ref_8php.html#76319c6fdabb160dcfd10671480a2ed7">_DIR_PLUGIN_ODB_REF</a>.<span class="stringliteral">"/img_pack/siou_carre.png"</span>);
<a name="l00664"></a>00664                         <span class="keywordflow">if</span>($isEncadrant || $isAdmin) {
<a name="l00665"></a>00665                                 icone_horizontale (_L('Historique des suppressions'), 
<a name="l00666"></a>00666                                         generer_url_ecrire(<span class="stringliteral">"odb_saisie"</span>).<span class="stringliteral">"&amp;annee=$annee&amp;historique_suppressions=true"</span>, 
<a name="l00667"></a>00667                                         <span class="stringliteral">"../"</span>.<a class="code" href="inc-odb__ref_8php.html#76319c6fdabb160dcfd10671480a2ed7">_DIR_PLUGIN_ODB_REF</a>.<span class="stringliteral">"/img_pack/siou_carre.png"</span>);
<a name="l00668"></a>00668                         }
<a name="l00669"></a>00669                 fin_raccourcis();
<a name="l00670"></a>00670    creer_colonne_droite();
<a name="l00671"></a>00671    debut_droite();
<a name="l00672"></a>00672         <span class="keywordflow">if</span>(strlen($historique_suppressions)&gt;0) {
<a name="l00673"></a>00673                         debut_boite_info();
<a name="l00674"></a>00674                                 echo $historique_suppressions;
<a name="l00675"></a>00675                         fin_boite_info();
<a name="l00676"></a>00676                 }
<a name="l00677"></a>00677       debut_cadre_relief(<span class="stringliteral">""</span>, <span class="keyword">false</span>, <span class="stringliteral">""</span>, <a class="code" href="inc-pdf-attestations_8php.html#43e5b5a819fedbd12b8cf5421ba6985e">$titre</a> = _T(<span class="stringliteral">"Acc&amp;egrave;s direct &amp;agrave; un candidat $annee"</span>));
<a name="l00678"></a>00678       echo <a class="code" href="odb__saisie_8php.html#b323857b58a69e0f0ff29ffd9d24d192" title="affiche formulaire de saisie">odb_form_saisie</a>(<span class="stringliteral">"odb_candidats"</span>,<span class="stringliteral">"la table des candidats"</span>,<a class="code" href="inc-pdf-attestations_8php.html#b372e2dd50f4a592a1226a01290a2f4f">$annee</a>);
<a name="l00679"></a>00679       fin_cadre_relief();
<a name="l00680"></a>00680 
<a name="l00681"></a>00681       <span class="comment">//Acces par clic</span>
<a name="l00682"></a>00682       $orderBy=isset($_GET['orderBy'])?$_GET['orderBy']:'nom';
<a name="l00683"></a>00683       <a class="code" href="inc-pdf-attestations_8php.html#e05862a0294251c88629b141b5ce329a">$limit</a>=isset($_GET['limit'])?$_GET['limit']:0;
<a name="l00684"></a>00684       $filtreSerie=trim($_GET['filtreSerie'])!=''?$_GET['filtreSerie']:<span class="keyword">false</span>;
<a name="l00685"></a>00685       $filtreDepartement=trim($_GET['filtreDepartement'])!=''?$_GET['filtreDepartement']:<span class="keyword">false</span>;
<a name="l00686"></a>00686       $filtreEtablissement=trim($_GET['filtreEtablissement'])!=''?$_GET['filtreEtablissement']:<span class="keyword">false</span>;
<a name="l00687"></a>00687 
<a name="l00688"></a>00688       <a class="code" href="inc-pdf-attestations_8php.html#d4a3e16ae571f7498eedad9de246faf7">$where</a>=<span class="stringliteral">"WHERE annee=$annee"</span>;
<a name="l00689"></a>00689       <span class="keywordflow">if</span>($isChefEtablissement) <a class="code" href="inc-pdf-attestations_8php.html#d4a3e16ae571f7498eedad9de246faf7">$where</a> .= ' AND etablissement='.$tab_auteur['id_etablissement'];
<a name="l00690"></a>00690       elseif($isOperateur &amp;&amp; !$isEncadrant) <a class="code" href="inc-pdf-attestations_8php.html#d4a3e16ae571f7498eedad9de246faf7">$where</a> .= ' AND login=<span class="stringliteral">"'.$tab_auteur['login'].'"</span>';
<a name="l00691"></a>00691       <span class="keywordflow">if</span>($filtreSerie) {
<a name="l00692"></a>00692          <a class="code" href="inc-pdf-attestations_8php.html#d4a3e16ae571f7498eedad9de246faf7">$where</a>.=<span class="stringliteral">" AND serie=$filtreSerie"</span>;
<a name="l00693"></a>00693          $andEtablissement.=<span class="stringliteral">" AND serie=$filtreSerie"</span>;
<a name="l00694"></a>00694          $andDepartement.=<span class="stringliteral">" AND serie=$filtreSerie"</span>;
<a name="l00695"></a>00695       }
<a name="l00696"></a>00696       <span class="keywordflow">if</span>($filtreDepartement) {
<a name="l00697"></a>00697          <a class="code" href="inc-pdf-attestations_8php.html#d4a3e16ae571f7498eedad9de246faf7">$where</a>.=<span class="stringliteral">" AND departement=$filtreDepartement"</span>;
<a name="l00698"></a>00698          $andSerie.=<span class="stringliteral">" AND departement=$filtreDepartement"</span>;
<a name="l00699"></a>00699          $andEtablissement.=<span class="stringliteral">" AND departement=$filtreDepartement"</span>;
<a name="l00700"></a>00700       }
<a name="l00701"></a>00701       <span class="keywordflow">if</span>($filtreEtablissement) {
<a name="l00702"></a>00702          <a class="code" href="inc-pdf-attestations_8php.html#d4a3e16ae571f7498eedad9de246faf7">$where</a>.=<span class="stringliteral">" AND etablissement=$filtreEtablissement"</span>;
<a name="l00703"></a>00703          $andSerie.=<span class="stringliteral">" AND etablissement=$filtreEtablissement"</span>;
<a name="l00704"></a>00704          $andDepartement.=<span class="stringliteral">" AND etablissement=$filtreEtablissement"</span>;
<a name="l00705"></a>00705       }
<a name="l00706"></a>00706 
<a name="l00707"></a>00707       <a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>=<span class="stringliteral">"SELECT id_saisie, id_table, sexe, prefixe, nom, prenoms, etablissement, serie, ville, departement, login, maj\n FROM odb_candidats\n $where"</span>;
<a name="l00708"></a>00708       <a class="code" href="inc-ezpdf_8php.html#112ef069ddc0454086e3d1e6d8d55d07">$result</a>=<a class="code" href="inc-odb_8php.html#cc73cdf19f49ae7162c99fd07a614e88" title="Execute une requete sql.">odb_query</a>(<a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>,__FILE__,__LINE__);
<a name="l00709"></a>00709       $nb_lignes_tot=mysql_num_rows(<a class="code" href="inc-ezpdf_8php.html#112ef069ddc0454086e3d1e6d8d55d07">$result</a>);<span class="comment">// nb d'enregistrements total</span>
<a name="l00710"></a>00710       <a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>.=<span class="stringliteral">" ORDER BY $orderBy LIMIT $limit,"</span>.MAX_LIGNES;
<a name="l00711"></a>00711       $result2=<a class="code" href="inc-odb_8php.html#cc73cdf19f49ae7162c99fd07a614e88" title="Execute une requete sql.">odb_query</a>(<a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>,__FILE__,__LINE__);
<a name="l00712"></a>00712       $nb_lignes=mysql_num_rows($result2);
<a name="l00713"></a>00713       <span class="keywordflow">if</span>($nb_lignes&gt;0) {
<a name="l00714"></a>00714 
<a name="l00715"></a>00715          $tab_titres=array('id_saisie'=&gt;'N&amp;deg; Saisie<span class="charliteral">','</span>id_table'=&gt;'N&amp;deg; Table<span class="charliteral">','</span>nom'=&gt;'Nom<span class="charliteral">','</span>serie'=&gt;'S&amp;eacute;r.<span class="charliteral">','</span>etablissement'=&gt;'&amp;Eacute;tablissement<span class="charliteral">','</span>departement'=&gt;'D&amp;eacute;pt.');
<a name="l00716"></a>00716          $thead='';
<a name="l00717"></a>00717          <span class="keywordflow">foreach</span>($tab_titres as <a class="code" href="resultats__ajournes__par__centre_8php.html#28034c8e7e61c01855a789a9215d8acd">$cle</a>=&gt;<a class="code" href="inc-pdf-attestations_8php.html#43e5b5a819fedbd12b8cf5421ba6985e">$titre</a>) {
<a name="l00718"></a>00718             <span class="keywordflow">if</span>($orderBy==<a class="code" href="resultats__ajournes__par__centre_8php.html#28034c8e7e61c01855a789a9215d8acd">$cle</a>) <a class="code" href="inc-pdf-attestations_8php.html#43e5b5a819fedbd12b8cf5421ba6985e">$titre</a>=<span class="stringliteral">"&lt;u&gt;$titre&lt;/u&gt;"</span>;
<a name="l00719"></a>00719             <span class="keywordflow">if</span>(($isAdmin || $isOperateur || ($isChefEtablissement &amp;&amp; <a class="code" href="resultats__ajournes__par__centre_8php.html#28034c8e7e61c01855a789a9215d8acd">$cle</a>!='etablissement' || <a class="code" href="resultats__ajournes__par__centre_8php.html#28034c8e7e61c01855a789a9215d8acd">$cle</a>!='departement')) &amp;&amp; !${<span class="stringliteral">"filtre"</span>.ucwords(<a class="code" href="resultats__ajournes__par__centre_8php.html#28034c8e7e61c01855a789a9215d8acd">$cle</a>)} ) <span class="comment">//ne pas afficher le filtre en cours</span>
<a name="l00720"></a>00720                 $thead.=<span class="stringliteral">"&lt;td align='center'&gt;&lt;A class='cellule-h' HREF=\"javascript:document.forms['tri_filtre'].orderBy.value='$cle';document.forms['tri_filtre'].submit();\"&gt;$titre&lt;/A&gt;&lt;/td&gt;"</span>;
<a name="l00721"></a>00721          }
<a name="l00722"></a>00722 
<a name="l00723"></a>00723          <span class="keywordflow">while</span>($row=mysql_fetch_array($result2)) {
<a name="l00724"></a>00724             $id_saisie=$row['id_saisie'];
<a name="l00725"></a>00725             <a class="code" href="inc-pdf-convocation_8php.html#295929cd9243ffe88a7c63fc065d7e9e">$id_table</a>=<a class="code" href="inc-odb_8php.html#50e3b190a166aaf85cb237405cf56be2" title="affiche un numero de table de facon lisible pour un humain">getIdTableHumain</a>($row['id_table']);
<a name="l00726"></a>00726             $id_departement=$row['departement'];
<a name="l00727"></a>00727             $serie=$tab_referentiel['serie'][$row['serie']];
<a name="l00728"></a>00728             $departement=$tab_referentiel['departement'][$id_departement];
<a name="l00729"></a>00729             $ville=$tab_referentiel['ville'][$id_departement][$row['ville']];
<a name="l00730"></a>00730             <a class="code" href="inc-pdf-convocation_8php.html#9173474babbbe880fc1f648e171d03d0">$id_etablissement</a>=$row['etablissement'];
<a name="l00731"></a>00731             <a class="code" href="inc-pdf-convocation_8php.html#a1d1a8c13dd23a13326547e2fb40b700">$prefixe</a>=$tab_referentiel['prefixe'][$row['prefixe']];
<a name="l00732"></a>00732             $sexe=$tab_referentiel['sexe'][$row['sexe']]==<span class="charliteral">'M'</span>?'M.<span class="charliteral">':'</span>Mlle';
<a name="l00733"></a>00733             $e=$sexe=='M.<span class="charliteral">'?'</span><span class="charliteral">':'</span>e';
<a name="l00734"></a>00734             <a class="code" href="resultats__ajournes__par__centre_8php.html#c72f7055f1354a72cd1dcca5d9f1e121">$nom</a>=stripslashes($row['nom']);
<a name="l00735"></a>00735             $prenoms=stripslashes($row['prenoms']);
<a name="l00736"></a>00736             $login=ucfirst($row['login']);
<a name="l00737"></a>00737             list($tmpDate,$tmpHeure)=explode(<span class="charliteral">' '</span>,$row['maj']);
<a name="l00738"></a>00738             list($yMaj,$mMaj,$jMaj)=explode(<span class="charliteral">'-'</span>,$tmpDate);
<a name="l00739"></a>00739             $texteMaj=<span class="stringliteral">"Saisi$e par $login le $jMaj/$mMaj/$yMaj &amp;agrave; "</span>.substr($tmpHeure,0,5);
<a name="l00740"></a>00740             <span class="keywordflow">if</span>(!$isChefEtablissement) $etablissement=$tab_referentiel['etablissement'][$id_departement][<a class="code" href="inc-pdf-convocation_8php.html#9173474babbbe880fc1f648e171d03d0">$id_etablissement</a>];
<a name="l00741"></a>00741             <span class="comment">//else $etablissement=$tab_auteur['nom_site'];</span>
<a name="l00742"></a>00742 
<a name="l00743"></a>00743             $ligne=<span class="stringliteral">"&lt;td&gt;&lt;small&gt;&lt;A title='$texteMaj' HREF='"</span>.generer_url_ecrire('odb_saisie').<span class="stringliteral">"&amp;annee=$annee&amp;step2=odb_candidats&amp;identifiant=id_saisie&amp;id=$id_saisie'&gt;$id_saisie&lt;/a&gt;&lt;/small&gt;&lt;/td&gt;&lt;td&gt;&lt;small&gt;$id_table&lt;/small&gt;&lt;/td&gt;&lt;td&gt;&lt;small&gt;$sexe &lt;/small&gt;&lt;A title='$texteMaj' HREF='"</span>.generer_url_ecrire('odb_saisie').<span class="stringliteral">"&amp;annee=$annee&amp;step2=odb_candidats&amp;identifiant=id_saisie&amp;id=$id_saisie'&gt;$prefixe &lt;b&gt;$nom&lt;/b&gt;&lt;small&gt; $prenoms&lt;/small&gt;&lt;/A&gt;&lt;/td&gt;"</span>;
<a name="l00744"></a>00744             <span class="keywordflow">if</span>(!$filtreSerie) $ligne.=<span class="stringliteral">"&lt;td&gt;&lt;small&gt;$serie&lt;/small&gt;&lt;/td&gt;"</span>;
<a name="l00745"></a>00745             <span class="keywordflow">if</span>(!$isChefEtablissement) {
<a name="l00746"></a>00746                <span class="keywordflow">if</span>(!$filtreEtablissement) $ligne.=<span class="stringliteral">"&lt;td title='$ville'&gt;&lt;small&gt;$etablissement&lt;/small&gt;&lt;/td&gt;"</span>;
<a name="l00747"></a>00747                <span class="keywordflow">if</span>(!$filtreDepartement) $ligne.=<span class="stringliteral">"&lt;td&gt;&lt;small&gt;$departement&lt;/small&gt;&lt;/td&gt;"</span>;
<a name="l00748"></a>00748             }
<a name="l00749"></a>00749             $candidats[$id_saisie]=$ligne;
<a name="l00750"></a>00750          }
<a name="l00751"></a>00751       } <span class="keywordflow">else</span> $thead=<span class="stringliteral">"&lt;td&gt;Aucun candidat trouv&amp;eacute; pour ces crit&amp;egrave;res en $annee&lt;/td&gt;"</span>;
<a name="l00752"></a>00752       echo <span class="stringliteral">"Vous pouvez choisir un candidat dans la liste ci-dessous&lt;br/&gt;&lt;br/&gt;\n"</span>;
<a name="l00753"></a>00753       echo <span class="stringliteral">"&lt;A NAME='acces_clic'&gt;&lt;/A&gt;"</span>;
<a name="l00754"></a>00754       <span class="keywordflow">if</span>($nb_lignes==0 &amp;&amp; $nb_lignes_tot&gt;0)
<a name="l00755"></a>00755          $thead=<span class="stringliteral">"Vos filtres vous obligent &amp;agrave; &lt;b&gt;&lt;A HREF=\"javascript:document.forms['tri_filtre'].limit.value=0;document.forms['tri_filtre'].submit();\"&gt;cliquer ici pour retourner au premier &amp;eacute;cran&lt;/A&gt;&lt;/b&gt;"</span>;
<a name="l00756"></a>00756       <span class="keywordflow">if</span>($nb_lignes_tot&gt;<a class="code" href="odb__repartition_8avecGeneriques_8php.html#80964ebc372556b131e270901883e24f">MAX_LIGNES</a>) {
<a name="l00757"></a>00757          <span class="keywordflow">if</span>(<a class="code" href="inc-pdf-attestations_8php.html#e05862a0294251c88629b141b5ce329a">$limit</a>&gt;=<a class="code" href="odb__repartition_8avecGeneriques_8php.html#80964ebc372556b131e270901883e24f">MAX_LIGNES</a>) $nav= <span class="stringliteral">"&lt;b&gt;&lt;A HREF=\"javascript:document.forms['tri_filtre'].limit.value="</span>.($limit-<a class="code" href="odb__repartition_8avecGeneriques_8php.html#80964ebc372556b131e270901883e24f">MAX_LIGNES</a>).<span class="stringliteral">";document.forms['tri_filtre'].submit();\"&gt;&amp;lt;&amp;lt; Pr&amp;eacute;c.&lt;/A&gt;&lt;/b&gt; :: "</span>;
<a name="l00758"></a>00758          $nav.= <span class="stringliteral">"$nb_lignes_tot enregistrements au total &lt;b&gt;[$limit-"</span>.($limit+$nb_lignes).<span class="stringliteral">"]&lt;/b&gt;"</span>;
<a name="l00759"></a>00759          <span class="keywordflow">if</span>($nb_lignes_tot-<a class="code" href="inc-pdf-attestations_8php.html#e05862a0294251c88629b141b5ce329a">$limit</a>&gt;<a class="code" href="odb__repartition_8avecGeneriques_8php.html#80964ebc372556b131e270901883e24f">MAX_LIGNES</a>) $nav.= <span class="stringliteral">" :: &lt;b&gt;&lt;A HREF=\"javascript:document.forms['tri_filtre'].limit.value="</span>.($limit+<a class="code" href="odb__repartition_8avecGeneriques_8php.html#80964ebc372556b131e270901883e24f">MAX_LIGNES</a>).<span class="stringliteral">";document.forms['tri_filtre'].submit();\"&gt;Suiv. &amp;gt;&amp;gt;&lt;/A&gt;&lt;/b&gt;\n"</span>;
<a name="l00760"></a>00760       } <span class="keywordflow">else</span> $nav= <span class="stringliteral">"$nb_lignes_tot enregistrements"</span>;
<a name="l00761"></a>00761       echo <span class="stringliteral">"&lt;FORM NAME='tri_filtre' METHOD='GET' ACTION='"</span>.generer_url_ecrire('odb_saisie').<span class="stringliteral">"#acces_clic' class='forml spip_xx-small'&gt;"</span>
<a name="l00762"></a>00762          . <span class="stringliteral">"&lt;input type='hidden' name='limit' value='$limit'/&gt;\n"</span>
<a name="l00763"></a>00763          . <span class="stringliteral">"&lt;input type='hidden' name='orderBy' value='$orderBy'/&gt;\n"</span>
<a name="l00764"></a>00764          . <span class="stringliteral">"&lt;INPUT TYPE='hidden' name='exec' value='odb_saisie'&gt;\n"</span>
<a name="l00765"></a>00765          . <span class="stringliteral">"&lt;div align='center'&gt;\n$nav&lt;/div&gt;\n"</span>
<a name="l00766"></a>00766          ;
<a name="l00767"></a>00767       $ligne=<span class="stringliteral">"Acc&amp;egrave;s par clic &amp;agrave; un candidat $annee\n"</span>
<a name="l00768"></a>00768             .<span class="stringliteral">"&lt;TABLE CELLPADDING=5 CELLSPACING=0 WIDTH='100%'&gt;\n&lt;TR&gt;\n"</span>
<a name="l00769"></a>00769             .<span class="stringliteral">"\t&lt;td&gt;&lt;label for='filtreSerie'&gt;Filtre s&amp;eacute;rie&lt;/label&gt;&lt;br/&gt;"</span>.<a class="code" href="inc-referentiel_8php.html#c6883d9c334e278e5a3ca040f8b16cc2" title="cree une liste SELECT a partir des resultats d&amp;#39;une requete SQL pour un referentiel...">formSelectQueryRef</a>('S&amp;eacute;rie<span class="charliteral">','</span>filtreSerie',<span class="stringliteral">"SELECT DISTINCT serie from odb_candidats where annee=$annee $andSerie order by serie"</span>,'serie<span class="charliteral">','</span>serie',$filtreSerie,<span class="stringliteral">"class='forml' onChange=\"document.forms['tri_filtre'].submit();\""</span>)
<a name="l00770"></a>00770             .<span class="stringliteral">"&lt;/td&gt;\n\t&lt;td&gt;&lt;label for='filtreDepartement'&gt;Filtre d&amp;eacute;partement&lt;/label&gt;&lt;br/&gt;"</span>.<a class="code" href="inc-referentiel_8php.html#c6883d9c334e278e5a3ca040f8b16cc2" title="cree une liste SELECT a partir des resultats d&amp;#39;une requete SQL pour un referentiel...">formSelectQueryRef</a>('D&amp;eacute;partement<span class="charliteral">','</span>filtreDepartement',<span class="stringliteral">"SELECT DISTINCT departement from odb_candidats where annee=$annee $andDepartement order by departement"</span>,'departement<span class="charliteral">','</span>departement',$filtreDepartement,<span class="stringliteral">"class='forml' onChange=\"document.forms['tri_filtre'].submit();\""</span>)
<a name="l00771"></a>00771             .<span class="stringliteral">"&lt;/td&gt;\n\t&lt;td&gt;&lt;label for='filtreEtablissement'&gt;Filtre &amp;eacute;tablissement&lt;/label&gt;&lt;br/&gt;"</span>.<a class="code" href="inc-referentiel_8php.html#c6883d9c334e278e5a3ca040f8b16cc2" title="cree une liste SELECT a partir des resultats d&amp;#39;une requete SQL pour un referentiel...">formSelectQueryRef</a>('&amp;Eacute;tablissement<span class="charliteral">','</span>filtreEtablissement',<span class="stringliteral">"SELECT DISTINCT etablissement from odb_candidats where annee=$annee $andEtablissement order by etablissement"</span>,'etablissement<span class="charliteral">','</span>etablissement',$filtreEtablissement,<span class="stringliteral">"class='forml' onChange=\"document.forms['tri_filtre'].submit();\""</span>)
<a name="l00772"></a>00772             .<span class="stringliteral">"&lt;/td&gt;\n&lt;/TR&gt;\n&lt;/TABLE&gt;\n"</span>
<a name="l00773"></a>00773             ;
<a name="l00774"></a>00774       <span class="keywordflow">if</span>($isChefEtablissement) {
<a name="l00775"></a>00775          echo $tab_auteur['nom'].<span class="stringliteral">", vous avez acc&amp;egrave;s aux candidats de l'&amp;eacute;tablissement &lt;b&gt;"</span>.$tab_auteur['nom_site'].<span class="stringliteral">"&lt;/b&gt;.&lt;br/&gt;\n"</span>;
<a name="l00776"></a>00776          $ligne.=' de l\'&amp;eacute;tablissement '.$tab_auteur['nom_site'];
<a name="l00777"></a>00777       }
<a name="l00778"></a>00778       echo <a class="code" href="inc-html_8php.html#5f91efa37c4c6e04e1e2792cc0c37600" title="Affiche une table html.">odb_html_table</a>($ligne,$candidats,$thead,$icone='message.gif');
<a name="l00779"></a>00779       echo <span class="stringliteral">"&lt;div align='center'&gt;\n$nav&lt;/div&gt;&lt;/form&gt;\n"</span>;
<a name="l00780"></a>00780 }
<a name="l00781"></a>00781 
<a name="l00782"></a>00782 <span class="comment">//fin_boite_info();</span>
<a name="l00783"></a>00783 fin_cadre_relief();
<a name="l00784"></a>00784 fin_page();
<a name="l00785"></a>00785 exit;
<a name="l00786"></a>00786 }
<a name="l00787"></a>00787 ?&gt;
</pre></div><hr size="1"><address style="text-align: right;"><small>Généré le Mon Mar 17 22:53:01 2008 pour Siou par&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.3 </small></address>
</body>
</html>
