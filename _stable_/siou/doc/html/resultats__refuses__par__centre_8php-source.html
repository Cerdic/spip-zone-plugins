<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Siou:  Fichier source de odb_statistiques_siou/exec/resultats_refuses_par_centre.php</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Généré par Doxygen 1.5.3 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Page&nbsp;principale</span></a></li>
    <li class="current"><a href="files.html"><span>Fichiers</span></a></li>
    <li><a href="dirs.html"><span>Répertoires</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;Rechercher&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul>
</div>
<div class="nav">
<a class="el" href="dir_89200f03b9e03e4bed23a73e0b0e62c1.html">odb_statistiques_siou</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_58a84f71e2ec18f26e0f9c4cd42b5552.html">exec</a></div>
<h1>resultats_refuses_par_centre.php</h1><a href="resultats__refuses__par__centre_8php.html">Aller à la documentation de ce fichier.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a><a class="code" href="resultats__refuses__par__centre_8php.html#f25bc576c1b6d0e1a28f8e900989a38f">00002</a> <a class="code" href="resultats__ajournes__par__centre_8php.html#f25bc576c1b6d0e1a28f8e900989a38f">$idCentre</a>=$stats_resultats_centre;
<a name="l00003"></a>00003 <span class="keywordflow">if</span>(<a class="code" href="resultats__ajournes__par__centre_8php.html#f25bc576c1b6d0e1a28f8e900989a38f">$idCentre</a>&gt;0) {
<a name="l00004"></a>00004         <span class="keywordflow">foreach</span>($tab_referentiel['centre'] as $id_departement=&gt;$t1)
<a name="l00005"></a>00005                 <span class="keywordflow">foreach</span>($t1 as $un_centre=&gt;$id_centre)
<a name="l00006"></a>00006                         <span class="keywordflow">if</span>($id_centre==<a class="code" href="resultats__ajournes__par__centre_8php.html#f25bc576c1b6d0e1a28f8e900989a38f">$idCentre</a>) { 
<a name="l00007"></a>00007                         $centre=$un_centre;
<a name="l00008"></a>00008                         $departement=$tab_referentiel['departement'][$id_departement];
<a name="l00009"></a>00009                 }
<a name="l00010"></a>00010         <a class="code" href="resultats__ajournes__par__centre_8php.html#9e168f4152c267835864153c54449583">$msg</a>=<span class="stringliteral">"&lt;h1&gt;$departement&lt;/h1&gt;\n&lt;h2&gt;$centre&lt;/h2&gt;\n"</span>;
<a name="l00011"></a>00011         <span class="comment">/*odb_maj_decisions($annee);</span>
<a name="l00012"></a>00012 <span class="comment">        odb_maj_decisions($annee,0,3,2);</span>
<a name="l00013"></a>00013 <span class="comment">        odb_maj_decisions($annee,0,3,3);*/</span>
<a name="l00014"></a><a class="code" href="resultats__refuses__par__centre_8php.html#047170d6020a882807665812a27e2525">00014</a>         <a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>=<span class="stringliteral">"SELECT decis.id_table, sex.sexe, pre.prefixe, nom, prenoms, eta.etablissement, can.serie idSerie, decis.delib1, decis.delib2, decis.delib3, decis.moyenne\n"</span>.
<a name="l00015"></a>00015         <span class="stringliteral">"FROM odb_ref_sexe sex, odb_ref_etablissement eta, odb_decisions decis, odb_repartition rep, odb_candidats can\n"</span>.
<a name="l00016"></a>00016         <span class="stringliteral">"left join odb_ref_prefixe pre on pre.id=can.prefixe\n"</span>.
<a name="l00017"></a>00017         <span class="stringliteral">"WHERE rep.id_table=decis.id_table and can.id_table=decis.id_table and can.sexe=sex.id and can.etablissement=eta.id\n"</span>.
<a name="l00018"></a>00018         <span class="stringliteral">"and can.annee=$annee and decis.annee=$annee and rep.annee=$annee and rep.id_etablissement=$idCentre\n"</span>.
<a name="l00019"></a>00019         <span class="stringliteral">"ORDER BY nom, prenoms"</span>;
<a name="l00020"></a>00020         <span class="comment">//echo $sql;</span>
<a name="l00021"></a><a class="code" href="resultats__refuses__par__centre_8php.html#112ef069ddc0454086e3d1e6d8d55d07">00021</a>         <a class="code" href="inc-ezpdf_8php.html#112ef069ddc0454086e3d1e6d8d55d07">$result</a>=mysql_query(<a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>) or die(<a class="code" href="odb__ref_8php.html#e56b96c4dfcced36887ba02c496c40a3">KO</a>." - erreur dans la requete &lt;pre&gt;".str_replace($pass,'*****',<a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>)."&lt;/pre&gt;&lt;br/&gt;".mysql_error());
<a name="l00022"></a><a class="code" href="resultats__refuses__par__centre_8php.html#ea5d1e230cf3df250120025d801dc7c3">00022</a>         <a class="code" href="resultats__ajournes__par__centre_8php.html#ea5d1e230cf3df250120025d801dc7c3">$cpt</a>=0;
<a name="l00023"></a><a class="code" href="resultats__refuses__par__centre_8php.html#46e38f8e36bb444e92ebeeaebd56cdba">00023</a>         <a class="code" href="resultats__ajournes__par__centre_8php.html#46e38f8e36bb444e92ebeeaebd56cdba">$tDelib</a>=array();
<a name="l00024"></a>00024         while($row=mysql_fetch_array(<a class="code" href="inc-ezpdf_8php.html#112ef069ddc0454086e3d1e6d8d55d07">$result</a>)) {
<a name="l00025"></a>00025                 <a class="code" href="resultats__ajournes__par__centre_8php.html#ea5d1e230cf3df250120025d801dc7c3">$cpt</a>++;
<a name="l00026"></a>00026                 <span class="keywordflow">foreach</span>(array('id_table<span class="charliteral">','</span>sexe<span class="charliteral">','</span>prefixe<span class="charliteral">','</span>nom<span class="charliteral">','</span>prenoms<span class="charliteral">','</span>etablissement<span class="charliteral">','</span>idSerie<span class="charliteral">','</span>delib1<span class="charliteral">','</span>delib2<span class="charliteral">','</span>delib3<span class="charliteral">','</span>moyenne') as $col) $$col=$row[$col];
<a name="l00027"></a>00027                 <span class="keywordflow">if</span>($sexe==<span class="charliteral">'F'</span>) {$sexe='Mlle';$e=<span class="charliteral">'e'</span>;} <span class="keywordflow">else</span> {$sexe='M.';$e='';}
<a name="l00028"></a>00028                 <span class="keywordflow">if</span>($delib1!='Admissible') <a class="code" href="inc-pdf-attestations_8php.html#9a4db75cbb47f99cc82e12e08bb365ec">$delib</a>=$delib1;
<a name="l00029"></a>00029                 elseif($delib2!='Oral') <a class="code" href="inc-pdf-attestations_8php.html#9a4db75cbb47f99cc82e12e08bb365ec">$delib</a>=$delib2;
<a name="l00030"></a><a class="code" href="resultats__refuses__par__centre_8php.html#12a6f07665340c6c759a07cf96d74ef8">00030</a>                 <span class="keywordflow">else</span> <a class="code" href="inc-pdf-attestations_8php.html#9a4db75cbb47f99cc82e12e08bb365ec">$delib</a>=$delib3;
<a name="l00031"></a><a class="code" href="resultats__refuses__par__centre_8php.html#c72f7055f1354a72cd1dcca5d9f1e121">00031</a>                 <a class="code" href="resultats__ajournes__par__centre_8php.html#c72f7055f1354a72cd1dcca5d9f1e121">$nom</a>=<a class="code" href="inc-pdf-convocation_8php.html#a1d1a8c13dd23a13326547e2fb40b700">$prefixe</a>.<span class="stringliteral">" &lt;b&gt;$nom&lt;/b&gt;"</span>;
<a name="l00032"></a>00032                 <span class="keywordflow">if</span>($sexe==<span class="charliteral">'F'</span>) {$sexe='Mlle';$e=<span class="charliteral">'e'</span>;} <span class="keywordflow">else</span> {$sexe='M.';$e='';}
<a name="l00033"></a>00033                 <span class="keywordflow">if</span>(in_array(strtolower(<a class="code" href="inc-pdf-attestations_8php.html#9a4db75cbb47f99cc82e12e08bb365ec">$delib</a>),array('passable<span class="charliteral">','</span>abien<span class="charliteral">','</span>bien<span class="charliteral">','</span>tbien'))) <a class="code" href="resultats__ajournes__par__centre_8php.html#28034c8e7e61c01855a789a9215d8acd">$cle</a>='Admis';
<a name="l00034"></a>00034                 elseif(<a class="code" href="inc-pdf-attestations_8php.html#9a4db75cbb47f99cc82e12e08bb365ec">$delib</a>!='Reserve' &amp;&amp; <a class="code" href="inc-pdf-attestations_8php.html#9a4db75cbb47f99cc82e12e08bb365ec">$delib</a>!='Absent') <a class="code" href="resultats__ajournes__par__centre_8php.html#28034c8e7e61c01855a789a9215d8acd">$cle</a>='Refuse';
<a name="l00035"></a><a class="code" href="resultats__refuses__par__centre_8php.html#28034c8e7e61c01855a789a9215d8acd">00035</a>                 <a class="code" href="odb__commun_2img__pack_2vignettes_2index_8php.html#0544c3fe466e421738dae463968b70ba">else</a> <a class="code" href="resultats__ajournes__par__centre_8php.html#28034c8e7e61c01855a789a9215d8acd">$cle</a>=<a class="code" href="inc-pdf-attestations_8php.html#9a4db75cbb47f99cc82e12e08bb365ec">$delib</a>;
<a name="l00036"></a><a class="code" href="resultats__refuses__par__centre_8php.html#e5efa48e39b526cf2a5bf412bb9918fe">00036</a>                 <a class="code" href="resultats__ajournes__par__centre_8php.html#46e38f8e36bb444e92ebeeaebd56cdba">$tDelib</a>[<a class="code" href="resultats__ajournes__par__centre_8php.html#28034c8e7e61c01855a789a9215d8acd">$cle</a>][$idSerie][<a class="code" href="resultats__ajournes__par__centre_8php.html#ea5d1e230cf3df250120025d801dc7c3">$cpt</a>]['id_table']=<a class="code" href="inc-pdf-convocation_8php.html#295929cd9243ffe88a7c63fc065d7e9e">$id_table</a>;
<a name="l00037"></a><a class="code" href="resultats__refuses__par__centre_8php.html#e77460eb09d9ff1d1e4e49a882f9cefa">00037</a>                 <a class="code" href="resultats__ajournes__par__centre_8php.html#46e38f8e36bb444e92ebeeaebd56cdba">$tDelib</a>[<a class="code" href="resultats__ajournes__par__centre_8php.html#28034c8e7e61c01855a789a9215d8acd">$cle</a>][$idSerie][<a class="code" href="resultats__ajournes__par__centre_8php.html#ea5d1e230cf3df250120025d801dc7c3">$cpt</a>]['candidat']=utf8_decode("$sexe <a class="code" href="resultats__ajournes__par__centre_8php.html#c72f7055f1354a72cd1dcca5d9f1e121">$nom</a> $prenoms");
<a name="l00038"></a><a class="code" href="resultats__refuses__par__centre_8php.html#34e2b63a3518244ee474991d37761dcc">00038</a>                 <a class="code" href="resultats__ajournes__par__centre_8php.html#46e38f8e36bb444e92ebeeaebd56cdba">$tDelib</a>[<a class="code" href="resultats__ajournes__par__centre_8php.html#28034c8e7e61c01855a789a9215d8acd">$cle</a>][$idSerie][<a class="code" href="resultats__ajournes__par__centre_8php.html#ea5d1e230cf3df250120025d801dc7c3">$cpt</a>]['etablissement']=utf8_decode($etablissement);
<a name="l00039"></a>00039                 if($delib==$delib1) $delib=ereg_replace("e$","&amp;<a class="code" href="inc-pdf-table_8php.html#1c3d7fb9d2f4e0216017175154061426">eacute</a>;",$delib1).$e;
<a name="l00040"></a><a class="code" href="resultats__refuses__par__centre_8php.html#ac029279bed824971e694cf420c1f349">00040</a>                 <a class="code" href="resultats__ajournes__par__centre_8php.html#46e38f8e36bb444e92ebeeaebd56cdba">$tDelib</a>[<a class="code" href="resultats__ajournes__par__centre_8php.html#28034c8e7e61c01855a789a9215d8acd">$cle</a>][$idSerie][<a class="code" href="resultats__ajournes__par__centre_8php.html#ea5d1e230cf3df250120025d801dc7c3">$cpt</a>]['delib']=html_entity_decode(utf8_decode($delib));
<a name="l00041"></a><a class="code" href="resultats__refuses__par__centre_8php.html#17eec7d96b61a43793c56c5d2c99efc5">00041</a>                 <a class="code" href="resultats__ajournes__par__centre_8php.html#46e38f8e36bb444e92ebeeaebd56cdba">$tDelib</a>[<a class="code" href="resultats__ajournes__par__centre_8php.html#28034c8e7e61c01855a789a9215d8acd">$cle</a>][$idSerie][<a class="code" href="resultats__ajournes__par__centre_8php.html#ea5d1e230cf3df250120025d801dc7c3">$cpt</a>]['moyenne']=round($moyenne,2);
<a name="l00042"></a>00042         }
<a name="l00043"></a>00043         foreach(array_keys(<a class="code" href="resultats__ajournes__par__centre_8php.html#46e38f8e36bb444e92ebeeaebd56cdba">$tDelib</a>['Refuse']) as $id_serie) {
<a name="l00044"></a>00044                 $tSeries[$id_serie]=$tab_referentiel['serie'][$id_serie];
<a name="l00045"></a>00045         }
<a name="l00046"></a>00046         asort($tSeries);
<a name="l00047"></a><a class="code" href="resultats__refuses__par__centre_8php.html#9e168f4152c267835864153c54449583">00047</a>         <a class="code" href="resultats__ajournes__par__centre_8php.html#9e168f4152c267835864153c54449583">$msg</a>.=<span class="stringliteral">"&lt;table class='spip'&gt;\n"</span>;
<a name="l00048"></a>00048         <span class="keywordflow">foreach</span>($tSeries as $iIdSerie=&gt;$sSerie) {
<a name="l00049"></a>00049                 <a class="code" href="resultats__par__centre_8php.html#d7ffa63e74542beba116bde88c6716b5">$nom_pdf</a>=<a class="code" href="inc-html_8php.html#a99d47bed9e80456aaed4dc43d2fc0cc" title="rend une chaine compatible url-rewriting">getRewriteString</a>(<span class="stringliteral">"Refus&amp;eacute;s centre $centre-Serie $sSerie"</span>);
<a name="l00050"></a><a class="code" href="resultats__refuses__par__centre_8php.html#082ba331d3cc45e8443c96d1131d5599">00050</a>                 <a class="code" href="resultats__ajournes__par__centre_8php.html#082ba331d3cc45e8443c96d1131d5599">$_SESSION</a>['cols'][<a class="code" href="resultats__par__centre_8php.html#d7ffa63e74542beba116bde88c6716b5">$nom_pdf</a>]=array('id_table'=&gt;html_entity_decode('Num&amp;<a class="code" href="inc-pdf-table_8php.html#1c3d7fb9d2f4e0216017175154061426">eacute</a>;ro table'),'candidat'=&gt;'Candidat<span class="charliteral">','</span>etablissement'=&gt;html_entity_decode('&amp;Eacute;tablissement'),'delib'=&gt;'Mention<span class="charliteral">','</span>moyenne'=&gt;'Moyenne');
<a name="l00051"></a><a class="code" href="resultats__refuses__par__centre_8php.html#9a4791d94dccd87599e1ad20ac58faf7">00051</a>                 <a class="code" href="resultats__ajournes__par__centre_8php.html#082ba331d3cc45e8443c96d1131d5599">$_SESSION</a>['format'][<a class="code" href="resultats__par__centre_8php.html#d7ffa63e74542beba116bde88c6716b5">$nom_pdf</a>]=array('taille'=&gt;'A3<span class="charliteral">','</span>orientation'=&gt;'portrait');
<a name="l00052"></a>00052                 <span class="comment">//$_SESSION['options'][$nom_pdf]=$PDF_A3_PORTRAIT;</span>
<a name="l00053"></a><a class="code" href="resultats__refuses__par__centre_8php.html#176051c7cf4cbb94e61584ce2ca1c66e">00053</a>            <a class="code" href="resultats__ajournes__par__centre_8php.html#082ba331d3cc45e8443c96d1131d5599">$_SESSION</a>['options'][<a class="code" href="resultats__par__centre_8php.html#d7ffa63e74542beba116bde88c6716b5">$nom_pdf</a>]=$PDF_A4_PORTRAIT;
<a name="l00054"></a><a class="code" href="resultats__refuses__par__centre_8php.html#9a4791d94dccd87599e1ad20ac58faf7">00054</a>            <a class="code" href="resultats__ajournes__par__centre_8php.html#082ba331d3cc45e8443c96d1131d5599">$_SESSION</a>['format'][<a class="code" href="resultats__par__centre_8php.html#d7ffa63e74542beba116bde88c6716b5">$nom_pdf</a>]=array('taille'=&gt;'A4', 'orientation'=&gt;'portrait');
<a name="l00055"></a>00055                 <span class="comment">//echo"tDelib&lt;pre&gt;";print_r($tDelib);echo"&lt;/pre&gt;";</span>
<a name="l00056"></a><a class="code" href="resultats__refuses__par__centre_8php.html#728789805f11b3c9d559ff71a0b73364">00056</a>                 <a class="code" href="resultats__ajournes__par__centre_8php.html#082ba331d3cc45e8443c96d1131d5599">$_SESSION</a>['data'][<a class="code" href="resultats__par__centre_8php.html#d7ffa63e74542beba116bde88c6716b5">$nom_pdf</a>]=<a class="code" href="resultats__ajournes__par__centre_8php.html#46e38f8e36bb444e92ebeeaebd56cdba">$tDelib</a>['Refuse'][$iIdSerie];
<a name="l00057"></a><a class="code" href="resultats__refuses__par__centre_8php.html#5c8a53679dc362674a7e845c316daed4">00057</a>                 <a class="code" href="resultats__ajournes__par__centre_8php.html#082ba331d3cc45e8443c96d1131d5599">$_SESSION</a>['titre'][<a class="code" href="resultats__par__centre_8php.html#d7ffa63e74542beba116bde88c6716b5">$nom_pdf</a>]=html_entity_decode(<span class="stringliteral">"Refus&amp;eacute;(e)s centre $centre - S&amp;eacute;rie $sSerie"</span>);
<a name="l00058"></a>00058                 <span class="comment">//$_SESSION['post'][$nom_pdf]=html_entity_decode("Le pr&amp;eacute;sident du jury,");</span>
<a name="l00059"></a><a class="code" href="resultats__refuses__par__centre_8php.html#4e5bd75ba6d44a1723c3ec18c61cd09b">00059</a>                 <a class="code" href="resultats__ajournes__par__centre_8php.html#4e5bd75ba6d44a1723c3ec18c61cd09b">$tmp1</a>=<span class="stringliteral">"&lt;A HREF='../plugins/odb/odb_commun/inc-pdf-table.php?pdf=$nom_pdf' target='_BLANK'&gt;"</span>;
<a name="l00060"></a><a class="code" href="resultats__refuses__par__centre_8php.html#ed9bcb6730d1510376ce80e32bd9504d">00060</a>                 <a class="code" href="resultats__ajournes__par__centre_8php.html#ed9bcb6730d1510376ce80e32bd9504d">$tmp2</a>=<span class="stringliteral">"Refus&amp;eacute;s au centre &lt;b&gt;$centre&lt;/b&gt;&lt;br/&gt;S&amp;eacute;rie &lt;b&gt;$sSerie&lt;/b&gt;&lt;/A&gt;&lt;br/&gt;&lt;br/&gt;"</span>;
<a name="l00061"></a><a class="code" href="resultats__refuses__par__centre_8php.html#110fc80fcb224fbae884b1a3742c4924">00061</a>                 <a class="code" href="resultats__ajournes__par__centre_8php.html#110fc80fcb224fbae884b1a3742c4924">$lien</a>=<a class="code" href="resultats__ajournes__par__centre_8php.html#4e5bd75ba6d44a1723c3ec18c61cd09b">$tmp1</a>.$tmp2;
<a name="l00062"></a><a class="code" href="resultats__refuses__par__centre_8php.html#9e168f4152c267835864153c54449583">00062</a>                 <a class="code" href="resultats__ajournes__par__centre_8php.html#9e168f4152c267835864153c54449583">$msg</a>.=<span class="stringliteral">"&lt;tr&gt;&lt;td&gt;"</span>.vignette('pdf',<span class="stringliteral">"Refus&amp;eacute;s centre $centre - s&amp;eacute;rie $sSerie"</span>).<span class="stringliteral">"&lt;/td&gt;&lt;td colspan=2&gt;$lien&lt;/td&gt;&lt;/tr&gt;\n"</span>;
<a name="l00063"></a>00063         }
<a name="l00064"></a><a class="code" href="resultats__refuses__par__centre_8php.html#9e168f4152c267835864153c54449583">00064</a>         <a class="code" href="resultats__ajournes__par__centre_8php.html#9e168f4152c267835864153c54449583">$msg</a>.=<span class="stringliteral">"&lt;/table&gt;\n"</span>;
<a name="l00065"></a><a class="code" href="resultats__refuses__par__centre_8php.html#2daca62dbc7d40521fd822a1aa028538">00065</a> } <span class="keywordflow">else</span> <a class="code" href="resultats__ajournes__par__centre_8php.html#9e168f4152c267835864153c54449583">$msg</a>=<span class="stringliteral">"Veuillez choisir un centre avant de cliquer sur ce bouton"</span>;
<a name="l00066"></a>00066 ?&gt;
</pre></div><hr size="1"><address style="text-align: right;"><small>Généré le Mon Mar 17 22:53:01 2008 pour Siou par&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.3 </small></address>
</body>
</html>
