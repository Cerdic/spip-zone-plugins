<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Siou:  Fichier source de odb_statistiques_siou/exec/resultats_par_centre.php</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Généré par Doxygen 1.5.3 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Page&nbsp;principale</span></a></li>
    <li class="current"><a href="files.html"><span>Fichiers</span></a></li>
    <li><a href="dirs.html"><span>Répertoires</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;Rechercher&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul>
</div>
<div class="nav">
<a class="el" href="dir_89200f03b9e03e4bed23a73e0b0e62c1.html">odb_statistiques_siou</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_58a84f71e2ec18f26e0f9c4cd42b5552.html">exec</a></div>
<h1>resultats_par_centre.php</h1><a href="resultats__par__centre_8php.html">Aller à la documentation de ce fichier.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a><a class="code" href="resultats__par__centre_8php.html#f25bc576c1b6d0e1a28f8e900989a38f">00002</a> <a class="code" href="resultats__ajournes__par__centre_8php.html#f25bc576c1b6d0e1a28f8e900989a38f">$idCentre</a>=$stats_resultats_centre;
<a name="l00003"></a>00003 <span class="keywordflow">if</span>(<a class="code" href="resultats__ajournes__par__centre_8php.html#f25bc576c1b6d0e1a28f8e900989a38f">$idCentre</a>&gt;0) {
<a name="l00004"></a>00004         <span class="keywordflow">foreach</span>($tab_referentiel['centre'] as $id_departement=&gt;$t1)
<a name="l00005"></a>00005                 <span class="keywordflow">foreach</span>($t1 as $un_centre=&gt;$id_centre)
<a name="l00006"></a>00006                         <span class="keywordflow">if</span>($id_centre==<a class="code" href="resultats__ajournes__par__centre_8php.html#f25bc576c1b6d0e1a28f8e900989a38f">$idCentre</a>) { 
<a name="l00007"></a>00007                         $centre=$un_centre;
<a name="l00008"></a>00008                         $departement=$tab_referentiel['departement'][$id_departement];
<a name="l00009"></a>00009                 }
<a name="l00010"></a>00010         <a class="code" href="resultats__ajournes__par__centre_8php.html#9e168f4152c267835864153c54449583">$msg</a>=<span class="stringliteral">"&lt;h1&gt;$departement&lt;/h1&gt;\n&lt;h2&gt;$centre&lt;/h2&gt;\n"</span>;
<a name="l00011"></a>00011         <span class="comment">/*odb_maj_decisions($annee);</span>
<a name="l00012"></a>00012 <span class="comment">        odb_maj_decisions($annee,0,3,2);</span>
<a name="l00013"></a>00013 <span class="comment">        odb_maj_decisions($annee,0,3,3);*/</span>
<a name="l00014"></a><a class="code" href="resultats__par__centre_8php.html#047170d6020a882807665812a27e2525">00014</a>         <a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>=<span class="stringliteral">"SELECT decis.id_table, sex.sexe, pre.prefixe, nom, prenoms, eta.etablissement, can.serie idSerie, decis.delib1, decis.delib2, decis.delib3, ldn, ne_en, ne_le, ne_vers\n"</span>.
<a name="l00015"></a>00015         <span class="stringliteral">"FROM odb_ref_sexe sex, odb_ref_etablissement eta, odb_decisions decis, odb_repartition rep, odb_candidats can\n"</span>.
<a name="l00016"></a>00016         <span class="stringliteral">"left join odb_ref_prefixe pre on pre.id=can.prefixe\n"</span>.
<a name="l00017"></a>00017         <span class="stringliteral">"WHERE rep.id_table=decis.id_table and can.id_table=decis.id_table and can.sexe=sex.id and can.etablissement=eta.id\n"</span>.
<a name="l00018"></a>00018         <span class="stringliteral">"and can.annee=$annee and decis.annee=$annee and rep.annee=$annee and rep.id_etablissement=$idCentre\n"</span>.
<a name="l00019"></a>00019         <span class="stringliteral">"ORDER BY idSerie, nom, prenoms"</span>;
<a name="l00020"></a>00020         <span class="comment">//echo $sql;</span>
<a name="l00021"></a><a class="code" href="resultats__par__centre_8php.html#112ef069ddc0454086e3d1e6d8d55d07">00021</a>         <a class="code" href="inc-ezpdf_8php.html#112ef069ddc0454086e3d1e6d8d55d07">$result</a>=mysql_query(<a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>) or die(<a class="code" href="odb__ref_8php.html#e56b96c4dfcced36887ba02c496c40a3">KO</a>." - erreur dans la requete &lt;pre&gt;".str_replace($pass,'*****',<a class="code" href="inc-pdf-attestations_8php.html#047170d6020a882807665812a27e2525">$sql</a>)."&lt;/pre&gt;&lt;br/&gt;".mysql_error());
<a name="l00022"></a><a class="code" href="resultats__par__centre_8php.html#ea5d1e230cf3df250120025d801dc7c3">00022</a>         <a class="code" href="resultats__ajournes__par__centre_8php.html#ea5d1e230cf3df250120025d801dc7c3">$cpt</a>=0;
<a name="l00023"></a><a class="code" href="resultats__par__centre_8php.html#46e38f8e36bb444e92ebeeaebd56cdba">00023</a>         <a class="code" href="resultats__ajournes__par__centre_8php.html#46e38f8e36bb444e92ebeeaebd56cdba">$tDelib</a>=array();
<a name="l00024"></a>00024         while($row=mysql_fetch_array(<a class="code" href="inc-ezpdf_8php.html#112ef069ddc0454086e3d1e6d8d55d07">$result</a>)) {
<a name="l00025"></a>00025                 <a class="code" href="resultats__ajournes__par__centre_8php.html#ea5d1e230cf3df250120025d801dc7c3">$cpt</a>++;
<a name="l00026"></a>00026                 <span class="keywordflow">foreach</span>(array('id_table<span class="charliteral">','</span>sexe<span class="charliteral">','</span>prefixe<span class="charliteral">','</span>nom<span class="charliteral">','</span>prenoms<span class="charliteral">','</span>etablissement<span class="charliteral">','</span>idSerie<span class="charliteral">','</span>delib1<span class="charliteral">','</span>delib2<span class="charliteral">','</span>delib3<span class="charliteral">','</span>ne_en<span class="charliteral">','</span>ne_le<span class="charliteral">','</span>ne_vers<span class="charliteral">','</span>ldn') as $col) $$col=$row[$col];
<a name="l00027"></a>00027       <span class="keywordflow">if</span>($ne_en&gt;0) $ddn=<span class="stringliteral">"En $ne_en"</span>;
<a name="l00028"></a>00028       elseif($ne_vers&gt;0) $ddn=<span class="stringliteral">"Vers $ne_vers"</span>;
<a name="l00029"></a>00029       <span class="keywordflow">else</span> {
<a name="l00030"></a>00030          <a class="code" href="inc-pdf-convocation_8php.html#6fd2de6056734aba5417b97d6d7a24bc">$tDate</a>=explode(<span class="charliteral">'-'</span>,$ne_le);
<a name="l00031"></a>00031          <a class="code" href="inc-pdf-attestations_8php.html#b372e2dd50f4a592a1226a01290a2f4f">$annee</a>=<a class="code" href="inc-pdf-convocation_8php.html#6fd2de6056734aba5417b97d6d7a24bc">$tDate</a>[0];
<a name="l00032"></a>00032          <a class="code" href="inc-pdf-attestations_8php.html#c3dd350c90be7c45f992a6efde984c66">$mois</a>=<a class="code" href="inc-pdf-convocation_8php.html#6fd2de6056734aba5417b97d6d7a24bc">$tDate</a>[1];
<a name="l00033"></a>00033          <a class="code" href="inc-pdf-attestations_8php.html#477477d68b3781b42c7fb933b20288af">$jour</a>=<a class="code" href="inc-pdf-convocation_8php.html#6fd2de6056734aba5417b97d6d7a24bc">$tDate</a>[2];
<a name="l00034"></a>00034          $ddn=<span class="stringliteral">"$jour/$mois/$annee"</span>;
<a name="l00035"></a>00035       }
<a name="l00036"></a>00036       $ddn.=<span class="stringliteral">" $ldn"</span>;
<a name="l00037"></a>00037                 <span class="keywordflow">if</span>($sexe==<span class="charliteral">'F'</span>) {$sexe='Mlle';$e=<span class="charliteral">'e'</span>;} <span class="keywordflow">else</span> {$sexe='M.';$e='';}
<a name="l00038"></a>00038                 <span class="keywordflow">if</span>($delib1!='Admissible') <a class="code" href="inc-pdf-attestations_8php.html#9a4db75cbb47f99cc82e12e08bb365ec">$delib</a>=$delib1;
<a name="l00039"></a>00039                 elseif($delib2!='Oral') <a class="code" href="inc-pdf-attestations_8php.html#9a4db75cbb47f99cc82e12e08bb365ec">$delib</a>=$delib2;
<a name="l00040"></a><a class="code" href="resultats__par__centre_8php.html#12a6f07665340c6c759a07cf96d74ef8">00040</a>                 <span class="keywordflow">else</span> <a class="code" href="inc-pdf-attestations_8php.html#9a4db75cbb47f99cc82e12e08bb365ec">$delib</a>=$delib3;
<a name="l00041"></a><a class="code" href="resultats__par__centre_8php.html#c72f7055f1354a72cd1dcca5d9f1e121">00041</a>                 <a class="code" href="resultats__ajournes__par__centre_8php.html#c72f7055f1354a72cd1dcca5d9f1e121">$nom</a>=<a class="code" href="inc-pdf-convocation_8php.html#a1d1a8c13dd23a13326547e2fb40b700">$prefixe</a>.<span class="stringliteral">" &lt;b&gt;$nom&lt;/b&gt;"</span>;
<a name="l00042"></a>00042                 <span class="keywordflow">if</span>($sexe==<span class="charliteral">'F'</span>) {$sexe='Mlle';$e=<span class="charliteral">'e'</span>;} <span class="keywordflow">else</span> {$sexe='M.';$e='';}
<a name="l00043"></a>00043                 <span class="keywordflow">if</span>(in_array(strtolower(<a class="code" href="inc-pdf-attestations_8php.html#9a4db75cbb47f99cc82e12e08bb365ec">$delib</a>),array('passable<span class="charliteral">','</span>abien<span class="charliteral">','</span>bien<span class="charliteral">','</span>tbien'))) <a class="code" href="resultats__ajournes__par__centre_8php.html#28034c8e7e61c01855a789a9215d8acd">$cle</a>='Admis';
<a name="l00044"></a>00044                 elseif(<a class="code" href="inc-pdf-attestations_8php.html#9a4db75cbb47f99cc82e12e08bb365ec">$delib</a>!='Reserve' &amp;&amp; <a class="code" href="inc-pdf-attestations_8php.html#9a4db75cbb47f99cc82e12e08bb365ec">$delib</a>!='Absent') <a class="code" href="resultats__ajournes__par__centre_8php.html#28034c8e7e61c01855a789a9215d8acd">$cle</a>='Refuse';
<a name="l00045"></a><a class="code" href="resultats__par__centre_8php.html#28034c8e7e61c01855a789a9215d8acd">00045</a>                 <a class="code" href="odb__commun_2img__pack_2vignettes_2index_8php.html#0544c3fe466e421738dae463968b70ba">else</a> <a class="code" href="resultats__ajournes__par__centre_8php.html#28034c8e7e61c01855a789a9215d8acd">$cle</a>=<a class="code" href="inc-pdf-attestations_8php.html#9a4db75cbb47f99cc82e12e08bb365ec">$delib</a>;
<a name="l00046"></a><a class="code" href="resultats__par__centre_8php.html#02865139c18747c179f0a5046ea359c9">00046</a>                 <a class="code" href="resultats__ajournes__par__centre_8php.html#46e38f8e36bb444e92ebeeaebd56cdba">$tDelib</a>[<a class="code" href="resultats__ajournes__par__centre_8php.html#28034c8e7e61c01855a789a9215d8acd">$cle</a>][<a class="code" href="resultats__ajournes__par__centre_8php.html#ea5d1e230cf3df250120025d801dc7c3">$cpt</a>]['id_table']=<a class="code" href="inc-pdf-convocation_8php.html#295929cd9243ffe88a7c63fc065d7e9e">$id_table</a>;
<a name="l00047"></a><a class="code" href="resultats__par__centre_8php.html#42072563b7613cc0505e7809d98b6e5e">00047</a>                 <a class="code" href="resultats__ajournes__par__centre_8php.html#46e38f8e36bb444e92ebeeaebd56cdba">$tDelib</a>[<a class="code" href="resultats__ajournes__par__centre_8php.html#28034c8e7e61c01855a789a9215d8acd">$cle</a>][<a class="code" href="resultats__ajournes__par__centre_8php.html#ea5d1e230cf3df250120025d801dc7c3">$cpt</a>]['serie']=$tab_referentiel['serie'][$idSerie];
<a name="l00048"></a><a class="code" href="resultats__par__centre_8php.html#c58f79433400cca2df341311f8412e40">00048</a>                 <a class="code" href="resultats__ajournes__par__centre_8php.html#46e38f8e36bb444e92ebeeaebd56cdba">$tDelib</a>[<a class="code" href="resultats__ajournes__par__centre_8php.html#28034c8e7e61c01855a789a9215d8acd">$cle</a>][<a class="code" href="resultats__ajournes__par__centre_8php.html#ea5d1e230cf3df250120025d801dc7c3">$cpt</a>]['candidat']=utf8_decode("$sexe &lt;b&gt;<a class="code" href="resultats__ajournes__par__centre_8php.html#c72f7055f1354a72cd1dcca5d9f1e121">$nom</a>&lt;/b&gt; $prenoms");
<a name="l00049"></a><a class="code" href="resultats__par__centre_8php.html#3acbb7c6d0935ae97acd9c427b309f87">00049</a>                 <a class="code" href="resultats__ajournes__par__centre_8php.html#46e38f8e36bb444e92ebeeaebd56cdba">$tDelib</a>[<a class="code" href="resultats__ajournes__par__centre_8php.html#28034c8e7e61c01855a789a9215d8acd">$cle</a>][<a class="code" href="resultats__ajournes__par__centre_8php.html#ea5d1e230cf3df250120025d801dc7c3">$cpt</a>]['etablissement']=utf8_decode($etablissement);
<a name="l00050"></a>00050                 if($delib==$delib1) $delib=ereg_replace("e$","&amp;<a class="code" href="inc-pdf-table_8php.html#1c3d7fb9d2f4e0216017175154061426">eacute</a>;",$delib1).$e;
<a name="l00051"></a><a class="code" href="resultats__par__centre_8php.html#f33de5b36b01c24dd1c225e545493b9d">00051</a>                 <a class="code" href="resultats__ajournes__par__centre_8php.html#46e38f8e36bb444e92ebeeaebd56cdba">$tDelib</a>[<a class="code" href="resultats__ajournes__par__centre_8php.html#28034c8e7e61c01855a789a9215d8acd">$cle</a>][<a class="code" href="resultats__ajournes__par__centre_8php.html#ea5d1e230cf3df250120025d801dc7c3">$cpt</a>]['delib']=html_entity_decode(utf8_decode($delib));
<a name="l00052"></a><a class="code" href="resultats__par__centre_8php.html#b3e2675b0afdb3efe38b3aae98bbf587">00052</a>                 <a class="code" href="resultats__ajournes__par__centre_8php.html#46e38f8e36bb444e92ebeeaebd56cdba">$tDelib</a>[<a class="code" href="resultats__ajournes__par__centre_8php.html#28034c8e7e61c01855a789a9215d8acd">$cle</a>][<a class="code" href="resultats__ajournes__par__centre_8php.html#ea5d1e230cf3df250120025d801dc7c3">$cpt</a>]['ddn']=utf8_decode($ddn);
<a name="l00053"></a>00053         }
<a name="l00054"></a>00054 
<a name="l00055"></a><a class="code" href="resultats__par__centre_8php.html#9e168f4152c267835864153c54449583">00055</a>         <a class="code" href="resultats__ajournes__par__centre_8php.html#9e168f4152c267835864153c54449583">$msg</a>.="&lt;table class='spip'&gt;\n";
<a name="l00056"></a><a class="code" href="resultats__par__centre_8php.html#d7ffa63e74542beba116bde88c6716b5">00056</a>         <a class="code" href="resultats__par__centre_8php.html#d7ffa63e74542beba116bde88c6716b5">$nom_pdf</a>=<a class="code" href="inc-html_8php.html#a99d47bed9e80456aaed4dc43d2fc0cc" title="rend une chaine compatible url-rewriting">getRewriteString</a>("Refus&amp;eacute;s centre $centre");
<a name="l00057"></a><a class="code" href="resultats__par__centre_8php.html#082ba331d3cc45e8443c96d1131d5599">00057</a>         <a class="code" href="resultats__ajournes__par__centre_8php.html#082ba331d3cc45e8443c96d1131d5599">$_SESSION</a>['cols'][<a class="code" href="resultats__par__centre_8php.html#d7ffa63e74542beba116bde88c6716b5">$nom_pdf</a>]=array('id_table'=&gt;html_entity_decode('Num&amp;eacute;ro table'),'serie'=&gt;html_entity_decode('S&amp;eacute;rie'),'candidat'=&gt;'Candidat','ddn'=&gt;'Date de naisssance','etablissement'=&gt;html_entity_decode('&amp;Eacute;tablissement'),'delib'=&gt;'Mention');
<a name="l00058"></a>00058         <span class="comment">//$_SESSION['format'][$nom_pdf]=array('taille'=&gt;'A3','orientation'=&gt;'portrait');</span>
<a name="l00059"></a><a class="code" href="resultats__par__centre_8php.html#176051c7cf4cbb94e61584ce2ca1c66e">00059</a>         <a class="code" href="resultats__ajournes__par__centre_8php.html#082ba331d3cc45e8443c96d1131d5599">$_SESSION</a>['options'][<a class="code" href="resultats__par__centre_8php.html#d7ffa63e74542beba116bde88c6716b5">$nom_pdf</a>]=<a class="code" href="odb__notes_8php.html#08287d6c1cec513971047d1fcf674a86">$PDF_A3_PAYSAGE</a>;
<a name="l00060"></a>00060    <span class="comment">//$_SESSION['options'][$nom_pdf]=$PDF_A4_PORTRAIT;</span>
<a name="l00061"></a>00061    <span class="comment">//$_SESSION['format'][$nom_pdf]=array('taille'=&gt;'A4', 'orientation'=&gt;'portrait');</span>
<a name="l00062"></a>00062         <span class="comment">//echo"tDelib&lt;pre&gt;";print_r($tDelib);echo"&lt;/pre&gt;";</span>
<a name="l00063"></a><a class="code" href="resultats__par__centre_8php.html#728789805f11b3c9d559ff71a0b73364">00063</a>         <a class="code" href="resultats__ajournes__par__centre_8php.html#082ba331d3cc45e8443c96d1131d5599">$_SESSION</a>['data'][<a class="code" href="resultats__par__centre_8php.html#d7ffa63e74542beba116bde88c6716b5">$nom_pdf</a>]=<a class="code" href="resultats__ajournes__par__centre_8php.html#46e38f8e36bb444e92ebeeaebd56cdba">$tDelib</a>['Admis'];
<a name="l00064"></a><a class="code" href="resultats__par__centre_8php.html#5c8a53679dc362674a7e845c316daed4">00064</a>         <a class="code" href="resultats__ajournes__par__centre_8php.html#082ba331d3cc45e8443c96d1131d5599">$_SESSION</a>['titre'][<a class="code" href="resultats__par__centre_8php.html#d7ffa63e74542beba116bde88c6716b5">$nom_pdf</a>]=html_entity_decode("Centre d'examen : $centre");
<a name="l00065"></a>00065         <span class="comment">//$_SESSION['post'][$nom_pdf]=html_entity_decode("Le pr&amp;eacute;sident du jury,");</span>
<a name="l00066"></a><a class="code" href="resultats__par__centre_8php.html#4e5bd75ba6d44a1723c3ec18c61cd09b">00066</a>         <a class="code" href="resultats__ajournes__par__centre_8php.html#4e5bd75ba6d44a1723c3ec18c61cd09b">$tmp1</a>="&lt;A HREF='../plugins/odb/odb_commun/inc-pdf-table.php?pdf=<a class="code" href="resultats__par__centre_8php.html#d7ffa63e74542beba116bde88c6716b5">$nom_pdf</a>' target='_BLANK'&gt;";
<a name="l00067"></a><a class="code" href="resultats__par__centre_8php.html#ed9bcb6730d1510376ce80e32bd9504d">00067</a>         <a class="code" href="resultats__ajournes__par__centre_8php.html#ed9bcb6730d1510376ce80e32bd9504d">$tmp2</a>="Centre d'examen : &lt;b&gt;$centre&lt;/b&gt;&lt;/A&gt;&lt;br/&gt;&lt;br/&gt;";
<a name="l00068"></a><a class="code" href="resultats__par__centre_8php.html#110fc80fcb224fbae884b1a3742c4924">00068</a>         <a class="code" href="resultats__ajournes__par__centre_8php.html#110fc80fcb224fbae884b1a3742c4924">$lien</a>=<a class="code" href="resultats__ajournes__par__centre_8php.html#4e5bd75ba6d44a1723c3ec18c61cd09b">$tmp1</a>.<a class="code" href="resultats__ajournes__par__centre_8php.html#ed9bcb6730d1510376ce80e32bd9504d">$tmp2</a>;
<a name="l00069"></a><a class="code" href="resultats__par__centre_8php.html#9e168f4152c267835864153c54449583">00069</a>         <a class="code" href="resultats__ajournes__par__centre_8php.html#9e168f4152c267835864153c54449583">$msg</a>.="&lt;tr&gt;&lt;td&gt;".<a class="code" href="inc-html_8php.html#fa7c9d548e547f5aa3b1a88df9ec970c" title="Affiche une vignette (icone de type de fichier).">vignette</a>('pdf',"Centre d'examen : $centre")."&lt;/td&gt;&lt;td colspan=2&gt;<a class="code" href="resultats__ajournes__par__centre_8php.html#110fc80fcb224fbae884b1a3742c4924">$lien</a>&lt;/td&gt;&lt;/tr&gt;\n";
<a name="l00070"></a><a class="code" href="resultats__par__centre_8php.html#9e168f4152c267835864153c54449583">00070</a>         <a class="code" href="resultats__ajournes__par__centre_8php.html#9e168f4152c267835864153c54449583">$msg</a>.="&lt;/table&gt;\n";
<a name="l00071"></a><a class="code" href="resultats__par__centre_8php.html#2daca62dbc7d40521fd822a1aa028538">00071</a> } <a class="code" href="odb__commun_2img__pack_2vignettes_2index_8php.html#0544c3fe466e421738dae463968b70ba">else</a> <a class="code" href="resultats__ajournes__par__centre_8php.html#9e168f4152c267835864153c54449583">$msg</a>="Veuillez choisir un centre avant de cliquer sur ce bouton";
<a name="l00072"></a>00072 ?&gt;
</pre></div><hr size="1"><address style="text-align: right;"><small>Généré le Mon Mar 17 22:53:01 2008 pour Siou par&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.3 </small></address>
</body>
</html>
