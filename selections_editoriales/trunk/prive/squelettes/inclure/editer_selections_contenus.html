<BOUCLE_selection(SELECTIONS){id_selection}{id_objet?}{objet?}>
#BOITE_OUVRIR{'',simple}
	[(#ENV{editer_selection}|=={oui}|oui)
		<h3 class="titrem"><a href="[(#ENV{id_selection}|generer_url_entite{selection})]"><:info_numero_abbreviation:>[(#ENV{id_selection})][(#ENV{vu}|=={oui}|oui)[(#CHEMIN_IMAGE{vu-16-10.png}|balise_img)]] - [(#INFO_TITRE{selection,#ENV{id_selection}}|sinon{<:ecrire:info_sans_titre:>})]</a></h3>
	]
	<div class="liste-items" id="editer_selections_contenus-#ID_SELECTION">
		<BOUCLE_contenus(SELECTIONS_CONTENUS){id_selection}{par rang}>
		<div class="item" id="selection#ID_SELECTION-contenu#ID_SELECTIONS_CONTENU" data-id_selections_contenu="#ID_SELECTIONS_CONTENU">
			[(#CONFIG{activer_logos}|=={oui}|oui)
				[<a class="ajax" title="<:info_telecharger_nouveau_logo|trim{:}:>" href="[(#SELF|parametre_url{editer_contenu,''}|parametre_url{editer_contenu_logo,#ENV{editer_contenu_logo}|=={#ID_SELECTIONS_CONTENU}|?{non,#ID_SELECTIONS_CONTENU}})]">(#LOGO_SELECTIONS_CONTENU|sinon{#CHEMIN{prive/images/rayures-gris.gif}}|image_reduire{60,60}|inserer_attribut{alt,<:info_telecharger_nouveau_logo|trim{:}:>}|inserer_attribut{class,spip_documents_left})</a>]
			]
			<h4 class="titrem"><span class="#EDIT{titre}"><a href="#URL">#TITRE</a></span></h4>
			<div class="descriptif #EDIT{descriptif}">#DESCRIPTIF</div>
			[(#ENV{editer_contenu,non}|=={non}|oui)
			<div class="actions">
				[(#AUTORISER{supprimer,selections_contenu,#ID_SELECTIONS_CONTENU}|oui)
					[(#BOUTON_ACTION{<:lien_supprimer:>, #URL_ACTION_AUTEUR{supprimer_selections_contenu,#ID_SELECTIONS_CONTENU,#SELF}, link ajax todo})]
				]
				
				[(#AUTORISER{modifier,selections_contenu,#ID_SELECTIONS_CONTENU}|oui)
					<a class="ajax" href="[(#SELF|parametre_url{editer_contenu_logo,''}|parametre_url{editer_contenu,#ID_SELECTIONS_CONTENU})]"><:bouton_modifier:></a>
					[(#BOUTON_ACTION{
						[(#CHEMIN_IMAGE{rang_haut-16.png}|balise_img{<:selections_contenu:deplacer_avant:>})],
						#URL_ACTION_AUTEUR{deplacer_selections_contenu, #ID_SELECTIONS_CONTENU-haut, #SELF},
						ajax link
					})]
					[(#BOUTON_ACTION{
						[(#CHEMIN_IMAGE{rang_bas-16.png}|balise_img{<:selections_contenu:deplacer_apres:>})],
						#URL_ACTION_AUTEUR{deplacer_selections_contenu, #ID_SELECTIONS_CONTENU-bas, #SELF},
						ajax link
					})]
					[(#CHEMIN_IMAGE{rang_deplacer-16.png}|balise_img{<:selections_contenu:deplacer:>, deplacer})]
				]
			</div>
			]
			[(#ENV{editer_contenu}|=={#ID_SELECTIONS_CONTENU}|et{#AUTORISER{modifier,selections_contenu,#ID_SELECTIONS_CONTENU}})
			<div class="ajax">
				#FORMULAIRE_EDITER_SELECTIONS_CONTENU{#ID_SELECTIONS_CONTENU}
			</div>
			]
			[(#ENV{editer_contenu_logo}|=={#ID_SELECTIONS_CONTENU}|et{#AUTORISER{modifier,selections_contenu,#ID_SELECTIONS_CONTENU}})
			<div class="ajax">
				#FORMULAIRE_EDITER_LOGO{selections_contenu,#ID_SELECTIONS_CONTENU}
			</div>
			]
		</div>
		</BOUCLE_contenus>
		<div class="item"><:selections_contenu:info_aucun_selections_contenu:></div>
		<//B_contenus>
		[(#ENV{editer_contenu}|=={new}|et{#ENV{id_section_contenu}|=={#ID_SELECTION}}||et{#AUTORISER{creerselectionscontenudans,selection,#ENV{id_selection}}})
		<div class="ajax">
			#FORMULAIRE_EDITER_SELECTIONS_CONTENU{new,#ID_SELECTION}
		</div>]
	</div>

	[(#ENV{editer_contenu,non}|=={non}|ou{#ENV{editer_contenu,non}|=={new}|et{#ENV{id_section_contenu}|!={#ID_SELECTION}}}|et{#AUTORISER{creerselectionscontenudans,selection,#ENV{id_selection}}})
	#BOITE_PIED{act}
	[(#AUTORISER{supprimer,selection,#ID_SELECTION}|oui)[(#BOUTON_ACTION{<:selection:bouton_supprimer_selection:>,#URL_ACTION_AUTEUR{supprimer_selection,#ID_SELECTION,#SELF},ajax})]]
	[(#AUTORISER{dissocierselections,#OBJET,#ID_OBJET}|et{#ENV{vu}|=={non}}|oui)[(#BOUTON_ACTION{<:selection:bouton_enlever_selection:>,#URL_ACTION_AUTEUR{dissocier_selection,#ID_OBJET-#OBJET-#ID_SELECTION--safe,#SELF},ajax})]]
	<a class="ajax" href="[(#SELF|parametre_url{id_section_contenu,#ID_SELECTION}|parametre_url{editer_contenu,new}|ancre_url{editer_selections_contenus-[(#ID_SELECTION)]})]"><:selections_contenu:texte_ajouter_selections_contenu:></a>
	]
#BOITE_FERMER

<script type="text/javascript">
/*<![CDATA[*/
;(function($){
	$(function(){
		$('#editer_selections_contenus-#ID_SELECTION').sortable({
			items : '.item',
			handle : '.deplacer',
			cursor : 'move',
			axis : 'y'
		});
		
		$('#editer_selections_contenus-#ID_SELECTION').on('sortupdate', function(event, ui) {
			// URL de base de l'action
			var url_action = '[(#VAL{deplacer_selections_contenu}|generer_url_action{"", 1})]';
			// On récupère l'identifiant du contenu qui a bougé
			var id_contenu = ui.item.data('id_selections_contenu');
			// On calcule le rang où il arrive à la fin
			var rang = ui.item.index() + 1;
			
			// URL finale
			url_action = parametre_url(url_action, 'arg', id_contenu + '-' + rang)
			
			//console.log(url_action);
			
			var request = $.ajax({
				type: 'POST',
				url: url_action
			});
			request.done(function() {
				$('#editer_selections_contenus-#ID_SELECTION').ajaxReload();
			});
		});
	});
})(jQuery);
/*]]>*/
</script>
</BOUCLE_selection>
