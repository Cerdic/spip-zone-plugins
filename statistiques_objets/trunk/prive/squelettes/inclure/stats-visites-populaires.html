[(#REM)

	Surcharge : prise en compte des différents objets éditoriaux

	Notes :
	Certaines balises ne pouvant être utilisées dans une boucle DATA, on les émule :
	- \#POPULARITE_ABSOLUE : on applique ceil à la popularite
	- \#EXPOSE : avec une balise conditionnelle

	Le squelette appelant ne transmet pas l'env, donc on récupère les variables nécessaires avec _request

	Inclus dans :
	- prive/squelettes/contenu/stats_visites.html

]

[(#REM) onglet des objets ]
#SET{objets,#ARRAY}
<BOUCLE_menu_articles(visites_articles){0,1}>#SET{objets,#GET{objets}|push{article}}</BOUCLE_menu_articles>
<BOUCLE_menu_objets(visites_objets){fusion objet}>#SET{objets,#GET{objets}|push{#OBJET}}</BOUCLE_menu_objets>
#SET{objet,#VAL{objet}|_request|sinon{#VAL{id_article}|_request|?{article}}|sinon{#GET{objets/0}}}
#SET{id_objet,#VAL{id_objet}|_request}
#SET{id_table_objet, #GET{objet}|id_table_objet}
#SET{table_objet_sql,#GET{objet}|table_objet_sql}
#SET{champ_titre,#GET{objet}|objet_info{titre}}

<div class="onglets_simple clearfix">
	<ul>
		<BOUCLE_menu(DATA){source table, #GET{objets}}>
		<li>[(#SELF|parametre_url{objet,#VALEUR}|parametre_url{id_article|id_objet,''}|lien_ou_expose{[(#VALEUR|objet_icone{16}) ][(#VALEUR|objet_info{texte_objets}|_T)],#VALEUR|=={#GET{objet}},ajax})]</li>
		</BOUCLE_menu>
	</ul>
</div>

#BOITE_OUVRIR{'','note'}
<div class="stats-articles">

	<div class="unit size1of2">

		[(#REM) les plus populaires ]
		#SET{c,#GET{objet}|classement_populaires}
		[(#SET{req_pluspop,SELECT [(#GET{id_table_objet}),visites,popularite][,(#GET{champ_titre})] FROM [(#GET{table_objet_sql})] WHERE [(#GET{id_table_objet})] IN \([(#GET{c}|join{','})]\)})]
		#SET{ids_pluspop,#ARRAY}
		<p><:statistiques:info_visites_objets_plus_populaires:></p>
		<B_pluspop>
		<ol class="classement">
			<BOUCLE_pluspop(DATA){source sql, #GET{req_pluspop}}>
				#SET{ids_pluspop,#GET{ids_pluspop}|push{#VALEUR{#GET{id_table_objet}}}}
				#SET{popularite,#VALEUR{popularite}|ceil}
				<li[ (#GET{id_objet}|=={#VALEUR{#GET{id_table_objet}}}|?{class="on"})]>
					<a
						href="[(#SELF|parametre_url{id_objet,#VALEUR{#GET{id_table_objet}}})]#contenu" class="ajax"
						title="<:statistiques:info_popularite_3{visites=#VALEUR{visites},popularite=#GET{popularite}}|attribut_html:>">
						#VALEUR{titre}
					</a>
				</li>
			</BOUCLE_pluspop>
		</ol>

		[(#REM) les 10 derniers visités ]
		[(#SET{req_derniers,SELECT [(#GET{id_table_objet}),date,visites,popularite][,(#GET{champ_titre})] FROM [(#GET{table_objet_sql})] WHERE popularite>0 AND [(#GET{id_table_objet})] NOT IN \([(#GET{ids_pluspop}|join{','})]\) RDER BY date DESC LIMIT [(#VAL{'0,10'})]})]
		<B_derniers>
			<p class="center">[...]</p>
			<p><:statistiques:info_visites_objets_derniers:></p>
			<ol class='classement'>
				<BOUCLE_derniers(DATA){source sql, #GET{req_derniers}}>
				#SET{popularite,#VALEUR{popularite}|ceil}
				<li[ (#GET{id_objet}|=={#VALEUR{#GET{id_table_objet}}}|?{class="on"})]>
					<a
						href="[(#SELF|parametre_url{id_objet,#VALEUR{#GET{id_table_objet}}})]#contenu" class="ajax"
						title="<:statistiques:info_popularite_3{visites=#VALEUR{visites},popularite=#GET{popularite}}|attribut_html:>">
						#VALEUR{titre}
					</a>
				</li>
			</BOUCLE_derniers>
			</ol>
		</B_derniers>
		</B_pluspop>
	</div>

	[(#REM) les 30 plus visités depuis le début ]
	<div class="unit lastUnit">
		<p><:statistiques:info_afficher_visites_objets_plus_visites:></p>
		#SET{c,#GET{objet}|classement_populaires}
		[(#SET{req_plusvisites,SELECT [(#GET{id_table_objet}),visites,popularite][,(#GET{champ_titre})] FROM [(#GET{table_objet_sql})] WHERE popularite>0 AND [(#GET{id_table_objet})] IN \([(#GET{c}|join{','})]\) ORDER BY visites DESC LIMIT [(#VAL{'0,30'})]})]
		<ol class='classement'>
			<BOUCLE_plusvisites(DATA){source sql, #GET{req_plusvisites}}>
			#SET{popularite,#VALEUR{popularite}|ceil}
				<li value="[(#VALEUR{#GET{id_table_objet}}|array_search{#GET{c}}|plus{1})]"[ (#GET{id_objet}|=={#VALEUR{#GET{id_table_objet}}}|?{class="on"})]><a href="[(#SELF|parametre_url{id_objet,#VALEUR{#GET{id_table_objet}}})]#contenu" class="ajax"
							title="<:statistiques:info_popularite_3{visites=#VALEUR{visites},popularite=#GET{popularite}}|attribut_html:>">#TITRE</a></li>
			</BOUCLE_plusvisites>
		</ol>

		<br class="nettoyeur" />
		<hr />
		<h4><:statistiques:info_comment_lire_tableau:></h4>
		<p><:statistiques:texte_comment_lire_tableau:></p>
	</div>
	
</div>
#BOITE_FERMER
