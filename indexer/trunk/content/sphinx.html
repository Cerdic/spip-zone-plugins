
<h1>Test SPHINX</h1>

[(#FORMULAIRE_RECHERCHE{#SELF})]


<aside class="tri">
	[(#ENV{order}|match{date}|?{
		[(#SET{order,date DESC})]
		résultats triés par date
	})]
	<div>
	[(#GET{order}|?{
		<a href="[(#SELF|parametre_url{order,''})]">trier par pertinence</a>
	,
		<a href="[(#SELF|parametre_url{order,date})]">trier par date</a>
	})]
	</div>
</aside>


<B_filtres>
<h4>Filtres:</h4>
<BOUCLE_filtres(DATA){liste auteur,tag,annee}>[
	<div>
		<a class="btn btn-mini" href="[(#SELF|parametre_url{#VALEUR,''})]"><i class="icon-remove"></i> (#ENV{#VALEUR})</a>
	</div>
]</BOUCLE_filtres>


<!--
	{filtre auteurs, properties.authors, ALL, #ENV*{auteur}}
	{filtre tags, properties.mots.fr, IN, #ENV*{auteur}}

	{mono #ENV{date}, date, =}
	{mono #ENV{date}, date, >}
	{mono #ENV{date}, date, IN}
	{mono #ENV{date}, date, INTERVAL, 100, 200, 300}

	{filtres #ENV*{f}} => tableau ? f[auteurs][description...]
-->

<BOUCLE_recherche_sphinx(SPHINX)
	{recherche #ENV*{recherche}}

	{facet auteurs, properties.authors ORDER BY COUNT(*) DESC}
	{facet tags, properties.tags ORDER BY COUNT(*) DESC}
	{facet date, YEAR(date) ORDER BY date DESC}
>

	<h1>Dans la boucle (SPHINX)</h1>
	<pre>#QUERY</pre>

	[(#INCLURE{fond=liste/sphinx_documents,docs,meta,env})]
	[(#INCLURE{fond=liste/sphinx_facettes,facets,env})]
	[(#INCLURE{fond=liste/sphinx_metas,meta,env})]

</BOUCLE_recherche_sphinx>

<hr />


[(#SET{sql, [(#ENV{source,''}|sphinx_get_query_documents{#ENV*{recherche},#ENV*{tag},#ENV*{auteur},#ENV{annee},#GET{order}})]})]

<BOUCLE_recherche(DATA) {source SphinxQL, #GET{sql}, #ENV{debut_documents}}>

	<h1>Dans la boucle oldschool</h1>
	<pre>#QUERY</pre>

	[(#INCLURE{fond=liste/sphinx_documents,docs,meta,env})]
	[(#INCLURE{fond=liste/sphinx_facettes,facets,env})]
	[(#INCLURE{fond=liste/sphinx_metas,meta,env})]

</BOUCLE_recherche>


