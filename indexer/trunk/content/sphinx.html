
<h1>Test SPHINX</h1>

[(#FORMULAIRE_RECHERCHE{#SELF})]



<aside class="tri">
	[(#ENV{order}|match{date}|?{
		[(#SET{order,date DESC})]
		résultats triés par date
	})]
	<div>
	[(#GET{order}|?{
		<a href="[(#SELF|parametre_url{order,''})]">trier par pertinence</a>
	,
		<a href="[(#SELF|parametre_url{order,date})]">trier par date</a>
	})]
	</div>
</aside>


[(#SET{sql, [(#ENV{source,spip}|sphinx_get_query_documents{#ENV*{recherche},#ENV*{tag},#ENV*{auteur},#ENV{annee},#GET{order}})]})]

<B_filtres>
<h4>Filtres:</h4>
<BOUCLE_filtres(DATA){liste auteur,tag,annee}>[
	<div><a href="[(#SELF|parametre_url{[(#VALEUR)],''})]">x</a> (#ENV{#VALEUR})</div>
]</BOUCLE_filtres>

<BOUCLE_recherche(DATA) {source SphinxQL, #GET{sql}, #ENV{debut_documents}}>

    <B_documents>
        <h2>Liste des documents trouvés</h2>
    [<p class="pagination">(#DEBUT_DOCUMENTS|?{#PAGINATION,#ANCRE_PAGINATION})</p>]
        <dl>
    <BOUCLE_documents(DATA){source tableau, #VALEUR}{si #CLE|=={docs}}
    {pagination 10}>
            [<dt>#SCORE <a href="[(#URI)]">(#TITLE)</a>
             [<small>(#DATE|affdate_court)</small>]
            </dt>
             [<dd>(#SNIPPET|sinon{#SUMMARY})</dd>]
            ]
    </BOUCLE_documents>
        </dl>
    [<p class="pagination">(#PAGINATION)</p>]
    </B_documents>


    <B_meta>
        <h2>Métas associées</h2>
        <dl>
    <BOUCLE_meta(DATA){source tableau, #VALEUR}{si #CLE|=={meta}}>
            [<dt>(#CLE)</dt>]
            [<dt><pre>(#VALEUR*|print_r{1})</pre></dt>]
    </BOUCLE_meta>
        </dl>
    </B_meta>



    <B_facettes>
        <h2>Facettes associées</h2>
    <BOUCLE_facettes(DATA){source tableau, #VALEUR}{si #CLE|=={facets}}>
        <h3>#CLE</h3>
        <div class='liste'>
            <ul class='liste-items'>
        <BOUCLE_liste_facettes(DATA){source tableau, #VALEUR}>
                <li class='item'>#CLE \(#VALEUR\)</li>
        </BOUCLE_liste_facettes>
            </ul>
        </div>
    </BOUCLE_facettes>
    </B_facettes>
</BOUCLE_recherche>


Debug: <pre>#GET{sql}</pre>

