
<h1>Test SPHINX</h1>

[(#FORMULAIRE_RECHERCHE{#SELF})]



<aside class="tri">
	[(#ENV{order}|match{date}|?{
		[(#SET{order,date DESC})]
		résultats triés par date
	})]
	<div>
	[(#GET{order}|?{
		<a href="[(#SELF|parametre_url{order,''})]">trier par pertinence</a>
	,
		<a href="[(#SELF|parametre_url{order,date})]">trier par date</a>
	})]
	</div>
</aside>


[(#SET{sql, [(#ENV{source,spip}|sphinx_get_query_documents{#ENV*{recherche},#ENV*{tag},#ENV*{auteur},#ENV{annee},#GET{order}})]})]

<B_filtres>
<h4>Filtres:</h4>
<BOUCLE_filtres(DATA){liste auteur,tag,annee}>[
	<div>
		<a class="btn btn-mini" href="[(#SELF|parametre_url{#VALEUR,''})]"><i class="icon-remove"></i> (#ENV{#VALEUR})</a>
	</div>
]</BOUCLE_filtres>



<BOUCLE_recherche(DATA) {source SphinxQL, #GET{sql}, #ENV{debut_documents}}>

	<B_documents>
		<h2>Documents trouvés</h2>
		<small>
		[(#VALEUR{meta/total_found}) ]résultats \([(#VALEUR{meta/time}|mult{1000})] ms\)
		</small>

		<div class='liste long resultats'>
			[<div class="pagination">(#DEBUT_DOCUMENTS|?{#PAGINATION,#ANCRE_PAGINATION})</div>]
			<ul class='liste-items'>
	<BOUCLE_documents(DATA){source tableau, #DOCS}{pagination 10}>
				[(#SET{properties,#PROPERTIES|json_decode})]
				<li class='item'>
					<article class='entry article hentry'>
						<strong class='h3-like entry-title'>#SCORE <a href="#URI">#TITLE</a></strong>
						<p class="publication">
							[<time pubdate="pubdate" datetime="[(#DATE|date_iso)]">(#DATE|affdate_jourcourt)</time>][<span class="authors"><span class="sep">, </span> <:par_auteur:> (#GET{properties/authors}|implode{', '})</span>]
						</p>
						[<div class="introduction entry-content">(#SNIPPET|sinon{#SUMMARY})</div>]
					</article>
				</li>
	</BOUCLE_documents>
			</ul>
		</div>
	[<div class="pagination">(#PAGINATION)</div>]
	</B_documents>



	<B_facettes>
		<h2>Facettes associées</h2>
		<div class='row-fluid'>
	<BOUCLE_facettes(DATA){source tableau, #FACETS}>
		<div class='span4'>
			<h3>#CLE</h3>
			<div class='liste'>
				<ul class='liste-items'>
			<BOUCLE_liste_facettes(DATA){source tableau, #VALEUR}>
					<li class='item'>#CLE \(#VALEUR\)</li>
			</BOUCLE_liste_facettes>
				</ul>
			</div>
		</div>
	</BOUCLE_facettes>
		</div>
	</B_facettes>


	<B_meta>
		<h2>Métas associées</h2>
		<dl>
	<BOUCLE_meta(DATA){source tableau, #META}>
			[<dt>(#CLE)</dt>]
			[<dt><pre>(#VALEUR*|print_r{1})</pre></dt>]
	</BOUCLE_meta>
		</dl>
	</B_meta>


</BOUCLE_recherche>


<h2>Debug:</h2>
<pre>#GET{sql}</pre>

