<h1>Test de l'indexer</h1>

<?php

include_spip('inc/indexer');

$indexer = new Indexer\Indexer();

$indexer->registerStorage(
    new Indexer\Storage\Sphinx(
        new Sphinx\SphinxQL(SPHINX_SERVER_HOST, SPHINX_SERVER_PORT), SPHINX_DEFAULT_INDEX)
);


$sources = new Indexer\Sources\Sources();
$sources->register('articles', new Spip\Indexer\Sources\Articles());
$sources = pipeline('indexer_sources', $sources);

$SpipSourcesIndexer = new Spip\Indexer\Sources\SpipSourcesIndexer($indexer, $sources);
$SpipSourcesIndexer->setTablesLiensAuto();

$res = $SpipSourcesIndexer->indexAll();

if (!$res) {
    echo "\n<br/><a href='#SELF'>Recharger la page pour continuer l'indexation</a>";
    echo "<script type='text/javascript'>window.location.reload();</script>";
} else {
    echo "\n<pre>"; print_r($res); echo "</pre>";
}

