<h1>Test SPHINX</h1>

[(#FORMULAIRE_RECHERCHE{#SELF})]

<?php
/*
include_spip('inc/indexer');
$sphinx = new Sphinx\SphinxQL(SPHINX_SERVER_HOST, SPHINX_SERVER_PORT);

echo '<pre>';
print_r($sphinx->allfetsel('SELECT titre FROM spip WHERE MATCH(\'Paris Brest\') LIMIT 10'));
echo '</pre>';
*/

?>

[(#SET{sql,"SELECT *, SNIPPET(content,"[(#ENV*{recherche}|_q|concat{","})]'limit=200') as snippet FROM [(#ENV{source,spip})] WHERE MATCH([(#ENV*{recherche}|_q)]) LIMIT 10})]

<pre>[(#GET{sql}|htmlspecialchars)]</pre>


<BOUCLE_recherche(DATA) {source SphinxQL, #GET{sql}} {si #ENV{recherche}}>

        <B_documents>
            <h2>Liste des documents trouvés</h2>
            <dl>
        <BOUCLE_documents(DATA){source tableau, #VALEUR}{si #CLE|=={docs}}>
                [<dt><a href="[(#URI)]">(#TITLE)</a></dt>
                <dd>#SNIPPET</dd>]
        </BOUCLE_documents>
            </dl>
        </B_documents>


        <B_meta>
            <h2>Métas associées</h2>
            <dl>
        <BOUCLE_meta(DATA){source tableau, #VALEUR}{si #CLE|=={meta}}>
                [<dt>(#CLE)</dt>]
                [<dt><pre>(#VALEUR**|print_r{1})</pre></dt>]
        </BOUCLE_meta>
            </dl>
        </B_meta>



</BOUCLE_recherche>



