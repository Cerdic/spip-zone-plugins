#HTTP_HEADER{Content-Type: text/javascript}

;if(window.jQuery) (function($){

$(document).ready(function(){

dessiner_repere = function($id, $position, $distance, $couleur) {
	$ou = 'top';
	if ($position == 'vertical') { $ou = 'left'; }
 return '<div id="repere_h_' + $id + '" class="invisible trait ' + $position + '" style="' + $ou +' :' + $distance + 'px; border-color:' + $couleur + '">' + 
			'<span class="repere">Rep. ' + $id + '</span>' + 
		'</div>';
}

$.get('#URL_ACTION_AUTEUR{reperes}', function(data) {
	if (data) {
		$('[(#CONFIG{reperes/calque/selecteur})]').[(#CONFIG{reperes/calque/position})]('<div id="reperes"></div>');

		$reperes = $('#reperes');
		console.log(data);
		if (typeof(data.horizontal) != 'undefined') {
			$.each(data.horizontal, function(key, def) {
				if (def) {
					$reperes.append(dessiner_repere(key, 'horizontal', def.distance, def.couleur));
				}
			});
		}

		if (typeof(data.vertical) != 'undefined') {
			$.each(data.vertical, function(key, def) {
				if (def) {
					$reperes.append(dessiner_repere(key, 'vertical', def.distance, def.couleur));
				}
			});
		}
		
		$('#reperes .horizontal').draggable({
			axis: 'y',
			cursor: 'row-resize',
			stop: function(event, ui) { $.post('#URL_ACTION_AUTEUR{reperes}', {
				 id: event.target.id.substring(9),
				 type: 'horizontal',
				 valeur: event.target.offsetTop,
				 couleur: '#ff3300' });
			 }
		});
		
		$('#reperes .vertical').draggable({
			axis: 'x',
			cursor: 'col-resize',
			stop: function(event, ui) { $.post('#URL_ACTION_AUTEUR{reperes}', {
				 id: event.target.id.substring(9),
				 type: 'vertical',
				 valeur: event.target.offsetLeft,
				 couleur: '#33ff00' });
			 }
		});
	}
});


});
})(jQuery);



