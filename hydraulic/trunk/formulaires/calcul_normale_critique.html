[<div class='hyd_formulaire_erreur '><span>(#ENV*{message_erreur})</span></div>]
<script language="javascript" type="text/javascript" src="#CHEMIN{js/hyd_fonctions.js}"></script>
<script language="javascript" type="text/javascript" src="#CHEMIN{js/jquery.svg.js}"></script>
<script language="javascript" type="text/javascript" src="#CHEMIN{js/jquery.drawinglibrary.js}"></script>
		
<script>
function elementsParClasse(classe, tagName){
	var divs = document.getElementsByTagName(tagName);
    var resultats = new Array();
    for(var i=0; i<divs.length; i++){
		if(divs[i].className == classe){
			resultats.push(divs[i]);
        }
    }
    return resultats;	
}

var globSelectSection = 'FT';

function setVarGlob(){
	globSelectSection = getSelectValue('choix_section');
}

function resetAffichageChamps(nom){
	setVarGlob();
	if(nom){
		var cacher = elementsParClasse('champs_var_'+nom, 'tr');
		for(var i in cacher){
			cacher[i].style.display='none';
		}
	}
	else{
		var tab = new Array();
		<BOUCLE_remplissageTab1(POUR){tableau #ENV{mes_saisies}}>
			#SET{field1, #CLE}
			<BOUCLE_remplissageTab2(POUR){tableau (#VALEUR|table_valeur{1})}>
				<BOUCLE_afficheSiSection(CONDITION){si #GET{field1}|substr{0,1}|== {'F'}}>
					tab.push('#GET{field1}_[(#CLE)]');
				</BOUCLE_afficheSiSection>
			</BOUCLE_remplissageTab2>
		</BOUCLE_remplissageTab1>
		
		for(var i in tab){
			if(document.getElementById('varier_val_'+tab[i]).checked){
				document.getElementById('val_a_cal_field_nc').style.display='none';
				document.getElementById('val_a_cal_nc').style.display='none';
			}
			
			document.getElementById('val_fixe_'+tab[i]).checked=true;
			document.getElementById('caract_'+tab[i]).disabled=false;
			var cacher = elementsParClasse('champs_var_'+tab[i], 'tr');
			for(var i in cacher){
				cacher[i].style.display='none';
			}
		}

	}
}

//Permet d'afficher ou cacher les champs correspondant Ã  une section.
function afficher_cacher() {
	resetAffichageChamps();
	var section = getSelectValue('choix_section');
    var f = document.getElementById("form_normale_critique");
    if(f) {
		var champs = f.getElementsByTagName("tr");
		for(var i=0, n=champs.length; i<n; i++) {    
			if((champs[i].getAttribute("id") != null) &&((champs[i].getAttribute("id")).substr(0,2) == section)){
				document.getElementById((champs[i].getAttribute("id"))).style.display='table-row';
			}
			else if((champs[i].getAttribute("id") != null) &&((champs[i].getAttribute("id")).substr(0,1) == 'F')) {
				document.getElementById((champs[i].getAttribute("id"))).style.display='none';
			}		
		}
    }  	
}

function gestion_radios(nom, valeur){
	setVarGlob();	
	var tabPartiel = new Array();
	<BOUCLE_remplissageTabPartiel1(POUR){tableau #ENV{mes_saisies}}>
		#SET{field2, #CLE}
		#SET{test, #VALEUR|table_valeur{1}}

		<BOUCLE_conditionSection(CONDITION){si #CLE|substr{0,1}|== {'F'}}>
			if(globSelectSection == '#CLE'){
				
				<BOUCLE_remplissageTabPartiel2(POUR){tableau #GET{test}}>
					tabPartiel.push('#GET{field2}_[(#CLE)]');
				</BOUCLE_remplissageTabPartiel2>
			}		
		</BOUCLE_conditionSection>
			<BOUCLE_remplissageTabPartiel3(POUR){tableau (#VALEUR|table_valeur{1})}>
				tabPartiel.push('#GET{field2}_[(#CLE)]');
			</BOUCLE_remplissageTabPartiel3>
		<//B_conditionSection>
	</BOUCLE_remplissageTabPartiel1>
	
	for(var i in tabPartiel){
		if(tabPartiel[i] == nom){
			delete(tabPartiel[i]);
		} 
	}
		
	if(valeur.substr(0,3) == 'var'){
		for(var cle in tabPartiel){
			if(document.getElementById('varier_val_'+tabPartiel[cle]).checked){
				document.getElementById('val_fixe_'+tabPartiel[cle]).checked=true;
				document.getElementById('caract_'+tabPartiel[cle]).disabled=false;	
				document.getElementById('caract_'+nom).disabled=true;	
				resetAffichageChamps(tabPartiel[cle]);	
			}	
		}
		document.getElementById('val_a_cal_field_nc').style.display='table-row';
		document.getElementById('val_a_cal_nc').style.display='table-row';
		document.getElementById('caract_'+nom).disabled=true;	
		var afficher = elementsParClasse('champs_var_'+nom, 'tr');
		for(var i in afficher){
			afficher[i].style.display='table-row';
		}	
	}

	if(valeur.substr(0,3) == 'val'){
		var CptValVar = 0;
		for(var cle in tabPartiel){
			if(document.getElementById('varier_val_'+tabPartiel[cle]).checked){
				CptValVar++;
			}
		}
		if(CptValVar == 0){
			document.getElementById('val_a_cal_field_nc').style.display='none';
			document.getElementById('val_a_cal_nc').style.display='none';
		}
	
		document.getElementById('caract_'+nom).disabled=false;	
		resetAffichageChamps(nom);
	}

}
</script>
<form method="post" action="#ENV{action}" id="form_normale_critique">
   #ACTION_FORMULAIRE{#ENV{action}}
   <table class="hyd_formulaire">
      <tbody>
		  	<tr id="type_section_field_nc">
				<td colspan="4"><div class="hyd_formulaire_chapitre"><:hydraulic:type_section:></div></td>
			</tr>

			<tr id="type_section_nc">
				<td align="right" width="30%">
					<:hydraulic:choix_section:> :
				</td>
				
				<td colspan="3" width="70%">
					<select name="ncTypeSection" id="choix_section" onChange="afficher_cacher();">
					<BOUCLE_selectOptions(POUR){tableau #ENV{mes_saisies}}>	
						#SET{test, #VALEUR|table_valeur{0}|decoupeIdSection}
						<BOUCLE_choixSection(CONDITION){si #CLE|substr{0,1}|== {'F'}}>
							<option value="#CLE" [(#ENV{ncTypeSection}|=={#CLE}|?{'selected',''})]>#GET{test}</option>
						</BOUCLE_choixSection>
					</BOUCLE_selectOptions>
					</select>
		  
					[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{[(#VALEUR|table_valeur{0})]})</div>]
				</td>	
			</tr>

	<BOUCLE_fieldChamps(POUR){tableau #ENV{mes_saisies}}>
			#SET{id_fieldset, #CLE}
			
			<tr id="#GET{id_fieldset}_field" style="display:[(#CLE|match{^([(#ENV{ncTypeSection})]|Cr)$}|?{'table-row','none'})];">				
				<td colspan="4"><div class="hyd_formulaire_chapitre">[(#VALEUR|table_valeur{0}|traduction_hydraulic)]</div></td>
			</tr>
			
		<BOUCLE_affichageParamCal(CONDITION){si #GET{id_fieldset}|!== {'Cr'}}>
			<tr id="#GET{id_fieldset}_optionCal_nc" style="display:[(#CLE|match{^([(#ENV{ncTypeSection})]|Cr)$}|?{'table-row','none'})];">
				<td colspan="2"></td>
				<td align="center"><:hydraulic:varier_val:></td>
				<td align="center"><:hydraulic:fixer_val:></td>
			</tr>
		</BOUCLE_affichageParamCal>


		<BOUCLE_champsLib(POUR){tableau (#VALEUR|table_valeur{1})}>
			#SET{clefield, #GET{id_fieldset}|concat{_, #CLE}}

			<tr id="#GET{clefield}" style="display:[(#GET{id_fieldset}|match{^([(#ENV{ncTypeSection})]|Cr)$}|?{'table-row','none'})];">
				<td align="right"> 
					[(#VALEUR|table_valeur{0}|traduction_hydraulic)] :
				</td>

				<td>
					<input id="caract_#GET{clefield}" type="text" value="[(#ENV{#GET{clefield}})]" maxlength="30" name="#GET{clefield}" [(#ENV{choix_champs_#GET{clefield}}|=={varier_val_#GET{clefield}}|?{'disabled="true"',''})]/>
					[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{#GET{clefield}})</div>]
				</td>
			
				<BOUCLE_val_var_existe(CONDITION){si #ENV{choix_champs_#GET{clefield}}|== {varier_val_#GET{clefield}}}>
					#SET{val_var, #CLE}	                                                
				</BOUCLE_val_var_existe>

				<td align="center">
					<input type="radio" id="varier_val_#GET{clefield}" name="choix_champs_#GET{clefield}" value="varier_val_#GET{clefield}" onclick="gestion_radios('#GET{clefield}', 'varier_val_#GET{clefield}')" [(#ENV{choix_champs_#GET{clefield}}|=={varier_val_#GET{clefield}}|?{'checked',''})]/>
				</td>	
					
				<td align="center">
					<input type="radio" id="val_fixe_#GET{clefield}" name="choix_champs_#GET{clefield}" value="val_fixe_#GET{clefield}" onclick="gestion_radios('#GET{clefield}', 'val_fixe_#GET{clefield}')" [(#ENV{choix_champs_#GET{clefield}}|=={val_fixe_#GET{clefield}}|?{'checked',''})]/>
				</td>
			</tr>
			
			<tr class="champs_var_#GET{clefield}"  style="display:[(#ENV{choix_champs_#GET{clefield}}|=={varier_val_#GET{clefield}}|?{'table-row','none'})];">
				<td colspan="2" align="right"><:hydraulic:val_min:> : </td>
				<td colspan="2">
					<input name="val_min_#GET{clefield}" type="text" value="[(#ENV{val_min_#GET{clefield}})]"/>
					[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{val_min_#GET{clefield}})</div>]
				</td>
			</tr>
						
			<tr class="champs_var_#GET{clefield}" style="display:[(#ENV{choix_champs_#GET{clefield}}|=={varier_val_#GET{clefield}}|?{'table-row','none'})];">
				<td colspan="2" align="right"><:hydraulic:val_max:> : </td>
				<td colspan="2">
					<input name="val_max_#GET{clefield}" type="text" value="[(#ENV{val_max_#GET{clefield}})]"/>
					[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{val_max_#GET{clefield}})</div>]
				</td>
			</tr>
			
			<tr class="champs_var_#GET{clefield}" style="display:[(#ENV{choix_champs_#GET{clefield}}|=={varier_val_#GET{clefield}}|?{'table-row','none'})];">
				<td colspan="2" align="right"><:hydraulic:pas_var:> : </td>
				<td colspan="2">
					<input name="pas_var_#GET{clefield}" type="text" value="[(#ENV{pas_var_#GET{clefield}})]"/>
					[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{pas_var_#GET{clefield}})</div>]
				</td>
			</tr>
			
		</BOUCLE_champsLib>
	</BOUCLE_fieldChamps>


			<tr id="param_calc_normale_critique">
				<td colspan="5"><div class="hyd_formulaire_chapitre"><:hydraulic:param_calcul:></div></td>
			</tr>
			
			<tr id="precision_normale_critique">
				<td align="right"> 
					<:hydraulic:precision:> :			
				</td>			
				<td>
					<input id="champs_Param_calc_rPrec" type="text" value="#ENV{Param_calc_rPrec}" maxlength="30" name="Param_calc_rPrec"/>
					[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{Param_calc_rPrec})</div>]
				</td>	
			</tr>
			
			<tr id="val_a_cal_field_nc" style="display:[(#GET{val_var}|!={''}|?{'table-row','none'})];">
				<td colspan="4"><div class="hyd_formulaire_chapitre"><:hydraulic:donnee_calc:></div></td>
			</tr>

			<tr id="val_a_cal_nc" style="display:[(#GET{val_var}|!={''}|?{'table-row','none'})];">
				<td align="right">
					<:hydraulic:choix_donnee_calc:> :
				</td>
					
				<td colspan="3">
					<select name="val_a_cal_nc" id="valeur_a_cal_nc">
						<BOUCLE_champs_select_cal(POUR){tableau #ENV{choix_champs_select}}>
							<option value="#CLE" [(#ENV{val_a_cal_nc}|=={#CLE}|?{'selected',''})]>[(#VALEUR|traduction_hydraulic)]</option> 
						</BOUCLE_champs_select_cal>
					</select>
					[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{[(#VALEUR|table_valeur{0})]})</div>]
				</td>	
				
			</tr>
			
			<tr>
				<td colspan="4" class="hyd_bouton_submit">
				   <input type="submit" value="<:hydraulic:calculer:>">
				</td>
			</tr>
	
      </tbody>
   </table>
</form>

[<div class='hydraulic_resultat' id="resultat_nc">(#ENV*{message_ok})</div>]
