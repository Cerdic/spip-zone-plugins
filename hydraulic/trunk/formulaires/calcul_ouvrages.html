[<div class='hyd_formulaire_erreur '><span>(#ENV*{message_erreur})</span></div>]

<script language="javascript" type="text/javascript" src="#CHEMIN{js/hyd_fonctions.js}"></script>
<script>
function elementsParClasse(classe, tagName){
	var divs = document.getElementsByTagName(tagName);
    var resultats = new Array();
    for(var i=0; i<divs.length; i++){
		if(divs[i].className == classe){
			resultats.push(divs[i]);
        }
    }
    return resultats;	
}

var globSelectOuv = 'vRect';
var glob = [];

// Variables globales contenant le choix fait pour chaque ligne	 
<BOUCLE_remplisglob(POUR){tableau #ENV{mes_saisies}}>
	if(globSelectOuv == '#CLE'){
	<BOUCLE_remplisglob1(POUR){tableau #VALEUR|table_valeur{1}}>
		glob['#CLE'] = '#ENV{choix_champs_#CLE}';
	</BOUCLE_remplisglob1>
	}
</BOUCLE_remplisglob>

function setVarGlob(){
	globSelectOuv = getSelectValue('choix_ouvrage');
	<BOUCLE_remplisglob2(POUR){tableau #ENV{mes_saisies}}>
		if(globSelectOuv == '#CLE'){
		<BOUCLE_remplisglob3(POUR){tableau #VALEUR|table_valeur{1}}>
			glob['#CLE'] = getRadioValue('choix_champs_#CLE');
		</BOUCLE_remplisglob3>
		}
	</BOUCLE_remplisglob2>
}

function gestion_radios(nom,valeur){
	var tabPartiel = [];
	var tabIndice = [];
	setVarGlob();

<BOUCLE_libelleCaract3(POUR){tableau #ENV{mes_saisies}}>
	if(globSelectOuv == '#CLE'){
	<BOUCLE_libelleCaract4(POUR){tableau #VALEUR|table_valeur{1}}>
		tabPartiel['#CLE'] = glob['#CLE'];
			tabIndice.push('#CLE');
		</BOUCLE_libelleCaract4>
		}
		</BOUCLE_libelleCaract3>
		
	delete(tabPartiel[nom]);
	// Si on appuis sur un bouton de type "calcul_val"
	if(valeur.substr(0,3) == 'cal'){
		/*
		 * Pour toutes les lignes autres que celle passée en paramètre,
		 * on contrôle  si il y a déjà une valeur à calculer.
		 * Si oui, alors on fais les modifications adéquates sur les champs: 
		 * sélection, visibilité	
		 */
		for(var cle in tabPartiel){
			if(document.getElementById('calcul_val_'+cle).checked){
				document.getElementById('val_fixe_'+cle).checked=true;
				document.getElementById('caract_'+cle).disabled=false;	
				document.getElementById('caract_'+nom).disabled=true;
				setVarGlob();
			}	
		}
	}

	// Si on appuis sur un bouton de type "varier_val" ou "val_fixe" 
	else if(valeur.substr(0,3) == 'var' || valeur.substr(0,3)=='val'){
		for(var cle in tabPartiel){
			var test = 0;
			if(document.getElementById('varier_val_'+cle).checked && (glob[nom] != "calcul_val_"+nom)){
				if(document.getElementById('varier_val_'+nom).checked){
					document.getElementById('val_fixe_'+cle).checked=true;
				}
				setVarGlob();
			}
			else if(document.getElementById('varier_val_'+cle).checked && (glob[nom] == "calcul_val_"+nom) && valeur.substr(0,3) == 'var'){
				document.getElementById('calcul_val_'+cle).checked=true;
				document.getElementById('caract_'+cle).disabled=true;
				document.getElementById('caract_'+nom).disabled=false;
				setVarGlob();
			}
		}	
		
		// Compte le nombre de calcul_val checké
		var cptValCal = 0;
		for(var cle in glob){
			if(document.getElementById('calcul_val_'+cle).checked){
				cptValCal++;
			}
		}
		// Si aucune calcul_val n'est checké
		if(cptValCal == 0){
			
			indice = '';
			for(var i = 0; i < tabIndice.length; i++){
				if(tabIndice[i] == nom){
					// Si on est pas arrivé au dernier élément
					if(i+1 <= tabIndice.length-1){
						indice = tabIndice[i+1];
					}
					else{
						indice = tabIndice[0];
					}
				}
				
			}
			document.getElementById('calcul_val_'+indice).checked=true;
			document.getElementById('caract_'+nom).disabled=false;
			document.getElementById('caract_'+indice).disabled=true;
			var cacher = elementsParClasse('champs_var_'+indice, 'tr');
			for(var i in cacher){
				cacher[i].style.display='none';
			}
			setVarGlob();
		}
	}

	if(valeur.substr(0,3) == 'var'){
		setVarGlob();
		document.getElementById('caract_'+nom).disabled=true;
		for(var cle in glob){
			if(glob[cle].substr(0,3) == 'val'){
				document.getElementById('caract_'+cle).disabled=false;
			}	
		}
		alert(nom);
		var afficher = elementsParClasse('champs_var_'+nom, 'tr');
		for(var i in afficher){
			afficher[i].style.display='table-row';
		}
		
		for(var cle in tabPartiel){	
			var cacher = elementsParClasse('champs_var_'+cle, 'tr');
			for(var i in cacher){
				cacher[i].style.display='none';
			}
		}
		
		setVarGlob();
	}

	// Compte le nombre de varier_val checké
	var cptVarVal = 0;
	for(var cle in glob){
		if(document.getElementById('varier_val_'+cle).checked){
			cptVarVal++;
		}
	}
	
	if(cptVarVal == 0){
		for(var cle in glob){
			if(glob[cle].substr(0,3) != 'cal'){
				document.getElementById('caract_'+cle).disabled=false;
			}	
		}
		var cacher = elementsParClasse('champs_var_'+nom, 'tr');
		for(var i in cacher){
			cacher[i].style.display='none';
		}
	}
	setVarGlob();
}	
</script>
<form method="post" action="#ENV{action}" id="form_calcul_ouvrages">
   #ACTION_FORMULAIRE{#ENV{action}}
   <table class="hyd_formulaire">
      <tbody>
		  
		<tr id="ch_ouvrage_field">
			<td colspan="5"><div class="hyd_formulaire_chapitre"><:hydraulic:type_ouvrage:></div></td>
        </tr>

		<tr id="type_ouvrage">
			<td align="right" width="30%">
				<:hydraulic:choix_ouvrage:> :
			</td>					

			<td colspan="4" width="70%">
				<select name="choixOuvrage" id="choix_ouvrage" onChange="affichageEtValeur()">
				<BOUCLE_choixOuvrages(POUR){tableau #ENV{mes_saisies}}>	
					<option value="#CLE" [(#ENV{choixOuvrage}|=={#CLE}|?{'selected',''})]>[(#VALEUR|table_valeur{0}|traduction_hydraulic)]</option>
				</BOUCLE_choixOuvrages>
				</select>
		  
				[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{[(#VALEUR|table_valeur{0})]})</div>]
			</td>
						
		</tr>

		<tr id="equation_debit">
			<td align="right" width="30%">
				<:hydraulic:loi_debit:> :
			</td>					

			<td colspan="4" width="70%">
				<select name="choixEquation" id="choix_equation_debit">
				<BOUCLE_choixEquat(POUR){tableau #ENV{numLoi}}>	
				#SET{numLoi, #CLE}
				<BOUCLE_tabMesSaisies(POUR){tableau #ENV{mes_saisies}}>
					#SET{val2-0, #VALEUR|table_valeur{2}}
					<BOUCLE_conditionAff(CONDITION){si #ENV{choixOuvrage}|=={#CLE}}>
						<BOUCLE_tabMesSaisies2(POUR){tableau #GET{val2-0}}>
							<BOUCLE_numeroLoi(CONDITION){si #GET{numLoi}|=={#VALEUR|table_valeur{0}}}>
								#SET{affichage, #GET{numLoi}}
							</BOUCLE_numeroLoi>
						</BOUCLE_tabMesSaisies2>
					</BOUCLE_conditionAff>
				</BOUCLE_tabMesSaisies>
					<option value="#CLE" [(#ENV{choixEquation}|=={#CLE}|?{'selected',''})] style="display: [(#CLE|=={#GET{affichage}}|?{'list-item','none'})]">#VALEUR</option>
				</BOUCLE_choixEquat>
				</select>
		  
				[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{[(#VALEUR|table_valeur{0})]})</div>]
			</td>	
		</tr>
				
		<tr id="caract_ouvrages">
			<td colspan="5"><div class="hyd_formulaire_chapitre"><:hydraulic:caract_ouvrages:></div></td>
        </tr>
        
		<tr>
			<td colspan="2"></td>
			<td align="center"><:hydraulic:calcul_val:></td>
			<td align="center"><:hydraulic:varier_val:></td>
			<td align="center"><:hydraulic:fixer_val:></td>
		</tr>
			
		
<BOUCLE_caract(POUR) {tableau #ENV{saisie_equat}}>
		#SET{cleLibOuv, #CLE}
		<BOUCLE_tableauSaisies(POUR){tableau #ENV{mes_saisies}}>
			#SET{ident_cle_field, #CLE}
			<BOUCLE_tableauSaisies2(POUR){tableau #VALEUR|table_valeur{1}}>
				#SET{cleValeur, #CLE}
				<BOUCLE_condLib(CONDITION){si #ENV{choixOuvrage}|=={#GET{ident_cle_field}}}>
					<BOUCLE_condLib2(CONDITION){si #GET{cleValeur}|=={#GET{cleLibOuv}}}>
						#SET{afficher_cle, #CLE}
					</BOUCLE_condLib2>
				</BOUCLE_condLib>	
			</BOUCLE_tableauSaisies2>
		</BOUCLE_tableauSaisies>
		
		<tr id="ouvrage_#CLE" style="display: [(#GET{afficher_cle}|=={#CLE}|?{'table-row','none'})]">
			<td align="right"> 
				[(#VALEUR|table_valeur{0}|traduction_hydraulic)] :
			</td>
			
			<td>
				<input id="caract_#CLE" type="text" value="#ENV{#CLE}" maxlength="30" name="#CLE" [(#ENV{choix_champs_#CLE}|match{^((calcul_val_#CLE)|(varier_val_#CLE))$}|?{'disabled="true"',''})]/>
				[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{#CLE})</div>]
			</td>	

			<td align="center">
				<input type="radio" id="calcul_val_#CLE" name="choix_champs_#CLE" value="calcul_val_#CLE" onclick="gestion_radios('#CLE', 'calcul_val_#CLE')" [(#ENV{choix_champs_#CLE}|=={calcul_val_#CLE}?{'checked',''})]/>
			</td>	
						
			<td align="center">
				<input type="radio" id="varier_val_#CLE" name="choix_champs_#CLE" value="varier_val_#CLE" onclick="gestion_radios('#CLE', 'varier_val_#CLE')"[(#ENV{choix_champs_#CLE}|=={varier_val_#CLE}?{'checked',''})]/>
			</td>
												
			<td align="center">
				<input type="radio" id="val_fixe_#CLE" name="choix_champs_#CLE" value="val_fixe_#CLE" onclick="gestion_radios('#CLE', 'val_fixe_#CLE')"[(#ENV{choix_champs_#CLE}|=={val_fixe_#CLE}?{'checked',''})]/>
			</td>
		</tr>

		<tr class="champs_var_#CLE" style="display:[(#ENV{choix_champs_#CLE}|=={varier_val_#CLE}|?{'table-row','none'})];">
			<td colspan="3" align="right"><:hydraulic:val_min:> : </td>
			<td colspan="2">
				<input name="val_min_#CLE" type="text" value="#ENV{val_min_#CLE}"/>
				[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{val_min_#CLE})</div>]
			</td>
		</tr>
							
		<tr class="champs_var_#CLE" style="display:[(#ENV{choix_champs_#CLE}|=={varier_val_#CLE}|?{'table-row','none'})];">
			<td colspan="3" align="right"><:hydraulic:val_max:> :</td>
			<td colspan="2">
				<input name="val_max_#CLE" type="text" value="#ENV{val_max_#CLE}"/>
				[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{val_max_#CLE})</div>]
			</td>
		</tr>
							
		<tr class="champs_var_#CLE" style="display:[(#ENV{choix_champs_#CLE}|=={varier_val_#CLE}|?{'table-row','none'})];">
			<td colspan="3" align="right"><:hydraulic:pas_var:> :</td>
			<td colspan="2">
				<input name="pas_var_#CLE" type="text" value="#ENV{pas_var_#CLE}"/>
				[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{pas_var_#CLE})</div>]
			</td>
		</tr>

</BOUCLE_caract>
		<tr id="surverseField" style="display: [(#ENV{choixOuvrage}|match{^(vRect|vCirc|vTrap)$}|?{'table-row', 'none'})]">
			<td colspan="5"><div class="hyd_formulaire_chapitre"><:hydraulic:surverse:></div></td>
        </tr>
        
        <tr id="afficher_surverse" style="display: [(#ENV{choixOuvrage}|match{^(vRect|vCirc|vTrap)$}|?{'table-row', 'none'})]">
			<td align="right"> 
				<:hydraulic:surverse:> :			
			</td>			
			<td>
				<input type="checkbox" id="affSurverse" name="afficher_surverse" onclick="afficher_case_a_cocher()" [(#ENV{afficher_surverse}|=={'on'}|?{'checked', ''})]/>
				[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{[(#VALEUR|table_valeur{0})]})</div>]
			</td>	
		</tr>
		
		<tr id="loi_debit_surverse" style="display:[(#ENV{afficher_surverse}|=={'on'}|?{'table-row','none'})];">
			<td align="right" width="30%">
				<:hydraulic:loi_debit:> :
			</td>					

			<td colspan="4" width="70%">
				
				<select name="equatSurverse" id="choix_surverse">
				<BOUCLE_champsNSurverse(POUR){tableau #ENV{surverse}}>
					#SET{tabV2, #VALEUR}
					<BOUCLE_conditionsurv(CONDITION){si #CLE|=={'loi_debit'}}>
						<BOUCLE_champsNSurverse2(POUR){tableau #GET{tabV2}}>
							<option value="[(#VALEUR|table_valeur{0})]" [(#ENV{equatSurverse}|=={[(#VALEUR|table_valeur{0})]}|?{'selected',''})]>[(#VALEUR|table_valeur{1})]</option>
						</BOUCLE_champsNSurverse2>
					</BOUCLE_conditionsurv>
				</BOUCLE_champsNSurverse>
				</select>
		  
				[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{[(#VALEUR|table_valeur{0})]})</div>]
			</td>				
		</tr>
		
<BOUCLE_champsSurverse(POUR){tableau #ENV{surverse}}>
		<BOUCLE_conditionLDebit(CONDITION){si #CLE|!={'loi_debit'}}>
		<tr id="[(#CLE)]_field_surverse" style="display:[(#ENV{afficher_surverse}|=={'on'}|?{'table-row','none'})];">
			<td align="right"> 
				[(#CLE|traduction_hydraulic)]
			</td>
					
			<td>
				<input id="caract_#CLE" type="text" value="#ENV{#CLE}" maxlength="30" name="#CLE" [(#ENV{choix_champs_#CLE}|match{^((calcul_val_#CLE)|(varier_val_#CLE))$}|?{'disabled="true"',''})]/>
				[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{#CLE})</div>]
			</td>	

			<td align="center">
				<input type="radio" id="calcul_val_#CLE" name="choix_champs_#CLE" value="calcul_val_#CLE" onclick="gestion_radios('#CLE', 'calcul_val_#CLE')" [(#ENV{choix_champs_#CLE}|=={calcul_val_#CLE}?{'checked',''})]/>
			</td>	
				
			<td align="center">
				<input type="radio" id="varier_val_#CLE" name="choix_champs_#CLE" value="varier_val_#CLE" onclick="gestion_radios('#CLE', 'varier_val_#CLE')"[(#ENV{choix_champs_#CLE}|=={varier_val_#CLE}?{'checked',''})]/>
			</td>
										
			<td align="center">
				<input type="radio" id="val_fixe_#CLE" name="choix_champs_#CLE" value="val_fixe_#CLE" onclick="gestion_radios('#CLE', 'val_fixe_#CLE')"[(#ENV{choix_champs_#CLE}|=={val_fixe_#CLE}?{'checked',''})]/>
			</td>
		</tr>

		<tr class="champs_var_#CLE" style="display:[(#ENV{choix_champs_#CLE}|=={varier_val_#CLE}|?{'table-row','none'})];">
			<td colspan="3" align="right"><:hydraulic:val_min:> : </td>
			<td colspan="2">
				<input name="val_min_#CLE" type="text" value="#ENV{val_min_#CLE}"/>
				[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{val_min_#CLE})</div>]
			</td>
		</tr>
					
		<tr class="champs_var_#CLE" style="display:[(#ENV{choix_champs_#CLE}|=={varier_val_#CLE}|?{'table-row','none'})];">
			<td colspan="3" align="right"><:hydraulic:val_max:> :</td>
			<td colspan="2">
				<input name="val_max_#CLE" type="text" value="#ENV{val_max_#CLE}"/>
				[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{val_max_#CLE})</div>]
			</td>
		</tr>
					
		<tr class="champs_var_#CLE" style="display:[(#ENV{choix_champs_#CLE}|=={varier_val_#CLE}|?{'table-row','none'})];">
			<td colspan="3" align="right"><:hydraulic:pas_var:> :</td>
			<td colspan="2">
				<input name="pas_var_#CLE" type="text" value="#ENV{pas_var_#CLE}"/>
				[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{pas_var_#CLE})</div>]
			</td>
		</tr>
		</BOUCLE_conditionLDebit>
</BOUCLE_champsSurverse>

<BOUCLE_caractFixe(POUR){tableau #ENV{caract_fixes}}>
	
		<tr id="[(#VALEUR|table_valeur{0})]">
			<td colspan="5"><div class="hyd_formulaire_chapitre">[(#VALEUR|table_valeur{0}|traduction_hydraulic)]</div></td>
        </tr>	
		#SET{valFixe2, #VALEUR|table_valeur{1}}
    <BOUCLE_condPasPrec(CONDITION){si #VALEUR|table_valeur{0}|!= {'param_calcul'}}>
	<BOUCLE_caractFixe2(POUR){tableau #GET{valFixe2}}>
		<tr id="ouvrage_#CLE">
			<td align="right"> 
				[(#VALEUR|table_valeur{0}|traduction_hydraulic)] :
			</td>

			<td>
				<input id="caract_#CLE" type="text" value="#ENV{#CLE}" maxlength="30" name="#CLE" [(#ENV{choix_champs_#CLE}|match{^((calcul_val_#CLE)|(varier_val_#CLE))$}|?{'disabled="true"',''})]/>
				[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{#CLE})</div>]
			</td>	

			<td align="center">
				<input type="radio" id="calcul_val_#CLE" name="choix_champs_#CLE" value="calcul_val_#CLE" onclick="gestion_radios('#CLE', 'calcul_val_#CLE')" [(#ENV{choix_champs_#CLE}|=={calcul_val_#CLE}?{'checked',''})]/>
			</td>	
				
			<td align="center">
				<input type="radio" id="varier_val_#CLE" name="choix_champs_#CLE" value="varier_val_#CLE" onclick="gestion_radios('#CLE', 'varier_val_#CLE')"[(#ENV{choix_champs_#CLE}|=={varier_val_#CLE}?{'checked',''})]/>
			</td>
										
			<td align="center">
				<input type="radio" id="val_fixe_#CLE" name="choix_champs_#CLE" value="val_fixe_#CLE" onclick="gestion_radios('#CLE', 'val_fixe_#CLE')"[(#ENV{choix_champs_#CLE}|=={val_fixe_#CLE}?{'checked',''})]/>
			</td>
		</tr>

		<tr class="champs_var_#CLE" style="display:[(#ENV{choix_champs_#CLE}|=={varier_val_#CLE}|?{'table-row','none'})];">
			<td colspan="3" align="right"><:hydraulic:val_min:> : </td>
			<td colspan="2">
				<input name="val_min_#CLE" type="text" value="#ENV{val_min_#CLE}"/>
				[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{val_min_#CLE})</div>]
			</td>
		</tr>
					
		<tr class="champs_var_#CLE" style="display:[(#ENV{choix_champs_#CLE}|=={varier_val_#CLE}|?{'table-row','none'})];">
			<td colspan="3" align="right"><:hydraulic:val_max:> :</td>
			<td colspan="2">
				<input name="val_max_#CLE" type="text" value="#ENV{val_max_#CLE}"/>
				[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{val_max_#CLE})</div>]
			</td>
		</tr>
					
		<tr class="champs_var_#CLE" style="display:[(#ENV{choix_champs_#CLE}|=={varier_val_#CLE}|?{'table-row','none'})];">
			<td colspan="3" align="right"><:hydraulic:pas_var:> :</td>
			<td colspan="2">
				<input name="pas_var_#CLE" type="text" value="#ENV{pas_var_#CLE}"/>
				[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{pas_var_#CLE})</div>]
			</td>
		</tr>
	</BOUCLE_caractFixe2>
	</BOUCLE_condPasPrec>
	
	<BOUCLE_caractFixe3(POUR){tableau #GET{valFixe2}}>
		<tr id="ouvrage_#CLE">
			<td align="right" width="30%"> 
				[(#VALEUR|table_valeur{0}|traduction_hydraulic)] :
			</td>
					
			<td colspan="4" width="70%">
				<input id="caract_#CLE" type="text" value="#ENV{#CLE}" maxlength="30" name="#CLE" [(#ENV{choix_champs_#CLE}|match{^((calcul_val_#CLE)|(varier_val_#CLE))$}|?{'disabled="true"',''})]/>
				[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{#CLE})</div>]
			</td>	
		</tr>
	</BOUCLE_caractFixe3>
	<//B_condPasPrec>
</BOUCLE_caractFixe>
		
		<tr>
            <td colspan="4" class="hyd_bouton_submit">
               <input type="submit" value="<:hydraulic:calculer:>">
            </td>
         </tr>

      </tbody>
   </table>
</form>

[<div class='hydraulic_resultat'>(#ENV*{message_ok})</div>]
