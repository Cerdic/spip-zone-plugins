[<div class='hyd_formulaire_erreur '><span>(#ENV*{message_erreur})</span></div>]
<script language="javascript" type="text/javascript" src="#CHEMIN{js/hyd_fonctions.js}"></script>
<script> 

//Permet d'afficher ou cacher les champs correspondant Ã  une section.
function afficher_cacher() {
	var section = getSelectValue('choix_section_nc');
    var f = document.getElementById("form_normale_critique");
    if(f) {
		var champs = f.getElementsByTagName("tr");
		for(var i=0, n=champs.length; i<n; i++) {    
			if((champs[i].getAttribute("id") != null) &&((champs[i].getAttribute("id")).substr(0,2) == section)){
				document.getElementById((champs[i].getAttribute("id"))).style.display='table-row';
			}
			else if((champs[i].getAttribute("id") != null) &&((champs[i].getAttribute("id")).substr(0,1) == 'F')) {
				document.getElementById((champs[i].getAttribute("id"))).style.display='none';
			}		
		}
    }  	
}

function gestion_radios(nom, valeur){
	var tabPartiel = ['rug', 'pente', 'coteEau', 'debit'];
	
	for(var i in tabPartiel){
		if(tabPartiel[i] == nom){
			delete(tabPartiel[i]);
		}
	}
	
	if(valeur.substr(0,3) == 'var'){
		for(var cle in tabPartiel){
			if(document.getElementById('varier_val_'+tabPartiel[cle]).checked){
				document.getElementById('val_fixe_'+tabPartiel[cle]).checked=true;
				document.getElementById('caract_'+tabPartiel[cle]).disabled=false;	
				document.getElementById('caract_'+nom).disabled=true;	
				var cacher = document.getElementsByClassName('champs_var_'+tabPartiel[cle]);
				for(var i in cacher){
					cacher[i].style.display='none';
				}		
			}	
		}
		document.getElementById('val_a_cal_field_nc').style.display='table-row';
		document.getElementById('val_a_cal_nc').style.display='table-row';
		document.getElementById('caract_'+nom).disabled=true;	
		var afficher = document.getElementsByClassName('champs_var_'+nom);
			for(var i in afficher){
				afficher[i].style.display='table-row';
		}	
	}

	if(valeur.substr(0,3) == 'val'){
		var CptValVar = 0;
		for(var cle in tabPartiel){
			if(document.getElementById('varier_val_'+tabPartiel[cle]).checked){
				CptValVar++;
			}
		}
		if(CptValVar == 0){
			document.getElementById('val_a_cal_field_nc').style.display='none';
			document.getElementById('val_a_cal_nc').style.display='none';
		}
	
		document.getElementById('caract_'+nom).disabled=false;	
		var cacher = document.getElementsByClassName('champs_var_'+nom);
		for(var i in cacher){
			cacher[i].style.display='none';
		}		
	}
}
</script>
<form method="post" action="#ENV{action}" id="form_normale_critique">
   #ACTION_FORMULAIRE{#ENV{action}}
   <table class="hyd_formulaire">
      <tbody>
		  	<tr id="type_section_field_nc">
				<td colspan="4"><div class="hyd_formulaire_chapitre"><:hydraulic:type_section:></div></td>
			</tr>

			<tr id="type_section_nc">
				<td align="right" width="30%">
					<:hydraulic:choix_section:> :
				</td>
						
				<td colspan="3" width="70%">
					<select name="ncTypeSection" id="choix_section_nc" onChange="afficher_cacher();">
						<option value="FT" [(#ENV{ncTypeSection}|=={'FT'}|?{'selected',''})]><:hydraulic:section_trap:></option>
						<option value="FR" [(#ENV{ncTypeSection}|=={'FR'}|?{'selected',''})]><:hydraulic:section_rect:></option>
						<option value="FC" [(#ENV{ncTypeSection}|=={'FC'}|?{'selected',''})]><:hydraulic:section_circ:></option>
						<option value="FP" [(#ENV{ncTypeSection}|=={'FP'}|?{'selected',''})]><:hydraulic:section_puiss:></option>
					</select>
		  
					[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{[(#VALEUR|table_valeur{0})]})</div>]
				</td>
						
			</tr>
			
			<BOUCLE_fieldChamps(POUR){tableau #ENV{mes_saisies}}>
				
				 #SET{id_fieldset, #CLE}
					
				 <tr id="#GET{id_fieldset}_field_nc" style="display:[(#CLE|match{^([(#ENV{ncTypeSection})]|Caract)$}|?{'table-row','none'})];">				
					 <td colspan="4"><div class="hyd_formulaire_chapitre">[(#VALEUR|table_valeur{0}|traduction_libelle)]</div></td>
				</tr>
				
				[(#GET{id_fieldset}|=={'Caract'}|?{
				<tr>
					<td colspan="2"></td>
					<td align="center"><:hydraulic:varier_val:></td>
					<td align="center"><:hydraulic:fixer_val:></td>
				</tr>
				})]
				
				<BOUCLE_champsLib(POUR){tableau (#VALEUR|table_valeur{1})}>

					<tr id="#GET{id_fieldset}_[(#CLE)]_nc" style="display:[(#GET{id_fieldset}|match{^([(#ENV{ncTypeSection})]|Caract)$}|?{'table-row','none'})];">
						<td align="right"> 
							[(#VALEUR|table_valeur{0}|traduction_libelle)] :		
						</td>
					
						<td>
						   <input id="caract_#CLE" type="text" value="[(#ENV{#GET{id_fieldset}_[(#CLE)]_nc})]" maxlength="30" name="#GET{id_fieldset}_[(#CLE)]_nc" [(#ENV{choix_champs_#CLE}|=={varier_val_#CLE}|?{'disabled="true"',''})]/>
						   [<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{#GET{id_fieldset}_[(#CLE)]_nc})</div>]
						</td>
					
					<BOUCLE_caract(CONDITION){si #GET{id_fieldset}|== {'Caract'}}>
						
						<BOUCLE_val_var_existe(CONDITION){si #ENV{choix_champs_#CLE}|== {varier_val_#CLE}}>
							#SET{val_var, #CLE}
						</BOUCLE_val_var_existe>

						<td align="center">
							<input type="radio" id="varier_val_#CLE" name="choix_champs_#CLE" value="varier_val_#CLE" onclick="gestion_radios('#CLE', 'varier_val_#CLE')" [(#ENV{choix_champs_#CLE}|=={varier_val_#CLE}|?{'checked',''})]/>
						</td>	
					
						<td align="center">
							<input type="radio" id="val_fixe_#CLE" name="choix_champs_#CLE" value="val_fixe_#CLE" onclick="gestion_radios('#CLE', 'val_fixe_#CLE')" [(#ENV{choix_champs_#CLE}|=={val_fixe_#CLE}|?{'checked',''})]/>
						</td>
					</tr>
					
					<tr class="champs_var_#CLE" style="display:[(#ENV{choix_champs_#CLE}|=={varier_val_#CLE}|?{'table-row','none'})];">
						<td colspan="2" align="right"><:hydraulic:val_min:> : </td>
						<td colspan="2">
							<input name="val_min_#CLE" type="text" value="#ENV{val_min_#CLE}"/>
							[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{val_min_#CLE})</div>]
						</td>
					</tr>
						
					<tr class="champs_var_#CLE" style="display:[(#ENV{choix_champs_#CLE}|=={varier_val_#CLE}|?{'table-row','none'})];">
						<td colspan="2" align="right"><:hydraulic:val_max:> :</td>
						<td colspan="2">
							<input name="val_max_#CLE" type="text" value="#ENV{val_max_#CLE}"/>
							[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{val_max_#CLE})</div>]
						</td>
					</tr>
						
					<tr class="champs_var_#CLE" style="display:[(#ENV{choix_champs_#CLE}|=={varier_val_#CLE}|?{'table-row','none'})];">
						<td colspan="2" align="right"><:hydraulic:pas_var:> :</td>
						<td colspan="2">
							<input name="pas_var_#CLE" type="text" value="#ENV{pas_var_#CLE}"/>
							[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{pas_var_#CLE})</div>]
						</td>
					</tr>
						
					</BOUCLE_caract>	
	
					</tr>
					
				</BOUCLE_champsLib>
	
			</BOUCLE_fieldChamps>
			<tr id="param_calc_normale_critique">
				<td colspan="5"><div class="hyd_formulaire_chapitre"><:hydraulic:param_calcul:></div></td>
			</tr>
			
			<tr id="precision_normale_critique">
				<td align="right"> 
					<:hydraulic:precision_lechapt_calmon:> :			
				</td>			
				<td>
					<input id="champs_prec_nc" type="text" value="#ENV{prec_nc}" maxlength="30" name="prec_nc"/>
					[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{prec_nc})</div>]
				</td>	
			</tr>
			
			<tr id="val_a_cal_field_nc" style="display:[(#GET{val_var}|!={''}|?{'table-row','none'})];">
				<td colspan="4"><div class="hyd_formulaire_chapitre"><:hydraulic:donnee_calc:></div></td>
			</tr>

			<tr id="val_a_cal_nc" style="display:[(#GET{val_var}|!={''}|?{'table-row','none'})];">
				<td align="right">
					<:hydraulic:choix_donnee_calc:> :
				</td>
						
				<td colspan="3">
					<select name="val_a_cal_nc">
						<option value="1" [(#ENV{val_a_cal_nc}|=={'1'}|?{'selected',''})]><:hydraulic:charge_spe:></option>
						<option value="2" [(#ENV{val_a_cal_nc}|=={'2'}|?{'selected',''})]><:hydraulic:charge_critique:></option>
						<option value="3" [(#ENV{val_a_cal_nc}|=={'3'}|?{'selected',''})]><:hydraulic:larg_miroir:></option>
						<option value="4" [(#ENV{val_a_cal_nc}|=={'4'}|?{'selected',''})]><:hydraulic:perim_mouille:></option>
						<option value="5" [(#ENV{val_a_cal_nc}|=={'5'}|?{'selected',''})]><:hydraulic:surf_mouille:></option>
						<option value="6" [(#ENV{val_a_cal_nc}|=={'6'}|?{'selected',''})]><:hydraulic:rayon_hyd:></option>
						<option value="7" [(#ENV{val_a_cal_nc}|=={'7'}|?{'selected',''})]><:hydraulic:vit_moy:></option>
						<option value="8" [(#ENV{val_a_cal_nc}|=={'8'}|?{'selected',''})]><:hydraulic:froud:></option>
						<option value="9" [(#ENV{val_a_cal_nc}|=={'9'}|?{'selected',''})]><:hydraulic:tirant_eau_crit:></option>
						<option value="10" [(#ENV{val_a_cal_nc}|=={'10'}|?{'selected',''})]><:hydraulic:tirant_eau_norm:></option>
						<option value="11" [(#ENV{val_a_cal_nc}|=={'11'}|?{'selected',''})]><:hydraulic:tirant_eau_fluv:></option>
						<option value="12" [(#ENV{val_a_cal_nc}|=={'12'}|?{'selected',''})]><:hydraulic:tirant_eau_torr:></option>
						<option value="13" [(#ENV{val_a_cal_nc}|=={'13'}|?{'selected',''})]><:hydraulic:tirant_eau_conj:></option>
						<option value="14" [(#ENV{val_a_cal_nc}|=={'14'}|?{'selected',''})]><:hydraulic:perte_charge:></option>
						<option value="15" [(#ENV{val_a_cal_nc}|=={'15'}|?{'selected',''})]><:hydraulic:var_lin:></option>
						<option value="16" [(#ENV{val_a_cal_nc}|=={'16'}|?{'selected',''})]><:hydraulic:impulsion:></option>
						<option value="17" [(#ENV{val_a_cal_nc}|=={'17'}|?{'selected',''})]><:hydraulic:force_tract:></option>
					</select>
					[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{[(#VALEUR|table_valeur{0})]})</div>]
				</td>
						
			</tr>
			
			<tr>
				<td colspan="4" class="hyd_bouton_submit">
				   <input type="submit" value="<:hydraulic:calculer:>">
				</td>
			</tr>
	
      </tbody>
   </table>
</form>

[<div class='hydraulic_resultat'>(#ENV*{message_ok})</div>]
