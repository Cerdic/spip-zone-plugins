[<div class='hyd_formulaire_erreur '><span>(#ENV*{message_erreur})</span></div>]
<script language="javascript" type="text/javascript" src="#CHEMIN{js/hyd_fonctions.js}"></script>
<script>
	
var glob = [];
// Variables globales contenant le choix fait pour chaque ligne	 
<BOUCLE_sans_coeff(POUR){tableau #ENV{tableau_caract}}>
	glob['#CLE'] = '#ENV{choix_champs_#CLE}';
</BOUCLE_sans_coeff>

// Mise a jour des variables globales
function setVarGlob(){
	<BOUCLE_sans_coeff2(POUR){tableau #ENV{tableau_caract}}>
		glob['#CLE'] = getRadioValue('choix_champs_#CLE');
	</BOUCLE_sans_coeff2>
}

// Permet de switcher les valeur de L, M et N en fonction du matériau choisie
function change_valeur() {
	var choix_mat = getSelectValue('choix_materiau')-1;
	var materiau = new Array();

    <BOUCLE_mat1(POUR){tableau #ENV{mes_saisies_materiaux}}>
		<BOUCLE_mat2(POUR){tableau #VALEUR}>
			materiau.push('#VALEUR');
        </BOUCLE_mat2>
    </BOUCLE_mat1>
    
   document.getElementById('champs_L').value=materiau[choix_mat*3];
   document.getElementById('champs_M').value=materiau[(choix_mat*3)+1];
   document.getElementById('champs_N').value=materiau[(choix_mat*3)+2];
}	

// Gére le comportement des boutons radios
function gestion_radios(nom,valeur){
	
	var tabPartiel = {
		<BOUCLE_sans_coeff3(POUR){tableau #ENV{tableau_caract}}>
			'#CLE' : glob['#CLE'],
		</BOUCLE_sans_coeff3>
	};
	
	delete(tabPartiel[nom]);
	
	// Tableau des indices

	var tabIndice = [
		<BOUCLE_sans_coeff4(POUR){tableau #ENV{tableau_caract}}>
			'#CLE',
		</BOUCLE_sans_coeff4>
	];
	
	// Si on appuis sur un bouton de type "calcul_val"
	if(valeur.substr(0,3) == 'cal'){
		/*
		 * Pour toutes les lignes autres que celle passée en paramètre,
		 * on contrôle  si il y a déjà une valeur à calculer.
		 * Si oui, alors on fais les modifications adéquates sur les champs: 
		 * sélection, visibilité	
		 */
		for(var cle in tabPartiel){
			if(document.getElementById('calcul_val_'+cle).checked){
				document.getElementById('val_fixe_'+cle).checked=true;
				document.getElementById('caract_'+cle).disabled=false;	
				document.getElementById('caract_'+nom).disabled=true;
				setVarGlob();
			}	
		}
	}

	// Si on appuis sur un bouton de type "varier_val" ou "val_fixe" 
	else if(valeur.substr(0,3) == 'var' || valeur.substr(0,3)=='val'){
		for(var cle in tabPartiel){
			if(document.getElementById('varier_val_'+cle).checked && (glob[nom] != "calcul_val_"+nom)){
				document.getElementById('val_fixe_'+cle).checked=true;
				setVarGlob();
			}
			else if(document.getElementById('varier_val_'+cle).checked && (glob[nom] == "calcul_val_"+nom) && valeur.substr(0,3) == 'var'){
			
				document.getElementById('calcul_val_'+cle).checked=true;
				document.getElementById('caract_'+cle).disabled=true;
				document.getElementById('caract_'+nom).disabled=false;
				setVarGlob();
			}
		}
		
		// Compte le nombre de calcul_val checké
		var cptValCal = 0;
		for(var cle in glob){
			if(document.getElementById('calcul_val_'+cle).checked){
				cptValCal++;
			}
		}
		// Si aucune calcul_val n'est checké
		if(cptValCal == 0){
			
			indice = '';
			for(var i = 0; i < tabIndice.length; i++){
				if(tabIndice[i] == nom){
					// Si on est pas arrivé au dernier élément
					if(i+1 <= tabIndice.length-1){
						indice = tabIndice[i+1];
					}
					else{
						indice = tabIndice[0];
					}
				}
				
			}
			document.getElementById('calcul_val_'+indice).checked=true;
			document.getElementById('caract_'+nom).disabled=false;
			document.getElementById('caract_'+indice).disabled=true;
			var cacher = document.getElementsByClassName('champs_var_'+indice);
			for(var i in cacher){
				cacher[i].style.display='none';
			}
			setVarGlob();
		}
	}

	if(valeur.substr(0,3) == 'var'){
		setVarGlob();
		document.getElementById('caract_'+nom).disabled=true;
		for(var cle in glob){
			if(glob[cle].substr(0,3) == 'val'){
				document.getElementById('caract_'+cle).disabled=false;
			}	
		}
		
		var afficher = document.getElementsByClassName('champs_var_'+nom);
		for(var i in afficher){
			afficher[i].style.display='table-row';
		}
		
		for(var cle in tabPartiel){	
			var cacher = document.getElementsByClassName('champs_var_'+cle);
			for(var i in cacher){
				cacher[i].style.display='none';
			}
		}
		
		setVarGlob();
	}

	// Compte le nombre de varier_val checké
	var cptVarVal = 0;
	for(var cle in glob){
		if(document.getElementById('varier_val_'+cle).checked){
			cptVarVal++;
		}
	}
	
	if(cptVarVal == 0){
		for(var cle in glob){
			if(glob[cle].substr(0,3) != 'cal'){
				document.getElementById('caract_'+cle).disabled=false;
			}	
		}
		var cacher = document.getElementsByClassName('champs_var_'+nom);
		for(var i in cacher){
			cacher[i].style.display='none';
		}
	}
	
	setVarGlob();
}
</script>
<form method="post" action="#ENV{action}" id="form_lechapt_calmon">
   #ACTION_FORMULAIRE{#ENV{action}}
   <table class="hyd_formulaire">
      <tbody>
		  	<tr id="type_materiau_field">
				<td colspan="8"><div class="hyd_formulaire_chapitre"><:hydraulic:type_materiau:></div></td>
			</tr>

			<tr id="type_materiau_choix">
				<td align="right">
					<:hydraulic:choix_materiau:> :
				</td>
						
				<td width="1px">
					<select name="typeMateriau" id="choix_materiau" onChange="change_valeur();">
						<option value="1" [(#ENV{typeMateriau}|=={'1'}|?{'selected',''})]><:hydraulic:fonte_beton_corrosive:></option>
						<option value="2" [(#ENV{typeMateriau}|=={'2'}|?{'selected',''})]><:hydraulic:fonte_beton_ncorrosive:></option>
						<option value="3" [(#ENV{typeMateriau}|=={'3'}|?{'selected',''})]><:hydraulic:fonte_revt_ciment:></option>
						<option value="4" [(#ENV{typeMateriau}|=={'4'}|?{'selected',''})]><:hydraulic:fonte_revt_bitume:></option>
						<option value="5" [(#ENV{typeMateriau}|=={'5'}|?{'selected',''})]><:hydraulic:acier_lamine:></option>
						<option value="6" [(#ENV{typeMateriau}|=={'6'}|?{'selected',''})]><:hydraulic:fonte_revt_centrifuge:></option>
						<option value="7" [(#ENV{typeMateriau}|=={'7'}|?{'selected',''})]><:hydraulic:pvc:></option>
						<option value="8" [(#ENV{typeMateriau}|=={'8'}|?{'selected',''})]><:hydraulic:tuyau_lisse1:></option>
						<option value="9" [(#ENV{typeMateriau}|=={'9'}|?{'selected',''})]><:hydraulic:tuyau_lisse2:></option>
					</select>
					
					[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{[(#VALEUR|table_valeur{0})]})</div>]

				</td>
			</tr>
			
		    #SET{tableau_coeff,#ARRAY{1,L,2,M,3,N}}
			
			<BOUCLE_coeff(POUR) {tableau #GET{tableau_coeff}}>
				<tr id="materiau_coeff_#VALEUR">
					<td align="right"> 
						#VALEUR :			
					</td>
								
					<td>
						<input id="champs_#VALEUR" type="text" value="#ENV{#VALEUR}" maxlength="30" name="#VALEUR"/>
						[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{#VALEUR})</div>]
					</td>	
				</tr>
			</BOUCLE_coeff>
			

			<tr id="caract_lechapt_calmon">
				<td colspan="8"><div class="hyd_formulaire_chapitre"><:hydraulic:caract_lechapt_calmon:></div></td>
			</tr>

			<tr>
				<td colspan="2"></td>
				<td width="75px" colspan="2" align="center"><:hydraulic:calcul_val:></td>
				<td width="75px" colspan="2" align="center"><:hydraulic:varier_val:></td>
				<td width="75px" colspan="2" align="center"><:hydraulic:fixer_val:></td>
			</tr>
			
			
			<BOUCLE_caract(POUR) {tableau #ENV{tableau_caract}}>
		
				<tr id="type_materiau_caract_#VALEUR">
					<td align="right" width="150px"> 
						#VALEUR :
					</td>
					
					<td>
						<input id="caract_#CLE" type="text" value="[(#ENV{choix_champs}|=={#CLE}|?{'',#ENV{#CLE}})]" maxlength="30" name="#CLE" [(#ENV{choix_champs_#CLE}|match{^((calcul_val_#CLE)|(varier_val_#CLE))$}|?{'disabled="true"',''})]/>
						[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{#CLE})</div>]
					</td>	

					<td colspan="2" align="center">
						<input type="radio" id="calcul_val_#CLE" name="choix_champs_#CLE" value="calcul_val_#CLE" onclick="gestion_radios('#CLE', 'calcul_val_#CLE')" [(#ENV{choix_champs_#CLE}|=={calcul_val_#CLE}?{'checked',''})]/>
					</td>	
					
					<td colspan="2" align="center">
						<input type="radio" id="varier_val_#CLE" name="choix_champs_#CLE" value="varier_val_#CLE" onclick="gestion_radios('#CLE', 'varier_val_#CLE')" [(#ENV{choix_champs_#CLE}|=={varier_val_#CLE}?{'checked',''})]/>
					</td>
										
					<td colspan="2" align="center">
						<input type="radio" id="val_fixe_#CLE" name="choix_champs_#CLE" value="val_fixe_#CLE" onclick="gestion_radios('#CLE', 'val_fixe_#CLE')" [(#ENV{choix_champs_#CLE}|=={val_fixe_#CLE}?{'checked',''})]/>
					</td>
				</tr>


				<tr class="champs_var_#CLE" style="display:[(#ENV{choix_champs_#CLE}|=={varier_val_#CLE}|?{'table-row','none'})];">
					<td></td>
					<td align="right"><:hydraulic:val_min:> #CLE :
						<input name="val_min_#CLE" type="text" value="#ENV{val_min_#CLE}"/>
						[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{val_min_#CLE})</div>]
					</td>
					<td colspan="6"></td>
				</tr>
					
				<tr class="champs_var_#CLE" style="display:[(#ENV{choix_champs_#CLE}|=={varier_val_#CLE}|?{'table-row','none'})];">
					<td></td>
					<td align="right"><:hydraulic:val_max:> #CLE :
						<input name="val_max_#CLE" type="text" value="#ENV{val_max_#CLE}"/>
						[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{val_max_#CLE})</div>]
					</td>
					<td colspan="6"></td>
				</tr>
					
				<tr class="champs_var_#CLE" style="display:[(#ENV{choix_champs_#CLE}|=={varier_val_#CLE}|?{'table-row','none'})];">
					<td></td>
					<td align="right"><:hydraulic:pas_var:> #CLE :
						<input name="pas_var_#CLE" type="text" value="#ENV{pas_var_#CLE}"/>
						[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{pas_var_#CLE})</div>]
					</td>
					<td colspan="6"></td>
				</tr>
				
			</BOUCLE_caract>		
			
			<tr id="param_calc_lechapt_calmon">
				<td colspan="8"><div class="hyd_formulaire_chapitre"><:hydraulic:param_calc_lechapt_calmon:></div></td>
			</tr>
			
			<tr id="precision_lechapt_calmon">
					<td align="right"> 
						<:hydraulic:precision_lechapt_calmon:> :			
					</td>
								
					<td>
						<input id="champs_prec_lc" type="text" value="#ENV{prec_lc}" maxlength="30" name="prec_lc"/>
						[<div class='hyd_erreur'>(#ENV**{erreurs}|table_valeur{prec_lc})</div>]
					</td>	
			</tr>
				
			<tr>		
				<td colspan="8" class="hyd_bouton_submit">
				   <input type="submit" value="<:hydraulic:calculer_lechapt_calmon:>">
				</td>
			</tr>
			
      </tbody>
   </table>
</form>

[<div class='hydraulic_resultat'>(#ENV*{message_ok})</div>]
