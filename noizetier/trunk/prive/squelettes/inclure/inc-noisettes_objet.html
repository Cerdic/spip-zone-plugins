[(#REM)

	Squelette inclus sur la page d'un objet via le pipeline affiche_milieu.

	Affiche des liens pour configurer les noisettes qui concernent l'objet ou sa page :
	- En priorité les noisettes pour l'objet précis
	- Sinon les noisettes pour sa page

	Paramètres :

	- objet       : Type d'objet
	- id_objet    : N° de l'objet
	- page        : Identifiant de la page pour le noizetier
	                Dans ce cas précis : objet-composition
	- composition : Composition éventuelle de l'objet

]
[(#BOITE_OUVRIR{[(#CHEMIN_IMAGE{noisettes-16}|balise_img)] <:noizetier:texte_noisettes:>,noisettes noisettes_milieu})]

[(#REM) Autorisation de configurer les noisettes pour cet objet précis ]
#SET{autoriser_objet,#AUTORISER{configurerpage,noizetier,0,'',#ARRAY{objet,#ENV{objet},id_objet,#ENV{id_objet}}}}

[(#REM) Compter les noisettes de cet objet précis ]
<BOUCLE_nb_noisettes_objet(NOISETTES)
	{plugin = noizetier}
	{objet}
	{id_objet}
	{si #GET{autoriser_objet}}
/>#SET{nb_noisettes_objet,#TOTAL_BOUCLE}<//B_nb_noisettes_objet>

[(#REM) Compter les noisettes de la page de l'objet ]
<BOUCLE_nb_noisettes_page(NOISETTES)
	{plugin = noizetier}
	{type = #ENV{objet}}
	{composition}
/>#SET{nb_noisettes_page,#TOTAL_BOUCLE}<//B_nb_noisettes_page>

[(#REM) Identifier les noisettes utilisées : celles de la page ou celle de l'objet ]
#SET{source,#GET{autoriser_objet}|?{
	#GET{nb_noisettes_objet}|?{objet,page},
	page}
}

[(#REM) Items à afficher ]
#SET{afficher_objet,#GET{autoriser_objet}}
#SET{afficher_page,#GET{autoriser_objet}|non|ou{#GET{autoriser_objet}|et{#GET{nb_noisettes_objet}|non}}}
#SET{exposer,#GET{afficher_objet}|et{#GET{afficher_page}}}

[(#GET{afficher_objet}|oui)
#SET{url_objet,#URL_ECRIRE{noizetier_page}|parametre_url{objet,#ENV{objet}}|parametre_url{id_objet,#ENV{id_objet}}}
#SET{label_nb_noisettes_objet,#GET{nb_noisettes_objet}|?{
	#GET{nb_noisettes_objet}|singulier_ou_pluriel{noizetier:noisettes_configurees_une,noizetier:noisettes_configurees_nb},
	#VAL{#VAL{noizetier:noisettes_configurees_aucune}|_T}
}|strtolower}
#SET{texte_objet,#ENV{objet}|objet_info{texte_objet}|_T}
#SET{exposer_objet,#GET{exposer}|et{#GET{source}|=={objet}}}
<span class="cfg-noisettes cfg-noisettes_objet">
	<span class="cfg-noisettes__label">
		<:noizetier:label_noisettes_objet:> : #GET{label_nb_noisettes_objet}
	</span>
	<a
		class="cfg-noisettes__bouton"
		href="[(#GET{url_objet})]" 
		title="<:noizetier:bulle_configurer_objet_noisettes|attribut_html:>"
	>
	<:noizetier:bouton_configurer:>
	</a>
</span>
]

<BOUCLE_page(NOIZETIER_PAGES)
	{page}
	{composition}
	{si #GET{afficher_page}}
>
#SET{url_page,#URL_ECRIRE{noizetier_page}|parametre_url{page,#PAGE}}
#SET{label_nb_noisettes_page,#GET{nb_noisettes_page}|?{
	#GET{nb_noisettes_page}|singulier_ou_pluriel{noizetier:noisettes_configurees_une,noizetier:noisettes_configurees_nb},
	#VAL{#VAL{noizetier:noisettes_configurees_aucune}|_T}
}|strtolower}
#SET{texte_objets,#TYPE|objet_info{texte_objets}|_T|strtolower}
#SET{exposer_page,#GET{exposer}|et{#GET{source}|=={page}}}
<span class="cfg-noisettes cfg-noisettes_page">
	<span class="cfg-noisettes__label">
		[(#COMPOSITION|?{
			<:noizetier:label_noisettes_composition:>,
			#VAL{noizetier:label_noisettes_page_objets}|_T{#ARRAY{objets,#GET{texte_objets}}}
		})] : #GET{label_nb_noisettes_page}
	</span>
	<a
		class="cfg-noisettes__bouton"
		href="[(#GET{url_page})]"
		title="[(#COMPOSITION|?{<:noizetier:bulle_configurer_composition_noisettes|attribut_html:>,<:noizetier:bulle_configurer_page_noisettes|attribut_html:>})]"
	>
	<:noizetier:bouton_configurer:>
	</a>
</span>
</BOUCLE_page>

#BOITE_FERMER