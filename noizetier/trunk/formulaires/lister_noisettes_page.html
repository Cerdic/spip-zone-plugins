[(#REM) en ajax, on perds parfois le param√®tre dans l'URL ]
#SET{self, #SELF|parametre_url{objet, #ENV{objet}}}
#SET{self, #GET{self}|parametre_url{id_objet, #ENV{id_objet}}}
#SET{self, #GET{self}|parametre_url{page, #ENV{page}}}
#SET{self, #GET{self}|parametre_url{bloc, #ENV{bloc}}}
<form method="post" action="#ENV{action}">
	[(#REM) declarer les hidden qui declencheront le service du formulaire parametre : url d'action ]
	#ACTION_FORMULAIRE{#ENV{action}}
	<input type="hidden" name="page" value="#ENV{page}" />
	<input type="hidden" name="objet" value="#ENV{objet}" />
	<input type="hidden" name="id_objet" value="#ENV{id_objet}" />

	[#BOITE_OUVRIR{'','error'}(#ENV*{message_erreur})#BOITE_FERMER]
	[#BOITE_OUVRIR{'','success'}(#ENV*{message_ok})#BOITE_FERMER]

	#SET{infos_bloc, #NOIZETIER_BLOC_INFOS{#ENV{bloc}}}
	<a name="bloc-#ENV{bloc}"></a>
	[(#BOITE_OUVRIR{#GET{infos_bloc/nom}, simple, titrem})]
		[<p>(#GET{infos_bloc/description})</p>]
		<ul class="editer-groupe liste-items liste-noisettes liste-noisettes-bloc">
		<BOUCLE_noisettes(NOIZETIER noizetier_noisettes){plugin=noizetier}{objet?}{id_objet?}{type=#ENV{page}|noizetier_page_type}{composition=#ENV{page}|noizetier_page_composition}{bloc=#ENV{bloc}}{par rang}>
			<li class="editer item noisette" id="noisette-#ID_NOISETTE">
				<div>
					<div class="resume">
						[(#NOM|_T_ou_typo)]
						[<br />(#NOIZETIER_NOISETTE_PREVIEW)]
						[(#REM) Logo de la noisette ]
						<div class="icone">
							[(#ICON|noizetier_icone_chemin|image_reduire{24}|extraire_attribut{src}|balise_img)]
						</div>
					</div>
					<div class="edition">
						[<a href="(#URL_ACTION_AUTEUR{deplacer_noisette, [haut:(#ID_NOISETTE)], #GET{self}})"
							title="<:noizetier:formulaire_deplacer_haut:>">
							[<img height="24" width="24" src="(#CHEMIN_IMAGE{noisette-up-24.png})" alt="" />]
						</a>]
						[<a href="(#URL_ACTION_AUTEUR{deplacer_noisette, [bas:(#ID_NOISETTE)], #GET{self}})"
							title="<:noizetier:formulaire_deplacer_bas:>">
							[<img height="24" width="24" src="(#CHEMIN_IMAGE{noisette-down-24.png})" alt="" />]
						</a>]
						[<a href="(#URL_ACTION_AUTEUR{supprimer_noisettes, [noisette:(#ID_NOISETTE)], #GET{self}#bloc-#ENV{bloc}})"
							title="<:noizetier:formulaire_supprimer_noisette:>">
							[<img height="24" width="24" src="(#CHEMIN_IMAGE{noisette-del-24.png})" alt="" />]
						</a>]
						[<a href="(#URL_ECRIRE{noisette_edit}
									|parametre_url{id_noisette, #ID_NOISETTE})" class="visible"
							title="<:noizetier:formulaire_modifier_noisette:>">
							[<img height="24" width="24" src="(#CHEMIN_IMAGE{noisette-edit-24.png})" alt="" />]
						</a>]
					</div>
					<input type="hidden" name="ordre[]" value="#ID_NOISETTE" />
				</div>
			</li>
		</BOUCLE_noisettes>
			<input type="hidden" name="nb_noisettes" value="#TOTAL_BOUCLE" />
		</B_noisettes>
			<li class="editer item">#BOITE_OUVRIR{'','notice'}<:noizetier:bloc_sans_noisette:>#BOITE_FERMER</li>
			<input type="hidden" name="nb_noisettes" value="0" />
		<//B_noisettes>
		</ul>
		[(#ENV{page}|?{
			#SET{url_add,#URL_ECRIRE{noisette_add,page=#ENV{page}&bloc=#ENV{bloc}}},
			#SET{url_add,#URL_ECRIRE{noisette_add,objet=#ENV{objet}&id_objet=#ENV{id_objet}&bloc=#ENV{bloc}}}
		})]
		[(#GET{url_add}
			|icone_verticale{<:noizetier:formulaire_ajouter_noisette:>,noisette, add, right preload})]
		[(#ENV{page}|?{
			#SET{$arg_page,page:#ENV{page}},
			#SET{$arg_page,objet:#ENV{id_objet}:#ENV{objet}}
		})]
		[(#URL_ACTION_AUTEUR{supprimer_noisettes,[#GET{$arg_page}/bloc:(#ENV{bloc})],#GET{self}}
			|icone_verticale{<:noizetier:formulaire_supprimer_noisettes_bloc:>,noizetier-24,'del',#LANG_LEFT})]
	#BOITE_FERMER

	[(#REM) <!-- ajouter les saisies supplementaires : extra et autre, a cet endroit -->]
	<!--extra-->
</form>
<script type="text/javascript">
/*<!\[CDATA\[*/
	[(#REM) <!-- Autoriser le tri des noisettes du bloc -->]
	jQuery('ul.liste-noisettes-bloc').sortable({
		items: 'li.noisette',
		axis: 'y',
		opacity: 0.5,
		connectWith: 'ul.liste-noisettes-bloc',
		forcePlaceholderSize: true,
		cursor: 'move',
		update: function(event, ui) {
			form = $(this).closest('form');
			form.submit();
		}
	});

	[(#REM) <!-- Affichage ou effacement des boutons d'actions de chaque page -->]
	$(function(){
		$('.item.noisette .edition a:not(.visible)').hide();
		$('.item.noisette')
			.hover(
				function(){
					$(this).find('.edition a').show();
				},
				function(){
					$(this).find('.edition a:not(.visible)').hide();
				}
			);
	});
/*\]\]>*/
</script>
