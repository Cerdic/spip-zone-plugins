[(#REM) en ajax, on perds parfois le param√®tre dans l'URL ]
#SET{self,#SELF|parametre_url{objet,#ENV{objet}}}
#SET{self,#GET{self}|parametre_url{id_objet,#ENV{id_objet}}}
#SET{self,#GET{self}|parametre_url{page,#ENV{page}}}
#SET{self,#GET{self}|parametre_url{bloc,#ENV{bloc}}}
<form method="post" action="#ENV{action}">
	[(#REM) declarer les hidden qui declencheront le service du formulaire parametre : url d'action ]
	#ACTION_FORMULAIRE{#ENV{action}}
	<input type="hidden" name="page" value="#ENV{page}" />
	<input type="hidden" name="objet" value="#ENV{objet}" />
	<input type="hidden" name="id_objet" value="#ENV{id_objet}" />
	<input type="hidden" name="bloc" value="#ENV{bloc}" />

	[#BOITE_OUVRIR{'','error'}(#ENV*{message_erreur})#BOITE_FERMER]
	[#BOITE_OUVRIR{'','success'}(#ENV*{message_ok})#BOITE_FERMER]

	#SET{blocs, #ENV{page, #ENV{objet}}|noizetier_page_lister_blocs}
	#SET{bloc_affiche, #ENV{bloc}|sinon{#GET{blocs}|reset}}
	<BOUCLE_bloc_affiche(CONDITION){si #GET{bloc_affiche}}>
	#SET{infos_bloc_affiche, #NOIZETIER_BLOC_INFOS{#GET{bloc_affiche}}}
	<a name="bloc-#GET{bloc_affiche}"></a>
	[(#BOITE_OUVRIR{#GET{infos_bloc_affiche/nom}, simple, titrem})]
		[<p>(#GET{infos_bloc_affiche/description})</p>]
		<input type="hidden" name="ordre[]" value="bloc-#GET{bloc_affiche}" />
		<ul class="editer-groupe liste-items liste-noisettes bloc">
		<BOUCLE_noisettes(NOISETTES){objet?}{id_objet?}{type=#ENV{page}|noizetier_page_type}{composition=#ENV{page}|noizetier_page_composition}{bloc=#GET{bloc_affiche}}{par rang}>
			#SET{infos_noisette, #NOISETTE|noizetier_info_noisette}
			<li class="editer item noisette" id="noisette-#ID_NOISETTE"[ style="background-image: url((#GET{infos_noisette}|table_valeur{icon}|sinon{noisette-24.png}|noizetier_icone_chemin));"]>
				[<strong>(#GET{infos_noisette}|table_valeur{nom}|sinon{#NOISETTE})</strong>]
				[(#AUTORISER{configurer,noizetier}|oui)
					[(#URL_ECRIRE{noisette_edit,id_noisette=#ID_NOISETTE}|icone_verticale{<:noizetier:formulaire_modifier_noisette:>, noisette, edit, right preload})]
					[(#URL_ACTION_AUTEUR{supprimer_noisettes, noisette:#ID_NOISETTE,#GET{self}#bloc-#GET{bloc_affiche}}|icone_verticale{<:noizetier:formulaire_supprimer_noisette:>, noisette, del, right})]
					[(#URL_ACTION_AUTEUR{deplacer_noisette, #ID_NOISETTE-bas,#GET{self}#noisette-#ID_NOISETTE}|icone_verticale{<:noizetier:formulaire_deplacer_bas:>, noisette-down, '', right})]
					[(#URL_ACTION_AUTEUR{deplacer_noisette, #ID_NOISETTE-haut,#GET{self}#noisette-#ID_NOISETTE}|icone_verticale{<:noizetier:formulaire_deplacer_haut:>, noisette-up, '', right})]
				]
				[<br />(#NOIZETIER_NOISETTE_PREVIEW)]
				<input type="hidden" name="ordre[]" value="noisette-#ID_NOISETTE" />
			</li>
		</BOUCLE_noisettes>
			<li class="editer item">#BOITE_OUVRIR{'','notice'}<:noizetier:bloc_sans_noisette:>#BOITE_FERMER</li>
		<//B_noisettes>
		</ul>
		[(#AUTORISER{configurer,noizetier}|oui)
			[(#ENV{page}|?{
				#SET{url_add,#URL_ECRIRE{noisette_add,page=#ENV{page}&bloc=#GET{bloc_affiche}}},
				#SET{url_add,#URL_ECRIRE{noisette_add,objet=#ENV{objet}&id_objet=#ENV{id_objet}&bloc=#GET{bloc_affiche}}}
			})]
			[(#GET{url_add}|icone_verticale{<:noizetier:formulaire_ajouter_noisette:>,noisette, add, right preload})]
		]

			[(#ENV{page}|?{
				#SET{arg_supp,page:#ENV{page}/bloc:#GET{bloc_affiche}},
				#SET{arg_supp,objet:#ENV{id_objet}:#ENV{objet}/bloc:#GET{bloc_affiche}}
			})]
			[(#URL_ACTION_AUTEUR{supprimer_noisettes,#GET{arg_supp},#GET{self}}|icone_verticale{<:noizetier:formulaire_supprimer_noisettes_bloc:>,noizetier-24,'del',#LANG_LEFT})]
	#BOITE_FERMER
	</BOUCLE_bloc_affiche>

	[(#AUTORISER{configurer,noizetier}|oui)
		#SET{modif_en_cours,#VAL{noizetier:modif_en_cours}|_T}
		#BOITE_OUVRIR{#GET{modif_en_cours},'notice none valider_rang'}
		<:noizetier:notice_enregistrer_rang:>
		#BOITE_PIED
		<input type="submit" name="cancel" class="submit link" value="<:bouton_annuler:>" />
		<input type="submit" name="save" class="submit" value="<:bouton_enregistrer:>" />
		#BOITE_FERMER

		<script type="text/javascript">/*<!\[CDATA\[*/
			jQuery('ul.bloc').sortable({
				items: 'li.noisette',
				opacity: 0.8,
				connectWith: 'ul.bloc',
				forcePlaceholderSize: true,
				cursor: 'move',
				update: function(event, ui) {
					jQuery('li.noisette .icone').hide();
					jQuery('.noisette-24').hide();
					jQuery('.noizetier-24').hide();
					jQuery('.valider_rang').show();
				}
			});
		/*\]\]>*/</script>
	]

	[(#REM) ajouter les saisies supplementaires : extra et autre, a cet endroit ]
	<!--extra-->
</form>
