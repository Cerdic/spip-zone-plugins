[(#REM)/**
* Plugin SPIP Geoportail
*
* @author:
* Jean-Marc Viglino (ign.fr)
*
* Copyright (c) 2010
* Logiciel distribue sous licence GNU/GPL.
*
* Exemple d'affichage d'une couche image en superposition sur une carte geoportail
* L'exemple defini une fonction initSpipMapX (ne marche qu'une seule fois !)
*	<geoportailX|image|id_document=YY|xmin=2.444775|ymin=48.92170|xmax=2.448227|ymax=48.92357>
* - center : se centrer sur la zone
* - id_document : identifiant du document
* - xmin, ymin, xmax, ymax : coins du doc
* - opacity : transparence
* - visibility : visible
* - minz, maxz : zoom mini et maxi
**/
]<BOUCLE_img(DOCUMENTS){id_document=#ID_DOCUMENT}{extension IN (jpg,png,gif)}>
<script type="text/javascript">
$.geoportail.onLoad([(#ENV{id_geoportail,0})] ,
function (map,id)
{	
	var xmin = [(#ENV{xmin,2.444775})];
	var ymin = [(#ENV{ymin,48.92170})];
	var xmax = [(#ENV{xmax,2.448227})];
	var ymax = [(#ENV{ymax,48.92357})];
	
	var pt1 = new OpenLayers.Geometry.Point(xmin,ymin);
	pt1.transform(new OpenLayers.Projection('IGNF:RGF93G'), map.getMap().getProjection());
	var pt2 = new OpenLayers.Geometry.Point(xmax,ymax);
	pt2.transform(new OpenLayers.Projection('IGNF:RGF93G'), map.getMap().getProjection());

	var options = 
	{	minZoomLevel:[(#ENV{minz,0})], 
		maxZoomLevel:[(#ENV{maxz,18})], 
		maxResolution:1000, 
		opacity: [(#ENV{opacity,0.65})], 
		isBaseLayer:false, 
		visibility:[(#ENV{visibility,true})], 
		maxExtent: new OpenLayers.Bounds(pt1.x, pt1.y, pt2.x, pt2.y),
		//originators: jQuery.geoportail.originators,
		view:{ zoomToExtent:true } 
	};

	var graphic = new OpenLayers.Layer.Image(
                '[(#TITRE|sinon{image})]',
                '[(#URL_DOCUMENT)]',
                new OpenLayers.Bounds(pt1.x, pt1.y, pt2.x, pt2.y),
                new OpenLayers.Size([(#LARGEUR)], [(#HAUTEUR)]),
                options
            );
	map.getMap().addLayer(graphic);
	// Hack pour Firefox (forcer l'image a s'afficher dans le css)
	$(graphic.div).addClass("layerImageHack");
	
	[(#ALIGN|=={center}|?{' '})
		// Centrer
		var extent = new OpenLayers.Bounds();
		extent.extend(pt1);
		extent.extend(pt2);
		map.getMap().zoomToExtent(extent);
	]
}
);
</script>
</BOUCLE_img>
