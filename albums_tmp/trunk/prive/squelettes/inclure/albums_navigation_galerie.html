#SET{self,#SELF|parametre_url{debut_galerie,''}}

[<!--(#REM) selections d'albums (passees dans l'environnement de la galerie) -->]
[<!--(#REM) a faire : transformer ces boucles en critÃ¨res 'contenu' et 'vide'  -->]
	[<!--(#REM) tous les albums -->]
#SET{selection,#ARRAY}
<BOUCLE_tous_les_albums(ALBUMS){tout}>
#SET{selection,#GET{selection}|push{#ID_ALBUM}}
</BOUCLE_tous_les_albums>
	[<!--(#REM) albums contenant des medias identiques a ENV{media} -->]
[(#ENV{media}|et{#ENV{media}|!={non}}|oui) #SET{selection,#ARRAY} ]
<BOUCLE_doc_medias(DOCUMENTS){media IN #ENV{media}}{tout}>
<BOUCLE_doc_lien_album(spip_documents_liens){id_document}{objet=album}{tout}>
[(#ENV{media}|et{#ENV{media}|!={non}}|oui) [(#GET{selection}|find{#ID_OBJET}|non)#SET{selection,#GET{selection}|push{#ID_OBJET}}] ]
</BOUCLE_doc_lien_album>
</BOUCLE_doc_medias>
	[<!--(#REM) albums sans contenu -->]
[(#ENV{media}|=={non}|oui) #SET{selection,#ARRAY} ]
<BOUCLE_tous_les_albums_bis(ALBUMS){tout}>
<BOUCLE_test_doc(DOCUMENTS){id_album}{tout}> </BOUCLE_test_doc>
[(#ENV{media}|=={non}|oui) [(#SET{selection,#GET{selection}|push{#ID_ALBUM}})] ]
#SET{albums_vides,oui}
<//B_test_doc>
</BOUCLE_tous_les_albums_bis>

[<!--(#REM) tableau des types de media contenus dans les albums  -->]
#SET{medias_contenus,#ARRAY}
<BOUCLE_medias_contenus(DOCUMENTS liens){objet=album}{tout}>
[(#GET{medias_contenus}|find{#MEDIA}|non) #SET{medias_contenus,#GET{medias_contenus}|push{#MEDIA}} ]
</BOUCLE_medias_contenus>

[<!--(#REM) tableau des types de medias non contenus dans les albums  -->]
#SET{medias_non_contenus,#ARRAY}
<BOUCLE_medias_non_contenus(DATA){liste image,audio,video,file}{tout}>
[(#GET{medias_contenus}|find{#VALEUR}|non) #SET{medias_non_contenus,#GET{medias_non_contenus}|push{#VALEUR}} ]
</BOUCLE_medias_non_contenus>

[<!--(#REM) Onglets : parents -->]
<div class='onglets_simple premier clearfix'>
<!-- <span class='label'><:album:label_parents:>:&nbsp;</span> -->
<ul class='parents'>
	[<li class='first'>(#GET{self}|parametre_url{objet,''}|lien_ou_expose{<:album:onglet_tous:>,#ENV{objet,''}|=={''},ajax})</li>]
	#SET{objets,#ARRAY}
	<BOUCLE_tableau_objets(ALBUMS liens){tout}>
	[(#GET{objets}|find{#OBJET}|non) #SET{objets,#GET{objets}|push{#OBJET}} ]
	</BOUCLE_tableau_objets>
	<BOUCLE_objets(DATA){liste #GET{objets}}>
		<BOUCLE_compteur(ALBUMS){objet=#VALEUR}{tout} />
		[<li>(#GET{self}|parametre_url{objet,#VALEUR}|lien_ou_expose{#VAL{#VALEUR}|concat{s}|concat{' (',#TOTAL_BOUCLE,')'},#ENV{objet}|=={#VALEUR},ajax})</li>]
		<//B_compteur>
	</BOUCLE_objets>
	[(#GET{objets}|find{article}|non)<li><span class="off">articles</span></li>]
	[(#GET{objets}|find{rubrique}|non)<li><span class="off">rubriques</span></li>]
</ul>
</div>

[<!--(#REM) Filtres : statut, utilisations, orphelins  -->]
<div class='onglets_simple second clearfix'>
<ul class='statut'>
	[<li class='first'>(#GET{self}|parametre_url{statut,''}|lien_ou_expose{<:medias:documents_tous:>,#ENV{statut,.*}|=={.*},ajax})</li>]
	[<li>(#GET{self}|parametre_url{statut,publie}|lien_ou_expose{<:medias:documents_publies:>,#ENV{statut}|=={publie},ajax})</li>]
	[<li>(#GET{self}|parametre_url{statut,prepa|poubelle}|lien_ou_expose{<:medias:documents_non_publies:>,#ENV{statut}|=={prepa|poubelle},ajax})</li>]
</ul>
<ul class='brises'>
	[<li class='first'>(#GET{self}|parametre_url{vu,''}|lien_ou_expose{<:album:filtre_tous:>,#ENV{vu}|non|et{#ENV{vu}|non},ajax})</li>]
	[<li>(#GET{self}|parametre_url{vu,''}|parametre_url{vu,oui}|lien_ou_expose{<:album:filtre_vus:>,#ENV{vu}|=={oui},ajax})</li>]
	[<li>(#GET{self}|parametre_url{vu,''}|parametre_url{vu,non}|lien_ou_expose{<:album:filtre_non_vus:>,#ENV{vu}|=={non},ajax})</li>]
</ul>
<ul class='brises'>
[<li class='first'>(#GET{self}|parametre_url{brise|orphelins,''}|lien_ou_expose{<:medias:documents_tous:>,#ENV{brise,0}|non|et{#ENV{orphelins,0}|non},ajax})</li>]
[<li>(#GET{self}|parametre_url{brise,''}|parametre_url{orphelins,1}|lien_ou_expose{<:medias:documents_orphelins:>,#ENV{orphelins,0}|=={1},ajax})</li>]
</ul>
</div>

[<!--(#REM) Filtres : contenus -->]
<div class='filtres troisieme clearfix'>
	<!--<span class='label'><:album:label_contenus:>:&nbsp;</span>-->
	<ul class='contenus'>
	
	[<!--(#REM) Filtre : tous -->]
	<li class='tous'>
	[(#ENV{media}|?{
		<a href='[(#GET{self}|parametre_url{media,''})]' class='ajax' alt='<:album:onglet_tous:>' title='<:album:onglet_tous:>'>,
		<strong class='on'>
	})]
	[(#CHEMIN_IMAGE{icone-medias-tous-24.png}|balise_img{<:album:filtre_albums_vides:>})]
	[(#ENV{media}|?{</a>,</strong>})]
	</li>
	
	[<!--(#REM) Filtre : vides -->]
	<li class='vides'>
	[(#GET{albums_vides}|oui)
		[(#SET{titre_vide,<:album:filtre_albums_vides:>})]
		[(#ENV{media}|match{'non'}|?{
			<a href='[(#GET{self}|parametre_url{media,''})]' class='ajax on' alt='<:album:filtre_albums_vides:>' title='<:album:filtre_albums_vides:>'>,
			<a href='[(#GET{self}|parametre_url{media,'non'})]' class='ajax' alt='<:album:filtre_albums_vides:>' title='<:album:filtre_albums_vides:>'>
		})]
	]
	[(#GET{albums_vides}|non) 
		[(#SET{titre_vide,<:album:info_aucun_album_vide:>})]
		<span class='off'> 
	]
	[(#CHEMIN_IMAGE{icone-vide-couleur-24.png}|balise_img{#GET{titre_vide}}|inserer_attribut{title,#GET{titre_vide}})]
	[(#GET{albums_vides}|?{</a>,</span>})]
	</li>
	
	[<!--(#REM) Filtres : medias -->]
	<BOUCLE_contenus(DATA){liste #GET{medias_contenus}}>

	[<!--(#REM) icones -->]
	<li class='#VALEUR'>
	#SET{titre, #VAL{medias:des_}|concat{#VALEUR}|concat{s}|_T|replace{'@nb@ ',''}}
	[(#VALEUR|match{#ENV{media}}|oui)
		#SET{retirer_media, #ENV{media}|supprimer_element_concat{#VALEUR,'|'}}
		<a href='[(#GET{self}|parametre_url{media,#GET{retirer_media}})]' class='ajax on' alt='[(#GET{titre})]' title='[(#GET{titre})]'>
	]
	[(#VALEUR|match{#ENV{media}}|non)
		[(#ENV{media}|?{#SET{ajouter_media,#ENV{media}|concat{'|'}|concat{#VALEUR}}, #SET{ajouter_media,#ENV{media}|concat{#VALEUR}}})]
		[(#ENV{media}|match{'non'}|?{
		<a href='[(#GET{self}|parametre_url{media,#VALEUR})]' class='ajax' alt='[(#GET{titre})]' title='[(#GET{titre})]'>,
		<a href='[(#GET{self}|parametre_url{media,#GET{ajouter_media}})]' class='ajax' alt='[(#GET{titre})]' title='[(#GET{titre})]'>
		})]
	]
	[(#SET{fichier_image, [media-(#VALEUR|strtolower)-24.png]})] [(#VALEUR|=={'file'}|oui) #SET{fichier_image,'document-24.png'}]
	[(#CHEMIN_IMAGE{#GET{fichier_image}}|balise_img{#VAL{medias:des_}|concat{#VALEUR}|concat{s}|_T|replace{'@nb@ ',''}})]
	</a>
	</li>	
	</BOUCLE_contenus>
	
	<BOUCLE_non_contenus(DATA){liste #GET{medias_non_contenus}}>
	#SET{titre, pas de #VAL{medias:des_}|concat{#VALEUR}|concat{s}|_T|replace{'@nb@ ',''}|replace{s$,''}|concat{&nbsp;dans les albums}}
	<li class='#VALEUR'>
	<span class='off'>
	[(#SET{fichier_image, [media-(#VALEUR|strtolower)-24.png]})] [(#VALEUR|=={'file'}|oui) #SET{fichier_image,'document-24.png'}]
	[(#CHEMIN_IMAGE{#GET{fichier_image}}|image_nb|inserer_attribut{'alt',#GET{titre}}|inserer_attribut{'title',#GET{titre}})]
	</span>
	</li>
	</BOUCLE_non_contenus>
	
	</ul>
	<div class="nettoyeur"></div>
</div>

<div class="nettoyeur"></div>
#FORMULAIRE_RECHERCHE_ECRIRE{#SELF,ajax}

[(#INCLURE{fond=prive/objets/liste/albums_galerie,selection=#GET{selection},classe=galerie,ajax,env})]

[(#AUTORISER{creer,album})
	[(#URL_ECRIRE{album_edit,new=oui}|icone_verticale{<:album:icone_creer_album:>,album,new,right})]
]
