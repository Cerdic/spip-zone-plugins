<script type="lib/json.js"></script>
<script type="text/javascript">
function modifier(id_groupe) {
	//On charge la liste des zones
	var id = id_groupe;
	$.get('http://#ENV{urlajax}?exec=liste_zones', {id_groupe:id}, function(data) {
		var tmpNom = $('#grp_nom_'+id).text();
		$('#grp_nom_'+id).html('<input type="text" name="grp_nom_'+id+'" value="'+tmpNom+'"/><input type="hidden" name="grp_tmp_'+id+'" value="'+tmpNom+'"/><form id="grp_zone_'+id_groupe+'">'+data+'</form>');		
		var t = $('#grp_nom_'+id);
		t[0].firstChild.focus();
	}, 'text');
	$('#grp_mod_'+id).html('<input type="button" value="modifier" onclick="modifierAction(\''+id+'\');"/>');
	
}

function modifierAction(id) {
	var t = $('#grp_nom_'+id);
	var nom = t[0].firstChild.value;
	var zones = $('#zones_'+id)[0].options;
	var arr_zones = new Array();
	for(var i=0; i<zones.length; i++) {
		if(zones[i].selected) {
			arr_zones.push(zones[i].value);
		}
	}
	$.get('http://#ENV{urlajax}?exec=groupe_modifier', {nom_groupe:nom, id_groupe:id, zones:JSON.stringify(arr_zones)},
			function(data) {
				if(data=='-1') {
					var t2 = $('#grp_tmp_'+id);
					$('#grp_nom_'+id).html(t2[0].firstChild.value);
					$('#resultat').text('<:groupes:pas_nom:>');
				} else if(data=='0') {
					$('#grp_nom_'+id).html(nom);
					$('#resultat').text('<:groupes:mod_ok:>');
				}
				$('#grp_mod_'+id).html('<a href="#" onclick="modifier('+id+')"><:groupes:mod:></a>');
			},'text');
}

function supprimer(id) {
	var nom = $('#grp_nom_'+id).text();
	if(window.confirm('<:groupes:conf_suppr:> '+nom+'?')) {
		supprimerAction(id);
	}
}

function supprimerAction(id) {
	$.get('http://#ENV{urlajax}?exec=groupe_supprimer', {id_groupe : id}, 
				function(data){
					var t = $("#grp_ligne_"+id)
					t.remove();
				}
				, 'text');
}
</script>
<div id="resultat"></div>
<B_grp>
<table>
<tr>
	<th><:groupes:nom:></th>
	<th><:groupes:mod:></th>
	<th><:groupes:suppr:></th>
	<th><:groupes:liste_auteurs_groupe:></th>
</tr>
<BOUCLE_grp(GROUPES)>
<tr id="grp_ligne_#ID_GROUPE">
	<td id="grp_nom_#ID_GROUPE">#NOM</td>
	<td id="grp_mod_#ID_GROUPE"><a href="#" onclick="modifier(#ID_GROUPE);"><:groupes:mod:></a></td>
	<td id="grp_sup_#ID_GROUPE"><a href="#" onclick="supprimer(#ID_GROUPE, '#NOM');"><:groupes:suppr:></a></td>
	<td><a href="?exec=groupes&page=liste_auteurs_groupe&id_groupe=#ID_GROUPE"><:groupes:liste_auteurs_groupe:></a></td>
</tr>
</BOUCLE_grp>
</table>
</B_grp>

#FORMULAIRE_AJOUTER_GROUPE