#CACHE{24*86400}
<?php // Retrieve some Spip DB values
$req = array(   'total_visites' => array('SUM(visites)','spip_visites'),
                'nb_articles' => array('COUNT(*)','spip_articles', 'statut = "publie"'),
                'nb_auteurs' => array('COUNT(*)','spip_auteurs', 'statut <> "nouveau"'),
                'visites_articles' => array('SUM(visites)','spip_articles')
                );

global $total_visites, $nb_articles, $nb_auteurs, $visites_articles;

function defineFromSpip($var, $sql, $table, $where)     // Define variables from Spip and ...
        {
        global $$var;                                   // ... make them globals ;-)

        $query = "SELECT ".$sql." AS truc FROM ".$table.(($where) ? ' WHERE '.$where : "");
        $result = spip_query($query);
        if ($row = spip_fetch_array($result))
                {
                $$var = $row['truc'];
                }
        }

foreach($req as $k=>$v)                                 // Parse requested values
        {
        defineFromSpip($k, $v[0], $v[1], $v[2]);
        }
echo '#NOM_SITE_SPIP '._T('acs:ours_visites', array(
'nb_articles' => $nb_articles,
'nb_auteurs' => $nb_auteurs,
'visites_articles' => $visites_articles,
'total_visites' => $total_visites
));
?>