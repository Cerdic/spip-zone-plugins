[(#REM)
               ACS
           (Plugin Spip)
      http://acs.geomaticien.org

  Copyright Daniel FAIVRE, 2007-2010
  Copyleft: licence GPL - Cf. LICENCES.txt

  JS interface d'admin d'ACS - ACS admin GUI
]#HTTP_HEADER{'Content-Type: text/javascript'}

function detail() {
	imgp = $(".imgp_spip_params").attr("src");
	if (imgp) {
		plon = $(".imgon_spip_params").attr("src");
		if (imgp == plon)
			return "&detail=2";
	}
	return "";
}

function mode_source() {
	if ($("#mode_source").attr("name") == "srcon")
		return "&mode=source";
	return "";
}

[(#REM) creation d'une nouvelle instance d'un composant]
var instance_create_input = false;
function instance_create(nic) {
  if (instance_create_input == false) {
    $("#form_instance_create").append('<input id="nic" type="text" name="nic"  size="4" maxlength="4" value="' + nic + '" />');
    instance_create_input = true;
    return false;
  }
  return true;
}
[(#REM) suppression de l'instance active d'un composant]
function instance_delete(msg) {
  if (confirm(msg))
    return true;
  else
    return false;
}

$(document).ready(
	function() {
    acs_ecrire_init();
		onAjaxLoad(acs_ecrire_init);
	}
);

function acs_ecrire_init() {
	if (detail() == "") {
		$(".pliable").each(
			function(i) {
				$(this).hide();
			}
		);
	}

  [(#REM) Donne leur fonction onclick aux plieurs (générique)]
	$(".acs_plieur").each(
		function(i, plieur) {
			var cap = plieur.name.substr(7); //classe à plier
			if ((typeof plieur.onclick) != "undefined") {
				plieur.clic = plieur.onclick.toString();
			}
			plieur.onclick = function(e) {
				e.preventDefault();
				imgp = $(".imgp_" + cap).attr("src");
				ploff = $(".imgoff_" + cap).attr("src");
				plon = $(".imgon_" + cap).attr("src");
				if (imgp == ploff)
					$(".imgp_" + cap).attr("src", plon)
				else
					$(".imgp_" + cap).attr("src", ploff)
				$("." + cap).each(
					function(i, cap) {
						$(cap).slideToggle("slow");
					}
				);
				if ((typeof plieur.clic) != "undefined") {
					eval(plieur.clic + ";onclick(e);");
				}
				return false;
			}
		}
	);

	// Retourne les infos sur la page avec le niveau de détail défini par le plieur 
	// get page infos with detail level setted by plieur
	$(".page_lien").each(
		function(i,link) {
			link.onclick = function(e) {
				AjaxSqueeze("?exec=acs_page_get_infos&pg=" + link.title + detail() + mode_source(), "page_infos");
				document.location.href = "#page_infos";
				return false;
			}
		}
	);

	$("#mode_source").each(
	function(i, link) {
	  link.onclick = function(e) {
	    AjaxSqueeze("?exec=acs_page_get_infos&pg=" + link.title + detail() + "&mode=source", "page_infos");
	    document.location.href = "#page_infos";
	      return false;
	    }
	  }
	);

	$("#mode_schema").each(
	  function(i, link) {
	    link.onclick = function(e) {
	      AjaxSqueeze("?exec=acs_page_get_infos&pg=" + link.title + detail() + "&mode=schema", "page_infos");
	      document.location.href = "#page_infos";
	      return false;
	    }
	  }
	);

  // Mask select controls on start (they works even without javascript !)
  $(".ctlWidget").each(
    function(i,cw) {
      var selectid = "#select_" + cw.id;
      $(selectid).attr("style", "visibility: hidden;");
      if ($(selectid).get(0)) $(selectid).get(0).style.visibility = "hidden"; // for IE damned browser 
      if ($(selectid).val() != '') { 
        var dragid = "#" + $(selectid).val();
        $(this).append($(dragid));
      }
    }
  );

[(#ENV{jquery_version}|=={1}|?{
   [(#INCLURE{javascript/acs_dragdrop.js})],
   [(#INCLURE{javascript/acs_dragdrop_for_older_jquery.js})]
})]

}

