[(#REM)
               ACS
           (Plugin Spip)
      http://acs.geomaticien.org

  Copyright Daniel FAIVRE, 2007-2011
  Copyleft: licence GPL - Cf. LICENCES.txt

  JS interface d'admin d'ACS - ACS admin GUI
]#HTTP_HEADER{'Content-Type: text/javascript'}
[(#INCLURE{fond=javascript/acs_lib.js})]

function detail() {
	imgp = $(".imgp_spip_params").attr("src");
	if (imgp) {
		plon = $(".imgon_spip_params").attr("src");
		if (imgp == plon)
			return "&detail=2";
	}
	return "";
}

function mode_source() {
	if ($("#mode_source").attr("name") == "srcon")
		return "&mode=source";
	return "";
}

[(#REM) creation d'une nouvelle instance d'un composant]
var instance_create_input = false;
function instance_create(nic) {
  if (instance_create_input == false) {
    $("#form_instance_create").append('<input id="nic" type="text" name="nic"  size="4" maxlength="4" value="' + nic + '" />');
    instance_create_input = true;
    return false;
  }
  return true;
}
[(#REM) suppression de l'instance active d'un composant]
function instance_delete(msg) {
  if (confirm(msg))
    return true;
  else
    return false;
}

$(document).ready(
	function() {
    acs_ecrire_init();
    acs_ecrire_init_ajax(false);
		onAjaxLoad(acs_ecrire_init_ajax);
	}
);

function acs_ecrire_init() {
	if (detail() == "") {
		$(".pliable").each(
			function(i) {
				$(this).hide();
			}
		);
	}

	// Retourne les infos sur la page avec le niveau de détail défini par le plieur 
	// get page infos with detail level setted by plieur
	$(".page_lien").each(
		function(i,link) {
			link.onclick = function(e) {
				AjaxSqueeze("?exec=acs_page_get_infos&pg=" + link.title + detail() + mode_source(), "page_infos");
				document.location.href = "#page_infos";
				return false;
			}
		}
	);

[(#ENV{jquery_version}|=={1}|?{
   [(#INCLURE{javascript/acs_dragdrop.js})],
   [(#INCLURE{javascript/acs_dragdrop_for_older_jquery.js})]
})]

}

function acs_ecrire_init_ajax(ajax) {
  if (ajax == null)
    ajax=true;

  acs_ecrire_init()

  draw_ctlWidgets();

  [(#REM) Donne leur fonction onclick aux plieurs (générique)]
  $(".acs_plieur").each(
    function(i, plieur) {
      var cap = plieur.name.substr(7); //classe à plier
      if ((typeof plieur.onclick) != "undefined") {
        plieur.clic = plieur.onclick.toString();
      }
      plieur.onclick = function(e) {
        e.preventDefault();
        imgp = $(".imgp_" + cap).attr("src");
        ploff = $(".imgoff_" + cap).attr("src");
        plon = $(".imgon_" + cap).attr("src");
        if (imgp == ploff)
          $(".imgp_" + cap).attr("src", plon)
        else
          $(".imgp_" + cap).attr("src", ploff)
        $("." + cap).each(
          function(i, cap) {
            $(cap).slideToggle("slow");
          }
        );
        if ((typeof plieur.clic) != "undefined") {
          if (!ajax) 
            eval(plieur.clic + ";onclick(e);");
        }
        return false;
      }
    }
  );
  
  $("#mode_source").each(
  function(i, link) {
    link.onclick = function(e) {
      AjaxSqueeze("?exec=acs_page_get_infos&pg=" + link.title + detail() + "&mode=source", "page_infos");
      document.location.href = "#page_infos";
        return false;
      }
    }
  );

  $("#mode_schema").each(
    function(i, link) {
      link.onclick = function(e) {
        AjaxSqueeze("?exec=acs_page_get_infos&pg=" + link.title + detail() + "&mode=schema", "page_infos");
        document.location.href = "#page_infos";
        return false;
      }
    }
  );
}

