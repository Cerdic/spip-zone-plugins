<div class="formulaire_spip formulaire_#FORM" id="formulaire_#FORM-#ENV{id}">
	[<p class='reponse_formulaire reponse_formulaire_ok'>(#ENV*{message_ok})</p>]
	[<p class='reponse_formulaire reponse_formulaire_erreur'>(#ENV*{message_erreur})</p>]
	<BOUCLE_si_editable(CONDITION){si #ENV{editable}|oui}>
	<form method='post' action='#ENV{action}'><div>
		[(#REM) declarer les hidden qui declencheront le service du formulaire
		parametre : url d'action ]
		#ACTION_FORMULAIRE{#ENV{action}}
		<div class="editer-groupe">
			<div class="editer editer_str_orig readonly">
				<BOUCLE_orig(TRADLANGS){id=#ENV{id}}{lang=#ENV{lang_orig}}{0,1}>
				[(#SET{comm_orig,#COMM})][(#SET{lines,#STR*|strlen|div{40}|intval|plus{1}})]
				[(#ENV{lang_orig}|=={#ENV{lang_mere}}|oui)<label><:tradlang:label_version_originale{lang=#ENV{lang_orig}}:></label>]
				[(#ENV{lang_orig}|=={#ENV{lang_mere}}|non)<label><:tradlang:label_version_selectionnee{lang=#ENV{lang_orig}}:></label>]
				<textarea class="texte" name="lang_orig" id="lang_orig_str" readonly="readonly" style="text-align:#LANG_LEFT;" dir="#LANG_DIR" rows="#GET{lines}">[(#STR*|tradlang_utf8|entites_html)]</textarea>
				</BOUCLE_orig>
				</B_orig>
				<BOUCLE_mere(TRADLANGS){id=#ENV{id}}{lang=#ENV{lang_mere}}{0,1}>
				[(#SET{comm_orig,#COMM})][(#SET{lines,#STR*|strlen|div{40}|intval|plus{2}})]
				<label><:tradlang:label_version_originale{lang=#ENV{lang_mere}}:></label>
				<textarea class="texte" name="lang_orig" id="lang_orig_str" readonly="readonly" style="text-align:#LANG_LEFT;" dir="#LANG_DIR">[(#STR*|tradlang_utf8|entites_html)]</textarea>
				</BOUCLE_mere>
				<//B_orig>
				<input type="hidden" class="hidden" value="#ENV{lang_orig}" />
			</div>
			<div class='editer editer_str obligatoire[(#ENV{erreurs}|table_valeur{str}|oui)erreur]'>
				<label for='str'><:tradlang:label_tradlang_str{lang=#ENV{langue}}:></label>[
				<span class="erreur_message">(#ENV{erreurs}|table_valeur{str})</span>]
				<textarea class="texte" name="str" id="str" rows="#GET{lines}">[(#ENV**{str}|tradlang_utf8)]</textarea>
			</div>
			[(#COMM|oui)<div class='editer editer_comm_orig readonly'>
				[(#ENV{lang_orig}|=={#ENV{lang_mere}}|oui)<label><:tradlang:label_version_originale_comm{lang=#ENV{lang_orig}}:></label>]
				[(#ENV{lang_orig}|=={#ENV{lang_mere}}|non)<label><:tradlang:label_version_selectionnee_comm{lang=#ENV{lang_orig}}:></label>]
				<textarea class="texte" name="comm_orig" id="comm_orig" readonly="readonly" style="text-align:#LANG_LEFT;" dir="#LANG_DIR">[(#GET*{comm}|entites_html)]</textarea>
			</div>]
			<div class="editer editer_statut obligatoire[(#ENV{erreurs}|table_valeur{statut}|oui)erreur]">
				<div class="alert alert-warning notice_statut" style="display:none;">
					<:tradlang:crayon_changer_statut:>
				</div>
				<label for="statut"><:tradlang:label_tradlang_status:></label>[
				<span class="erreur_message">(#ENV{erreurs}|table_valeur{statut})</span>]
				<select class="text crayon_active" name="statut" id="statut">
					<option value="OK"[(#STATUT|=={OK}|oui)selected="selected"]><:tradlang:str_status_traduit:></option>
					<option value="RELIRE"[(#STATUT|=={RELIRE}|oui)selected="selected"]><:tradlang:str_status_relire:></option>
					<option value="MODIF"[(#STATUT|=={MODIF}|oui)selected="selected"]><:tradlang:str_status_modif:></option>
					<option value="NEW"[(#STATUT|=={NEW}|oui)selected="selected"]><:tradlang:str_status_new:></option>
				</select>
			</div>
		</div>
		<p class='boutons'>
			<input type='submit' class='btn btn-primary' value='<:bouton_valider|attribut_html:>' />
		</p>
	</div></form>
	</BOUCLE_si_editable>
</div>

<script type='text/javascript'>
	jQuery(function(){
		var contenu_orig = '[(#ENV**{str}|html2unicode|tradlang_utf8|replace{"\n","_"}|replace{"\r",""}|replace{"\t",""})]',
			statut_orig = '#STATUT';
		var $me = jQuery('#formulaire_[#FORM-(#ENV{id})]');
		var $notice = $me.find('.notice_statut');
		jQuery('form', $me).submit(function(){
			var newstatut = jQuery(this).find('#statut').val();
			var new_contenu = jQuery(this).find('#str').val().replace(/\n/,'_');
			if((new_contenu != contenu_orig) && (newstatut != 'OK'))
				if(!window.confirm('<:tradlang:crayon_changer_statut|filtrer_entites|texte_script:>'))
					return false;
		});
		function check_str_changes(){
			var newstatut = jQuery('#statut', $me).val();
			var new_contenu = jQuery('#str', $me).val().replace(/\n/,'_');
			if((new_contenu != contenu_orig) && (newstatut != 'OK') && $notice.is(':hidden'))
				{$notice.toggle();jQuery('#statut', $me).closest('.editer').addClass('error');}
			else if((new_contenu == contenu_orig) && $notice.is(':visible'))
				{$notice.toggle();jQuery('#statut', $me).closest('.editer').removeClass('error');}
		}
		jQuery('#str', $me).keyup(check_str_changes);
		check_str_changes();
		jQuery('#statut', $me).change(function(){
			var newstatut = jQuery(this).val();
			var new_contenu = jQuery('#str', $me).val().replace(/\n/,'_');
			if((new_contenu != contenu_orig) && (newstatut != 'OK') && (newstatut == statut_orig) && $notice.is(':hidden'))
				{$notice.toggle();jQuery('#statut', $me).closest('.editer').addClass('error');}
			else if((new_contenu != contenu_orig) && (newstatut == 'OK') && $notice.is(':visible'))
				{$notice.toggle();jQuery('#statut', $me).closest('.editer').removeClass('error');}
			else if((new_contenu == contenu_orig) && $notice.is(':visible'))
				{$notice.toggle();jQuery('#statut', $me).closest('.editer').removeClass('error');}
		});
	})

</script>