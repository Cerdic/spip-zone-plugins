<div class='formulaire_spip formulaire_editer formulaire_#FORM formulaire_#FORM-#ENV{id_carte,nouveau}'>
	[<p class="reponse_formulaire reponse_formulaire_ok">(#ENV**{message_ok})</p>]
	[<p class="reponse_formulaire reponse_formulaire_erreur">(#ENV*{message_erreur})</p>]

	<BOUCLE_si_editable(CONDITION){si #ENV{editable}|oui}>
	<form method="post" action="#ENV{action}"><div>
		#ACTION_FORMULAIRE{#ENV{action}}
		<input type="hidden" name="id_carte" value="#ENV{id_carte}" />
		<div class="editer-groupe">
 
			[(#SAISIE{input, titre, obligatoire=oui,
				label=<:carte:champ_titre_label:>})]
 
			[(#SAISIE{textarea, texte,
				label=<:carte:champ_texte_label:>})]
 
			[(#SAISIE{input, style_carte,
				label=<:carte:champ_style_carte_label:>})]
 
			[(#SAISIE{input, footer_carte,
				label=<:carte:champ_footer_carte_label:>})]
			
			[(#SAISIE{textarea, texte_footer,
				label=<:carte:champ_texte_footer_label:>})]
			
			#SET{layers,#ARRAY{none,#VAL{carte:option_aucun_layer}|_T}}
			<BOUCLE_layer(DATA){source table, #EVAL{$GLOBALS['gis_layers']}}>
			#SET{layers,#GET{layers}|array_merge{#ARRAY{#CLE,#VALEUR|table_valeur{nom}}}}
			</BOUCLE_layer>
			[(#SET{layer_defaut,#CONFIG{gis/layer_defaut,openstreetmap_mapnik}})]
			[(#VAL{_GIS_LAYER_DEFAUT}|defined|oui)
				[(#SET{gis_layer_defaut,[(#EVAL{_GIS_LAYER_DEFAUT})]})]
			]

			[(#SAISIE{selection,layer_defaut,
				label=<:gis:cfg_lbl_layer_defaut:>,
				cacher_option_intro=oui,
				defaut=#GET{layer_defaut},
				datas=#GET{layers}})]
				
			#SET{layers_topojson,#ARRAY}
			<BOUCLE_layers_topojson(DATA){source pregfiles, #EVAL{_DIR_RACINE}, .topojson$, 5}>
			[(#VALEUR|match{topojson_carte}|oui)
			#SET{layers_topojson,#GET{layers_topojson}|array_merge{#ARRAY{#VALEUR|replace{'\.\./',''},#VALEUR|basename}}}]
			</BOUCLE_layers_topojson>
			[(#SAISIE{selection,layer_topojson,
				label=<:carte:champ_layer_topojson_label:>,
				option_intro=<:carte:option_aucun_layer:>,
				defaut='',
				datas=#GET{layers_topojson}})]

			[(#SAISIE{selection,popup,
				label=<:carte:champ_popup_label:>,
				cacher_option_intro=oui,
				datas=#ARRAY{
					openpopup,<:carte:option_openpopup:>,
					control,<:carte:option_control:>}})]
			<div class="fieldset">
				<fieldset>
					<legend><:carte:legend_centrage:></legend>
					[(#SET{geojson_centre,[\{"type": "FeatureCollection","features": \[\{"type": "Feature","geometry": \{"type":"Point","coordinates":\[(#LON),[(#LAT)]\]\},"id":"centre","properties": \{\}\}\]\}]})]
					[(#SAISIE{carte, centre,
						recherche=non,
						noimport=oui,
						nodraw=oui,
						lat=#LAT,
						lon=#LON,
						champ_zoom=zoom_defaut,
						zoom=[(#ZOOM_DEFAUT|sinon{#CONFIG{gis/zoom,0}})],
						champ_geojson=geojson_centre,
						champ_type=type_centre,
						geojson=#GET{geojson_centre}})]
					[(#SAISIE{input,lat,
						label=<:gis:lat:>,
						defaut=#ENV{lat,#CONFIG{gis/lat,0}}})]
					[(#SAISIE{input,lon,
						label=<:gis:lon:>,
						defaut=#ENV{lon,#CONFIG{gis/lon,0}}})]
					[(#SAISIE{input,zoom_defaut,
						label=<:carte:champ_zoom_defaut_label:>,
						defaut=#ENV{zoom_defaut,#CONFIG{gis/zoom,0}},
						size=2,
						maxlength=2})]
					[(#SAISIE{case,center_points,
						label=<:carte:champ_center_points_label:>})]
				</fieldset>
			</div>

			[(#SAISIE{input, zoom_min,
				label=<:carte:champ_zoom_min_label:>})]
 
			[(#SAISIE{input, zoom_max,
				label=<:carte:champ_zoom_max_label:>})]
 			<div class="fieldset">
				<fieldset>
					<legend><:carte:champ_bounds_label:></legend>
					[(#SAISIE{carte, bounds,
						recherche=non,
						geojson=#ENV{geojson},
						noimport=oui,
						nomajinputs=oui,
						boutons=#ARRAY{marker,non,polyline,non,polygon,non}})]
				</fieldset>
			</div>
			<div class="fieldset">
				<fieldset>
					<legend><:carte:legend_controles:></legend>
					[(#SAISIE{checkbox, controles,
						label=<:carte:champ_controles_label:>,
						defaut=#ARRAY,
						datas=#ARRAY{
							fullscreen,<:carte:option_fullscreen:>,
							scale,<:carte:option_scale:>,
							overview,<:carte:option_overview:>}})]
				</fieldset>
			</div>
		</div>
		[(#REM) ajouter les saisies supplementaires : extra et autre, a cet endroit ]
		<!--extra-->
		<p class="boutons"><input type="submit" class="submit" value="<:bouton_enregistrer:>" /></p>
	</div></form>
	</BOUCLE_si_editable>
</div>