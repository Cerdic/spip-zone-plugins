[(#REM)
	Note : utilise My_jQuery à la place de jQuery :
	c'est un hack pour SPIP 3.0 et son vieux jQuery 1.7
]

<script type="text/javascript">
(function($){
$(document).ready(function(){
	$('body.plan #contenu #racine').spiptree({
		drag: [(#AUTORISER{configurer}|?{true,false})],
		statut: "#ENV{statut}",
		urls: {
			plan: "[(#VAL{plan}|generer_url_action{"", 1})]",
			deplacer: "[(#VAL{deplacer_objets}|generer_url_action{"", 1})]"
		},
		default: {
			icon: "[(#VAL{rubrique}|objet_icone{16}|extraire_attribut{src})]"
		},
		objets: [
			<BOUCLE_objets(DATA){source table,#REM|plan_lister_objets_rubrique}{", "}>
			{
				icon: "[(#VALEUR|objet_icone{16}|extraire_attribut{src})]",
				type: "[(#VALEUR|objet_type)]"
			}
			</BOUCLE_objets>
		]
	});
	$('body.plan #contenu #mytree_actions .pliage').html(
		"<a href=\"#\" onClick=\"My_jQuery('#racine').jstree('open_all'); return false;\"><:lien_tout_deplier:></a> | " +
		"<a href=\"#\" onClick=\"My_jQuery('#racine').jstree('close_all'); return false;\"><:lien_tout_replier:></a>"
	);
});
})(My_jQuery);
</script>

<div id="mytree_actions">
	<input id="mytree_search" class="input" type="text" value="" placeholder="<:info_rechercher|attribut_html:>">

	<span class='pliage'>
		[(#REM) Sera enlevé par le javascript ]
		[(#ENV{lister}|non)
			<a href="[(#SELF|parametre_url{lister,tout})]"><:info_tout_afficher:></a>
		]
	</span>

[(#SET{statut,[(#ENV{statuts}|?{[(#ENV{statuts}|explode{-}|end)],#NULL})]})]
[(#SET{objet,[(#ENV{statuts}|?{[(#ENV{statuts}|explode{-}|reset)],#NULL})]})]

	<span class='statut #GET{objet}'>
		<B_objets_statuts>
			<form method="GET" action="#SELF" onChange="this.submit(); return true;">
			[(#SELF|parametre_url{statuts,''}|form_hidden)]
			<select name="statuts" id="selection_statut">
				<option value=""[(#ENV{statuts}|non) selected="selected"]><:plan:tous_les_statuts:></option>
		<BOUCLE_objets_statuts(DATA){source table, #REM|plan_lister_objets_rubrique_statuts}>
				<optgroup label="[(#CLE|objet_info{texte_objets}|_T)]" class="#CLE">
					<BOUCLE_statuts(DATA){source table, #VALEUR}>
						[(#SET{class,[(#_objets_statuts:CLE)]-#CLE})]
						<option class="#GET{class}" value="#GET{class}"[(#ENV{statuts}|=={#GET{class}}|oui) selected="selected"]>#TITRE</option>
					</BOUCLE_statuts>
				</optgroup>
		</BOUCLE_objets_statuts>
			</select>
			</form>
		</B_objets_statuts>
	</span>
</div>

#BOITE_OUVRIR{'', simple}
<div id="racine">
<INCLURE{fond=prive/squelettes/inclure/plan-rubriques, id_parent=0, statut=#GET{statut}, objet=#GET{objet}, lister}>
</div>
#BOITE_FERMER
