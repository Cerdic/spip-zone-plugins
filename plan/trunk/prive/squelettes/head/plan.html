<INCLURE{fond=prive/squelettes/head/dist, env}>

[<link rel="stylesheet" href="(#CHEMIN{lib/jstree/dist/themes/default/style.min.css})" />]
[<script src="(#CHEMIN{lib/jstree/dist/jstree.min.js})"></script>]


<script type="text/javascript">
(function($){
$(document).ready(function(){
	$(function () {

		$mytree = $('body.plan #contenu #racine');
		$mytree.jstree({
			"plugins" : [ "types", "search", "state" ],
			"core" : {
				/*
				"data" : function (node, cb) {
					console.log(node);
					return true;
				}*//*,
				"themes" : {
					"variant" : "large"
				}*/
			},
			"search" : {
				"show_only_matches" : true,
			},
			"types" : {
				"default" : {
					"icon" : "[(#VAL{rubrique}|objet_icone{16}|extraire_attribut{src})]",
				}
				<BOUCLE_objets(DATA){source table,#REM|plan_lister_objets_rubrique}>
				,"[(#VALEUR|objet_type)]" : {
					"icon" : "[(#VALEUR|objet_icone{16}|extraire_attribut{src})]",
				}
				</BOUCLE_objets>
			}
		});

		// un clic d'une feuille amène sur son lien
		// mais… éviter que le plugin 'state' clique automatiquement lorsqu'il restaure
		// la sélection précédente !
		$mytree.one("restore_state.jstree", function () {
			$(this).on("changed.jstree", function (e, data) {
				data.instance.save_state();
				location.href = data.instance.get_node(data.node, true).children('a').attr('href');
			});
		});


		// recherche automatique
		$mytree_search = $("#mytree_search");

		var to = false;
		$mytree_search.keyup(function () {
			if (to) { clearTimeout(to); }
			to = setTimeout(function () {
				var v = $mytree_search.val();
				$mytree.jstree(true).search(v);
			}, 250);
		});

	});
});
})(jQuery);
</script>

<style type='text/css'>
#mytree_actions { margin-bottom:1em; margin-top:1em; }
#mytree_actions input,
#mytree_actions .pliage { margin-right:2em; }
</style>
