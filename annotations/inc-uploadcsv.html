#CACHE{86400}
[<script type="text/javascript" src="(#CHEMIN{javascript/jquery.MultiFile.js})"></script>
][<script type="text/javascript" src="(#CHEMIN{javascript/jquery.upload_attach.js})"></script>
]




			<div id="tous_docs">
			<INCLURE{fond=modeles/upload_documents_auteurs}>
			</div>



<script type="text/javascript"><!--

var load_zone_documents = function() {

	var r = ($(this).attr('href')||'').match(/[?&;]debut_tous=([0-9]+)/);
	r = r ? r[1] : 0;
	$('#tous_docs')
	.addClass('ajaxloading')
	.css({'opacity': 0.5});
	$.get(
		'#URL_PAGE{annotation_mini_formulaire_upload}&liste=1&debut_tous='+r,
		function(c) {
			$('#tous_docs')
			.html(
				$('<iframe>').html(c).find('#tous_docs').html()
			)
			.removeClass('ajaxloading')
			.css({'opacity':1.0});
			pagination_zone();
		}
	);
	return false;
};

var pagination_zone = function() {
	$('#zone-documents')
	.prev('.pagination')
	.find('a')
	.click(load_zone_documents);
};
pagination_zone();

// --></script>


		#FORMULAIRE_UPLOAD{auteur,upload_annotation}


<script type='text/javascript'><!--
if (window.jQuery && jQuery.fn.ajaxForm) {
	window.jQuery(function() {
		var bind_pagination = function() {
			var self = this;
      //bind click
		  $("a.annotate_document",self).click(function(){
  			$.carto.annotate_window.idCsv = this.id.match(/\d+/);
  			$.carto.annotate_window.showAnnotatePanel(4);
  		});
  		// si on reattache les evenements, remettre les crayons
			if (window.cQuery)
			   cQuery(".crayon:lt(1000)",this).initcrayon();


			$('.pagination a',self)
			.click(function(){
				var r = ($(this).attr('href')||'').match(/[?&;]debut_docs=([0-9]+)/);
				r = r ? r[1] : 0;
				$(self)
				.addClass('ajaxloading')
				.css({'opacity': 0.5});
				$.get(
					'#URL_PAGE{annotation_mini_formulaire_upload}&debut_docs='+r,
					function(c) {
						//avoid a bug when script are loaded with <script> in the <head>
						//jQuery insert them in the parent window
						//Since we want only the .formualaire upload element
						//we can inject it alone without the head
						var body = c.match(/<body>(?:.|\s)*?<\/body>/i);
            if(body) c = body[0]; 
            
            $(self)
						.removeClass('ajaxloading')
						.css({'opacity': 1.0})
						.html(
							$('<iframe>').html(c).find('.formulaire_upload').html()
						).
						upload_attach(options).
            each(bind_pagination);
					}
				);
				return false;
			});    
    };
		//options
		//-url (string)
		//-callback (function)
    var options = {
			url: '#URL_PAGE{annotation_mini_formulaire_upload}',
			callback: function() {
				load_zone_documents(); // recharge la partie du milieu
        //la pagination, les crayons, les evenements
        $(this).each(bind_pagination);
			}
		};
	
		jQuery('#annotate_window .formulaire_upload')
		.upload_attach(options)
		// et la pagination
		.each(bind_pagination);
	});
}
// --></script>
