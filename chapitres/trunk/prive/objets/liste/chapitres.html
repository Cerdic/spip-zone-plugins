[(#SET{defaut_tri,#ARRAY{
	titre,1,
	date,-1,
	id_chapitre,1,
	points,-1
}})]
#SET{is_enfant,#ENV{id_parent}|ou{#ENV{objet}|=={chapitre}}}
#SET{is_plan,#ENV{arbo}|=={oui}|et{#ENV{id_parent}|intval|=={0}}}
#SET{is_plie,#VAL{chapitres_vue}|_request|=={plie}}
#SET{pagination,#ENV{pagination,#GET{is_plan}|?{n,10}}}
#SET{compteur,0}
<B_liste_chapitres>
#ANCRE_PAGINATION
<div class="liste-objets chapitres[ (#GET{is_plan}|oui)plan][ (#GET{is_plie}|oui)plie]">
<table class="spip liste">
	#SET{total, #GRAND_TOTAL}
	<BOUCLE_total_chapitres (CHAPITRES) {si #ENV{arbo}|=={oui}}{branche #ID_PARENT}{objet?}{id_objet?}{id_mot?}{where?}{statut?}{recherche?}>
	#SET{total, #TOTAL_BOUCLE}
	</BOUCLE_total_chapitres>
	[<caption>
		<a href="[(#SELF|parametre_url{chapitres_vue,#GET{is_plie}|?{'',plie}})]" class="ajax preload">
			<strong class="caption">
				(#ENV*{titre,#GET{total}|singulier_ou_pluriel{#GET{is_enfant}|?{chapitre:info_1_chapitre_enfant,chapitre:info_1_chapitre},#GET{is_enfant}|?{chapitre:info_nb_chapitres_enfants,chapitre:info_nb_chapitres}}})
				[<span class="label-pliage">(#GET{is_plie}|?{<:chapitre:bouton_deplier:>,<:chapitre:bouton_plier:>})</:chapitre:bouton_plier:></span>]
			</strong>
		</a>
	</caption>]
	<thead>
		<tr class="first_row">
			<th class="statut" scope="col">[(#TRI{statut,<span title="<:lien_trier_statut|attribut_html:>">#</span>,ajax})]</th> 
			<th class="titre" scope="col">[(#TRI{titre,<:chapitre:champ_titre_label:>,ajax})]</th>
			[(#ENV{simple}|!={oui}|oui)<th class="date" scope="col">[(#TRI{date,<:date:>,ajax})]</th>]
			[(#ENV{arbo}|!={oui}|oui)<th class="sous"><:chapitre:titre_chapitres_sous:></th>]
			<th class="id" scope="col">[(#TRI{id_chapitre,<:info_numero_abbreviation:>,ajax})]</th>
			<th class="actions" closs="col"></th>
		</tr>
	</thead>
	<tbody>
	<BOUCLE_liste_chapitres (CHAPITRES) {id_parent?}{objet?}{id_objet?}{id_mot?}{id_auteur?}{where?}{statut?}{recherche?}{tri #ENV{par,num titre},#GET{defaut_tri}}{par titre}{pagination #GET{pagination}}>
		#SET{compteur,#GET{compteur}|plus{1}}
		<tr
			class="[(#GET{compteur}|alterner{row_odd,row_even})][ (#EXPOSE{expose})]"
			data-profondeur="0"
		>
			<td class="statut">[(#STATUT|puce_statut{chapitre,#ID_CHAPITRE})]</td> 
			<td
				class="titre principale"
				data-profondeur="0"
				[(#COMPTEUR_BOUCLE|=={#TOTAL_BOUCLE}|oui)data-impasse="true"]
			>
				[(#LOGO_CHAPITRE|image_reduire{20,26})]<a href="[(#ID_CHAPITRE|generer_url_entite{chapitre})]" title="<:info_numero_abbreviation|attribut_html:> #ID_CHAPITRE">[(#RANG). ]#TITRE</a>
			</td>
			[(#ENV{simple}|!={oui}|oui)<td class="date secondaire">[(#DATE|affdate_jourcourt)]</td>]
			<BOUCLE_compter_enfants (CHAPITRES) {si #ENV{arbo}|!={oui}}{id_parent=#ID_CHAPITRE}{objet?}{id_objet?}{id_mot?}{id_auteur?}{where?}{statut?}{recherche?} />
			[(#ENV{arbo}|!={oui}|oui)<td class="sous">#TOTAL_BOUCLE</td>]
			<//B_compter_enfants>
			<td class="id">[(#AUTORISER{modifier,chapitre,#ID_CHAPITRE}|?{
				<a href="[(#URL_ECRIRE{chapitre_edit,id_chapitre=#ID_CHAPITRE})]">#ID_CHAPITRE</a>,
				#ID_CHAPITRE
			})]</td>
			<td class="actions">
				[(#AUTORISER{creer,chapitre}|oui)
					<a href="[(#URL_ECRIRE{chapitre_edit,id_parent=#ID_CHAPITRE}|parametre_url{objet,#OBJET}|parametre_url{id_objet,#ID_OBJET}|parametre_url{redirect,#SELF})]" class="icone" title="<:chapitre:icone_ajouter_chapitre_enfant:>">
						[(#CHEMIN_IMAGE{chapitre-add-16}|balise_img) ]<b><:chapitre:icone_ajouter_chapitre_enfant:></b>
					</a>
				]
			</td>
		</tr>
		
		#SET{profondeur, 1}
		<BOUCLE_liste_chapitres_enfants (CHAPITRES) {si #ENV{arbo}|=={oui}}{id_parent=#ID_CHAPITRE}{objet?}{id_objet?}{id_mot?}{id_auteur?}{where?}{statut==.*}{recherche?}{tri #ENV{par,num titre},#GET{defaut_tri}}{par titre}>
		#SET{compteur,#GET{compteur}|plus{1}}
		<tr
			class="[(#GET{compteur}|alterner{row_odd,row_even})][ (#EXPOSE{expose})]"
			data-profondeur="#GET{profondeur}"
			[(#COMPTEUR_BOUCLE|=={#TOTAL_BOUCLE}|oui)data-impasse="true"]
		>
			<td class="statut">[(#STATUT|puce_statut{chapitre,#ID_CHAPITRE})]</td> 
			<td class="titre principale">
				[(#LOGO_CHAPITRE|image_reduire{20,26})]
				<a href="[(#ID_CHAPITRE|generer_url_entite{chapitre})]" title="<:info_numero_abbreviation|attribut_html:> #ID_CHAPITRE">
					[(#RANG). ]#TITRE
				</a>
			</td>
			[(#ENV{simple}|!={oui}|oui)<td class="date secondaire">[(#DATE|affdate_jourcourt)]</td>]
			<td class="id">[(#AUTORISER{modifier,chapitre,#ID_CHAPITRE}|?{
				<a href="[(#URL_ECRIRE{chapitre_edit,id_chapitre=#ID_CHAPITRE})]">#ID_CHAPITRE</a>,
				#ID_CHAPITRE
			})]</td>
			<td class="actions">
				[(#AUTORISER{creer,chapitre}|oui)
					<a href="[(#URL_ECRIRE{chapitre_edit,id_parent=#ID_CHAPITRE}|parametre_url{objet,#OBJET}|parametre_url{id_objet,#ID_OBJET}|parametre_url{redirect,#SELF})]" class="icone" title="<:chapitre:icone_ajouter_chapitre_enfant:>">
						[(#CHEMIN_IMAGE{chapitre-add-16}|balise_img) ]<b><:chapitre:icone_ajouter_chapitre_enfant:></b>
					</a>
				]
			</td>
		</tr>
		
		#SET{profondeur,#GET{profondeur}|plus{1}}
		<BOUCLE_liste_chapitres_petits_enfants (BOUCLE_liste_chapitres_enfants) />
		#SET{profondeur,#GET{profondeur}|moins{1}}
		</BOUCLE_liste_chapitres_enfants>
	</BOUCLE_liste_chapitres>
	</tbody>
</table>
[<p class="pagination">(#PAGINATION{prive})</p>]
</div>
</B_liste_chapitres>[
<div class="liste-objets chapitres caption-wrap"><strong class="caption">(#ENV*{sinon,''})</strong></div>
]<//B_liste_chapitres>
