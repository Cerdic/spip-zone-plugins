[(#REM)

	Plan complet des chapitres d'un objet (chapitre ou autre)

	Paramètres :

		- objet
		- id_objet
		- chapitres : 'editables' pour mettre des ancres à la place des liens
]
#SET{ancres,#ENV{chapitres}|=={editables}|?{oui,''}}

<B_chapitres_racine>
[(#BOITE_OUVRIR{<:chapitre:titre_plan:>, 'simple chapitres-plan'})]

<p class='pliage'>
	<a data-pliage="deplier" href="#"><:lien_tout_deplier:></a> | <a data-pliage="replier" href="#"><:lien_tout_replier:></a>
</p>

[<a href="[(#ID_OBJET|generer_url_entite{#OBJET})]" class="objet-parent jstree-anchor">[(#OBJET|objet_icone{16}) ](#INFO_TITRE{#OBJET,#ID_OBJET})</a>]

<div class="plan[ (#ENV{chapitres})]" id="chapitres-plan">

	<ul class="menu-items">

		<BOUCLE_chapitres_racine (CHAPITRES)
			{id_parent = 0}
			{objet?}
			{id_objet?}
			{id_mot?}
			{id_auteur?}
			{where?}
			{statut?}
			{recherche?}
			{tri #ENV{par,num titre},#GET{defaut_tri}}
			{par titre}
		>
		#SET{expose_branche,#EXPOSE}
		#SET{ancre,#GET{ancres}|et{#GET{expose_branche}}|ou{#GET{ancres}|et{#ENV{id_chapitre}|non}}}
		#SET{lien,#GET{ancre}|?{
			#chapitre#ID_CHAPITRE,
			#ID_CHAPITRE|generer_url_entite{chapitre}
		}}
		#SET{numero,#COMPTEUR_BOUCLE}
		#SET{numero_parent,#GET{numero}}
		<li class="item[ (#EXPOSE{expose})]">

			[(#GET{lien}|lien_ou_expose{<span class="numero">#GET{numero}</span> #TITRE,#EXPOSE,#GET{ancre}|?{lien-ancre,lien}})]

			<B_chapitres_enfants>
			<ul class="menu-items">
				<BOUCLE_chapitres_enfants (CHAPITRES)
					{id_parent = #ID_CHAPITRE}
					{objet?}
					{id_objet?}
					{id_mot?}
					{id_auteur?}
					{where?}
					{statut !IN #LISTE{refuse,poubelle}}
					{recherche?}
					{tri #ENV{par,num titre},#GET{defaut_tri}}
					{par titre}
				>
				#SET{expose_branche,#GET{expose_branche}|ou{#EXPOSE}}
				#SET{ancre,#GET{ancres}|et{#GET{expose_branche}}|ou{#GET{ancres}|et{#ENV{id_chapitre}|non}}}
				#SET{lien,#GET{ancre}|?{
					#chapitre#ID_CHAPITRE,
					#ID_CHAPITRE|generer_url_entite{chapitre}
				}}
				#SET{numero,#GET{numero_parent}|concat{.#COMPTEUR_BOUCLE}}
				#SET{numero_parent,#GET{numero}}

				<li class="item[ (#EXPOSE{expose})]">

					[(#GET{lien}|lien_ou_expose{<span class="numero">#GET{numero}</span> #TITRE,#EXPOSE,#GET{ancre}|?{lien-ancre,lien}})]

					<BOUCLE_chapitres_petits_enfants (BOUCLE_chapitres_enfants) />
					#SET{numero_parent,#GET{numero_parent}|substr{0,#GET{numero_parent}|strrpos{.}}}

				</li>

				</BOUCLE_chapitres_enfants>
			</ul>
			</B_chapitres_enfants>

		</li>
		</BOUCLE_chapitres_racine>

	</ul>

</div>

[<link rel="stylesheet" href="(#CHEMIN{lib/jstree/dist/themes/default/style.min.css}|timestamp)" type="text/css" />]
[<script src="(#CHEMIN{lib/jstree/dist/jstree.min.js}|timestamp)"></script>]
[<script src="(#CHEMIN{lib/sticky-kit/jquery.sticky-kit.min.js}|timestamp)"></script>]
[<script src="(#CHEMIN{prive/javascript/chapitres_plan.js}|compacte{js}|timestamp)"></script>]

#BOITE_FERMER
</B_chapitres_racine>