[(#REM)

	Plan complet des chapitres d'un objet (chapitre ou autre)

	Paramètres :

		- objet
		- id_objet
		- chapitres : 'editables' pour mettre des ancres à la place des liens
]
#SET{ancres,#ENV{chapitres}|=={editables}|?{oui,''}}

<B_liste_chapitres>
[(#BOITE_OUVRIR{<:chapitre:titre_plan:>, 'simple chapitres-plan'})]

<p class='pliage'>
	<a href="#" onclick="jQuery('#chapitres-plan').jstree('open_all'); return false;"><:lien_tout_deplier:></a> | <a href="#" onclick="jQuery('#chapitres-plan').jstree('close_all'); return false;"><:lien_tout_replier:></a>
</p>

<div class="plan[ (#ENV{chapitres})]" id="chapitres-plan">

	<ul class="menu-items">
		<li class="item">
			<a href="[(#ID_OBJET|generer_url_entite{#OBJET})]">#INFO_TITRE{#OBJET,#ID_OBJET}</a>

			<ul class="menu-items">

				<BOUCLE_liste_chapitres (CHAPITRES)
					{id_parent = 0}
					{objet?}
					{id_objet?}
					{id_mot?}
					{id_auteur?}
					{where?}
					{statut?}
					{recherche?}
					{tri #ENV{par,num titre},#GET{defaut_tri}}
					{par titre}
				>
				#SET{expose_branche,#EXPOSE}
				#SET{ancre,#GET{ancres}|et{#GET{expose_branche}}|ou{#GET{ancres}|et{#ENV{id_chapitre}|non}}}
				#SET{lien,#GET{ancre}|?{
					#chapitre#ID_CHAPITRE,
					#ID_CHAPITRE|generer_url_entite{chapitre}
				}}
				<li class="item[ (#EXPOSE{expose})]">

					[(#GET{lien}|lien_ou_expose{#TITRE,#EXPOSE,#GET{ancre}|?{lien-ancre,lien}})]

					<B_liste_chapitres_enfants>
					<ul class="menu-items">
						<BOUCLE_liste_chapitres_enfants (CHAPITRES)
							{id_parent = #ID_CHAPITRE}
							{objet?}
							{id_objet?}
							{id_mot?}
							{id_auteur?}
							{where?}
							{statut !IN #LISTE{refuse,poubelle}}
							{recherche?}
							{tri #ENV{par,num titre},#GET{defaut_tri}}
							{par titre}
						>
						#SET{expose_branche,#GET{expose_branche}|ou{#EXPOSE}}
						#SET{ancre,#GET{ancres}|et{#GET{expose_branche}}|ou{#GET{ancres}|et{#ENV{id_chapitre}|non}}}
						#SET{lien,#GET{ancre}|?{
							#chapitre#ID_CHAPITRE,
							#ID_CHAPITRE|generer_url_entite{chapitre}
						}}

						<li class="item[ (#EXPOSE{expose})]">

							[(#GET{lien}|lien_ou_expose{#TITRE,#EXPOSE,#GET{ancre}|?{lien-ancre,lien}})]

							<BOUCLE_liste_chapitres_petits_enfants (BOUCLE_liste_chapitres_enfants) />

						</li>

						</BOUCLE_liste_chapitres_enfants>
					</ul>
					</B_liste_chapitres_enfants>

				</li>
				</BOUCLE_liste_chapitres>

			</ul>

		</li>
	</ul>

</div>

[<link rel="stylesheet" href="(#CHEMIN{lib/jstree/dist/themes/default/style.min.css}|timestamp)" type="text/css" />]
[<script src="(#CHEMIN{lib/jstree/dist/jstree.min.js}|timestamp)"></script>]
[<script src="(#CHEMIN{lib/sticky-kit/jquery.sticky-kit.min.js}|timestamp)"></script>]
<script type="text/javascript">
jQuery(function($){
	// Plan
	$('#chapitres-plan').jstree({
		core: {
			animation: false,
			themes: {
				icons: false
			}
		}
	});
	$('#chapitres-plan').bind('ready.jstree', function(e, data) {
		// Déplier la racine
		$(this).jstree('open_node', $('#chapitres-plan > ul > li'));
		// Déplier le chapitre en cours (toute la branche si vue complète)
		if ($(this).hasClass('editables')) {
			$(this).jstree('open_all', $('#chapitres-plan li.expose'));
		} else {
			$(this).jstree('open_node', $('#chapitres-plan li.expose'));
		}
		// Sélectionner le chapitre en cours
		$(this).jstree('select_node', $('#chapitres-plan li.expose'));
		// Liens cliquables
		$('#chapitres-plan li a').click(function(e) {
			var href = $(this).attr('href');
			if (href !== '#') {
				document.location.href = href;
			}
		});
	});
	// Sticky
	$('.chapitres-plan').stick_in_parent({
		parent: '#navigation'
	});
});
</script>

#BOITE_FERMER
</B_liste_chapitres>