[(#REM) Récupérer les objets sélectionnés. ex. spip_articles -> article ]

#SET{objets, #ARRAY}
<BOUCLE_objets_selectionnes(DATA){liste #CONFIG{lim_objets}}>#SET{objets,#GET{objets}|push{#VALEUR}} #SET{nbre_objets,#TOTAL_BOUCLE|moins{1}}</BOUCLE_objets_selectionnes>
#SET{objets, #GET{objets}|array_flip}


[(#REM) multilinguisme : pour les objets sélectionnés, récupérer le nom traduit et les afficher dans l'ordre alphabétique ]
#SET{traductions,#ARRAY}<BOUCLE_objets(DATA){source tableau,#REM|lister_tables_objets_sql}>[(#EDITABLE|oui)
[(#SET{traductions,#GET{traductions}|array_merge{#ARRAY{#CLE,#TEXTE_OBJETS|_T}}})]
]</BOUCLE_objets>
[(#SET{traductions,#GET{traductions}|array_intersect_key{#GET{objets}}})]

[(#REM) Récupérer le tableau des types d'objets sélectionnés. ex. spip_articles -> article ]
#SET{type, #ARRAY}
[(#SET{type, #GET{traductions}|lim_type})]


<div class="grid_rub">
	<div></div>
	<BOUCLE_entete2(DATA){source tableau,#GET{traductions}}{par cle}>
		#SET{type_obj, #CLE|objet_type}
		<div class="center"><img src='#CHEMIN_IMAGE{#GET{type_obj}-24.png}'><br>#VALEUR</div>
	</BOUCLE_entete2>
</div>

<BOUCLE_titre_rubrique(RUBRIQUES){racine}{par num titre,titre}{tout}>
	<div class='pin'><img src='#CHEMIN_IMAGE{rubrique-16.png}'></div>
	<div class='secteur'>
		<div class="grid_rub">
			<div class="tab rub"><b><a href="#URL_ECRIRE{rubrique,id_rubrique=#ID_RUBRIQUE}">#TITRE</a></b></div>
			<BOUCLE_par_traduction1(DATA){source tableau,#GET{type}}{par cle}>
				[(#INCLURE{fond=formulaires/inc-input-rub,env,name=#VALEUR}{#VALEUR=#ENV{#VALEUR}}{id_rubrique=#ID_RUBRIQUE}{secteur=oui})]
			</BOUCLE_par_traduction1>
		</div>
		<BOUCLE_enfants_rubriques(RUBRIQUES){id_parent}{par num titre,titre}{tout}>
			<div class='sousrub_#PROFONDEUR grid_rub'>
			<div class="tab rub">#TITRE</div><BOUCLE_par_traduction2(DATA){source tableau,#GET{type}}{par cle}>
			[(#INCLURE{fond=formulaires/inc-input-rub,env,name=#VALEUR}{#VALEUR=#ENV{#VALEUR}}{id_rubrique=#ID_RUBRIQUE})]
			</BOUCLE_par_traduction2></div><BOUCLE_rec(BOUCLE_enfants_rubriques)/>
		</BOUCLE_enfants_rubriques>
	</div>
</BOUCLE_titre_rubrique>

<style type="text/css">
	.grid_rub{
		display:grid;
		grid-template-columns: 320px repeat(#GET{nbre_objets}, 1fr);
		justify-items: center;
		align-items: center;
	}

	.grid_rub .tab {
		justify-self: start;
	}

	.grid_rub:hover {
		background-color: #ffffef;
	}
</style>

<script type="text/javascript">
(function($){
	$(document).ready(function(){

		jQuery(".rub_secteur input:checkbox").change(function(){
			var type = $(this).attr('name').slice(0,-2);
			var $check = "div.check." + type;
			if (jQuery(this).is(":checked")) {
				jQuery.each( jQuery(this).parent().parent().parent().find($check), function(index,item) {
					jQuery(item).find('input').prop('checked',true);
					jQuery(item).find('.lim_icon').removeClass('icon-on').addClass('icon-off');
				});
			} else {
				jQuery.each( jQuery(this).parent().parent().parent().find($check), function(index,item) {
					jQuery(item).find('input').prop('checked',false);
					jQuery(item).find('.lim_icon').removeClass('icon-off').addClass('icon-on');
				});
			}
		});

		jQuery("input:checkbox").change(function(){
			var type = $(this).attr('name').slice(0,-2);
			var $check = "div.check." + type;
			if (jQuery(this).is(":checked")) {
				$(this).parent().find('.lim_icon').removeClass('icon-on').addClass('icon-off');
			} else {
				$(this).parent().find('.lim_icon').removeClass('icon-off').addClass('icon-on');
			}
		});
	});
})(jQuery);
</script>