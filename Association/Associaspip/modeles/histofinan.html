[(#REM)<!-- HISTOrique FINANcier d'un membre : presque tous
plugin concerne = associaspip ; tables = spip_asso_comptes, spip_asso_plans, spip_association_metas
plugins necessaires = aucun
parametres =
- id (entier) : id_auteur du membre concerne
remarques =
- Seul le membre ou un admin a acces a cet historique
- Ce modele ne s'occupe que de l'information comptable, pas plus
  (c'est donc succint en ce qui concerne les dons/ventes/etc.)

maj:2011-10-03; version:0.4.1; licence:GPL; copyleft:gilcot; -->]

[(#SET{droit_acces, [(#SESSION{id_auteur}|=={#ENV{id}}|ou{#SESSION{statut}|=={0minirezo}}|?{oui,non})] })]

[(#REM)<!-- RECUS FISCAUX ANNUELS (que pour les cotisations, pas les dons) -->]
<B_RecusFiscaux>
[(#GET{droit_acces}|=={oui }|oui)
	<hr class="nettoyeur" />
	<:asso:liens_vers_les_justificatifs:>
]
<BOUCLE_RecusFiscaux(ASSO_COMPTES){id_journal=#ENV{id}}{imputation=#META{/association/pc_cotisations}} {fusion YEAR(date)} {!par date}>
[(#GET{droit_acces}|=={oui }|oui)
	<a href="[(#URL_ECRIRE{pdf_fiscal}
		|parametre_url{id,#ID_JOURNAL}
		|parametre_url{annee,[(#DATE|annee)]}
		|parametre_url{retour,[(#ENV{retour,#SELF})]}
	)]">[(#DATE|annee)]</a>,
]
</BOUCLE_RecusFiscaux>
</B_RecusFiscaux>
<//B_RecusFiscaux>

[(#REM)<!-- FICHE HISTORIQUE COTISATIONS -->]
[(#GET{droit_acces}|=={oui }|oui)
	<hr class="nettoyeur" />
	[(#AUTORISER{associer_adherents,asso_comptes,#ID_COMPTE}|oui)
	[(#BOUTON_ACTION{
		<:asso:adherent_label_ajouter_cotisation:>,
		[(#URL_ECRIRE{ajout_cotisation}
			|parametre_url{id,#ENV{id}}
			|parametre_url{retour,[(#ENV{retour,#SELF})]}
			)],
		ajax
	})]
	<br class="nettoyeur" />
	]
	[(#MODELE{asso_comptes}{id_journal=#ENV{id},imputation=#META{/association/pc_cotisations}}{titre=<:asso:adherent_titre_historique_cotisations:>}{vide=<:aucune_cotisation_pour_l_instant:>})]
	<hr class="nettoyeur" />
]

[(#REM)<!-- FICHE HISTORIQUE ACTIVITES -->]
#SET{liste_activites,#ARRAY}
<BOUCLE_activites(ASSO_ACTIVITES){id_auteur=#ENV{id}}>
	#SET{liste_activites, #GET{liste_activites}|push{#ID_ACTIVITE}}
</BOUCLE_activites>
[(#META{/association/activites}|=={on}|et{#GET{droit_acces}|=={oui }}|oui)
	[(#AUTORISER{associer_adherents,asso_comptes,#ID_COMPTE}|oui)
	[(#BOUTON_ACTION{
		<:asso:activite_titre_ajouter_inscriptions:>,
		[(#URL_ECRIRE{ajout_participation}
			|parametre_url{id,#ENV{id}}
			|parametre_url{retour,[(#ENV{retour,#SELF})]}
			)],
		ajax
	})]
	<br class="nettoyeur" />
	]
	[(#GET{liste_activites}|?{
		[(#MODELE{asso_comptes}{id_journal=#GET{liste_activites},imputation=#META{/association/pc_activites}}{titre=<:asso:adherent_titre_historique_activites:>})]
	,
		<:aucune_activite_payante_pour_l_instant:>
	})]
	<hr class="nettoyeur" />
]

[(#REM)<!-- FICHE HISTORIQUE VENTES -->]
#SET{liste_achats,#ARRAY}
<BOUCLE_achats(ASSO_VENTES){id_acheteur=#ENV{id}}>
	#SET{liste_achats, #GET{liste_achats}|push{#ID_VENTE}}
</BOUCLE_achats>
[(#META{/association/ventes}|=={on}|et{#GET{droit_acces}|=={oui }}|oui)
	[(#AUTORISER{associer_adherents,asso_comptes,#ID_COMPTE}|oui)
	[(#BOUTON_ACTION{
		<:asso:ajouter_une_vente:>,
		[(#URL_ECRIRE{edit_vente}
			|parametre_url{id_acheteur,#ENV{id}}
			|parametre_url{retour,[(#ENV{retour,#SELF})]}
			)],
		ajax
	})]
	<br class="nettoyeur" />
	]
	[(#GET{liste_achats}|?{
		[(#MODELE{asso_comptes}{id_journal=#GET{liste_achats},imputation=#META{/association/pc_ventes}}{titre=<:asso:adherent_titre_historique_ventes:>})]
	,
		<:aucun_achat_pour_l_instant:>
	})]
	<hr class="nettoyeur" />
]

[(#REM)<!-- FICHE HISTORIQUE DONS -->]
#SET{liste_dons,#ARRAY}
<BOUCLE_dons(ASSO_DONS){id_auteur=#ENV{id}}>
	#SET{liste_dons, #GET{liste_dons}|push{#ID_DON}}
</BOUCLE_dons>
[(#META{/association/dons}|=={on}|et{#GET{droit_acces}|=={oui }}|oui)
	[(#AUTORISER{associer_adherents,asso_comptes,#ID_COMPTE}|oui)
	[(#BOUTON_ACTION{
		<:asso:ajouter_un_don:>,
		[(#URL_ECRIRE{edit_don}
			|parametre_url{id_auteur,#ENV{id}}
			|parametre_url{retour,[(#ENV{retour,#SELF})]}
			)],
		ajax
	})]
	<br class="nettoyeur" />
	]
	[(#GET{liste_dons}|?{
		[(#MODELE{asso_comptes}{id_journal=#GET{liste_dons},imputation=#META{/association/pc_dons}}{titre=<:asso:adherent_titre_historique_dons:>})]
	,
		<:aucun_don_pour_l_instant:>
	})]
	<hr class="nettoyeur" />
]

[(#REM)<!-- FICHE HISTORIQUE PRETS -->]
#SET{liste_prets,#ARRAY}
<BOUCLE_prets(ASSO_PRETS){id_auteur=#ENV{id}}>
	#SET{liste_prets, #GET{liste_prets}|push{#ID_PRET}}
</BOUCLE_prets>
[(#META{/association/prets}|=={on}|et{#GET{droit_acces}|=={oui }}|oui)
	[(#GET{liste_dons}|?{
		[(#MODELE{asso_comptes}{id_journal=#GET{liste_prets},imputation=#META{/association/pc_prets}}{titre=<:asso:adherent_titre_historique_prets:>})]
	,
		<:aucun_pret_payant_pour_l_instant:>
	})]
	<hr class="nettoyeur" />
]
