#CACHE{0}
#HTTP_HEADER{Content-Type: text/html}
<?php

if(!($auteur_session['statut'] == "0minirezo")) {echo "reservé aux admins"; return ;}
include_spip("console_options"); // Pour Spip 1.9.2 ?

function console_lit_log($logname = "#ENV{log}"){
	$files = preg_files(_DIR_LOG, $logname._FILE_LOG_SUFFIX."(\.[0-9])?");
	krsort($files);

	$log = "";
	foreach($files as $nom){
		if (lire_fichier($nom,$contenu))
			$log.=$contenu;
	}
	$contenu = explode("<br />",nl2br($contenu));
	
	$out = "";
	$maxlines = 40;
	while ($contenu && $maxlines--){
		$hop = array_pop($contenu) ;
		if(preg_match(",page='console',", $hop)) continue ;
		if (preg_match_all("/.{100}/UmsS", $hop, $longs, PREG_SET_ORDER)) {
	        foreach ($longs as $long) {
 	            $hop = str_replace($long[0], $long[0].'<br>', $hop);
 	        }
 	    }
		
		$out .= $hop."\n";
	}
	return $out;
}


echo "<pre>";
echo console_lit_log();
echo "</pre>";
?>
#SPIP_CRON
