[(#REM)

	Controleur pour le crayon 'adressecomplete', uniquement html
	Validation JS pour les champs specifies obligatoires
	Si les champs ne sont pas actifs dans le CFG, ils n'apparaissent pas...

]
#CACHE{0}
<BOUCLE_a(AUTEURS_ELARGIS){id_auteur=#ENV{id_auteurs_elargi}}{tout}>
[<script type="text/javascript" src="(#URL_PAGE{crayons_validation.js}|parametre_url{lang,#ENV{lang}})"></script>]

<script type="text/javascript">
	var me = cQuery(".auteurs_elargi-adressecomplete-#ID_AUTEUR");
	var id = me.crayon().find('form');
	
	function validation(){
		/**
		 * Obligé de le répéter ici au cas ou on a activé la barre de rédaction dans les crayons
		 */
		var me = cQuery(".auteurs_elargi-adressecomplete-#ID_AUTEUR");
		var id = me.crayon().find('form');
		var validator = cQuery(id).validate({
			errorElement:"p",
			errorClass: "erreur",
			onkeyup:function(){
				validation();
			},
			showErrors: function(errors, errorList) {
				validator.defaultShowErrors();
				crayon_affiche_submit(me,id);
			},
			errorPlacement: function(error, element) {
				error.appendTo(element.parent("li"));
			},
			success: function(label){
				label.remove();
				crayon_affiche_submit(me,id)
			},
			rules: {
				#ENV{name_adresse}: { 
					rangelength:[5,1000]
				},
				#ENV{name_ville}: {
					chaine:true,
					rangelength:[2,30]
				},
				#ENV{name_pays}:{[(#CONFIG{inscription2/pays_obligatoire}|=={on}|?{required: true})]}
			},
			messages: {
				#ENV{name_ville}: {
					chaine:"<:inscription2:chaine_valide:> <:inscription2:chainelettre:>"
				}
			}
		});
		id.find('.obligatoire input').each(function(){
			if(cQuery(this).val() == ""){
				cQuery(this).addClass('error');
				var id_label = cQuery(this).attr('name');
				var erreur = '<p class="error" generated="true"><:inscription2:champ_obligatoire:></p>';
				cQuery(this).parent("div").append(erreur);
				cQuery(this).parent("div").find("p.error").show();
				id.find('.crayon-submit').hide();
			}
		});
		//On test le formulaire pour chercher les potentielles erreurs
		validator.form();
		crayon_affiche_submit(me,id);
	}
	//On ajoute l'asterisque qui signale qu'un champ est obligatoire
	id.find('.obligatoire label').not('.error').append('*');
	setTimeout('validation()',500);

</script>
<fieldset[ style="(#ENV{style})"]>
	<legend><:inscription2:votre_adresse:></legend>
	<ul>
		[(#CONFIG{inscription2/adresse_fiche_mod}|oui)
		[(#CONFIG{inscription2/adresse_obligatoire}|=={on}|oui)#SET{adresse_obl, true}]
		[(#GET{adresse_obl}|?{<li class="obligatoire">,<li>})]
			<label><:inscription2:adresse:></label> 
			<textarea class="crayon-active text[(#GET{adresse_obl}|oui) obligatoire]" name="#ENV{name_adresse}" style="width:#ENV{largeur}px;">[(#ADRESSE**|entites_html)]</textarea><br />
		</li>]
	
		[(#CONFIG{inscription2/code_postal_fiche_mod}|oui)
		[(#CONFIG{inscription2/code_postal_obligatoire}|=={on}|oui)#SET{code_postal_obl,true}]
		[(#GET{code_postal_obl}|?{<li class="obligatoire">,<li>})]
			<label><:inscription2:code_postal:></label>
			<input class="crayon-active text cp[(#GET{code_postal_obl}|oui) obligatoire]" name="#ENV{name_code_postal}" style="width:#ENV{largeur}px;" value="[(#CODE_POSTAL**|entites_html)]" />
		</li>]

		[(#CONFIG{inscription2/ville_fiche_mod}|oui)
		[(#CONFIG{inscription2/ville_obligatoire}|=={on}|oui)#SET{ville_obl,true}]
		[(#GET{ville_obl}|=={true}|?{<li class="obligatoire">,<li>})]
			<label><:inscription2:ville:></label> 
			<input class="crayon-active text[(#GET{ville_obl}|oui) obligatoire]" name="#ENV{name_ville}" style="width:#ENV{largeur}px;" value="[(#VILLE**|entites_html)]" />
		</li>]

		[(#CONFIG{inscription2/pays_fiche_mod}|oui)
		[(#CONFIG{inscription2/pays_obligatoire}|=={on}|oui)#SET{pays_obl,true}]
		[(#GET{pays_obl}|?{<li class="obligatoire">,<li>})]
			<label><:inscription2:pays:></label> 
			#SET{id,#PAYS}
			<select class="crayon-active text[(#GET{pays_obl}|oui) obligatoire]" name="#ENV{name_pays}" style="width:#ENV{largeur}px;" onchange="validation()">
				<INCLURE{fond=prive/listes/select_pays}{id=#GET{id}}>
			</select>
		</li>]
	</ul>
</fieldset>
</BOUCLE_a>
<//B_a>