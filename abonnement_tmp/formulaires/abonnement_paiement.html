
[(#REM)
	Cette page peut etre appellee de plusieurs endroits :
	- de #FORMULAIRE_COMMANDER_ARTICLE{#ID_ARTICLE}
	- de #FORMULAIRE_COMMANDER_ABONNEMENT
	- de #FORMULAIRE_INSCRIPTION2 (si la config d'abonnement le permet
		et via les pipelines du formulaire i2 utilises par abonnement)

	Pour les deux premiers, la variable "type_commande"
	est transmise : ils supposent que l'on connait les informations
	de l'auteur, puisqu'il est deja inscrit.

	On utilise des #ENV{id_auteur} et non des #SESSION car
	a l'inscription l'auteur n'est pas encore loge, mais
	on connait son identifiant.

]
#CACHE{0}

<h2><:abo:paiement:></h2>


<BOUCLE_ma_correspondance(CONDITION){si #ENV{type_commande}}>
	<dl>
		<dt><h3><:abo:donnees_correspondances:></h3></dt>
		<BOUCLE_correspondance(AUTEURS_ELARGIS auteurs){id_auteur}>
		<dd class="abo_nom">[(#PRENOM)][ (#NOM_FAMILLE)]<dd>
		<dd class="abo_adresse">[(#ADRESSE)]</dd>
		<dd class="abo_cp">[(#CODE_POSTAL)][ (#VILLE)]</dd>
		[<dd class="abo_pays">(#PAYS|id_pays_to_pays)</dd>]
		[(#SET{le_pays,#PAYS})]
		[<dd class="abo_email"><strong><:email:>&nbsp;:</strong> (#EMAIL)</dd>]
		</BOUCLE_correspondance>
	</dl>
</BOUCLE_ma_correspondance>

	<dl>
		<BOUCLE_mon_abonnement(CONDITION){si #ENV{type_commande}|!={article}}>
			[(#SET{texteLibre,[abonnement-(#ENV*{hash})]})]
			<BOUCLE_abo(ABONNEMENTS){id_abonnement=#ENV{abonnement}}>
				<table>
				<tr><th colspan="2"><h3><:abo:mon_abonnement:></h3></th></tr>
				<tr><td>#LIBELLE</td><td><strong>#MONTANT euros</strong></td></tr>
				#SET{montant,#MONTANT}
				#SET{libelle,#LIBELLE}
				
				<BOUCLE_frais_de_port_etranger(CONDITION){si (#GET{le_pays}|!={70})}>
					[(#SET{europe,[(#GET{le_pays}|in_array{#VAL{"6,7,18,24,36,46,57,64,65,69,77,92,111,114,126,131,132,140,150,163,175,179,182,185,187,188,207,208,212,213"}|explode{","}})]})]
						<BOUCLE_frais_de_port_europe(CONDITION){si #GET{europe}}>
						[
						<tr><td><:abo:fieldset_frais_de_port:> </td><td> <strong>(#CONFIG{abonnement/prix_frais_port_europe}) euros</strong></td></tr>
						[(#SET{montant,[(#GET{montant}|plus{#CONFIG{abonnement/prix_frais_port_europe}})]})]
						]
						<tr><td>Total </td><td>  <strong>[(#GET{montant})] euros </strong></td></tr>
						</BOUCLE_frais_de_port_europe>
						[
						<tr><td><:abo:fieldset_frais_de_port:> </td><td> <strong>(#CONFIG{abonnement/prix_frais_port_monde}) euros</strong></td></tr>
						[(#SET{montant,[(#GET{montant}|plus{#CONFIG{abonnement/prix_frais_port_monde}})]})]
						]
						<tr><td>Total </td><td>  <strong>[(#GET{montant})] euros </strong></td></tr>
						<//B_frais_de_port_europe>
				</BOUCLE_frais_de_port_etranger>
			</table>
			</BOUCLE_abo>
		</BOUCLE_mon_abonnement>

		<BOUCLE_mon_article(CONDITION){si #ENV{type_commande}|=={article}}>
			[(#SET{texteLibre,[article-(#ENV*{hash})]})]
			<BOUCLE_art(ARTICLES){id_article}>
				#SET{montant,#CONFIG{abonnement/prix_article}}
				#SET{libelle,#TITRE}
				<dt><:abo:mon_article:></dt>
				<dd>#TITRE - #GET{montant} euros</dd>
			</BOUCLE_art>
		</BOUCLE_mon_article>
	</dl>
		
	[(#REM)
		Il n'y a plus qu'a mettre le bon formulaire ici...
	]
	
	[(#REM) boutons de validation de test simulant la banque ]
	[(#FORMULAIRE_PAIEMENT_FICTIF{#ARRAY{
		montant,#GET{montant},
		libelle,#GET{libelle},
		reference,#ENV{id_auteur},
		args,#GET{texteLibre},
		redirect,#URL_PAGE{validation_banque},
	}})]
	