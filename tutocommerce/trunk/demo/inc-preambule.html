[(#REM)
	Tutoriel pour implémenter le framework ecommerce pour SPIP.
	Étape 0 : Préambule.
	Présentation du framework et test de la présence des trucs nécessaire pour faire marcher la démo.
]
#SET{url_propre,#URL_PAGE{demo/tutocommerce}}
#SET{bank_on,#PLUGIN{bank}}
#SET{simulation_on,#EVAL{_SIMU_BANK_ALLOWED}|=={true}|?{1,''}}
#SET{prestas_acte,#CONFIG{bank_paiement/presta}|array_filter|array_keys}
#SET{prestas_abo,#CONFIG{bank_paiement/presta_abo}|array_filter|array_keys}
#SET{prestas_modetest_acte,#LISTE{cmcic,cyberplus,ogone,paybox,paypal,paypalexpress}}
#SET{prestas_modetest_abo,#LISTE{paybox}}

Vérifications préliminaires :

[(#REM) Tester la présence du plugin bank. En théorie, les autres plugins nécessaires sont déjà installés en dépendance. ]
[(#GET{bank_on}|?{
	"<div class='notice ok'>Tous les plugins nécessaires sont installés.</div>",
	"<div class='notice'>Installez manuellement le plugin «&nbsp;Banque & paiement&nbsp;», à récupérer sur github : <a href='http://github.com/nursit/bank'>http://github.com/nursit/bank</a></div>"
})]

[(#REM) Vérifier si au moins un presta de paiement à l'acte est activé ]
[(#GET{prestas_acte}|count|?{
	"<div class='notice ok'>Il y a au moins un mode de paiement à l'acte d'activé.</div>",
	"<div class='notice'>Activez au moins un mode de paiement à l'acte.</div>"
})]

[(#REM) Vérifier si l'option TEST est activée pour les prestas actifs qui ont cette option ]
#SET{prestas_modetest_acte_off,#ARRAY}
<BOUCLE_prestas_modeset_acte(DATA){source table, #GET{prestas_acte}|array_intersect{#GET{prestas_modetest_acte}}}>
[(#CONFIG{bank_paiement/config_#VALEUR/mode_test}|non)#SET{prestas_modetest_acte_off,#GET{prestas_modetest_acte_off}|push{#VALEUR}}]
</BOUCLE_prestas_modeset_acte>
<B_prestas_modeset_acte_off>
<div class='notice'>
	<a href='[(#URL_ECRIRE{configurer_bank})]'>Cochez l'option</a> <code>«&nbsp;Utiliser en mode TEST (aucun paiement réel)&nbsp;»</code> pour [(#GET{prestas_modetest_off}|count|>{1}|?{"les modes de paiement suivants :","le mode de paiement à l'acte"})]<BOUCLE_prestas_modeset_acte_off(DATA){source table,#GET{prestas_modetest_acte_off}}{','}>[«&nbsp;(#VALEUR)&nbsp;»]</BOUCLE_prestas_modeset_acte_off>
</div>
</B_prestas_modeset_acte_off>
#SET{prestas_modetest_acte_ok,1}
<//B_prestas_modeset_acte_off>

[(#REM) Message pour passer à l'étape suivante si tout est en ordre ]
#SET{ok,#GET{bank_on}|et{#GET{prestas_acte}}|et{#GET{prestas_modetest_acte_ok}}|?{1,''}}
[<div class='verification'>
	(#GET{ok}|?{
		[Tout est en ordre. Passer à l'étape 1 : <a href="(#SELF|parametre_url{etape,produits})" class="lien-etape-suivante">ajouter des objets au panier</a>.],
		"Oups ! Réglez ce qui ne va pas avant de passer à l'étape 1."}
)</div>]
