<BOUCLE_principale (PROJETS_SITES) {id_projets_site}>[(#SET{lesmaj,#ARRAY})]
[(#BOITE_OUVRIR{[
<h2>[(#RANG). ](#TITRE|sinon{<:info_sans_titre:>}) [(#TYPE_SITE|oui)[\((#VAL{projets_site:type_site_}|concat{#TYPE_SITE,'_abbr'}|_T)\)]]</h2>
],simple fiche_objet})]
<textarea class="textarea" cols="100" rows="10">#!/bin/bash
url_local=[(#SERVEUR_PATH)]
<BOUCLE_plugins_site (DATA) {source table, (#LOGICIEL_PLUGINS**|formater_tableau)} {par /0}>[(#SET{plugin,[(#ARRAY{prefixe,[(#VALEUR{prefixe})],titre,[(#VALEUR{titre})], statut,[(#VALEUR{statut})], version,[(#VALEUR{version})]})]})]<BOUCLE_paquet_meme_branche (PAQUETS) {tout} {prefixe=(#GET{plugin/prefixe})} {!par version} {branches_spip LIKE %(#_principale:LOGICIEL_VERSION|version2branche)%} {id_depot>0} {0,1}  {si (#GET{plugin/statut}|=={dist}|non)}>[(#VERSION|=={#_plugins_site:GET{plugin/version}}|non)[(#SET{lesmaj,[(#GET{lesmaj}|push{#PREFIXE})]})]
# Branche [(#_principale:LOGICIEL_NOM)] [(#_principale:LOGICIEL_VERSION|version2branche)]
cd ${url_local}/plugins/
rm -rf [(#PREFIXE|strtolower)/]
]<BOUCLE_archive_mm_branche (DEPOTS) {id_depot} {si (#VERSION|=={#_plugins_site:GET{plugin/version}}|non)}>curl -LOk [(#URL_ARCHIVES)/#_paquet_meme_branche:NOM_ARCHIVE]
unzip [(#_paquet_meme_branche:NOM_ARCHIVE)]
folder=$(zipinfo -1 [(#_paquet_meme_branche:NOM_ARCHIVE)] | head -n 1)
mv "$folder/" "[(#PREFIXE|strtolower)/]"
rm -rf [(#_paquet_meme_branche:NOM_ARCHIVE)]
git add [(#PREFIXE|strtolower)]
git commit -m "Mise à jour du plugin ['(#GET{plugin/titre})'] de la v[(#GET{plugin/version})] à la v[(#_paquet_meme_branche:VERSION)]"
</BOUCLE_archive_mm_branche></BOUCLE_paquet_meme_branche></BOUCLE_plugins_site>
</textarea><br/>
<BOUCLE_lesmaj (DATA) {source table, #GET{lesmaj}}>
#VALEUR </br>
</BOUCLE_lesmaj>
#BOITE_FERMER
</BOUCLE_principale>
