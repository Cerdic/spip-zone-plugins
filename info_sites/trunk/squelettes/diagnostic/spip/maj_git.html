<BOUCLE_principale (PROJETS_SITES) {id_projets_site}>[(#SET{lesmaj,#ARRAY})]
<pre class="pre-scrollable create" id="textbox">#!/bin/bash
url_local=[(#SERVEUR_PATH)]
<BOUCLE_plugins_site (DATA) {source table, (#LOGICIEL_PLUGINS**|formater_tableau{'plugins'})} {par /prefixe}>[(#SET{plugin,[(#ARRAY{prefixe,[(#VALEUR{prefixe})],titre,[(#VALEUR{titre})], statut,[(#VALEUR{statut})], version,[(#VALEUR{version})]})]})]<BOUCLE_paquet_meme_branche (PAQUETS) {tout} {prefixe=(#GET{plugin/prefixe})} {!par version} {branches_spip LIKE %(#_principale:LOGICIEL_VERSION|version2branche)%} {id_depot>0} {0,1}  {si (#GET{plugin/statut}|=={dist}|non)}>[(#VERSION|=={#_plugins_site:GET{plugin/version}}|non)[(#SET{lesmaj,[(#GET{lesmaj}|push{<strong>[(#_plugins_site:GET{plugin/titre})]</strong> <em>\([(#PREFIXE)] [(#_plugins_site:GET{plugin/version})] -> [(#VERSION)]\)</em>})]})]
# Branche [(#_principale:LOGICIEL_NOM)] [(#_principale:LOGICIEL_VERSION|version2branche)]
cd ${url_local}/plugins/
rm -rf [(#PREFIXE|strtolower)/]
]<BOUCLE_archive_mm_branche (DEPOTS) {id_depot} {si (#VERSION|=={#_plugins_site:GET{plugin/version}}|non)}>curl -LOk [(#URL_ARCHIVES)/#_paquet_meme_branche:NOM_ARCHIVE]
unzip [(#_paquet_meme_branche:NOM_ARCHIVE)]
folder=$(zipinfo -1 [(#_paquet_meme_branche:NOM_ARCHIVE)] | head -n 1)
mv "$folder/" "[(#PREFIXE|strtolower)/]"
rm -rf [(#_paquet_meme_branche:NOM_ARCHIVE)]
git add [(#PREFIXE|strtolower)]
git commit -m "Mise à jour du plugin ['(#GET{plugin/titre})'] de la v[(#GET{plugin/version})] à la v[(#_paquet_meme_branche:VERSION)]"
</BOUCLE_archive_mm_branche></BOUCLE_paquet_meme_branche></BOUCLE_plugins_site>
</pre>
	<div class="center-block">
		<div class="pull-right">
			<a download="[(#TITRE|info_sites_nom_machine)].sh" id="downloadlink" class="btn btn-default"><:info_sites:btn_telecharger:></a>
		</div>
		<div class="clearfix"></div>
	</div>
	<B_lesmaj>
		<ol><BOUCLE_lesmaj (DATA) {source table, #GET{lesmaj}}>
			<li>#VALEUR</li></BOUCLE_lesmaj>
		</ol>
	</B_lesmaj>
</BOUCLE_principale>
