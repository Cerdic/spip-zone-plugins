[(#ENV{erreurs}|table_valeur{positionner}|oui)
	<a name="ajax_ancre" href="[(#ENV{erreurs}|table_valeur{positionner})]"></a>
]
<div class="formulaire_spip formulaire_editer formulaire_#ENV{form}">
	[<p class="reponse_formulaire reponse_formulaire_ok">(#ENV*{message_ok})</p>]
	[<p class="reponse_formulaire reponse_formulaire_erreur">(#ENV*{message_erreur})</p>]
	
	<BOUCLE_editable(CONDITION){si #ENV{editable}|oui}>
	<form method='post' action='#ENV{action}' enctype='multipart/form-data'><div>
		[(#REM) declarer les hidden qui declencheront le service du formulaire 
		parametre : url d'action ]
		#ACTION_FORMULAIRE{#ENV{action}}
		
		<ul>
			<BOUCLE_contenu(POUR){tableau #ENV{_contenu}}>
			[(#VAL{explication}|array_key_exists{#VALEUR}|oui)
			[<li>
				<div class="explication">
					(#VALEUR|table_valeur{explication}|saisies_transformer_langue)
				</div>
			</li>]
			]

			[(#VAL{saisie}|array_key_exists{#VALEUR}|oui)
				[(#VALEUR|formidable_generer_saisie_configurable{#ENV**|unserialize})]
			]

			[(#VAL{groupe}|array_key_exists{#VALEUR}|oui)
			#SET{titre, #VALEUR|table_valeur{groupe}}
			#SET{css, #VALEUR|table_valeur{css}}
			#SET{pliable, #VALEUR|table_valeur{pliable}|et{#VALEUR|table_valeur{pliable}|!={non}}|?{'pliable', ''}}
			#SET{plie, #VALEUR|table_valeur{plie}|et{#VALEUR|table_valeur{plie}|!={non}}|?{'plie', ''}}
			#SET{contenu, #VALEUR|table_valeur{contenu}}
			<li class="fieldset[ (#GET{css})]">
				<fieldset>
					[<h3 class="legend">(#GET{titre}|saisies_transformer_langue)</h3>]
		
					[(#GET{contenu}|is_array|oui)
					<ul [class="(#GET{pliable})[ (#GET{plie})]"]>
						#INCLURE{fond=inclure/generer_saisies, env, saisies=#GET{contenu}}
					</ul>
					]
				</fieldset>
			</li>
			]
			</BOUCLE_contenu>
			<li class="aucun"><em class="attention"><:formidable:construire_aucun_champs:></em></li>
			<//B_contenu>
			
			<B_saisies_disponibles>
			<li class="saisies_disponibles">
				<label><:formidable:construire_ajouter_champ:></label>
				<BOUCLE_saisies_disponibles(POUR){tableau #ENV{saisies_disponibles}}>
				<button type="submit" name="ajouter_saisie" value="#CLE" class="submit ajouter_saisie"[ title="(#VALEUR|table_valeur{description})"] [style="background-image:url((#VALEUR|table_valeur{icone}|sinon{#CHEMIN{images/formulaire-saisie-defaut.png}}))"]>
					[(#VALEUR|table_valeur{titre})]
				</button>
				</BOUCLE_saisies_disponibles>
			</li>
			</B_saisies_disponibles>
		</ul>
		
		[(#REM) ajouter les saisies supplementaires : extra et autre, a cet endroit ]
		<!--extra-->
		
		<span class='image_loading'></span>
	</div></form>
	
	<script type="text/javascript">
		$(function(){
			$('.formulaire_construire_formulaire li .actions').addClass('hidden');
			$('.formulaire_construire_formulaire li:has(.actions)')
				.hover(
					function(){
						$(this).find('> .actions').removeClass('hidden');
					},
					function(){
						$(this).find('> .actions').addClass('hidden');
					}
				);
			
			// On lance la création des onglets
			formulaire_configurer_onglets();
		});
		
		function formulaire_configurer_onglets(){
			var formulaire_configurer = $('.formulaire_configurer');
			var onglets = $('<ul class="formulaire_configurer-onglets"></ul>');
			var contenus = formulaire_configurer.find('> ul > li.fieldset');
			
			// On ajoute le conteneur des onglets
			formulaire_configurer
				.prepend(onglets);
			
			// On parcourt les contenus pour générer les onglets
			contenus
				.each(function(i){
					// On ajoute un identifiant et une classe
					$(this)
						.attr('id', 'formulaire_configurer-contenu-'+i)
						.addClass('formulaire_configurer-contenu');
					// On récupère le titre (en le cachant au passage)
					var titre = $(this).find('h3').hide().text();
					// On crée un onglet
					var onglet = $('<li><a href="#formulaire_configurer-contenu-'+i+'">'+titre+'</a></li>');
					onglet
						.click(function(){
							contenus.hide();
							$(
								$(this)
									.siblings()
										.removeClass('actif')
									.end()
									.addClass('actif')
									.find('a')
										.attr('href')
							).show();
							return false;
						});
					
					// On active le premier onglet au démarrage
					if (i == 0) onglet.addClass('actif');
					
					// S'il y a des erreurs dans cette partie du contenu, on met une classe "erreurs" à l'onglet aussi
					if ($(this).find('li.erreur').length > 0)
						onglet.addClass('erreur');
					
					// On ajoute l'onglet
					onglets
						.append(onglet);
				})
				.hide()
				.eq(0)
					.show();
		}
	</script>
	</BOUCLE_editable>
</div>
