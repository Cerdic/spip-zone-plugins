#SET{valeur, #ARRAY}
[(#ENV{defaut}|oui)
  #SET{valeur, #ENV{defaut}}
]
[(#ENV{valeur}|oui)
  #SET{valeur, #ENV{valeur}}
]
<fieldset>
  <legend>#ENV{label}</legend>

  <input type="hidden" name="#ENV{nom}\[permutations\]"
         value="[(#GET{valeur}|count|enumerer|joindre{','})]" />

  <ul id="liste-objets-#ENV{nom}" class="saisie-liste-objets">
    <BOUCLE_liste_objets(DATA) {enum 0, #GET{valeur}|count}>
      #SET{compteur_objets, #COMPTEUR_BOUCLE|moins{1}}
      <li>
        <fieldset>
        <legend>Objet #GET{compteur_objets}</legend>

        [(#ENV{inclure}|oui)
          #INCLURE{fond=#ENV{inclure}}
        ]

        <input type="submit"
               name="#ENV{nom}\[action\]\[monter-#GET{compteur_objets}\]"
               value="Monter"
               class="bouton-monter" />
        <input type="submit"
               name="#ENV{nom}\[action\]\[descendre-#GET{compteur_objets}\]"
               value="Descendre"
               class="bouton-descendre" />
        <ul>
          <BOUCLE_saisies_objet(DATA) {source table, #ENV{saisies}}>

            #SET{saisie, #VALEUR}

            [(#REM) si le tableau ne contient pas de clé "options", on
                    suppose qu'il n'est pas au format de #GENERER_SAISIE.
                    Il faut alors le convertir à ce format. ]
            [(#GET{saisie}|table_valeur{options}|non)
              [(#SET{saisie, #GET{saisie}|preparer_tableau_saisie})]
            ]

            [(#REM) charger les valeurs. ]
            [(#SET{saisie, #GET{saisie}|charger_valeurs{#GET{valeur}, #GET{compteur_objets}}})]

            [(#REM) on renomme les saisies pour les grouper par objet. ]
            [(#SET{saisie, #GET{saisie}|renommer_saisies{#GET{compteur_objets}, #ENV{nom}}})]

            [(#GENERER_SAISIES{#ARRAY{0,#GET{saisie}}})]

          </BOUCLE_saisies_objet>
        </ul>
        <input type="submit"
               name="#ENV{nom}[action][supprimer-#GET{compteur_objets}]"
               value="Supprimer" />
      </fieldset></li>
    </BOUCLE_liste_objets>
  </ul>
  <input type="submit" name="#ENV{nom}[action][ajouter]" value="Ajouter Objet" />
</fieldset>

<script type="text/javascript">
  #INCLURE{fond=inclure/init-saisie-liste-objets.js, nom=#ENV{nom}}
</script>
