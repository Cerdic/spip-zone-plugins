<div class="formulaire_spip formulaire_#FORM">

    [<p class="reponse_formulaire reponse_formulaire_ok">(#ENV*{message_ok})</p>]
    [<p class="reponse_formulaire reponse_formulaire_erreur">(#ENV*{message_erreur})</p>]

    [(#ENV{editable}|oui)
    <form name="formulaire_#FORM" action="#ENV{action}" method="post"><div>
		#ACTION_FORMULAIRE{#ENV{action}}
		<ul>
			<li class="editer_nom_reservation obligatoire[ (#ENV**{erreurs}|table_valeur{nom_reservation}|oui)erreur]">
				<label for="champ_nom_reservation"><:orr:nom_de_la_reservation:></label>
				[<span class='erreur_message'>(#ENV**{erreurs}|table_valeur{nom_reservation})</span>]
				<input type="text" id="champ_nom_reservation" name="nom_reservation" value="[(#ENV{nom_reservation})]" />
				<span class="error-message"></span>
			</li>
            [(#REM)Détermine si c'est une mise à jour ou un ajout
            Si c'est un ajout, choix entre toutes les ressources]
            [(#ENV{idreservation}|?{#SET{affichage_ressource,cachee},#SET{affichage_ressource,visible}})]
            <li class="ressource_#GET{affichage_ressource}">
                [(#ENV{id_ressource}|oui)
                    [(#SAISIE{oui_non, choix_ressource_active, obligatoire}
                    {label=<:orr:ressource_active:>})]
                ]
                [(#SAISIE*{checkbox,liste_ressources}
                    {label=<:orr:liste_ressources:>}
                    {datas=#ENV{liste_ressources}})]
            </li>
			<li class="editer_date_debut obligatoire[ (#ENV**{erreurs}|table_valeur{date_debut}|oui)erreur]">
				<label for="date_debut"><:orr:date_de_debut:></label>
				[<span class='erreur_message'>(#ENV**{erreurs}|table_valeur{date_debut})</span>]
				<input type="text" id="date_debut" class="datepicker" name="date_debut" value="[(#ENV{date_debut})]" />
				<span class="error-message"></span>
			</li>
			<li class="editer_date_fin obligatoire[ (#ENV**{erreurs}|table_valeur{date_fin}|oui)erreur]">
				<label for="date_fin"><:orr:date_de_fin:></label>
				[<span class='erreur_message'>(#ENV**{erreurs}|table_valeur{date_fin})</span>]
				<input type="text" id="date_fin" class="datepicker" name="date_fin" value="[(#ENV{date_fin})]" />
				<span class="error-message"></span>
			</li>

			[(#CONFIG*{champs_extras_spip_orr_reservations}|oui) <INCLURE{fond=inc/formulaire_reservation_champs_extra}{env}>]
		</ul>
		<p class="boutons"> <input type="submit" id="envoyer" class="submit" value="<:bouton_enregistrer:>" /></p>
    </div></form>
    ]
</div>

<script>
    jQuery(function(){
        jQuery('.datepicker').datetimepicker({
            timeFormat: 'hh:mm:ss',
            stepHour: 1,
            stepMinute: 15,
            minuteGrid:15,
            hourGrid:4,
            addSliderAccess: true,
			sliderAccessArgs: { touchonly: false },
			onClose: function(dateText, inst) {
				var endDateTextBox = $('#date_fin');
				if (endDateTextBox.val() != '') {
					var testStartDate = new Date(dateText);
					var testEndDate = new Date(endDateTextBox.val());
					if (testStartDate > testEndDate)
					endDateTextBox.val(dateText);
				}
				else {
					endDateTextBox.val(dateText);
				}
			},
			onSelect: function (selectedDateTime){
				var start = $(this).datetimepicker('getDate');
				$('#date_fin').datetimepicker('option', 'minDate', new Date(start.getTime()));
			}
            });
         jQuery('#date_fin').datetimepicker({
			onClose: function(dateText, inst) {
				var startDateTextBox = $('#date_debut');
				if (startDateTextBox.val() != '') {
					var testStartDate = new Date(startDateTextBox.val());
					var testEndDate = new Date(dateText);
					if (testStartDate > testEndDate)
						startDateTextBox.val(dateText);
				}
				else {
					startDateTextBox.val(dateText);
				}
			},
			onSelect: function (selectedDateTime){
				var end = $(this).datetimepicker('getDate');
				jQuery('#date_debut').datetimepicker('option', 'maxDate', new Date(end.getTime()) );
			}
        });
    });
</script>
