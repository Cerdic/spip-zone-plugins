<div class="formulaire_spip formulaire_#FORM">

    [<p class="reponse_formulaire reponse_formulaire_ok">(#ENV*{message_ok})</p>]
    [<p class="reponse_formulaire reponse_formulaire_erreur">(#ENV*{message_erreur})</p>]

    [(#ENV{editable}|oui)
    <form name="formulaire_#FORM" action="#ENV{action}" method="post"><div>

            #ACTION_FORMULAIRE{#ENV{action}}
            <ul>
                <li class="editer_nom_ressource obligatoire[ (#ENV**{erreurs}|table_valeur{message}|oui)erreur]">
                <label for="champ_nom_ressource"><:nom_ressource:></label>
                [<span class='erreur_message'>(#ENV**{erreurs}|table_valeur{message})</span>]
                <input type="text" id="champ_nom_ressource" name="nom_reservation" value="" />
                <span class="error-message"></span>
                </li>

                <li class="editer_date_debut obligatoire[ (#ENV**{erreurs}|table_valeur{message}|oui)erreur]">
                <label for="date_debut"><:date_de_debut:></label>
                [<span class='erreur_message'>(#ENV**{erreurs}|table_valeur{message})</span>]
                <input type="text" id="date_debut" class="datepicker" name="date_debut" value="[(#ENV{date_debut})]" />
                <span class="error-message"></span>
                </li>

                <li class="editer_date_fin obligatoire[ (#ENV**{erreurs}|table_valeur{message}|oui)erreur]">
                <label for="date_fin"><:date_de_fin:></label>
                [<span class='erreur_message'>(#ENV**{erreurs}|table_valeur{message})</span>]
                <input type="text" id="date_fin" class="datepicker" name="date_fin" value="[(#ENV{date_fin})]" />
                <span class="error-message"></span>
                </li>
            </ul>
            <p class="boutons"> <input type="submit" id="envoyer" class="submit" value="<:bouton_enregistrer:>" />
            </p>
    </div></form>
    ]
</div>

<script>
    $(function(){
        var datepickers = $('.datepicker').datetimepicker({
            timeFormat: 'hh:mm:ss',
            stepHour: 1,
            stepMinute: 15,
            minuteGrid:15,
            hourGrid:4,
            // bloque les minDate des datepickers en fonction de la date entrée dans l'un deux deux datepickers (debut ou fin)
            onSelect: function(date){
                var option = this.id == 'date_debut' ? 'minDate' : 'maxDate';
                datepickers.not('#'+this.id).datepicker('option',option,date);
            }
        });
        // action de controle du formulaire lorsque l'on clique sur le bouton envoyé
        $('#envoyer').click(function(){
            var valid     = true;
            var datedebut = $("#date_debut").val();
            var datefin   = $("#date_fin").val();
            // Les verifications :
            // Pour le champ nom, vérifie sa présence
            if ($("#champ_nom_ressource").val() == ""){
                $("#champ_nom_ressource").css("border-color","#FF0000");
                $("#champ_nom_ressource").next(".error-message").css("color","#FF0000").html("X  Il faut remplir ce champ !!");
                valid = false;
            }
            else{
                $("#champ_nom_ressource").css("border-color","#04F935");
                $("#champ_nom_ressource").next(".error-message").html("");

            }
            // Pour le champ date_debut, vérifie sa présence
            if ($("#date_debut").val() == ""){
                $("#date_debut").css("border-color","#FF0000");
                $("#date_debut").next(".error-message").css("color","#FF0000").html("X  Il faut remplir ce champ !!");
                valid = false;
            }
            else{
                $("#date_debut").css("border-color","#04F935");
                $("#date_debut").next(".error-message").html("");

            }
            // Pour le champ date_fin, vérifie sa présence
            if ($("#date_fin").val() == ""){
                $("#date_fin").css("border-color","#FF0000");
                $("#date_fin").next(".error-message").css("color","#FF0000").html("X  Il faut remplir ce champ !!");
                valid = false;
            }
            else{
                // vérifie que date_fin soit postérieur à date_debut
                if (datedebut > datefin){
                    $("#date_fin").css("border-color","#FF0000");
                    $("#date_fin").next(".error-message").css("color","#FF0000").html("X mauvaise date !!");
                    valid = false;
                }
                else{
                    $("#date_fin").css("border-color","#04F935");
                    $("#date_fin").next(".error-message").html("");
                }
            }
            return valid;
        });
    });
</script>
