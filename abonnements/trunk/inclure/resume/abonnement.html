[(#REM)

	Présentation résumée d'un abonnement et de l'offre associée.

	Si on trouve une commande liée à l'abonnement,
	on prend certaines infos dans cette dernière en priorité,
	car ça peut différer de ce qu'il y a dans l'offre (prix, durée, etc).
	**Important** : la commande est supposée ne comprendre que l'offre d'abonnement.

	On affiche les informations suivantes :
	- Logo et titre de l'offre
	- Infos techniques de l'abo : prix, dates...
	- Descriptif de l'offre

	Paramètres :
	**obligatoire

	- **id_abonnement
	- masquer : tableau d'éléments à masquer
							logo | descriptif
	- class : classe ajoutée au conteneur

]
[(#REM) L'offre d'abonnement liée ]
<BOUCLE_offre(ABONNEMENTS_OFFRES abonnements) {id_abonnement} {tout}>
#SET{offre,#ARRAY{
	logo,           #LOGO_ABONNEMENTS_OFFRE|extraire_attribut{src},
	titre,          #TITRE,
	prix,           #PRIX*,
	renouvellement, #RENOUVELLEMENT_AUTO,
	periode,        #PERIODE,
	duree,          #DUREE,
	descriptif,     #DESCRIPTIF,
}}
</BOUCLE_offre>

[(#REM) L'éventuelle commande liée ]
<BOUCLE_commande(COMMANDES?) {id_abonnement} {tout} {si #ENV{commande}|non}>
#SET{commande,#ARRAY{
	prix,           #PRIX*,
	reference,      #REFERENCE,
	periode,        #ECHEANCES_TYPE|replace{annee,an},
	renouvellement, #ECHEANCES_TYPE|?{on},
}}
</BOUCLE_commande>

[(#REM) L'abonnement lui-même ]
<BOUCLE_abonnement(ABONNEMENTS) {id_abonnement} {statut?}>
[(#REM) Infos sur l'abonnement : prendre en priorité dans la commande éventuelle ]
#SET{prix,           #GET{commande/prix}|sinon{#GET{offre/prix}}}
#SET{renouvellement, #GET{commande}|?{#GET{commande/renouvellement},#GET{offre/renouvellement}}}
#SET{periode,        #GET{commande/periode}|sinon{#GET{offre/periode}}}
#SET{duree,          #GET{offre/duree}}
#SET{actif,          #PUBLIE}
#SET{statut,         #STATUT}

<article class="abonnement abonnement_resume[ abonnement_(#GET{statut})][ (#GET{renouvellement}|oui)abonnement_renouvelable][ (#ENV{class}|attribut_html)]" id="abonnement_#ID_ABONNEMENT">

	[(#REM) Logo ]
	[(#VAL{logo}|in_any{#ENV{masquer}}|non)
	[<header class="abonnement__header">
		(#GET{offre/logo}|balise_img{'','abonnement__logo spip_logo'})
	</header>]
	]

	[(#REM) Ttire, infos techniques, descriptif ]
	<div class="abonnement__content">

		[<h3 class="abonnement__titre">
			(#GET{offre/titre})
		</h3>]

		<div class="abonnement__infos">

			[(#REM) Commande liée éventuelle ]
			<div class="abonnement__info abonnement__info_commande">
				[<strong class="label"><:commandes:commande_titre:></strong>
				<span class="valeur">
					<span class="reference">(#GET{commande/reference})</span>
				</span>]
			</div>

			[(#REM) Montant et période éventuelle ]
			<div class="abonnement__info abonnement__info_prix">
				<strong class="label"><:abonnement:label_montant:></strong>
				<span class="valeur">
					[<span class="montant">(#GET{prix}|prix_formater)</span>]
					[(#GET{renouvellement}|oui)
						<span class="par">/</span>
						<span class="periode">[(#VAL{abonnementsoffre:champ_periode_choix_#GET{periode}}|_T)]</span>
					]
				</span>
			</div>

			[(#REM) Durée / renouvellement ]
			<div class="abonnement__info abonnement__info_duree">
				<strong class="label"><:abonnement:label_duree:></strong>
				<span class="valeur">
					[(#GET{renouvellement}|?{
						<span class="renouvellement"><:abonnementsoffre:info_renouvellement_auto:></span>[ <span class="sep">-</span> (#DATE_FIN|intval|oui)<span class="date_fin">[(#VAL{abonnement:info_date_fin}|_T{#ARRAY{date,#DATE_FIN|affdate}})]</span>],
						<span class="duree">[(#GET{duree}|abonnements_afficher_duree{#GET{periode}})]</span>
					})]
				</span>
			</div>

			[(#REM) Dates ]
			<div class="abonnement__info abonnement__info_dates">
				<strong class="label"><:abonnement:label_dates:></strong>
				<span class="valeur">
					[(#GET{renouvellement}|et{#GET{actif}}|?{
						[<span class="dates dates_debut"><:abonnement:label_date_depuis:> (#DATE_DEBUT|affdate)</span>],
						[<span class="dates dates_debut-fin">(#DATE_DEBUT|affdate_debut_fin{#DATE_FIN})</span>]
					})]
				</span>
			</div>

			[(#REM) Statut ]
			<div class="abonnement__info abonnement__info_statut[ abonnement__info_statut_(#GET{statut})]">
				<strong class="label"><:abonnement:label_statut:></strong>
				<span class="valeur">
					[<span class="statut">(#GET{actif}|?{
						<:abonnement:statut_actif|ucfirst:>,
						<:abonnement:statut_inactif|ucfirst:>
					})</span>]
				</span>
			</div>

		</div>

		[(#VAL{descriptif}|in_any{#ENV{masquer}}|non)
		[<div class="abonnement__descriptif">
			(#GET{offre/descriptif})
		</div>]
		]
	</div>

	[(#REM) Footer : boutons, liens... ]
	[<footer class="abonnement__footer">
		(#INCLURE{fond=inclure/resume/inc-abonnement_footer, env})
	</footer>]

</article>
</BOUCLE_abonnement>
