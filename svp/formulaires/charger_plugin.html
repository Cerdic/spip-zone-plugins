<div class="formulaire_spip formulaire_charger_plugin" id="formulaire_charger_plugin">
	<h3 class="titrem">[(#CHEMIN_IMAGE{ajouter_plugin-24.gif}|balise_img{icone ajouter_plugin-24,cadre-icone})]<:plugin_titre_automatique_ajouter:></h3>

	[<p class="reponse_formulaire reponse_formulaire_erreur">(#ENV*{message_erreur})</p>]
	[<p class="reponse_formulaire reponse_formulaire_ok">(#ENV*{message_ok})</p>]
<BOUCLE_depot_existe(DEPOTS) {0,1}>
	<form method="post" action="#ENV{action}">


		[<div class="reponse_formulaire reponse_formulaire_erreur">
			(#ENV**{erreurs}|table_valeur{decideur_erreurs}|foreach)
		</div>]

        [<div id="charger_plugin_confirm">
			
            [<div class="reponse_formulaire reponse_formulaire_ok">
                <strong>Demande :</strong>
                <ul>(#ENV**{erreurs}|table_valeur{decideur_demandes}|foreach)</ul>
            </div>]
            [<div class="reponse_formulaire reponse_formulaire_ok">
                <strong>Propositions :</strong>
                <ul>(#ENV**{erreurs}|table_valeur{decideur_propositions}|foreach)</ul>
            </div>]
            <div class="reponse_formulaire reponse_formulaire_ok">
                <strong>Actions :</strong>
                <ul>(#ENV**{erreurs}|table_valeur{decideur_actions}|foreach)</ul>
            </div>
            <p class="boutons">
                <input type="submit" name="annuler_actions" class="submit annuler_actions" value="<:bouton_annuler:>" />
                <input type="submit" name="valider_actions" class="submit valider_actions" value="<:bouton_valider:>" />
            </p>
            <script type="text/javascript">
				[(#REM)
					Fonctionnement du JS.
						- overlayClose // pas de click en dehors des éléments prévus
						
						- onComplete   // le chargement et fait : si l'on clique les boutons du formulaire
									   // mis dans la modale, on leur ajoute une classe 'fire'
									   // et on lance la fermeture de la boite

						- onCleanup    // avant la fermeture... on verifie que 'fire' est bien là
									   // sinon c'est qu'on a appuyé ESC ou cliqué X
									   // dans ce cas on met 'fire' sur annuler

						- onClose	   // apres la fermeture, on clique le bouton ayant 'fire'
								
				]
                <!--
                (function($){
                    $(function(){
						if ($.modalbox !== 'undefined') {
							
							$.modalboxload('#charger_plugin_confirm', {
								overlayClose: false, // pas de click en dehors
								onComplete: function() {
									$('#cboxLoadedContent .boutons .submit').click(function(){
										$(this).addClass('fire'); $.mediaboxClose();
									});
								},
								onCleanup: function() {
									if (!$('#charger_plugin_confirm .boutons .submit.fire').length) {
										$('#charger_plugin_confirm .boutons .submit.annuler_actions').addClass('fire');
									}
								},
								onClose: function() { $('#charger_plugin_confirm .submit.fire').click(); }
							});
						}
                    });
                })(jQuery);
                -->
            </script>
        </div>]
        
		[(#REM) <!-- declarer les hidden qui declencheront le service du formulaire
		parametre : url d'action --> ]
		#ACTION_FORMULAIRE{#ENV{action}}
		<input type="hidden" name="_todo" class='hidden' value="[(#ENV{_todo})]" />

		<div>
			<fieldset>
				<legend><:svp:legende_rechercher_plugins:></legend>
				<p class="explication"><:svp:info_charger_plugin{version=#SPIP_VERSION}:></p>
				<ul>
					<li class="editer_phrase obligatoire[(#ENV{erreurs}|table_valeur{phrase}|oui) erreur]">
						<label for="phrase"><:svp:label_critere_phrase:></label>
						<p class="explication"><:svp:info_critere_phrase:></p>
						[<span class="erreur_message">(#ENV{erreurs}|table_valeur{phrase})</span>]
						<input type="text" name="phrase" id="phrase" value="#ENV{phrase}" class="text" />
					</li>
					<li class="editer_categorie obligatoire[(#ENV{erreurs}|table_valeur{categorie}|oui) erreur]">
						<label for="categorie"><:svp:label_critere_categorie:></label>
						[<span class="erreur_message">(#ENV{erreurs}|table_valeur{categorie})</span>]
						<INCLURE{fond=formulaires/inc-select_categorie, categorie=#ENV{categorie}, env} />
					</li>
					<li class="editer_etat obligatoire[(#ENV{erreurs}|table_valeur{etat}|oui) erreur]">
						<label for="etat"><:svp:label_critere_etat:></label>
						[<span class="erreur_message">(#ENV{erreurs}|table_valeur{etat})</span>]
						<select name="etat" id="etat">
							<option value="tout_etat"[ (#ENV{etat,stable}|=={tout_etat}|oui)selected="selected"]><:svp:option_etat_tout:></option>
							<option value="stable"[ (#ENV{etat,stable}|=={stable}|oui)selected="selected"]><:plugin_etat_stable|ucfirst:></option>
							<option value="test"[ (#ENV{etat,stable}|=={test}|oui)selected="selected"]><:plugin_etat_test|ucfirst:></option>
							<option value="dev"[ (#ENV{etat,stable}|=={dev}|oui)selected="selected"]><:plugin_etat_developpement|ucfirst:></option>
							<option value="experimental"[ (#ENV{etat,stable}|=={experimental}|oui)selected="selected"]><:plugin_etat_experimental|ucfirst:></option>
						</select>
					</li>
					<li class="editer_depot obligatoire[(#ENV{erreurs}|table_valeur{depot}|oui) erreur]">
						<label for="depot"><:svp:label_critere_depot:></label>
						[<span class="erreur_message">(#ENV{erreurs}|table_valeur{depot})</span>]
						<INCLURE{fond=formulaires/inc-select_depot, env} />
					</li>
					<li class="editer_doublon obligatoire[(#ENV{erreurs}|table_valeur{doublon}|oui) erreur]">
						<label for="doublon"><:svp:label_critere_doublon:></label>
						[<span class="erreur_message">(#ENV{erreurs}|table_valeur{doublon})</span>]
						<select name="doublon" id="doublon">
							<option value="non"[ (#ENV{doublon}|=={non}|oui)selected="selected"]><:svp:option_doublon_non:></option>
							<option value="oui"[ (#ENV{doublon}|=={oui}|oui)selected="selected"]><:svp:option_doublon_oui:></option>
						</select>
					</li>
				</ul>
			</fieldset>

		<p class="boutons"><input type="submit" name="rechercher" class="submit" value="<:info_rechercher:>" /></p>
		</div>

		[(#ENV{phrase}|ou{#ENV{depot}}|ou{#ENV{categorie}}|ou{#ENV{etat}|ou{#ENV{doublon}}}|oui)
		<div class="liste-plugins">
			<fieldset>
				<legend><:svp:legende_installer_plugins:></legend>
				<INCLURE{fond=formulaires/inc-plugins_trouves, plugins=#ENV*{message_ok}|table_valeur{plugins}, env} />
			</fieldset>
			<p class="boutons" style="display:none"><input type="submit" name="installer" class="submit" value="<:svp:bouton_installer:>" /></p>
		</div>]
	</form>
</BOUCLE_depot_existe>
	#BOITE_OUVRIR{'','notice'}
		<p><:svp:message_nok_aucun_depot_disponible:></p>
	#BOITE_FERMER
<//B_depot_existe>
</div>
