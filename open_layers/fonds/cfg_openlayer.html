#CACHE{0}

<!-- titre=Open Layers API-->
<!-- descriptif=
<h4>Configuration du plugin Open Layers</h4>
-->

<div class="formulaire_spip formulaire_editer formulaire_cfg">
<div id="formMap" name="formMap" style="width: 470px; height: 350px;margin:10px auto;"></div>
<script type="text/javascript">
/*<![CDATA[*/
	var map = null;
	OpenLayers.Control.Click = OpenLayers.Class(OpenLayers.Control, {
		defaultHandlerOptions: {
			'single': true,
			'double': false,
			'pixelTolerance': 1000,
			'stopSingle': false,
			'stopDouble': false
		},

		initialize: function(options) {
			this.handlerOptions = OpenLayers.Util.extend(
				{}, this.defaultHandlerOptions
			);
			OpenLayers.Control.prototype.initialize.apply(
				this, arguments
			); 
			this.handler = new OpenLayers.Handler.Click(
				this, {
					'click': this.trigger
				}, this.handlerOptions
			);
		}, 

		trigger: function(e) {
			var lonlat = map.getCenter();
			var zoom = map.getZoom();
			jQuery("#latitude").val(lonlat.fromDisplayToData().lat);
			jQuery("#longitude").val(lonlat.fromDisplayToData().lon);
			jQuery("#zoom").val(zoom);
		}

	});
	function init(){
		map = new OpenLayers.Map("formMap",{
			maxExtent: new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34),
			numZoomLevels: 19,
			maxResolution: 156543.0399,
			units: "m",
			projection: new OpenLayers.Projection("EPSG:900913"),
			displayProjection: new OpenLayers.Projection("EPSG:4326")
		});
		var lon = #CONFIG*{openlayer/longitude,0.0};
		var lat = #CONFIG*{openlayer/latitude,0.0};
		var zoom = #CONFIG*{openlayer/zoom,0};
		var lonlat = new OpenLayers.LonLat(lon, lat);
		var wms = new OpenLayers.Layer.WMS(
			"#CONFIG{openlayer/nom_serveur_openlayer,OpenLayers WMS}",
			"#CONFIG{openlayer/url_script_openlayer,http://labs.metacarta.com/wms/vmap0}",
			{layers: 'basic'}
		);
		var nasa = new OpenLayers.Layer.WMS( "NASA Global Mosaic",
			"http://t1.hypercube.telascience.org/cgi-bin/landsat7", 
			{layers: "landsat7"}
		);
		var osm = new OpenLayers.Layer.OSM.Osmarender("Osmarender");
		map.addLayers([osm, nasa, wms]);
		map.zoomTo(zoom);
		map.setCenter(lonlat.fromDataToDisplay());
		map.addControl(new OpenLayers.Control.LayerSwitcher());
		var click = new OpenLayers.Control.Click();
		map.addControl(click);
		click.activate();

	}
	function showAddress(address) {
		//no funciona con el servidor de geonames da un error XMLHttpRequest
		var lon = "";
		var lat = "";
		$.getJSON("http://ws.geonames.org/searchJSON?maxRows=1&q='" + address + "'", function(data){
			$.each(data.geonames, function(i,geoname){
				lon = geoname.lng;
				lat = geoname.lat;
			});
		});
		var lonlat = new OpenLayers.LonLat(lon, lat);
		map.setCenter(lonlat);
		return false;
	}
	$(document).ready(function(){
		init();
	});
/*]]>*/
</script>


<form method="post"><div>
	[(#ENV{_cfg_}|form_hidden)]
	<ul>
		<li class="editer_nom_serveur_openlayer">
			<label for="nom_serveur_openlayer"><:openlayer:nom_serveur_openlayer:></label>
			<input type="text" name="nom_serveur_openlayer" class="text" value="#ENV*{nom_serveur_openlayer,OpenLayers WMS}" id="nom_serveur_openlayer" />
		</li>
		<li class="editer_url_script_openlayer">
			<label for="url_script_openlayer"><:openlayer:url_script_openlayer:></label>
			<input type="text" name="url_script_openlayer" class="text" value="#ENV*{url_script_openlayer,http://labs.metacarta.com/wms/vmap0}" id="url_script_openlayer" />
		</li>
		<li class="editer_latitude_openlayer">
			<label for="latitude"><:openlayer:latitude:></label>
			<input type="text" name="latitude" class="text" value="#ENV*{latitude,0.0}" id="latitude" />
		</li>
		<li class="editer_longitude_openlayer">
			<label for="longitude"><:openlayer:longitude:></label>
			<input type="text" name="longitude" class="text" value="#ENV*{longitude,0.0}" id="longitude" />
		</li>
		<li class="editer_zoom_openlayer">
			<label for="zoom"><:openlayer:zoom:></label>
			<input type="text" name="zoom" class="text" value="#ENV*{zoom,0}" id="zoom" />
		</li>
	</ul>
	<p class="boutons">
		<input type="submit" name="_cfg_ok" class="submit" value="<:valider:>" />
		<input type="submit" name="_cfg_delete" class="submit" value="<:effacer:>" />
	</p>
</div></form>
</div>
#CFG_ARBO{openlayer}
